<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.09.29"/>
        <title>mypy 1.6.0+dev.7141d6bcff9e26e774e88712015ca6bbe8307c9e.dirty documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="_static/_static/css/badge_only.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="#"><div class="brand">mypy</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="#">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/mypy_light.svg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">mypy</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">First steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-getting_started">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cheat_sheet_py3">Type hints cheat sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-existing_code">Using mypy with an existing codebase</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Type system reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-builtin_types">Built-in types</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-type_inference_and_annotations">Type inference and type annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-kinds_of_types">Kinds of types</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-class_basics">Class basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-runtime_troubles">Annotation issues at runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-protocols">Protocols and structural subtyping</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-dynamic_typing">Dynamically typed code</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-type_narrowing">Type narrowing</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-duck_type_compatibility">Duck type compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-stubs">Stub files</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-generics">Generics</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-more_types">More types</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-literal_types">Literal types and Enums</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-typed_dict">TypedDict</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-final_attrs">Final names, methods and classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-metaclasses">Metaclasses</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuring and running mypy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-running_mypy">Running mypy and managing imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-command_line">The mypy command line</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-config_file">The mypy configuration file</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-inline_config">Inline configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-mypy_daemon">Mypy daemon (mypy server)</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-installed_packages">Using installed packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-extending_mypy">Extending and integrating mypy</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-stubgen">Automatic stub generation (stubgen)</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-stubtest">Automatic stub testing (stubtest)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-common_issues">Common issues and solutions</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-supported_python_features">Supported Python features</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-error_codes">Error codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-error_code_list">Error codes enabled by default</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-error_code_list2">Error codes for optional checks</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-additional_features">Additional features</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-faq">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/python/mypy">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://mypy-lang.org/">Website</a></li>
</ul>

</div>

<div
  id="furo-sidebar-ad-placement"
  class="flat"
  data-ea-publisher="readthedocs"
  data-ea-type="readthedocs-sidebar"
  data-ea-manual="true"
></div>
</div>

<div id="furo-readthedocs-versions" class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions" tabindex="0">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book">&nbsp;</span>
    v: latest
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Versions</dt>
      
        <dd><a href="/en/latest/">latest</a></dd>
      
        <dd><a href="/en/stable/">stable</a></dd>
      
    </dl>
    <dl>
      <dt>Downloads</dt>
      
        <dd><a href="//mypy.readthedocs.io/_/downloads/en/latest/pdf/">pdf</a></dd>
      
        <dd><a href="//mypy.readthedocs.io/_/downloads/en/latest/htmlzip/">html</a></dd>
      
        <dd><a href="//mypy.readthedocs.io/_/downloads/en/latest/epub/">epub</a></dd>
      
    </dl>
    <dl>
      
      <dt>On Read the Docs</dt>
        <dd>
          <a href="//readthedocs.org/projects/mypy/?fromdocs=mypy">Project Home</a>
        </dd>
        <dd>
          <a href="//readthedocs.org/builds/mypy/?fromdocs=mypy">Builds</a>
        </dd>
    </dl>
  </div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="welcome-to-mypy-documentation">
<h1>Welcome to mypy documentation!<a class="headerlink" href="#welcome-to-mypy-documentation" title="Permalink to this headline">#</a></h1>
<p>Mypy is a static type checker for Python.</p>
<p>Type checkers help ensure that you’re using variables and functions in your code
correctly. With mypy, add type hints (<span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a>)
to your Python programs, and mypy will warn you when you use those types
incorrectly.</p>
<p>Python is a dynamic language, so usually you’ll only see errors in your code
when you attempt to run it. Mypy is a <em>static</em> checker, so it finds bugs
in your programs without even running them!</p>
<p>Here is a small example to whet your appetite:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">number</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;What is your favourite number?&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;It is&quot;</span><span class="p">,</span> <span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># error: Unsupported operand types for + (&quot;str&quot; and &quot;int&quot;)</span>
</pre></div>
</div>
<p>Adding type hints for mypy does not interfere with the way your program would
otherwise run. Think of type hints as similar to comments! You can always use
the Python interpreter to run your code, even if mypy reports errors.</p>
<p>Mypy is designed with gradual typing in mind. This means you can add type
hints to your code base slowly and that you can always fall back to dynamic
typing when static typing is not convenient.</p>
<p>Mypy has a powerful and easy-to-use type system, supporting features such as
type inference, generics, callable types, tuple types, union types,
structural subtyping and more. Using mypy will make your programs easier to
understand, debug, and maintain.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although mypy is production ready, there may be occasional changes
that break backward compatibility. The mypy development team tries to
minimize the impact of changes to user code. In case of a major breaking
change, mypy’s major version will be bumped.</p>
</div>
<section id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">#</a></h2>
<div class="toctree-wrapper compound">
<span id="document-getting_started"></span><section id="getting-started">
<span id="id1"></span><h3>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">#</a></h3>
<p>This chapter introduces some core concepts of mypy, including function
annotations, the <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> module, stub files, and more.</p>
<p>If you’re looking for a quick intro, see the
<a class="reference internal" href="index.html#cheat-sheet-py3"><span class="std std-ref">mypy cheatsheet</span></a>.</p>
<p>If you’re unfamiliar with the concepts of static and dynamic type checking,
be sure to read this chapter carefully, as the rest of the documentation
may not make much sense otherwise.</p>
<section id="installing-and-running-mypy">
<h4>Installing and running mypy<a class="headerlink" href="#installing-and-running-mypy" title="Permalink to this headline">#</a></h4>
<p>Mypy requires Python 3.8 or later to run.  You can install mypy using pip:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>mypy
</pre></div>
</div>
<p>Once mypy is installed, run it by using the <code class="docutils literal notranslate"><span class="pre">mypy</span></code> tool:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>mypy<span class="w"> </span>program.py
</pre></div>
</div>
<p>This command makes mypy <em>type check</em> your <code class="docutils literal notranslate"><span class="pre">program.py</span></code> file and print
out any errors it finds. Mypy will type check your code <em>statically</em>: this
means that it will check for errors without ever running your code, just
like a linter.</p>
<p>This also means that you are always free to ignore the errors mypy reports,
if you so wish. You can always use the Python interpreter to run your code,
even if mypy reports errors.</p>
<p>However, if you try directly running mypy on your existing Python code, it
will most likely report little to no errors. This is a feature! It makes it
easy to adopt mypy incrementally.</p>
<p>In order to get useful diagnostics from mypy, you must add <em>type annotations</em>
to your code. See the section below for details.</p>
</section>
<section id="dynamic-vs-static-typing">
<span id="getting-started-dynamic-vs-static"></span><h4>Dynamic vs static typing<a class="headerlink" href="#dynamic-vs-static-typing" title="Permalink to this headline">#</a></h4>
<p>A function without type annotations is considered to be <em>dynamically typed</em> by mypy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;Hello &#39;</span> <span class="o">+</span> <span class="n">name</span>
</pre></div>
</div>
<p>By default, mypy will <strong>not</strong> type check dynamically typed functions. This means
that with a few exceptions, mypy will not report any errors with regular unannotated Python.</p>
<p>This is the case even if you misuse the function!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;Hello &#39;</span> <span class="o">+</span> <span class="n">name</span>

<span class="c1"># These calls will fail when the program run, but mypy does not report an error</span>
<span class="c1"># because &quot;greeting&quot; does not have type annotations.</span>
<span class="n">greeting</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">greeting</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Alice&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can get mypy to detect these kinds of bugs by adding <em>type annotations</em> (also
known as <em>type hints</em>). For example, you can tell mypy that <code class="docutils literal notranslate"><span class="pre">greeting</span></code> both accepts
and returns a string like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The &quot;name: str&quot; annotation says that the &quot;name&quot; argument should be a string</span>
<span class="c1"># The &quot;-&gt; str&quot; annotation says that &quot;greeting&quot; will return a string</span>
<span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s1">&#39;Hello &#39;</span> <span class="o">+</span> <span class="n">name</span>
</pre></div>
</div>
<p>This function is now <em>statically typed</em>: mypy will use the provided type hints
to detect incorrect use of the <code class="docutils literal notranslate"><span class="pre">greeting</span></code> function and incorrect use of
variables within the <code class="docutils literal notranslate"><span class="pre">greeting</span></code> function. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s1">&#39;Hello &#39;</span> <span class="o">+</span> <span class="n">name</span>

<span class="n">greeting</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>         <span class="c1"># Argument 1 to &quot;greeting&quot; has incompatible type &quot;int&quot;; expected &quot;str&quot;</span>
<span class="n">greeting</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Alice&#39;</span><span class="p">)</span>  <span class="c1"># Argument 1 to &quot;greeting&quot; has incompatible type &quot;bytes&quot;; expected &quot;str&quot;</span>
<span class="n">greeting</span><span class="p">(</span><span class="s2">&quot;World!&quot;</span><span class="p">)</span>  <span class="c1"># No error</span>

<span class="k">def</span> <span class="nf">bad_greeting</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s1">&#39;Hello &#39;</span> <span class="o">*</span> <span class="n">name</span>  <span class="c1"># Unsupported operand types for * (&quot;str&quot; and &quot;str&quot;)</span>
</pre></div>
</div>
<p>Being able to pick whether you want a function to be dynamically or statically
typed can be very helpful. For example, if you are migrating an existing
Python codebase to use static types, it’s usually easier to migrate by incrementally
adding type hints to your code rather than adding them all at once. Similarly,
when you are prototyping a new feature, it may be convenient to initially implement
the code using dynamic typing and only add type hints later once the code is more stable.</p>
<p>Once you are finished migrating or prototyping your code, you can make mypy warn you
if you add a dynamic function by mistake by using the <a class="reference internal" href="index.html#cmdoption-mypy-disallow-untyped-defs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-untyped-defs</span></code></a>
flag. You can also get mypy to provide some limited checking of dynamically typed
functions by using the <a class="reference internal" href="index.html#cmdoption-mypy-check-untyped-defs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--check-untyped-defs</span></code></a> flag.
See <a class="reference internal" href="index.html#command-line"><span class="std std-ref">The mypy command line</span></a> for more information on configuring mypy.</p>
</section>
<section id="strict-mode-and-configuration">
<h4>Strict mode and configuration<a class="headerlink" href="#strict-mode-and-configuration" title="Permalink to this headline">#</a></h4>
<p>Mypy has a <em>strict mode</em> that enables a number of additional checks,
like <a class="reference internal" href="index.html#cmdoption-mypy-disallow-untyped-defs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-untyped-defs</span></code></a>.</p>
<p>If you run mypy with the <a class="reference internal" href="index.html#cmdoption-mypy-strict"><code class="xref std std-option docutils literal notranslate"><span class="pre">--strict</span></code></a> flag, you
will basically never get a type related error at runtime without a corresponding
mypy error, unless you explicitly circumvent mypy somehow.</p>
<p>However, this flag will probably be too aggressive if you are trying
to add static types to a large, existing codebase. See <a class="reference internal" href="index.html#existing-code"><span class="std std-ref">Using mypy with an existing codebase</span></a>
for suggestions on how to handle that case.</p>
<p>Mypy is very configurable, so you can start with using <code class="docutils literal notranslate"><span class="pre">--strict</span></code>
and toggle off individual checks. For instance, if you use many third
party libraries that do not have types,
<a class="reference internal" href="index.html#cmdoption-mypy-ignore-missing-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--ignore-missing-imports</span></code></a>
may be useful. See <a class="reference internal" href="index.html#getting-to-strict"><span class="std std-ref">Introduce stricter options</span></a> for how to build up to <code class="docutils literal notranslate"><span class="pre">--strict</span></code>.</p>
<p>See <a class="reference internal" href="index.html#command-line"><span class="std std-ref">The mypy command line</span></a> and <a class="reference internal" href="index.html#config-file"><span class="std std-ref">The mypy configuration file</span></a> for a complete reference on
configuration options.</p>
</section>
<section id="more-complex-types">
<h4>More complex types<a class="headerlink" href="#more-complex-types" title="Permalink to this headline">#</a></h4>
<p>So far, we’ve added type hints that use only basic concrete types like
<code class="docutils literal notranslate"><span class="pre">str</span></code> and <code class="docutils literal notranslate"><span class="pre">float</span></code>. What if we want to express more complex types,
such as “a list of strings” or “an iterable of ints”?</p>
<p>For example, to indicate that some function can accept a list of
strings, use the <code class="docutils literal notranslate"><span class="pre">list[str]</span></code> type (Python 3.9 and later):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">greet_all</span><span class="p">(</span><span class="n">names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello &#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="s2">&quot;Charlie&quot;</span><span class="p">]</span>
<span class="n">ages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>

<span class="n">greet_all</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>   <span class="c1"># Ok!</span>
<span class="n">greet_all</span><span class="p">(</span><span class="n">ages</span><span class="p">)</span>    <span class="c1"># Error due to incompatible types</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> type is an example of something called a <em>generic type</em>: it can
accept one or more <em>type parameters</em>. In this case, we <em>parameterized</em> <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a>
by writing <code class="docutils literal notranslate"><span class="pre">list[str]</span></code>. This lets mypy know that <code class="docutils literal notranslate"><span class="pre">greet_all</span></code> accepts specifically
lists containing strings, and not lists containing ints or any other type.</p>
<p>In the above examples, the type signature is perhaps a little too rigid.
After all, there’s no reason why this function must accept <em>specifically</em> a list –
it would run just fine if you were to pass in a tuple, a set, or any other custom iterable.</p>
<p>You can express this idea using <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">collections.abc.Iterable</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>  <span class="c1"># or &quot;from typing import Iterable&quot;</span>

<span class="k">def</span> <span class="nf">greet_all</span><span class="p">(</span><span class="n">names</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello &#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>This behavior is actually a fundamental aspect of the PEP 484 type system: when
we annotate some variable with a type <code class="docutils literal notranslate"><span class="pre">T</span></code>, we are actually telling mypy that
variable can be assigned an instance of <code class="docutils literal notranslate"><span class="pre">T</span></code>, or an instance of a <em>subtype</em> of <code class="docutils literal notranslate"><span class="pre">T</span></code>.
That is, <code class="docutils literal notranslate"><span class="pre">list[str]</span></code> is a subtype of <code class="docutils literal notranslate"><span class="pre">Iterable[str]</span></code>.</p>
<p>This also applies to inheritance, so if you have a class <code class="docutils literal notranslate"><span class="pre">Child</span></code> that inherits from
<code class="docutils literal notranslate"><span class="pre">Parent</span></code>, then a value of type <code class="docutils literal notranslate"><span class="pre">Child</span></code> can be assigned to a variable of type <code class="docutils literal notranslate"><span class="pre">Parent</span></code>.
For example, a <code class="docutils literal notranslate"><span class="pre">RuntimeError</span></code> instance can be passed to a function that is annotated
as taking an <code class="docutils literal notranslate"><span class="pre">Exception</span></code>.</p>
<p>As another example, suppose you want to write a function that can accept <em>either</em>
ints or strings, but no other types. You can express this using the
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a> type. For example, <code class="docutils literal notranslate"><span class="pre">int</span></code> is a subtype of <code class="docutils literal notranslate"><span class="pre">Union[int,</span> <span class="pre">str]</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="k">def</span> <span class="nf">normalize_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;user-</span><span class="si">{</span><span class="mi">100_000</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">user_id</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">user_id</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> module contains many other useful types.</p>
<p>For a quick overview, look through the <a class="reference internal" href="index.html#cheat-sheet-py3"><span class="std std-ref">mypy cheatsheet</span></a>.</p>
<p>For a detailed overview (including information on how to make your own
generic types or your own type aliases), look through the
<a class="reference internal" href="index.html#overview-type-system-reference"><span class="std std-ref">type system reference</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When adding types, the convention is to import types
using the form <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">typing</span> <span class="pre">import</span> <span class="pre">Union</span></code> (as opposed to doing
just <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">typing</span></code> or <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">typing</span> <span class="pre">as</span> <span class="pre">t</span></code> or <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">typing</span> <span class="pre">import</span> <span class="pre">*</span></code>).</p>
<p>For brevity, we often omit imports from <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#module-collections.abc" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">collections.abc</span></code></a>
in code examples, but mypy will give an error if you use types such as
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a> without first importing them.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In some examples we use capitalized variants of types, such as
<code class="docutils literal notranslate"><span class="pre">List</span></code>, and sometimes we use plain <code class="docutils literal notranslate"><span class="pre">list</span></code>. They are equivalent,
but the prior variant is needed if you are using Python 3.8 or earlier.</p>
</div>
</section>
<section id="local-type-inference">
<h4>Local type inference<a class="headerlink" href="#local-type-inference" title="Permalink to this headline">#</a></h4>
<p>Once you have added type hints to a function (i.e. made it statically typed),
mypy will automatically type check that function’s body. While doing so,
mypy will try and <em>infer</em> as many details as possible.</p>
<p>We saw an example of this in the <code class="docutils literal notranslate"><span class="pre">normalize_id</span></code> function above – mypy understands
basic <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance</span></code></a> checks and so can infer that the <code class="docutils literal notranslate"><span class="pre">user_id</span></code> variable was of
type <code class="docutils literal notranslate"><span class="pre">int</span></code> in the if-branch and of type <code class="docutils literal notranslate"><span class="pre">str</span></code> in the else-branch.</p>
<p>As another example, consider the following function. Mypy can type check this function
without a problem: it will use the available context and deduce that <code class="docutils literal notranslate"><span class="pre">output</span></code> must be
of type <code class="docutils literal notranslate"><span class="pre">list[float]</span></code> and that <code class="docutils literal notranslate"><span class="pre">num</span></code> must be of type <code class="docutils literal notranslate"><span class="pre">float</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">nums_below</span><span class="p">(</span><span class="n">numbers</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
<p>For more details, see <a class="reference internal" href="index.html#type-inference-and-annotations"><span class="std std-ref">Type inference and type annotations</span></a>.</p>
</section>
<section id="types-from-libraries">
<h4>Types from libraries<a class="headerlink" href="#types-from-libraries" title="Permalink to this headline">#</a></h4>
<p>Mypy can also understand how to work with types from libraries that you use.</p>
<p>For instance, mypy comes out of the box with an intimate knowledge of the
Python standard library. For example, here is a function which uses the
<code class="docutils literal notranslate"><span class="pre">Path</span></code> object from the
<a class="reference external" href="https://docs.python.org/3/library/pathlib.html">pathlib standard library module</a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span> <span class="nf">load_template</span><span class="p">(</span><span class="n">template_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># Mypy knows that `template_path` has a `read_text` method that returns a str</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">template_path</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
    <span class="c1"># ...so it understands this line type checks</span>
    <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;USERNAME&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>If a third party library you use <a class="reference internal" href="index.html#installed-packages"><span class="std std-ref">declares support for type checking</span></a>,
mypy will type check your use of that library based on the type hints
it contains.</p>
<p>However, if the third party library does not have type hints, mypy will
complain about missing type information.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>prog.py:1: error: Library stubs not installed for &quot;yaml&quot;
prog.py:1: note: Hint: &quot;python3 -m pip install types-PyYAML&quot;
prog.py:2: error: Library stubs not installed for &quot;requests&quot;
prog.py:2: note: Hint: &quot;python3 -m pip install types-requests&quot;
...
</pre></div>
</div>
<p>In this case, you can provide mypy a different source of type information,
by installing a <em>stub</em> package. A stub package is a package that contains
type hints for another library, but no actual code.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>types-PyYAML<span class="w"> </span>types-requests
</pre></div>
</div>
<p>Stubs packages for a distribution are often named <code class="docutils literal notranslate"><span class="pre">types-&lt;distribution&gt;</span></code>.
Note that a distribution name may be different from the name of the package that
you import. For example, <code class="docutils literal notranslate"><span class="pre">types-PyYAML</span></code> contains stubs for the <code class="docutils literal notranslate"><span class="pre">yaml</span></code>
package.</p>
<p>For more discussion on strategies for handling errors about libraries without
type information, refer to <a class="reference internal" href="index.html#fix-missing-imports"><span class="std std-ref">Missing imports</span></a>.</p>
<p>For more information about stubs, see <a class="reference internal" href="index.html#stub-files"><span class="std std-ref">Stub files</span></a>.</p>
</section>
<section id="next-steps">
<h4>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">#</a></h4>
<p>If you are in a hurry and don’t want to read lots of documentation
before getting started, here are some pointers to quick learning
resources:</p>
<ul class="simple">
<li><p>Read the <a class="reference internal" href="index.html#cheat-sheet-py3"><span class="std std-ref">mypy cheatsheet</span></a>.</p></li>
<li><p>Read <a class="reference internal" href="index.html#existing-code"><span class="std std-ref">Using mypy with an existing codebase</span></a> if you have a significant existing
codebase without many type annotations.</p></li>
<li><p>Read the <a class="reference external" href="https://blog.zulip.org/2016/10/13/static-types-in-python-oh-mypy/">blog post</a>
about the Zulip project’s experiences with adopting mypy.</p></li>
<li><p>If you prefer watching talks instead of reading, here are
some ideas:</p>
<ul>
<li><p>Carl Meyer:
<a class="reference external" href="https://www.youtube.com/watch?v=pMgmKJyWKn8">Type Checked Python in the Real World</a>
(PyCon 2018)</p></li>
<li><p>Greg Price:
<a class="reference external" href="https://www.youtube.com/watch?v=0c46YHS3RY8">Clearer Code at Scale: Static Types at Zulip and Dropbox</a>
(PyCon 2018)</p></li>
</ul>
</li>
<li><p>Look at <a class="reference internal" href="index.html#common-issues"><span class="std std-ref">solutions to common issues</span></a> with mypy if
you encounter problems.</p></li>
<li><p>You can ask questions about mypy in the
<a class="reference external" href="https://github.com/python/mypy/issues">mypy issue tracker</a> and
typing <a class="reference external" href="https://gitter.im/python/typing">Gitter chat</a>.</p></li>
<li><p>For general questions about Python typing, try posting at
<a class="reference external" href="https://github.com/python/typing/discussions">typing discussions</a>.</p></li>
</ul>
<p>You can also continue reading this document and skip sections that
aren’t relevant for you. You don’t need to read sections in order.</p>
</section>
</section>
<span id="document-cheat_sheet_py3"></span><section id="type-hints-cheat-sheet">
<span id="cheat-sheet-py3"></span><h3>Type hints cheat sheet<a class="headerlink" href="#type-hints-cheat-sheet" title="Permalink to this headline">#</a></h3>
<p>This document is a quick cheat sheet showing how to use type
annotations for various common types in Python.</p>
<section id="variables">
<h4>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">#</a></h4>
<p>Technically many of the type annotations shown below are redundant,
since mypy can usually infer the type of a variable from its value.
See <a class="reference internal" href="index.html#type-inference-and-annotations"><span class="std std-ref">Type inference and type annotations</span></a> for more details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is how you declare the type of a variable</span>
<span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># You don&#39;t need to initialize a variable to annotate it</span>
<span class="n">a</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Ok (no value at runtime until assigned)</span>

<span class="c1"># Doing so can be useful in conditional branches</span>
<span class="n">child</span><span class="p">:</span> <span class="nb">bool</span>
<span class="k">if</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">:</span>
    <span class="n">child</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">child</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</section>
<section id="useful-built-in-types">
<h4>Useful built-in types<a class="headerlink" href="#useful-built-in-types" title="Permalink to this headline">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># For most types, just use the name of the type in the annotation</span>
<span class="c1"># Note that mypy can usually infer the type of a variable from its value,</span>
<span class="c1"># so technically these annotations are redundant</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;test&quot;</span>

<span class="c1"># For collections on Python 3.9+, the type of the collection item is in brackets</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">}</span>

<span class="c1"># For mappings, we need the types of both keys and values</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">}</span>  <span class="c1"># Python 3.9+</span>

<span class="c1"># For tuples of fixed size, we specify the types of all the elements</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">)</span>  <span class="c1"># Python 3.9+</span>

<span class="c1"># For tuples of variable size, we use one type and ellipsis</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># Python 3.9+</span>

<span class="c1"># On Python 3.8 and earlier, the name of the collection type is</span>
<span class="c1"># capitalized, and the type is imported from the &#39;typing&#39; module</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="n">x</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">}</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">}</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">)</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>

<span class="c1"># On Python 3.10+, use the | operator when something could be one of a few types</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;fun&quot;</span><span class="p">]</span>  <span class="c1"># Python 3.10+</span>
<span class="c1"># On earlier versions, use Union</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;fun&quot;</span><span class="p">]</span>

<span class="c1"># Use Optional[X] for a value that could be None</span>
<span class="c1"># Optional[X] is the same as X | None or Union[X, None]</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;something&quot;</span> <span class="k">if</span> <span class="n">some_condition</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
<span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Mypy understands x won&#39;t be None here because of the if-statement</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
<span class="c1"># If you know a value can never be None due to some logic that mypy doesn&#39;t</span>
<span class="c1"># understand, use an assert</span>
<span class="k">assert</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="functions">
<h4>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>

<span class="c1"># This is how you annotate a function definition</span>
<span class="k">def</span> <span class="nf">stringify</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="c1"># And here&#39;s how you specify multiple arguments</span>
<span class="k">def</span> <span class="nf">plus</span><span class="p">(</span><span class="n">num1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num2</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span>

<span class="c1"># If a function does not return a value, use None as the return type</span>
<span class="c1"># Default value for an argument goes after the type annotation</span>
<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">excitement</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="s2">&quot;!&quot;</span> <span class="o">*</span> <span class="n">excitement</span><span class="p">)</span>

<span class="c1"># Note that arguments without a type are dynamically typed (treated as Any)</span>
<span class="c1"># and that functions without any annotations are not checked</span>
<span class="k">def</span> <span class="nf">untyped</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span><span class="o">.</span><span class="n">anything</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="s2">&quot;string&quot;</span>  <span class="c1"># no errors</span>

<span class="c1"># This is how you annotate a callable (function) value</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
<span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="c1"># A generator function that yields ints is secretly just a function that</span>
<span class="c1"># returns an iterator of ints, so that&#39;s how we annotate it</span>
<span class="k">def</span> <span class="nf">gen</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">i</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1"># You can of course split a function annotation over multiple lines</span>
<span class="k">def</span> <span class="nf">send_email</span><span class="p">(</span><span class="n">address</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
               <span class="n">sender</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
               <span class="n">cc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
               <span class="n">bcc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
               <span class="n">subject</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
               <span class="n">body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
               <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="o">...</span>

<span class="c1"># Mypy understands positional-only and keyword-only arguments</span>
<span class="c1"># Positional-only arguments can also be marked by using a name starting with</span>
<span class="c1"># two underscores</span>
<span class="k">def</span> <span class="nf">quux</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="n">quux</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Ok</span>
<span class="n">quux</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># error: Too many positional arguments for &quot;quux&quot;</span>
<span class="n">quux</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># error: Unexpected keyword argument &quot;x&quot; for &quot;quux&quot;</span>

<span class="c1"># This says each positional arg and each keyword arg is a &quot;str&quot;</span>
<span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;tuple[str, ...]&quot;</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;dict[str, str]&quot;</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_api_query</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="classes">
<h4>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BankAccount</span><span class="p">:</span>
    <span class="c1"># The &quot;__init__&quot; method doesn&#39;t return anything, so it gets return</span>
    <span class="c1"># type &quot;None&quot; just like any other method that doesn&#39;t return anything</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">initial_balance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># mypy will infer the correct types for these instance variables</span>
        <span class="c1"># based on the types of the parameters.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">account_name</span> <span class="o">=</span> <span class="n">account_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">initial_balance</span>

    <span class="c1"># For instance methods, omit type for &quot;self&quot;</span>
    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>

<span class="c1"># User-defined classes are valid as types in annotations</span>
<span class="n">account</span><span class="p">:</span> <span class="n">BankAccount</span> <span class="o">=</span> <span class="n">BankAccount</span><span class="p">(</span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">transfer</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="n">BankAccount</span><span class="p">,</span> <span class="n">dst</span><span class="p">:</span> <span class="n">BankAccount</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">src</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
    <span class="n">dst</span><span class="o">.</span><span class="n">deposit</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>

<span class="c1"># Functions that accept BankAccount also accept any subclass of BankAccount!</span>
<span class="k">class</span> <span class="nc">AuditedBankAccount</span><span class="p">(</span><span class="n">BankAccount</span><span class="p">):</span>
    <span class="c1"># You can optionally declare instance variables in the class body</span>
    <span class="n">audit_log</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">initial_balance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">initial_balance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audit_log</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audit_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deposited </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audit_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Withdrew </span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>

<span class="n">audited</span> <span class="o">=</span> <span class="n">AuditedBankAccount</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">transfer</span><span class="p">(</span><span class="n">audited</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># type checks!</span>

<span class="c1"># You can use the ClassVar annotation to declare a class variable</span>
<span class="k">class</span> <span class="nc">Car</span><span class="p">:</span>
    <span class="n">seats</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">passengers</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>

<span class="c1"># If you want dynamic attributes on your class, have it</span>
<span class="c1"># override &quot;__setattr__&quot; or &quot;__getattr__&quot;</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="c1"># This will allow assignment to any A.x, if x is the same type as &quot;value&quot;</span>
    <span class="c1"># (use &quot;value: Any&quot; to allow arbitrary types)</span>
    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

    <span class="c1"># This will allow access to any A.x, if x is compatible with the return type</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>

<span class="n">a</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="mi">42</span>  <span class="c1"># Works</span>
<span class="n">a</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="s1">&#39;Ex-parrot&#39;</span>  <span class="c1"># Fails type checking</span>
</pre></div>
</div>
</section>
<section id="when-you-re-puzzled-or-when-things-are-complicated">
<h4>When you’re puzzled or when things are complicated<a class="headerlink" href="#when-you-re-puzzled-or-when-things-are-complicated" title="Permalink to this headline">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">cast</span>

<span class="c1"># To find out what type mypy infers for an expression anywhere in</span>
<span class="c1"># your program, wrap it in reveal_type().  Mypy will print an error</span>
<span class="c1"># message with the type; remove it again before running the code.</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;builtins.int&quot;</span>

<span class="c1"># If you initialize a variable with an empty container or &quot;None&quot;</span>
<span class="c1"># you may have to help mypy a bit by providing an explicit type annotation</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Use Any if you don&#39;t know the type of something or it&#39;s too</span>
<span class="c1"># dynamic to write a type for</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">mystery_function</span><span class="p">()</span>
<span class="c1"># Mypy will let you do anything with x!</span>
<span class="n">x</span><span class="o">.</span><span class="n">whatever</span><span class="p">()</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;you&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">(</span><span class="s2">&quot;want&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">super</span>  <span class="c1"># no errors</span>

<span class="c1"># Use a &quot;type: ignore&quot; comment to suppress errors on a given line,</span>
<span class="c1"># when your code confuses mypy or runs into an outright bug in mypy.</span>
<span class="c1"># Good practice is to add a comment explaining the issue.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">confusing_function</span><span class="p">()</span>  <span class="c1"># type: ignore  # confusing_function won&#39;t return None here because ...</span>

<span class="c1"># &quot;cast&quot; is a helper function that lets you override the inferred</span>
<span class="c1"># type of an expression. It&#39;s only for mypy -- there&#39;s no runtime check.</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span>  <span class="c1"># Passes fine</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span>  <span class="c1"># Passes fine despite being a lie (no runtime check)</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;builtins.list[builtins.str]&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># Still prints [4] ... the object is not changed or casted at runtime</span>

<span class="c1"># Use &quot;TYPE_CHECKING&quot; if you want to have code that mypy can see but will not</span>
<span class="c1"># be executed at runtime (or to have code that mypy can&#39;t see)</span>
<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">orjson</span> <span class="k">as</span> <span class="nn">json</span>  <span class="c1"># mypy is unaware of this</span>
</pre></div>
</div>
<p>In some cases type annotations can cause issues at runtime, see
<a class="reference internal" href="index.html#runtime-troubles"><span class="std std-ref">Annotation issues at runtime</span></a> for dealing with this.</p>
<p>See <a class="reference internal" href="index.html#silencing-type-errors"><span class="std std-ref">Silencing type errors</span></a> for details on how to silence errors.</p>
</section>
<section id="standard-duck-types">
<h4>Standard “duck types”<a class="headerlink" href="#standard-duck-types" title="Permalink to this headline">#</a></h4>
<p>In typical Python code, many functions that can take a list or a dict
as an argument only need their argument to be somehow “list-like” or
“dict-like”.  A specific meaning of “list-like” or “dict-like” (or
something-else-like) is called a “duck type”, and several duck types
that are common in idiomatic Python are standardized.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">MutableMapping</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Iterable</span>

<span class="c1"># Use Iterable for generic iterables (anything usable in &quot;for&quot;),</span>
<span class="c1"># and Sequence where a sequence (supporting &quot;len&quot; and &quot;__getitem__&quot;) is</span>
<span class="c1"># required</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">ints</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ints</span><span class="p">]</span>

<span class="n">f</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># Mapping describes a dict-like object (with &quot;__getitem__&quot;) that we won&#39;t</span>
<span class="c1"># mutate, and MutableMapping one (with &quot;__setitem__&quot;) that we might</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">my_mapping</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="n">my_mapping</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;maybe&#39;</span>  <span class="c1"># mypy will complain about this line...</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">my_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">f</span><span class="p">({</span><span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">my_mapping</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="n">my_mapping</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;maybe&#39;</span>  <span class="c1"># ...but mypy is OK with this.</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">my_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="n">f</span><span class="p">({</span><span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;no&#39;</span><span class="p">})</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">IO</span>

<span class="c1"># Use IO[str] or IO[bytes] for functions that should accept or return</span>
<span class="c1"># objects that come from an open() call (note that IO does not</span>
<span class="c1"># distinguish between reading, writing or other modes)</span>
<span class="k">def</span> <span class="nf">get_sys_IO</span><span class="p">(</span><span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IO</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
</pre></div>
</div>
<p>You can even make your own duck types using <a class="reference internal" href="index.html#protocol-types"><span class="std std-ref">Protocols and structural subtyping</span></a>.</p>
</section>
<section id="forward-references">
<h4>Forward references<a class="headerlink" href="#forward-references" title="Permalink to this headline">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># You may want to reference a class before it is defined.</span>
<span class="c1"># This is known as a &quot;forward reference&quot;.</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">foo</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># This will fail at runtime with &#39;A&#39; is not defined</span>
    <span class="o">...</span>

<span class="c1"># However, if you add the following special import:</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="c1"># It will work at runtime and type checking will succeed as long as there</span>
<span class="c1"># is a class of that name later on in the file</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">foo</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># Ok</span>
    <span class="o">...</span>

<span class="c1"># Another option is to just put the type in quotes</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">foo</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># Also ok</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="c1"># This can also come up if you need to reference a class in a type</span>
    <span class="c1"># annotation inside the definition of that class</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#forward-references"><span class="std std-ref">Class name forward references</span></a> for more details.</p>
</section>
<section id="decorators">
<h4>Decorators<a class="headerlink" href="#decorators" title="Permalink to this headline">#</a></h4>
<p>Decorator functions can be expressed via generics. See
<a class="reference internal" href="index.html#declaring-decorators"><span class="std std-ref">Declaring decorators</span></a> for more details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">bare_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">F</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">F</span><span class="p">:</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">decorator_args</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">F</span><span class="p">],</span> <span class="n">F</span><span class="p">]:</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="coroutines-and-asyncio">
<h4>Coroutines and asyncio<a class="headerlink" href="#coroutines-and-asyncio" title="Permalink to this headline">#</a></h4>
<p>See <a class="reference internal" href="index.html#async-and-await"><span class="std std-ref">Typing async/await</span></a> for the full detail on typing coroutines and asynchronous code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="c1"># A coroutine is typed like a normal function</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">while</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;T-minus </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="s2">&quot;Blastoff!&quot;</span>
</pre></div>
</div>
</section>
</section>
<span id="document-existing_code"></span><section id="using-mypy-with-an-existing-codebase">
<span id="existing-code"></span><h3>Using mypy with an existing codebase<a class="headerlink" href="#using-mypy-with-an-existing-codebase" title="Permalink to this headline">#</a></h3>
<p>This section explains how to get started using mypy with an existing,
significant codebase that has little or no type annotations. If you are
a beginner, you can skip this section.</p>
<section id="start-small">
<h4>Start small<a class="headerlink" href="#start-small" title="Permalink to this headline">#</a></h4>
<p>If your codebase is large, pick a subset of your codebase (say, 5,000 to 50,000
lines) and get mypy to run successfully only on this subset at first, <em>before
adding annotations</em>. This should be doable in a day or two. The sooner you get
some form of mypy passing on your codebase, the sooner you benefit.</p>
<p>You’ll likely need to fix some mypy errors, either by inserting
annotations requested by mypy or by adding <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code>
comments to silence errors you don’t want to fix now.</p>
<p>We’ll mention some tips for getting mypy passing on your codebase in various
sections below.</p>
</section>
<section id="run-mypy-consistently-and-prevent-regressions">
<h4>Run mypy consistently and prevent regressions<a class="headerlink" href="#run-mypy-consistently-and-prevent-regressions" title="Permalink to this headline">#</a></h4>
<p>Make sure all developers on your codebase run mypy the same way.
One way to ensure this is adding a small script with your mypy
invocation to your codebase, or adding your mypy invocation to
existing tools you use to run tests, like <code class="docutils literal notranslate"><span class="pre">tox</span></code>.</p>
<ul class="simple">
<li><p>Make sure everyone runs mypy with the same options. Checking a mypy
<a class="reference internal" href="index.html#config-file"><span class="std std-ref">configuration file</span></a> into your codebase can help
with this.</p></li>
<li><p>Make sure everyone type checks the same set of files. See
<a class="reference internal" href="index.html#specifying-code-to-be-checked"><span class="std std-ref">Specifying code to be checked</span></a> for details.</p></li>
<li><p>Make sure everyone runs mypy with the same version of mypy, for instance
by pinning mypy with the rest of your dev requirements.</p></li>
</ul>
<p>In particular, you’ll want to make sure to run mypy as part of your
Continuous Integration (CI) system as soon as possible. This will
prevent new type errors from being introduced into your codebase.</p>
<p>A simple CI script could look something like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>python3 -m pip install mypy==0.971
# Run your standardised mypy invocation, e.g.
mypy my_project
# This could also look like `scripts/run_mypy.sh`, `tox run -e mypy`, `make mypy`, etc
</pre></div>
</div>
</section>
<section id="ignoring-errors-from-certain-modules">
<h4>Ignoring errors from certain modules<a class="headerlink" href="#ignoring-errors-from-certain-modules" title="Permalink to this headline">#</a></h4>
<p>By default mypy will follow imports in your code and try to check everything.
This means even if you only pass in a few files to mypy, it may still process a
large number of imported files. This could potentially result in lots of errors
you don’t want to deal with at the moment.</p>
<p>One way to deal with this is to ignore errors in modules you aren’t yet ready to
type check. The <a class="reference internal" href="index.html#confval-ignore_errors"><code class="xref std std-confval docutils literal notranslate"><span class="pre">ignore_errors</span></code></a> option is useful for this, for instance,
if you aren’t yet ready to deal with errors from <code class="docutils literal notranslate"><span class="pre">package_to_fix_later</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[mypy-package_to_fix_later.*]
ignore_errors = True
</pre></div>
</div>
<p>You could even invert this, by setting <code class="docutils literal notranslate"><span class="pre">ignore_errors</span> <span class="pre">=</span> <span class="pre">True</span></code> in your global
config section and only enabling error reporting with <code class="docutils literal notranslate"><span class="pre">ignore_errors</span> <span class="pre">=</span> <span class="pre">False</span></code>
for the set of modules you are ready to type check.</p>
</section>
<section id="fixing-errors-related-to-imports">
<h4>Fixing errors related to imports<a class="headerlink" href="#fixing-errors-related-to-imports" title="Permalink to this headline">#</a></h4>
<p>A common class of error you will encounter is errors from mypy about modules
that it can’t find, that don’t have types, or don’t have stub files:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>core/config.py:7: error: Cannot find implementation or library stub for module named &#39;frobnicate&#39;
core/model.py:9: error: Cannot find implementation or library stub for module named &#39;acme&#39;
...
</pre></div>
</div>
<p>Sometimes these can be fixed by installing the relevant packages or
stub libraries in the environment you’re running <code class="docutils literal notranslate"><span class="pre">mypy</span></code> in.</p>
<p>See <a class="reference internal" href="index.html#ignore-missing-imports"><span class="std std-ref">Missing imports</span></a> for a complete reference on these errors
and the ways in which you can fix them.</p>
<p>You’ll likely find that you want to suppress all errors from importing
a given module that doesn’t have types. If you only import that module
in one or two places, you can use <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comments. For example,
here we ignore an error about a third-party module <code class="docutils literal notranslate"><span class="pre">frobnicate</span></code> that
doesn’t have stubs using <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">frobnicate</span>  <span class="c1"># type: ignore</span>
<span class="o">...</span>
<span class="n">frobnicate</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>  <span class="c1"># OK (but not checked)</span>
</pre></div>
</div>
<p>But if you import the module in many places, this becomes unwieldy. In this
case, we recommend using a <a class="reference internal" href="index.html#config-file"><span class="std std-ref">configuration file</span></a>. For example,
to disable errors about importing <code class="docutils literal notranslate"><span class="pre">frobnicate</span></code> and <code class="docutils literal notranslate"><span class="pre">acme</span></code> everywhere in your
codebase, use a config like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[mypy-frobnicate.*]
ignore_missing_imports = True

[mypy-acme.*]
ignore_missing_imports = True
</pre></div>
</div>
<p>If you get a large number of errors, you may want to ignore all errors
about missing imports, for instance by setting <a class="reference internal" href="index.html#confval-ignore_missing_imports"><code class="xref std std-confval docutils literal notranslate"><span class="pre">ignore_missing_imports</span></code></a>
to true globally. This can hide errors later on, so we recommend avoiding this
if possible.</p>
<p>Finally, mypy allows fine-grained control over specific import following
behaviour. It’s very easy to silently shoot yourself in the foot when playing
around with these, so it’s mostly recommended as a last resort. For more
details, look <a class="reference internal" href="index.html#follow-imports"><span class="std std-ref">here</span></a>.</p>
</section>
<section id="prioritise-annotating-widely-imported-modules">
<h4>Prioritise annotating widely imported modules<a class="headerlink" href="#prioritise-annotating-widely-imported-modules" title="Permalink to this headline">#</a></h4>
<p>Most projects have some widely imported modules, such as utilities or
model classes. It’s a good idea to annotate these pretty early on,
since this allows code using these modules to be type checked more
effectively.</p>
<p>Mypy is designed to support gradual typing, i.e. letting you add annotations at
your own pace, so it’s okay to leave some of these modules unannotated. The more
you annotate, the more useful mypy will be, but even a little annotation
coverage is useful.</p>
</section>
<section id="write-annotations-as-you-go">
<h4>Write annotations as you go<a class="headerlink" href="#write-annotations-as-you-go" title="Permalink to this headline">#</a></h4>
<p>Consider adding something like these in your code style
conventions:</p>
<ol class="arabic simple">
<li><p>Developers should add annotations for any new code.</p></li>
<li><p>It’s also encouraged to write annotations when you modify existing code.</p></li>
</ol>
<p>This way you’ll gradually increase annotation coverage in your
codebase without much effort.</p>
</section>
<section id="automate-annotation-of-legacy-code">
<h4>Automate annotation of legacy code<a class="headerlink" href="#automate-annotation-of-legacy-code" title="Permalink to this headline">#</a></h4>
<p>There are tools for automatically adding draft annotations based on simple
static analysis or on type profiles collected at runtime.  Tools include
<a class="reference external" href="https://monkeytype.readthedocs.io/en/latest/index.html" title="(in MonkeyType v23.3.1)"><span>MonkeyType</span></a>, <a class="reference external" href="https://github.com/JelleZijlstra/autotyping">autotyping</a> and <a class="reference external" href="https://github.com/dropbox/pyannotate">PyAnnotate</a>.</p>
<p>A simple approach is to collect types from test runs. This may work
well if your test coverage is good (and if your tests aren’t very
slow).</p>
<p>Another approach is to enable type collection for a small, random
fraction of production network requests.  This clearly requires more
care, as type collection could impact the reliability or the
performance of your service.</p>
</section>
<section id="introduce-stricter-options">
<span id="getting-to-strict"></span><h4>Introduce stricter options<a class="headerlink" href="#introduce-stricter-options" title="Permalink to this headline">#</a></h4>
<p>Mypy is very configurable. Once you get started with static typing, you may want
to explore the various strictness options mypy provides to catch more bugs. For
example, you can ask mypy to require annotations for all functions in certain
modules to avoid accidentally introducing code that won’t be type checked using
<a class="reference internal" href="index.html#confval-disallow_untyped_defs"><code class="xref std std-confval docutils literal notranslate"><span class="pre">disallow_untyped_defs</span></code></a>. Refer to <a class="reference internal" href="index.html#config-file"><span class="std std-ref">The mypy configuration file</span></a> for the details.</p>
<p>An excellent goal to aim for is to have your codebase pass when run against <code class="docutils literal notranslate"><span class="pre">mypy</span> <span class="pre">--strict</span></code>.
This basically ensures that you will never have a type related error without an explicit
circumvention somewhere (such as a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment).</p>
<p>The following config is equivalent to <code class="docutils literal notranslate"><span class="pre">--strict</span></code> (as of mypy 1.0):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Start off with these
warn_unused_configs = True
warn_redundant_casts = True
warn_unused_ignores = True

# Getting these passing should be easy
strict_equality = True
strict_concatenate = True

# Strongly recommend enabling this one as soon as you can
check_untyped_defs = True

# These shouldn&#39;t be too much additional work, but may be tricky to
# get passing if you use a lot of untyped libraries
disallow_subclassing_any = True
disallow_untyped_decorators = True
disallow_any_generics = True

# These next few are various gradations of forcing use of type annotations
disallow_untyped_calls = True
disallow_incomplete_defs = True
disallow_untyped_defs = True

# This one isn&#39;t too hard to get passing, but return on investment is lower
no_implicit_reexport = True

# This one can be tricky to get passing if you use a lot of untyped libraries
warn_return_any = True
</pre></div>
</div>
<p>Note that you can also start with <code class="docutils literal notranslate"><span class="pre">--strict</span></code> and subtract, for instance:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>strict = True
warn_return_any = False
</pre></div>
</div>
<p>Remember that many of these options can be enabled on a per-module basis. For instance,
you may want to enable <code class="docutils literal notranslate"><span class="pre">disallow_untyped_defs</span></code> for modules which you’ve completed
annotations for, in order to prevent new code from being added without annotations.</p>
<p>And if you want, it doesn’t stop at <code class="docutils literal notranslate"><span class="pre">--strict</span></code>. Mypy has additional checks
that are not part of <code class="docutils literal notranslate"><span class="pre">--strict</span></code> that can be useful. See the complete
<a class="reference internal" href="index.html#command-line"><span class="std std-ref">The mypy command line</span></a> reference and <a class="reference internal" href="index.html#error-codes-optional"><span class="std std-ref">Error codes for optional checks</span></a>.</p>
</section>
<section id="speed-up-mypy-runs">
<h4>Speed up mypy runs<a class="headerlink" href="#speed-up-mypy-runs" title="Permalink to this headline">#</a></h4>
<p>You can use <a class="reference internal" href="index.html#mypy-daemon"><span class="std std-ref">mypy daemon</span></a> to get much faster
incremental mypy runs. The larger your project is, the more useful
this will be.  If your project has at least 100,000 lines of code or
so, you may also want to set up <a class="reference internal" href="index.html#remote-cache"><span class="std std-ref">remote caching</span></a>
for further speedups.</p>
</section>
</section>
</div>
<div class="toctree-wrapper compound" id="overview-type-system-reference">
<span id="document-builtin_types"></span><section id="built-in-types">
<h3>Built-in types<a class="headerlink" href="#built-in-types" title="Permalink to this headline">#</a></h3>
<p>This chapter introduces some commonly used built-in types. We will
cover many other kinds of types later.</p>
<section id="simple-types">
<h4>Simple types<a class="headerlink" href="#simple-types" title="Permalink to this headline">#</a></h4>
<p>Here are examples of some common built-in types:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 72%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p>integer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">float</span></code></p></td>
<td><p>floating point number</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p>boolean value (subclass of <code class="docutils literal notranslate"><span class="pre">int</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">str</span></code></p></td>
<td><p>text, sequence of unicode codepoints</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bytes</span></code></p></td>
<td><p>8-bit string, sequence of byte values</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">object</span></code></p></td>
<td><p>an arbitrary object (<code class="docutils literal notranslate"><span class="pre">object</span></code> is the common base class)</p></td>
</tr>
</tbody>
</table>
</div>
<p>All built-in classes can be used as types.</p>
</section>
<section id="any-type">
<h4>Any type<a class="headerlink" href="#any-type" title="Permalink to this headline">#</a></h4>
<p>If you can’t find a good type for some value, you can always fall back
to <code class="docutils literal notranslate"><span class="pre">Any</span></code>:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Any</span></code></p></td>
<td><p>dynamically typed value with an arbitrary type</p></td>
</tr>
</tbody>
</table>
</div>
<p>The type <code class="docutils literal notranslate"><span class="pre">Any</span></code> is defined in the <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> module.
See <a class="reference internal" href="index.html#dynamic-typing"><span class="std std-ref">Dynamically typed code</span></a> for more details.</p>
</section>
<section id="generic-types">
<h4>Generic types<a class="headerlink" href="#generic-types" title="Permalink to this headline">#</a></h4>
<p>In Python 3.9 and later, built-in collection type objects support
indexing:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">list[str]</span></code></p></td>
<td><p>list of <code class="docutils literal notranslate"><span class="pre">str</span></code> objects</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">tuple[int,</span> <span class="pre">int]</span></code></p></td>
<td><p>tuple of two <code class="docutils literal notranslate"><span class="pre">int</span></code> objects (<code class="docutils literal notranslate"><span class="pre">tuple[()]</span></code> is the empty tuple)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">tuple[int,</span> <span class="pre">...]</span></code></p></td>
<td><p>tuple of an arbitrary number of <code class="docutils literal notranslate"><span class="pre">int</span></code> objects</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dict[str,</span> <span class="pre">int]</span></code></p></td>
<td><p>dictionary from <code class="docutils literal notranslate"><span class="pre">str</span></code> keys to <code class="docutils literal notranslate"><span class="pre">int</span></code> values</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Iterable[int]</span></code></p></td>
<td><p>iterable object containing ints</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Sequence[bool]</span></code></p></td>
<td><p>sequence of booleans (read-only)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Mapping[str,</span> <span class="pre">int]</span></code></p></td>
<td><p>mapping from <code class="docutils literal notranslate"><span class="pre">str</span></code> keys to <code class="docutils literal notranslate"><span class="pre">int</span></code> values (read-only)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">type[C]</span></code></p></td>
<td><p>type object of <code class="docutils literal notranslate"><span class="pre">C</span></code> (<code class="docutils literal notranslate"><span class="pre">C</span></code> is a class/type variable/union of types)</p></td>
</tr>
</tbody>
</table>
</div>
<p>The type <code class="docutils literal notranslate"><span class="pre">dict</span></code> is a <em>generic</em> class, signified by type arguments within
<code class="docutils literal notranslate"><span class="pre">[...]</span></code>. For example, <code class="docutils literal notranslate"><span class="pre">dict[int,</span> <span class="pre">str]</span></code> is a dictionary from integers to
strings and <code class="docutils literal notranslate"><span class="pre">dict[Any,</span> <span class="pre">Any]</span></code> is a dictionary of dynamically typed
(arbitrary) values and keys. <code class="docutils literal notranslate"><span class="pre">list</span></code> is another generic class.</p>
<p><code class="docutils literal notranslate"><span class="pre">Iterable</span></code>, <code class="docutils literal notranslate"><span class="pre">Sequence</span></code>, and <code class="docutils literal notranslate"><span class="pre">Mapping</span></code> are generic types that correspond to
Python protocols. For example, a <code class="docutils literal notranslate"><span class="pre">str</span></code> object or a <code class="docutils literal notranslate"><span class="pre">list[str]</span></code> object is
valid when <code class="docutils literal notranslate"><span class="pre">Iterable[str]</span></code> or <code class="docutils literal notranslate"><span class="pre">Sequence[str]</span></code> is expected.
You can import them from <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#module-collections.abc" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">collections.abc</span></code></a> instead of importing from
<a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> in Python 3.9.</p>
<p>See <a class="reference internal" href="index.html#generic-builtins"><span class="std std-ref">Using generic builtins</span></a> for more details, including how you can
use these in annotations also in Python 3.7 and 3.8.</p>
<p>These legacy types defined in <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> are needed if you need to support
Python 3.8 and earlier:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">List[str]</span></code></p></td>
<td><p>list of <code class="docutils literal notranslate"><span class="pre">str</span></code> objects</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Tuple[int,</span> <span class="pre">int]</span></code></p></td>
<td><p>tuple of two <code class="docutils literal notranslate"><span class="pre">int</span></code> objects (<code class="docutils literal notranslate"><span class="pre">Tuple[()]</span></code> is the empty tuple)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Tuple[int,</span> <span class="pre">...]</span></code></p></td>
<td><p>tuple of an arbitrary number of <code class="docutils literal notranslate"><span class="pre">int</span></code> objects</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Dict[str,</span> <span class="pre">int]</span></code></p></td>
<td><p>dictionary from <code class="docutils literal notranslate"><span class="pre">str</span></code> keys to <code class="docutils literal notranslate"><span class="pre">int</span></code> values</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Iterable[int]</span></code></p></td>
<td><p>iterable object containing ints</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Sequence[bool]</span></code></p></td>
<td><p>sequence of booleans (read-only)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Mapping[str,</span> <span class="pre">int]</span></code></p></td>
<td><p>mapping from <code class="docutils literal notranslate"><span class="pre">str</span></code> keys to <code class="docutils literal notranslate"><span class="pre">int</span></code> values (read-only)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Type[C]</span></code></p></td>
<td><p>type object of <code class="docutils literal notranslate"><span class="pre">C</span></code> (<code class="docutils literal notranslate"><span class="pre">C</span></code> is a class/type variable/union of types)</p></td>
</tr>
</tbody>
</table>
</div>
<p><code class="docutils literal notranslate"><span class="pre">List</span></code> is an alias for the built-in type <code class="docutils literal notranslate"><span class="pre">list</span></code> that supports
indexing (and similarly for <code class="docutils literal notranslate"><span class="pre">dict</span></code>/<code class="docutils literal notranslate"><span class="pre">Dict</span></code> and
<code class="docutils literal notranslate"><span class="pre">tuple</span></code>/<code class="docutils literal notranslate"><span class="pre">Tuple</span></code>).</p>
<p>Note that even though <code class="docutils literal notranslate"><span class="pre">Iterable</span></code>, <code class="docutils literal notranslate"><span class="pre">Sequence</span></code> and <code class="docutils literal notranslate"><span class="pre">Mapping</span></code> look
similar to abstract base classes defined in <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#module-collections.abc" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">collections.abc</span></code></a>
(formerly <code class="docutils literal notranslate"><span class="pre">collections</span></code>), they are not identical, since the latter
don’t support indexing prior to Python 3.9.</p>
</section>
</section>
<span id="document-type_inference_and_annotations"></span><section id="type-inference-and-type-annotations">
<span id="type-inference-and-annotations"></span><h3>Type inference and type annotations<a class="headerlink" href="#type-inference-and-type-annotations" title="Permalink to this headline">#</a></h3>
<section id="type-inference">
<h4>Type inference<a class="headerlink" href="#type-inference" title="Permalink to this headline">#</a></h4>
<p>For most variables, if you do not explicitly specify its type, mypy will
infer the correct type based on what is initially assigned to the variable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mypy will infer the type of these variables, despite no annotations</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;builtins.int&quot;</span>
<span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;builtins.list[builtins.int]&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that mypy will not use type inference in dynamically typed functions
(those without a function type annotation) — every local variable type
defaults to <code class="docutils literal notranslate"><span class="pre">Any</span></code> in such functions. For more details, see <a class="reference internal" href="index.html#dynamic-typing"><span class="std std-ref">Dynamically typed code</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">untyped_function</span><span class="p">():</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="c1"># Revealed type is &quot;Any&quot;</span>
                   <span class="c1"># &#39;reveal_type&#39; always outputs &#39;Any&#39; in unchecked functions</span>
</pre></div>
</div>
</div>
</section>
<section id="explicit-types-for-variables">
<span id="explicit-var-types"></span><h4>Explicit types for variables<a class="headerlink" href="#explicit-types-for-variables" title="Permalink to this headline">#</a></h4>
<p>You can override the inferred type of a variable by using a
variable type annotation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Without the type annotation, the type of <code class="docutils literal notranslate"><span class="pre">x</span></code> would be just <code class="docutils literal notranslate"><span class="pre">int</span></code>. We
use an annotation to give it a more general type <code class="docutils literal notranslate"><span class="pre">Union[int,</span> <span class="pre">str]</span></code> (this
type means that the value can be either an <code class="docutils literal notranslate"><span class="pre">int</span></code> or a <code class="docutils literal notranslate"><span class="pre">str</span></code>).</p>
<p>The best way to think about this is that the type annotation sets the type of
the variable, not the type of the expression. For instance, mypy will complain
about the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.1</span>  <span class="c1"># error: Incompatible types in assignment</span>
                          <span class="c1"># (expression has type &quot;float&quot;, variable has type &quot;Union[int, str]&quot;)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To explicitly override the type of an expression you can use
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.cast" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">cast(&lt;type&gt;,</span> <span class="pre">&lt;expression&gt;)</span></code></a>.
See <a class="reference internal" href="index.html#casts"><span class="std std-ref">Casts</span></a> for details.</p>
</div>
<p>Note that you can explicitly declare the type of a variable without
giving it an initial value:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># We only unpack two values, so there&#39;s no right-hand side value</span>
<span class="c1"># for mypy to infer the type of &quot;cs&quot; from:</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">cs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>  <span class="c1"># error: Need type annotation for &quot;cs&quot;</span>

<span class="n">rs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>  <span class="c1"># no assignment!</span>
<span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="o">*</span><span class="n">rs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>  <span class="c1"># OK</span>
</pre></div>
</div>
</section>
<section id="explicit-types-for-collections">
<h4>Explicit types for collections<a class="headerlink" href="#explicit-types-for-collections" title="Permalink to this headline">#</a></h4>
<p>The type checker cannot always infer the type of a list or a
dictionary. This often arises when creating an empty list or
dictionary and assigning it to a new variable that doesn’t have an explicit
variable type. Here is an example where mypy can’t infer the type
without some help:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Error: Need type annotation for &quot;l&quot;</span>
</pre></div>
</div>
<p>In these cases you can give the type explicitly using a type annotation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>       <span class="c1"># Create empty list of int</span>
<span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Create empty dictionary (str -&gt; int)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using type arguments (e.g. <code class="docutils literal notranslate"><span class="pre">list[int]</span></code>) on builtin collections like
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a>,  <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>, and  <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a>
only works in Python 3.9 and later. For Python 3.8 and earlier, you must use
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a> (e.g. <code class="docutils literal notranslate"><span class="pre">List[int]</span></code>), <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>, and
so on.</p>
</div>
</section>
<section id="compatibility-of-container-types">
<h4>Compatibility of container types<a class="headerlink" href="#compatibility-of-container-types" title="Permalink to this headline">#</a></h4>
<p>A quick note: container types can sometimes be unintuitive. We’ll discuss this
more in <a class="reference internal" href="index.html#variance"><span class="std std-ref">Invariance vs covariance</span></a>. For example, the following program generates a mypy error,
because mypy treats <code class="docutils literal notranslate"><span class="pre">list[int]</span></code> as incompatible with <code class="docutils literal notranslate"><span class="pre">list[object]</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">l</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">object</span><span class="p">],</span> <span class="n">k</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">k</span>  <span class="c1"># error: Incompatible types in assignment</span>
</pre></div>
</div>
<p>The reason why the above assignment is disallowed is that allowing the
assignment could result in non-int values stored in a list of <code class="docutils literal notranslate"><span class="pre">int</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">l</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">object</span><span class="p">],</span> <span class="n">k</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">k</span>
    <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Ouch; a string in list[int]</span>
</pre></div>
</div>
<p>Other container types like <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> behave similarly.</p>
<p>You can still run the above program; it prints <code class="docutils literal notranslate"><span class="pre">x</span></code>. This illustrates the fact
that static types do not affect the runtime behavior of programs. You can run
programs with type check failures, which is often very handy when performing a
large refactoring. Thus you can always ‘work around’ the type system, and it
doesn’t really limit what you can do in your program.</p>
</section>
<section id="context-in-type-inference">
<h4>Context in type inference<a class="headerlink" href="#context-in-type-inference" title="Permalink to this headline">#</a></h4>
<p>Type inference is <em>bidirectional</em> and takes context into account.</p>
<p>Mypy will take into account the type of the variable on the left-hand side
of an assignment when inferring the type of the expression on the right-hand
side. For example, the following will type check:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">l</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Infer type list[object] for [1, 2], not list[int]</span>
</pre></div>
</div>
<p>The value expression <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code> is type checked with the additional
context that it is being assigned to a variable of type <code class="docutils literal notranslate"><span class="pre">list[object]</span></code>.
This is used to infer the type of the <em>expression</em> as <code class="docutils literal notranslate"><span class="pre">list[object]</span></code>.</p>
<p>Declared argument types are also used for type context. In this program
mypy knows that the empty list <code class="docutils literal notranslate"><span class="pre">[]</span></code> should have type <code class="docutils literal notranslate"><span class="pre">list[int]</span></code> based
on the declared type of <code class="docutils literal notranslate"><span class="pre">arg</span></code> in <code class="docutils literal notranslate"><span class="pre">foo</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Items:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">))</span>

<span class="n">foo</span><span class="p">([])</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<p>However, context only works within a single statement. Here mypy requires
an annotation for the empty list, since the context would only be available
in the following statement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Items:&#39;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Error: Need type annotation for &quot;a&quot;</span>
<span class="n">foo</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<p>Working around the issue is easy by adding a type annotation:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">a</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># OK</span>
<span class="n">foo</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="silencing-type-errors">
<span id="id1"></span><h4>Silencing type errors<a class="headerlink" href="#silencing-type-errors" title="Permalink to this headline">#</a></h4>
<p>You might want to disable type checking on specific lines, or within specific
files in your codebase. To do that, you can use a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment.</p>
<p>For example, say in its latest update, the web framework you use can now take an
integer argument to <code class="docutils literal notranslate"><span class="pre">run()</span></code>, which starts it on localhost on that port.
Like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Starting app on http://localhost:8000</span>
<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">8000</span><span class="p">)</span>
</pre></div>
</div>
<p>However, the devs forgot to update their type annotations for
<code class="docutils literal notranslate"><span class="pre">run</span></code>, so mypy still thinks <code class="docutils literal notranslate"><span class="pre">run</span></code> only expects <code class="docutils literal notranslate"><span class="pre">str</span></code> types.
This would give you the following error:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>error: Argument 1 to &quot;run&quot; of &quot;A&quot; has incompatible type &quot;int&quot;; expected &quot;str&quot;
</pre></div>
</div>
<p>If you cannot directly fix the web framework yourself, you can temporarily
disable type checking on that line, by adding a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Starting app on http://localhost:8000</span>
<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">8000</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</pre></div>
</div>
<p>This will suppress any mypy errors that would have raised on that specific line.</p>
<p>You should probably add some more information on the <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment,
to explain why the ignore was added in the first place. This could be a link to
an issue on the repository responsible for the type stubs, or it could be a
short explanation of the bug. To do that, use this format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Starting app on http://localhost:8000</span>
<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">8000</span><span class="p">)</span>  <span class="c1"># type: ignore  # `run()` in v2.0 accepts an `int`, as a port</span>
</pre></div>
</div>
<section id="type-ignore-error-codes">
<h5>Type ignore error codes<a class="headerlink" href="#type-ignore-error-codes" title="Permalink to this headline">#</a></h5>
<p>By default, mypy displays an error code for each error:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>error: &quot;str&quot; has no attribute &quot;trim&quot;  [attr-defined]
</pre></div>
</div>
<p>It is possible to add a specific error-code in your ignore comment (e.g.
<code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore[attr-defined]</span></code>) to clarify what’s being silenced. You can
find more information about error codes <a class="reference internal" href="index.html#silence-error-codes"><span class="std std-ref">here</span></a>.</p>
</section>
<section id="other-ways-to-silence-errors">
<h5>Other ways to silence errors<a class="headerlink" href="#other-ways-to-silence-errors" title="Permalink to this headline">#</a></h5>
<p>You can get mypy to silence errors about a specific variable by dynamically
typing it with <code class="docutils literal notranslate"><span class="pre">Any</span></code>. See <a class="reference internal" href="index.html#dynamic-typing"><span class="std std-ref">Dynamically typed code</span></a> for more information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;hello&#39;</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<p>You can ignore all mypy errors in a file by adding a
<code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">mypy:</span> <span class="pre">ignore-errors</span></code> at the top of the file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: ignore-errors</span>
<span class="c1"># This is a test file, skipping type checking in it.</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="o">...</span>
</pre></div>
</div>
<p>You can also specify per-module configuration options in your <a class="reference internal" href="index.html#config-file"><span class="std std-ref">The mypy configuration file</span></a>.
For example:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># Don&#39;t report errors in the &#39;package_to_fix_later&#39; package</span>
<span class="k">[mypy-package_to_fix_later.*]</span>
<span class="na">ignore_errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>

<span class="c1"># Disable specific error codes in the &#39;tests&#39; package</span>
<span class="c1"># Also don&#39;t require type annotations</span>
<span class="k">[mypy-tests.*]</span>
<span class="na">disable_error_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">var-annotated, has-type</span>
<span class="na">allow_untyped_defs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>

<span class="c1"># Silence import errors from the &#39;library_missing_types&#39; package</span>
<span class="k">[mypy-library_missing_types.*]</span>
<span class="na">ignore_missing_imports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
</pre></div>
</div>
<p>Finally, adding a <code class="docutils literal notranslate"><span class="pre">&#64;typing.no_type_check</span></code> decorator to a class, method or
function causes mypy to avoid type checking that class, method or function
and to treat it as not having any type annotations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@typing</span><span class="o">.</span><span class="n">no_type_check</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
   <span class="k">return</span> <span class="mi">12345</span>  <span class="c1"># No error!</span>
</pre></div>
</div>
</section>
</section>
</section>
<span id="document-kinds_of_types"></span><section id="kinds-of-types">
<h3>Kinds of types<a class="headerlink" href="#kinds-of-types" title="Permalink to this headline">#</a></h3>
<p>We’ve mostly restricted ourselves to built-in types until now. This
section introduces several additional kinds of types. You are likely
to need at least some of them to type check any non-trivial programs.</p>
<section id="class-types">
<h4>Class types<a class="headerlink" href="#class-types" title="Permalink to this headline">#</a></h4>
<p>Every class is also a valid type. Any instance of a subclass is also
compatible with all superclasses – it follows that every value is compatible
with the <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a> type (and incidentally also the <code class="docutils literal notranslate"><span class="pre">Any</span></code> type, discussed
below). Mypy analyzes the bodies of classes to determine which methods and
attributes are available in instances. This example uses subclassing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># Type of self inferred (A)</span>
        <span class="k">return</span> <span class="mi">2</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
         <span class="k">return</span> <span class="mi">3</span>
    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">4</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">f</span><span class="p">())</span>  <span class="c1"># 3</span>
    <span class="n">a</span><span class="o">.</span><span class="n">g</span><span class="p">()</span>         <span class="c1"># Error: &quot;A&quot; has no attribute &quot;g&quot;</span>

<span class="n">foo</span><span class="p">(</span><span class="n">B</span><span class="p">())</span>  <span class="c1"># OK (B is a subclass of A)</span>
</pre></div>
</div>
</section>
<section id="the-any-type">
<h4>The Any type<a class="headerlink" href="#the-any-type" title="Permalink to this headline">#</a></h4>
<p>A value with the <code class="docutils literal notranslate"><span class="pre">Any</span></code> type is dynamically typed. Mypy doesn’t know
anything about the possible runtime types of such value. Any
operations are permitted on the value, and the operations are only checked
at runtime. You can use <code class="docutils literal notranslate"><span class="pre">Any</span></code> as an “escape hatch” when you can’t use
a more precise type for some reason.</p>
<p><code class="docutils literal notranslate"><span class="pre">Any</span></code> is compatible with every other type, and vice versa. You can freely
assign a value of type <code class="docutils literal notranslate"><span class="pre">Any</span></code> to a variable with a more precise type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">s</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>     <span class="c1"># OK (assign &quot;int&quot; to &quot;Any&quot;)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">a</span>     <span class="c1"># OK (assign &quot;Any&quot; to &quot;str&quot;)</span>
</pre></div>
</div>
<p>Declared (and inferred) types are ignored (or <em>erased</em>) at runtime. They are
basically treated as comments, and thus the above code does not
generate a runtime error, even though <code class="docutils literal notranslate"><span class="pre">s</span></code> gets an <code class="docutils literal notranslate"><span class="pre">int</span></code> value when
the program is run, while the declared type of <code class="docutils literal notranslate"><span class="pre">s</span></code> is actually
<code class="docutils literal notranslate"><span class="pre">str</span></code>! You need to be careful with <code class="docutils literal notranslate"><span class="pre">Any</span></code> types, since they let you
lie to mypy, and this could easily hide bugs.</p>
<p>If you do not define a function return value or argument types, these
default to <code class="docutils literal notranslate"><span class="pre">Any</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_heading</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=== &#39;</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39; ===&#39;</span><span class="p">)</span>  <span class="c1"># No static type checking, as s has type Any</span>

<span class="n">show_heading</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># OK (runtime error only; mypy won&#39;t generate an error)</span>
</pre></div>
</div>
<p>You should give a statically typed function an explicit <code class="docutils literal notranslate"><span class="pre">None</span></code>
return type even if it doesn’t return a value, as this lets mypy catch
additional type errors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>  <span class="c1"># Implicit Any return value</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waiting...&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="k">if</span> <span class="n">wait</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>   <span class="c1"># Mypy doesn&#39;t catch this error!</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>If we had used an explicit <code class="docutils literal notranslate"><span class="pre">None</span></code> return type, mypy would have caught
the error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Waiting...&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="k">if</span> <span class="n">wait</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>   <span class="c1"># Error: can&#39;t compare None and int</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Any</span></code> type is discussed in more detail in section <a class="reference internal" href="index.html#dynamic-typing"><span class="std std-ref">Dynamically typed code</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A function without any types in the signature is dynamically
typed. The body of a dynamically typed function is not checked
statically, and local variables have implicit <code class="docutils literal notranslate"><span class="pre">Any</span></code> types.
This makes it easier to migrate legacy Python code to mypy, as
mypy won’t complain about dynamically typed functions.</p>
</div>
</section>
<section id="tuple-types">
<span id="id1"></span><h4>Tuple types<a class="headerlink" href="#tuple-types" title="Permalink to this headline">#</a></h4>
<p>The type <code class="docutils literal notranslate"><span class="pre">tuple[T1,</span> <span class="pre">...,</span> <span class="pre">Tn]</span></code> represents a tuple with the item types <code class="docutils literal notranslate"><span class="pre">T1</span></code>, …, <code class="docutils literal notranslate"><span class="pre">Tn</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use `typing.Tuple` in Python 3.8 and earlier</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span>    <span class="c1"># OK</span>
    <span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">1</span>    <span class="c1"># Type check error</span>
</pre></div>
</div>
<p>A tuple type of this kind has exactly a specific number of items (2 in
the above example). Tuples can also be used as immutable,
varying-length sequences. You can use the type <code class="docutils literal notranslate"><span class="pre">tuple[T,</span> <span class="pre">...]</span></code> (with
a literal <code class="docutils literal notranslate"><span class="pre">...</span></code> – it’s part of the syntax) for this
purpose. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_squared</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">print_squared</span><span class="p">(())</span>           <span class="c1"># OK</span>
<span class="n">print_squared</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>    <span class="c1"># OK</span>
<span class="n">print_squared</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>       <span class="c1"># Error: only a tuple is valid</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Usually it’s a better idea to use <code class="docutils literal notranslate"><span class="pre">Sequence[T]</span></code> instead of <code class="docutils literal notranslate"><span class="pre">tuple[T,</span> <span class="pre">...]</span></code>, as
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> is also compatible with lists and other non-tuple sequences.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">tuple[...]</span></code> is valid as a base class in Python 3.6 and later, and
always in stub files. In earlier Python versions you can sometimes work around this
limitation by using a named tuple as a base class (see section <a class="reference internal" href="#named-tuples"><span class="std std-ref">Named tuples</span></a>).</p>
</div>
</section>
<section id="callable-types-and-lambdas">
<span id="callable-types"></span><h4>Callable types (and lambdas)<a class="headerlink" href="#callable-types-and-lambdas" title="Permalink to this headline">#</a></h4>
<p>You can pass around function objects and bound methods in statically
typed code. The type of a function that accepts arguments <code class="docutils literal notranslate"><span class="pre">A1</span></code>, …, <code class="docutils literal notranslate"><span class="pre">An</span></code>
and returns <code class="docutils literal notranslate"><span class="pre">Rt</span></code> is <code class="docutils literal notranslate"><span class="pre">Callable[[A1,</span> <span class="pre">...,</span> <span class="pre">An],</span> <span class="pre">Rt]</span></code>. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>

<span class="k">def</span> <span class="nf">twice</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">next</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="n">twice</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">add</span><span class="p">))</span>   <span class="c1"># 5</span>
</pre></div>
</div>
<p>You can only have positional arguments, and only ones without default
values, in callable types. These cover the vast majority of uses of
callable types, but sometimes this isn’t quite enough. Mypy recognizes
a special form <code class="docutils literal notranslate"><span class="pre">Callable[...,</span> <span class="pre">T]</span></code> (with a literal <code class="docutils literal notranslate"><span class="pre">...</span></code>) which can
be used in less typical cases. It is compatible with arbitrary
callable objects that return a type compatible with <code class="docutils literal notranslate"><span class="pre">T</span></code>, independent
of the number, types or kinds of arguments. Mypy lets you call such
callable values with arbitrary arguments, without any checking – in
this respect they are treated similar to a <code class="docutils literal notranslate"><span class="pre">(*args:</span> <span class="pre">Any,</span> <span class="pre">**kwargs:</span>
<span class="pre">Any)</span></code> function signature. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>

<span class="k">def</span> <span class="nf">arbitrary_call</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># OK</span>

<span class="n">arbitrary_call</span><span class="p">(</span><span class="nb">ord</span><span class="p">)</span>   <span class="c1"># No static error, but fails at runtime</span>
<span class="n">arbitrary_call</span><span class="p">(</span><span class="nb">open</span><span class="p">)</span>  <span class="c1"># Error: does not return an int</span>
<span class="n">arbitrary_call</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>     <span class="c1"># Error: &#39;int&#39; is not callable</span>
</pre></div>
</div>
<p>In situations where more precise or complex types of callbacks are
necessary one can use flexible <a class="reference internal" href="index.html#callback-protocols"><span class="std std-ref">callback protocols</span></a>.
Lambdas are also supported. The lambda argument and return value types
cannot be given explicitly; they are always inferred based on context
using bidirectional type inference:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>   <span class="c1"># Infer x as int and l as list[int]</span>
</pre></div>
</div>
<p>If you want to give the argument or return value types explicitly, use
an ordinary, perhaps nested function definition.</p>
<p>Callables can also be used against type objects, matching their
<code class="docutils literal notranslate"><span class="pre">__init__</span></code> or <code class="docutils literal notranslate"><span class="pre">__new__</span></code> signature:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>

<span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="n">CallableType</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">C</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">class_or_callable</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="n">CallableType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">inst</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="s2">&quot;my_app&quot;</span><span class="p">)</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;C&quot;</span>
</pre></div>
</div>
<p>This is useful if you want <code class="docutils literal notranslate"><span class="pre">arg</span></code> to be either a <code class="docutils literal notranslate"><span class="pre">Callable</span></code> returning an
instance of <code class="docutils literal notranslate"><span class="pre">C</span></code> or the type of <code class="docutils literal notranslate"><span class="pre">C</span></code> itself. This also works with
<a class="reference internal" href="index.html#callback-protocols"><span class="std std-ref">callback protocols</span></a>.</p>
</section>
<section id="union-types">
<span id="id2"></span><h4>Union types<a class="headerlink" href="#union-types" title="Permalink to this headline">#</a></h4>
<p>Python functions often accept values of two or more different
types. You can use <a class="reference internal" href="index.html#function-overloading"><span class="std std-ref">overloading</span></a> to
represent this, but union types are often more convenient.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">Union[T1,</span> <span class="pre">...,</span> <span class="pre">Tn]</span></code> type constructor to construct a union
type. For example, if an argument has type <code class="docutils literal notranslate"><span class="pre">Union[int,</span> <span class="pre">str]</span></code>, both
integers and strings are valid argument values.</p>
<p>You can use an <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> check to narrow down a union type to a
more specific type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>     <span class="c1"># Error: str + int is not valid</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="c1"># Here type of x is int.</span>
        <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>      <span class="c1"># OK</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Here type of x is str.</span>
        <span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;a&#39;</span>    <span class="c1"># OK</span>

<span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># OK</span>
<span class="n">f</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="n">f</span><span class="p">(</span><span class="mf">1.1</span><span class="p">)</span>  <span class="c1"># Error</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Operations are valid for union types only if they are valid for <em>every</em>
union item. This is why it’s often necessary to use an <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a>
check to first narrow down a union type to a non-union type. This also
means that it’s recommended to avoid union types as function return types,
since the caller may have to use <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> before doing anything
interesting with the value.</p>
</div>
</section>
<section id="optional-types-and-the-none-type">
<span id="strict-optional"></span><h4>Optional types and the None type<a class="headerlink" href="#optional-types-and-the-none-type" title="Permalink to this headline">#</a></h4>
<p>You can use the <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a> type modifier to define a type variant
that allows <code class="docutils literal notranslate"><span class="pre">None</span></code>, such as <code class="docutils literal notranslate"><span class="pre">Optional[int]</span></code> (<code class="docutils literal notranslate"><span class="pre">Optional[X]</span></code> is
the preferred shorthand for <code class="docutils literal notranslate"><span class="pre">Union[X,</span> <span class="pre">None]</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="k">def</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># OK</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">strlen_invalid</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Error: None not compatible with int</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
<p>Most operations will not be allowed on unguarded <code class="docutils literal notranslate"><span class="pre">None</span></code> or <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>
values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Error: Cannot add None and int</span>
</pre></div>
</div>
<p>Instead, an explicit <code class="docutils literal notranslate"><span class="pre">None</span></code> check is required. Mypy has
powerful type inference that lets you use regular Python
idioms to guard against <code class="docutils literal notranslate"><span class="pre">None</span></code> values. For example, mypy
recognizes <code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">None</span></code> checks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># The inferred type of x is just int here.</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Mypy will infer the type of <code class="docutils literal notranslate"><span class="pre">x</span></code> to be <code class="docutils literal notranslate"><span class="pre">int</span></code> in the else block due to the
check against <code class="docutils literal notranslate"><span class="pre">None</span></code> in the if condition.</p>
<p>Other supported checks for guarding against a <code class="docutils literal notranslate"><span class="pre">None</span></code> value include
<code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">x</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">not</span> <span class="pre">x</span></code>. Additionally, mypy understands
<code class="docutils literal notranslate"><span class="pre">None</span></code> checks within logical expressions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">concat</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Both x and y are not None here</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
<p>Sometimes mypy doesn’t realize that a value is never <code class="docutils literal notranslate"><span class="pre">None</span></code>. This notably
happens when a class instance can exist in a partially defined state,
where some attribute is initialized to <code class="docutils literal notranslate"><span class="pre">None</span></code> during object
construction, but a method assumes that the attribute is no longer <code class="docutils literal notranslate"><span class="pre">None</span></code>. Mypy
will complain about the possible <code class="docutils literal notranslate"><span class="pre">None</span></code> value. You can use
<code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">x</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">None</span></code> to work around this in the method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Resource</span><span class="p">:</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># We require that the object has been initialized.</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># OK</span>
           <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">Resource</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="s1">&#39;/foo/bar&#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>When initializing a variable as <code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">None</span></code> is usually an
empty place-holder value, and the actual value has a different type.
This is why you need to annotate an attribute in cases like the class
<code class="docutils literal notranslate"><span class="pre">Resource</span></code> above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Resource</span><span class="p">:</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This also works for attributes defined within methods:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Counter</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<p>This is not a problem when using variable annotations, since no initial
value is needed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Container</span><span class="p">:</span>
    <span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># No initial value</span>
</pre></div>
</div>
<p>Mypy generally uses the first assignment to a variable to
infer the type of the variable. However, if you assign both a <code class="docutils literal notranslate"><span class="pre">None</span></code>
value and a non-<code class="docutils literal notranslate"><span class="pre">None</span></code> value in the same scope, mypy can usually do
the right thing without an annotation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Inferred type Optional[int] because of the assignment below</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
         <span class="n">n</span> <span class="o">=</span> <span class="n">i</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Sometimes you may get the error “Cannot determine type of &lt;something&gt;”. In this
case you should add an explicit <code class="docutils literal notranslate"><span class="pre">Optional[...]</span></code> annotation (or type comment).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">None</span></code> is a type with only one value, <code class="docutils literal notranslate"><span class="pre">None</span></code>. <code class="docutils literal notranslate"><span class="pre">None</span></code> is also used
as the return type for functions that don’t return a value, i.e. functions
that implicitly return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Python interpreter internally uses the name <code class="docutils literal notranslate"><span class="pre">NoneType</span></code> for
the type of <code class="docutils literal notranslate"><span class="pre">None</span></code>, but <code class="docutils literal notranslate"><span class="pre">None</span></code> is always used in type
annotations. The latter is shorter and reads better. (<code class="docutils literal notranslate"><span class="pre">NoneType</span></code>
is available as <a class="reference external" href="https://docs.python.org/3/library/types.html#types.NoneType" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">types.NoneType</span></code></a> on Python 3.10+, but is
not exposed at all on earlier versions of Python.)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">Optional[...]</span></code> <em>does not</em> mean a function argument with a default value.
It simply means that <code class="docutils literal notranslate"><span class="pre">None</span></code> is a valid value for the argument. This is
a common confusion because <code class="docutils literal notranslate"><span class="pre">None</span></code> is a common default value for arguments.</p>
</div>
<section id="x-y-syntax-for-unions">
<span id="alternative-union-syntax"></span><h5>X | Y syntax for Unions<a class="headerlink" href="#x-y-syntax-for-unions" title="Permalink to this headline">#</a></h5>
<p><span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0604/"><strong>PEP 604</strong></a> introduced an alternative way for spelling union types. In Python
3.10 and later, you can write <code class="docutils literal notranslate"><span class="pre">Union[int,</span> <span class="pre">str]</span></code> as <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">|</span> <span class="pre">str</span></code>. It is
possible to use this syntax in versions of Python where it isn’t supported by
the runtime with some limitations (see <a class="reference internal" href="index.html#runtime-troubles"><span class="std std-ref">Annotation issues at runtime</span></a>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span>  <span class="c1"># equivalent to Union[int, str]</span>

<span class="n">t2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>  <span class="c1"># equivalent to Optional[int]</span>
</pre></div>
</div>
</section>
</section>
<section id="disabling-strict-optional-checking">
<span id="no-strict-optional"></span><h4>Disabling strict optional checking<a class="headerlink" href="#disabling-strict-optional-checking" title="Permalink to this headline">#</a></h4>
<p>Mypy also has an option to treat <code class="docutils literal notranslate"><span class="pre">None</span></code> as a valid value for every
type (in case you know Java, it’s useful to think of it as similar to
the Java <code class="docutils literal notranslate"><span class="pre">null</span></code>). In this mode <code class="docutils literal notranslate"><span class="pre">None</span></code> is also valid for primitive
types such as <code class="docutils literal notranslate"><span class="pre">int</span></code> and <code class="docutils literal notranslate"><span class="pre">float</span></code>, and <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a> types are
not required.</p>
<p>The mode is enabled through the <a class="reference internal" href="index.html#cmdoption-mypy-no-strict-optional"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-strict-optional</span></code></a> command-line
option. In mypy versions before 0.600 this was the default mode. You
can enable this option explicitly for backward compatibility with
earlier mypy versions, in case you don’t want to introduce optional
types to your codebase yet.</p>
<p>It will cause mypy to silently accept some buggy code, such as
this example – it’s not recommended if you can avoid it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">inc</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># No error reported by mypy if strict optional mode disabled!</span>
</pre></div>
</div>
<p>However, making code “optional clean” can take some work! You can also use
<a class="reference internal" href="index.html#config-file"><span class="std std-ref">the mypy configuration file</span></a> to migrate your code
to strict optional checking one file at a time, since there exists
the per-module flag
<a class="reference internal" href="index.html#confval-strict_optional"><code class="xref std std-confval docutils literal notranslate"><span class="pre">strict_optional</span></code></a> to control strict optional mode.</p>
<p>Often it’s still useful to document whether a variable can be
<code class="docutils literal notranslate"><span class="pre">None</span></code>. For example, this function accepts a <code class="docutils literal notranslate"><span class="pre">None</span></code> argument,
but it’s not obvious from its signature:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Hello, stranger&#39;</span>

<span class="nb">print</span><span class="p">(</span><span class="n">greeting</span><span class="p">(</span><span class="s1">&#39;Python&#39;</span><span class="p">))</span>  <span class="c1"># Okay!</span>
<span class="nb">print</span><span class="p">(</span><span class="n">greeting</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>      <span class="c1"># Also okay!</span>
</pre></div>
</div>
<p>You can still use <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional[t]</span></code></a> to document that <code class="docutils literal notranslate"><span class="pre">None</span></code> is a
valid argument type, even if strict <code class="docutils literal notranslate"><span class="pre">None</span></code> checking is not
enabled:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Hello, stranger&#39;</span>
</pre></div>
</div>
<p>Mypy treats this as semantically equivalent to the previous example
if strict optional checking is disabled, since <code class="docutils literal notranslate"><span class="pre">None</span></code> is implicitly
valid for any type, but it’s much more
useful for a programmer who is reading the code. This also makes
it easier to migrate to strict <code class="docutils literal notranslate"><span class="pre">None</span></code> checking in the future.</p>
</section>
<section id="type-aliases">
<span id="id3"></span><h4>Type aliases<a class="headerlink" href="#type-aliases" title="Permalink to this headline">#</a></h4>
<p>In certain situations, type names may end up being long and painful to type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]]],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]:</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>When cases like this arise, you can define a type alias by simply
assigning the type to a variable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">AliasType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]]],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span>

<span class="c1"># Now we can use AliasType in place of the full name:</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AliasType</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A type alias does not create a new type. It’s just a shorthand notation for
another type – it’s equivalent to the target type except for
<a class="reference internal" href="index.html#generic-type-aliases"><span class="std std-ref">generic aliases</span></a>.</p>
</div>
<p>Since Mypy 0.930 you can also use <em>explicit type aliases</em>, which were
introduced in <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0613/"><strong>PEP 613</strong></a>.</p>
<p>There can be confusion about exactly when an assignment defines an implicit type alias –
for example, when the alias contains forward references, invalid types, or violates some other
restrictions on type alias declarations.  Because the
distinction between an unannotated variable and a type alias is implicit,
ambiguous or incorrect type alias declarations default to defining
a normal variable instead of a type alias.</p>
<p>Explicit type aliases are unambiguous and can also improve readability by
making the intent clear:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeAlias</span>  <span class="c1"># &quot;from typing_extensions&quot; in Python 3.9 and earlier</span>

<span class="n">AliasType</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]]],</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span>
</pre></div>
</div>
</section>
<section id="named-tuples">
<span id="id4"></span><h4>Named tuples<a class="headerlink" href="#named-tuples" title="Permalink to this headline">#</a></h4>
<p>Mypy recognizes named tuples and can type check code that defines or
uses them.  In this example, we can detect code trying to access a
missing attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Point</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Point&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># Error: Point has no attribute &#39;z&#39;</span>
</pre></div>
</div>
<p>If you use <a class="reference external" href="https://docs.python.org/3/library/collections.html#collections.namedtuple" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">namedtuple</span></code></a> to define your named tuple, all the items
are assumed to have <code class="docutils literal notranslate"><span class="pre">Any</span></code> types. That is, mypy doesn’t know anything
about item types. You can use <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NamedTuple" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NamedTuple</span></code></a> to also define
item types:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>

<span class="n">Point</span> <span class="o">=</span> <span class="n">NamedTuple</span><span class="p">(</span><span class="s1">&#39;Point&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
                             <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)])</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>  <span class="c1"># Argument has incompatible type &quot;str&quot;; expected &quot;int&quot;</span>
</pre></div>
</div>
<p>Python 3.6 introduced an alternative, class-based syntax for named tuples with types:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>

<span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>  <span class="c1"># Argument has incompatible type &quot;str&quot;; expected &quot;int&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can use the raw <code class="docutils literal notranslate"><span class="pre">NamedTuple</span></code> “pseudo-class” in type annotations
if any <code class="docutils literal notranslate"><span class="pre">NamedTuple</span></code> object is valid.</p>
<p>For example, it can be useful for deserialization:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">deserialize_named_tuple</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="n">NamedTuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">arg</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span>

<span class="n">Point</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Point&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="n">Person</span> <span class="o">=</span> <span class="n">NamedTuple</span><span class="p">(</span><span class="s1">&#39;Person&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)])</span>

<span class="n">deserialize_named_tuple</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># ok</span>
<span class="n">deserialize_named_tuple</span><span class="p">(</span><span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Nikita&#39;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">18</span><span class="p">))</span>  <span class="c1"># ok</span>

<span class="c1"># Error: Argument 1 to &quot;deserialize_named_tuple&quot; has incompatible type</span>
<span class="c1"># &quot;Tuple[int, int]&quot;; expected &quot;NamedTuple&quot;</span>
<span class="n">deserialize_named_tuple</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that this behavior is highly experimental, non-standard,
and may not be supported by other type checkers and IDEs.</p>
</div>
</section>
<section id="the-type-of-class-objects">
<span id="type-of-class"></span><h4>The type of class objects<a class="headerlink" href="#the-type-of-class-objects" title="Permalink to this headline">#</a></h4>
<p>(Freely after <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/#the-type-of-class-objects"><strong>PEP 484: The type of class objects</strong></a>.)</p>
<p>Sometimes you want to talk about class objects that inherit from a
given class.  This can be spelled as <code class="docutils literal notranslate"><span class="pre">type[C]</span></code> (or, on Python 3.8 and lower,
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Type" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Type[C]</span></code></a>) where <code class="docutils literal notranslate"><span class="pre">C</span></code> is a
class.  In other words, when <code class="docutils literal notranslate"><span class="pre">C</span></code> is the name of a class, using <code class="docutils literal notranslate"><span class="pre">C</span></code>
to annotate an argument declares that the argument is an instance of
<code class="docutils literal notranslate"><span class="pre">C</span></code> (or of a subclass of <code class="docutils literal notranslate"><span class="pre">C</span></code>), but using <code class="docutils literal notranslate"><span class="pre">type[C]</span></code> as an
argument annotation declares that the argument is a class object
deriving from <code class="docutils literal notranslate"><span class="pre">C</span></code> (or <code class="docutils literal notranslate"><span class="pre">C</span></code> itself).</p>
<p>For example, assume the following classes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">:</span>
    <span class="c1"># Defines fields like name, email</span>

<span class="k">class</span> <span class="nc">BasicUser</span><span class="p">(</span><span class="n">User</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">upgrade</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Upgrade to Pro&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">ProUser</span><span class="p">(</span><span class="n">User</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">pay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pay bill&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">ProUser</span></code> doesn’t inherit from <code class="docutils literal notranslate"><span class="pre">BasicUser</span></code>.</p>
<p>Here’s a function that creates an instance of one of these classes if
you pass it the right class object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">new_user</span><span class="p">(</span><span class="n">user_class</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">user_class</span><span class="p">()</span>
    <span class="c1"># (Here we could write the user object to a database)</span>
    <span class="k">return</span> <span class="n">user</span>
</pre></div>
</div>
<p>How would we annotate this function?  Without the ability to parameterize <code class="docutils literal notranslate"><span class="pre">type</span></code>, the best we
could do would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">new_user</span><span class="p">(</span><span class="n">user_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
    <span class="c1"># Same  implementation as before</span>
</pre></div>
</div>
<p>This seems reasonable, except that in the following example, mypy
doesn’t see that the <code class="docutils literal notranslate"><span class="pre">buyer</span></code> variable has type <code class="docutils literal notranslate"><span class="pre">ProUser</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">buyer</span> <span class="o">=</span> <span class="n">new_user</span><span class="p">(</span><span class="n">ProUser</span><span class="p">)</span>
<span class="n">buyer</span><span class="o">.</span><span class="n">pay</span><span class="p">()</span>  <span class="c1"># Rejected, not a method on User</span>
</pre></div>
</div>
<p>However, using the <code class="docutils literal notranslate"><span class="pre">type[C]</span></code> syntax and a type variable with an upper bound (see
<a class="reference internal" href="index.html#type-variable-upper-bound"><span class="std std-ref">Type variables with upper bounds</span></a>) we can do better:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">U</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">User</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">new_user</span><span class="p">(</span><span class="n">user_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">U</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">U</span><span class="p">:</span>
    <span class="c1"># Same  implementation as before</span>
</pre></div>
</div>
<p>Now mypy will infer the correct type of the result when we call
<code class="docutils literal notranslate"><span class="pre">new_user()</span></code> with a specific subclass of <code class="docutils literal notranslate"><span class="pre">User</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">beginner</span> <span class="o">=</span> <span class="n">new_user</span><span class="p">(</span><span class="n">BasicUser</span><span class="p">)</span>  <span class="c1"># Inferred type is BasicUser</span>
<span class="n">beginner</span><span class="o">.</span><span class="n">upgrade</span><span class="p">()</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The value corresponding to <code class="docutils literal notranslate"><span class="pre">type[C]</span></code> must be an actual class
object that’s a subtype of <code class="docutils literal notranslate"><span class="pre">C</span></code>.  Its constructor must be
compatible with the constructor of <code class="docutils literal notranslate"><span class="pre">C</span></code>.  If <code class="docutils literal notranslate"><span class="pre">C</span></code> is a type
variable, its upper bound must be a class object.</p>
</div>
<p>For more details about <code class="docutils literal notranslate"><span class="pre">type[]</span></code> and <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Type" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">typing.Type[]</span></code></a>, see <span class="target" id="index-3"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/#the-type-of-class-objects"><strong>PEP 484: The type of
class objects</strong></a>.</p>
</section>
<section id="generators">
<span id="id5"></span><h4>Generators<a class="headerlink" href="#generators" title="Permalink to this headline">#</a></h4>
<p>A basic generator that only yields values can be succinctly annotated as having a return
type of either <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterator" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator[YieldType]</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable[YieldType]</span></code></a>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">squares</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i</span>
</pre></div>
</div>
<p>A good rule of thumb is to annotate functions with the most specific return
type possible. However, you should also take care to avoid leaking implementation
details into a function’s public API. In keeping with these two principles, prefer
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterator" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator[YieldType]</span></code></a> over
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable[YieldType]</span></code></a> as the return-type annotation for a
generator function, as it lets mypy know that users are able to call <a class="reference external" href="https://docs.python.org/3/library/functions.html#next" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">next()</span></code></a> on
the object returned by the function. Nonetheless, bear in mind that <code class="docutils literal notranslate"><span class="pre">Iterable</span></code> may
sometimes be the better option, if you consider it an implementation detail that
<code class="docutils literal notranslate"><span class="pre">next()</span></code> can be called on the object returned by your function.</p>
<p>If you want your generator to accept values via the <a class="reference external" href="https://docs.python.org/3/reference/expressions.html#generator.send" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send()</span></code></a> method or return
a value, on the other hand, you should use the
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Generator" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generator[YieldType,</span> <span class="pre">SendType,</span> <span class="pre">ReturnType]</span></code></a> generic type instead of
either <code class="docutils literal notranslate"><span class="pre">Iterator</span></code> or <code class="docutils literal notranslate"><span class="pre">Iterable</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">echo_round</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="n">sent</span> <span class="o">=</span> <span class="k">yield</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">sent</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sent</span> <span class="o">=</span> <span class="k">yield</span> <span class="nb">round</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;Done&#39;</span>
</pre></div>
</div>
<p>Note that unlike many other generics in the typing module, the <code class="docutils literal notranslate"><span class="pre">SendType</span></code> of
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Generator" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generator</span></code></a> behaves contravariantly, not covariantly or invariantly.</p>
<p>If you do not plan on receiving or returning values, then set the <code class="docutils literal notranslate"><span class="pre">SendType</span></code>
or <code class="docutils literal notranslate"><span class="pre">ReturnType</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code>, as appropriate. For example, we could have
annotated the first example as the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">squares</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i</span>
</pre></div>
</div>
<p>This is slightly different from using <code class="docutils literal notranslate"><span class="pre">Iterator[int]</span></code> or <code class="docutils literal notranslate"><span class="pre">Iterable[int]</span></code>,
since generators have <a class="reference external" href="https://docs.python.org/3/reference/expressions.html#generator.close" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code></a>, <a class="reference external" href="https://docs.python.org/3/reference/expressions.html#generator.send" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">send()</span></code></a>, and <a class="reference external" href="https://docs.python.org/3/reference/expressions.html#generator.throw" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">throw()</span></code></a> methods that
generic iterators and iterables don’t. If you plan to call these methods on the returned
generator, use the <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Generator" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generator</span></code></a> type instead of <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterator" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a>.</p>
</section>
</section>
<span id="document-class_basics"></span><section id="class-basics">
<span id="id1"></span><h3>Class basics<a class="headerlink" href="#class-basics" title="Permalink to this headline">#</a></h3>
<p>This section will help get you started annotating your
classes. Built-in classes such as <code class="docutils literal notranslate"><span class="pre">int</span></code> also follow these same
rules.</p>
<section id="instance-and-class-attributes">
<h4>Instance and class attributes<a class="headerlink" href="#instance-and-class-attributes" title="Permalink to this headline">#</a></h4>
<p>The mypy type checker detects if you are trying to access a missing
attribute, which is a very common programming error. For this to work
correctly, instance and class attributes must be defined or
initialized within the class. Mypy infers the types of attributes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>  <span class="c1"># Aha, attribute &#39;x&#39; of type &#39;int&#39;</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># OK!</span>
<span class="n">a</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Error: &quot;A&quot; has no attribute &quot;y&quot;</span>
</pre></div>
</div>
<p>This is a bit like each class having an implicitly defined
<a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__slots__" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">__slots__</span></code></a> attribute. This is only enforced during type
checking and not when your program is running.</p>
<p>You can declare types of variables in the class body explicitly using
a type annotation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>  <span class="c1"># Declare attribute &#39;x&#39; of type list[int]</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>     <span class="c1"># OK</span>
</pre></div>
</div>
<p>As in Python generally, a variable defined in the class body can be used
as a class or an instance variable. (As discussed in the next section, you
can override this with a <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a> annotation.)</p>
<p>Similarly, you can give explicit types to instance variables defined
in a method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>You can only define an instance variable within a method if you assign
to it explicitly using <code class="docutils literal notranslate"><span class="pre">self</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c1"># Define &#39;y&#39;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>      <span class="c1"># Error: &#39;x&#39; not defined</span>
</pre></div>
</div>
</section>
<section id="annotating-init-methods">
<h4>Annotating __init__ methods<a class="headerlink" href="#annotating-init-methods" title="Permalink to this headline">#</a></h4>
<p>The <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a> method is somewhat special – it doesn’t return a
value.  This is best expressed as <code class="docutils literal notranslate"><span class="pre">-&gt;</span> <span class="pre">None</span></code>.  However, since many feel
this is redundant, it is allowed to omit the return type declaration
on <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a> methods <strong>if at least one argument is annotated</strong>.  For
example, in the following classes <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a> is considered fully
annotated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">C1</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="mi">42</span>

<span class="k">class</span> <span class="nc">C2</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">arg</span>
</pre></div>
</div>
<p>However, if <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a> has no annotated arguments and no return type
annotation, it is considered an untyped method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">C3</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This body is not type checked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="mi">42</span> <span class="o">+</span> <span class="s1">&#39;abc&#39;</span>
</pre></div>
</div>
</section>
<section id="class-attribute-annotations">
<h4>Class attribute annotations<a class="headerlink" href="#class-attribute-annotations" title="Permalink to this headline">#</a></h4>
<p>You can use a <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar[t]</span></code></a> annotation to explicitly declare that a
particular attribute should not be set on instances:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">ClassVar</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Class variable only</span>

<span class="n">A</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># OK</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Error: Cannot assign to class variable &quot;x&quot; via instance</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># OK -- can be read through an instance</span>
</pre></div>
</div>
<p>It’s not necessary to annotate all class variables using
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a>. An attribute without the <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a> annotation can
still be used as a class variable. However, mypy won’t prevent it from
being used as an instance variable, as discussed previously:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Can be used as a class or instance variable</span>

<span class="n">A</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># OK</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Also OK</span>
</pre></div>
</div>
<p>Note that <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a> is not a class, and you can’t use it with
<a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/functions.html#issubclass" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">issubclass()</span></code></a>. It does not change Python
runtime behavior – it’s only for type checkers such as mypy (and
also helpful for human readers).</p>
<p>You can also omit the square brackets and the variable type in
a <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a> annotation, but this might not do what you’d expect:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">ClassVar</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Type implicitly Any!</span>
</pre></div>
</div>
<p>In this case the type of the attribute will be implicitly <code class="docutils literal notranslate"><span class="pre">Any</span></code>.
This behavior will change in the future, since it’s surprising.</p>
<p>An explicit <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a> may be particularly handy to distinguish
between class and instance variables with callable types. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">ClassVar</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">foo</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">bar</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">A</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span>
    <span class="n">bad</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">A</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>

<span class="n">A</span><span class="p">()</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="n">A</span><span class="p">()</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="n">A</span><span class="p">()</span><span class="o">.</span><span class="n">bad</span><span class="p">()</span>  <span class="c1"># Error: Too few arguments</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a> type parameter cannot include type variables:
<code class="docutils literal notranslate"><span class="pre">ClassVar[T]</span></code> and <code class="docutils literal notranslate"><span class="pre">ClassVar[list[T]]</span></code>
are both invalid if <code class="docutils literal notranslate"><span class="pre">T</span></code> is a type variable (see <a class="reference internal" href="index.html#generic-classes"><span class="std std-ref">Defining generic classes</span></a>
for more about type variables).</p>
</div>
</section>
<section id="overriding-statically-typed-methods">
<h4>Overriding statically typed methods<a class="headerlink" href="#overriding-statically-typed-methods" title="Permalink to this headline">#</a></h4>
<p>When overriding a statically typed method, mypy checks that the
override has a compatible signature:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived1</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># Error: type of &#39;x&#39; incompatible</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived2</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Error: too many arguments</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived3</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># OK</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived4</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># OK: mypy treats int as a subtype of float</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived5</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># OK: accepts more than the base</span>
        <span class="o">...</span>                                    <span class="c1">#     class method</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also vary return types <strong>covariantly</strong> in overriding. For
example, you could override the return type <code class="docutils literal notranslate"><span class="pre">Iterable[int]</span></code> with a
subtype such as <code class="docutils literal notranslate"><span class="pre">list[int]</span></code>. Similarly, you can vary argument types
<strong>contravariantly</strong> – subclasses can have more general argument types.</p>
</div>
<p>In order to ensure that your code remains correct when renaming methods,
it can be helpful to explicitly mark a method as overriding a base
method. This can be done with the <code class="docutils literal notranslate"><span class="pre">&#64;override</span></code> decorator. <code class="docutils literal notranslate"><span class="pre">&#64;override</span></code>
can be imported from <code class="docutils literal notranslate"><span class="pre">typing</span></code> starting with Python 3.12 or from
<code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> for use with older Python versions. If the base
method is then renamed while the overriding method is not, mypy will
show an error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">override</span>

<span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>
    <span class="k">def</span> <span class="nf">g_renamed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived1</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="nd">@override</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># OK</span>
        <span class="o">...</span>

    <span class="nd">@override</span>
    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>   <span class="c1"># Error: no corresponding base method found</span>
        <span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use <a class="reference internal" href="index.html#code-explicit-override"><span class="std std-ref">–enable-error-code explicit-override</span></a> to require
that method overrides use the <code class="docutils literal notranslate"><span class="pre">&#64;override</span></code> decorator. Emit an error if it is missing.</p>
</div>
<p>You can also override a statically typed method with a dynamically
typed one. This allows dynamically typed code to override methods
defined in library classes without worrying about their type
signatures.</p>
<p>As always, relying on dynamically typed code can be unsafe. There is no
runtime enforcement that the method override returns a value that is
compatible with the original return type, since annotations have no
effect at runtime:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">class</span> <span class="nc">Derived</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>   <span class="c1"># Override, dynamically typed</span>
        <span class="k">return</span> <span class="s1">&#39;hello&#39;</span>  <span class="c1"># Incompatible with &#39;Base&#39;, but no mypy error</span>
</pre></div>
</div>
</section>
<section id="abstract-base-classes-and-multiple-inheritance">
<h4>Abstract base classes and multiple inheritance<a class="headerlink" href="#abstract-base-classes-and-multiple-inheritance" title="Permalink to this headline">#</a></h4>
<p>Mypy supports Python <a class="reference external" href="https://docs.python.org/3/library/abc.html" title="(in Python v3.11)"><span class="xref std std-doc">abstract base classes</span></a> (ABCs). Abstract classes
have at least one abstract method or property that must be implemented
by any <em>concrete</em> (non-abstract) subclass. You can define abstract base
classes using the <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.ABCMeta" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABCMeta</span></code></a> metaclass and the <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.abstractmethod" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;abc.abstractmethod</span></code></a>
function decorator. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">Animal</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">eat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">food</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">can_walk</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span> <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Cat</span><span class="p">(</span><span class="n">Animal</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">eat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">food</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>  <span class="c1"># Body omitted</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">can_walk</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">Animal</span><span class="p">()</span>  <span class="c1"># Error: &#39;Animal&#39; is abstract due to &#39;eat&#39; and &#39;can_walk&#39;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">Cat</span><span class="p">()</span>     <span class="c1"># OK</span>
</pre></div>
</div>
<p>Note that mypy performs checking for unimplemented abstract methods
even if you omit the <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.ABCMeta" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ABCMeta</span></code></a> metaclass. This can be useful if the
metaclass would cause runtime metaclass conflicts.</p>
<p>Since you can’t create instances of ABCs, they are most commonly used in
type annotations. For example, this method accepts arbitrary iterables
containing arbitrary animals (instances of concrete <code class="docutils literal notranslate"><span class="pre">Animal</span></code>
subclasses):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">feed_all</span><span class="p">(</span><span class="n">animals</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Animal</span><span class="p">],</span> <span class="n">food</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">animal</span> <span class="ow">in</span> <span class="n">animals</span><span class="p">:</span>
        <span class="n">animal</span><span class="o">.</span><span class="n">eat</span><span class="p">(</span><span class="n">food</span><span class="p">)</span>
</pre></div>
</div>
<p>There is one important peculiarity about how ABCs work in Python –
whether a particular class is abstract or not is somewhat implicit.
In the example below, <code class="docutils literal notranslate"><span class="pre">Derived</span></code> is treated as an abstract base class
since <code class="docutils literal notranslate"><span class="pre">Derived</span></code> inherits an abstract <code class="docutils literal notranslate"><span class="pre">f</span></code> method from <code class="docutils literal notranslate"><span class="pre">Base</span></code> and
doesn’t explicitly implement it. The definition of <code class="docutils literal notranslate"><span class="pre">Derived</span></code>
generates no errors from mypy, since it’s a valid ABC:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Derived</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>  <span class="c1"># No error -- Derived is implicitly abstract</span>
    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Attempting to create an instance of <code class="docutils literal notranslate"><span class="pre">Derived</span></code> will be rejected,
however:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">Derived</span><span class="p">()</span>  <span class="c1"># Error: &#39;Derived&#39; is abstract</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It’s a common error to forget to implement an abstract method.
As shown above, the class definition will not generate an error
in this case, but any attempt to construct an instance will be
flagged as an error.</p>
</div>
<p>Mypy allows you to omit the body for an abstract method, but if you do so,
it is unsafe to call such method via <code class="docutils literal notranslate"><span class="pre">super()</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>
<span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="k">pass</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
<span class="k">class</span> <span class="nc">Sub</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># error: Call to abstract method &quot;foo&quot; of &quot;Base&quot;</span>
                                  <span class="c1"># with trivial body via super() is unsafe</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># This is OK however.</span>
</pre></div>
</div>
<p>A class can inherit any number of classes, both abstract and
concrete. As with normal overrides, a dynamically typed method can
override or implement a statically typed method defined in any base
class, including an abstract method defined in an abstract base class.</p>
<p>You can implement an abstract property using either a normal
property or an instance variable.</p>
</section>
<section id="slots">
<h4>Slots<a class="headerlink" href="#slots" title="Permalink to this headline">#</a></h4>
<p>When a class has explicitly defined
<a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#slots">__slots__</a>,
mypy will check that all attributes assigned to are members of <code class="docutils literal notranslate"><span class="pre">__slots__</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Album</span><span class="p">:</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>
       <span class="c1"># Error: Trying to assign name &quot;released&quot; that is not in &quot;__slots__&quot; of type &quot;Album&quot;</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">released</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">my_album</span> <span class="o">=</span> <span class="n">Album</span><span class="p">(</span><span class="s1">&#39;Songs about Python&#39;</span><span class="p">,</span> <span class="mi">2021</span><span class="p">)</span>
</pre></div>
</div>
<p>Mypy will only check attribute assignments against <code class="docutils literal notranslate"><span class="pre">__slots__</span></code> when
the following conditions hold:</p>
<ol class="arabic simple">
<li><p>All base classes (except builtin ones) must have explicit
<code class="docutils literal notranslate"><span class="pre">__slots__</span></code> defined (this mirrors Python semantics).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__slots__</span></code> does not include <code class="docutils literal notranslate"><span class="pre">__dict__</span></code>. If <code class="docutils literal notranslate"><span class="pre">__slots__</span></code>
includes <code class="docutils literal notranslate"><span class="pre">__dict__</span></code>, arbitrary attributes can be set, similar to
when <code class="docutils literal notranslate"><span class="pre">__slots__</span></code> is not defined (this mirrors Python semantics).</p></li>
<li><p>All values in <code class="docutils literal notranslate"><span class="pre">__slots__</span></code> must be string literals.</p></li>
</ol>
</section>
</section>
<span id="document-runtime_troubles"></span><section id="annotation-issues-at-runtime">
<span id="runtime-troubles"></span><h3>Annotation issues at runtime<a class="headerlink" href="#annotation-issues-at-runtime" title="Permalink to this headline">#</a></h3>
<p>Idiomatic use of type annotations can sometimes run up against what a given
version of Python considers legal code. This section describes these scenarios
and explains how to get your code running again. Generally speaking, we have
three tools at our disposal:</p>
<ul class="simple">
<li><p>Use of <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">annotations</span></code> (<span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0563/"><strong>PEP 563</strong></a>)
(this behaviour may eventually be made the default in a future Python version)</p></li>
<li><p>Use of string literal types or type comments</p></li>
<li><p>Use of <code class="docutils literal notranslate"><span class="pre">typing.TYPE_CHECKING</span></code></p></li>
</ul>
<p>We provide a description of these before moving onto discussion of specific
problems you may encounter.</p>
<section id="string-literal-types-and-type-comments">
<span id="string-literal-types"></span><h4>String literal types and type comments<a class="headerlink" href="#string-literal-types-and-type-comments" title="Permalink to this headline">#</a></h4>
<p>Mypy allows you to add type annotations using <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span></code> type comments.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># type: int</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>  <span class="c1"># type: (int) -&gt; int</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># Alternative type comment syntax for functions with many arguments</span>
<span class="k">def</span> <span class="nf">send_email</span><span class="p">(</span>
     <span class="n">address</span><span class="p">,</span>     <span class="c1"># type: Union[str, List[str]]</span>
     <span class="n">sender</span><span class="p">,</span>      <span class="c1"># type: str</span>
     <span class="n">cc</span><span class="p">,</span>          <span class="c1"># type: Optional[List[str]]</span>
     <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
     <span class="n">body</span><span class="o">=</span><span class="kc">None</span>    <span class="c1"># type: List[str]</span>
<span class="p">):</span>
    <span class="c1"># type: (...) -&gt; bool</span>
</pre></div>
</div>
<p>Type comments can’t cause runtime errors because comments are not evaluated by
Python.</p>
<p>In a similar way, using string literal types sidesteps the problem of
annotations that would cause runtime errors.</p>
<p>Any type can be entered as a string literal, and you can combine
string-literal types with non-string-literal types freely:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>  <span class="c1"># OK, prevents NameError since A is defined later</span>
<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>      <span class="c1"># Also OK, though not useful</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="k">pass</span>
</pre></div>
</div>
<p>String literal types are never needed in <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span></code> comments and <a class="reference internal" href="index.html#stub-files"><span class="std std-ref">stub files</span></a>.</p>
<p>String literal types must be defined (or imported) later <em>in the same module</em>.
They cannot be used to leave cross-module references unresolved.  (For dealing
with import cycles, see <a class="reference internal" href="#import-cycles"><span class="std std-ref">Import cycles</span></a>.)</p>
</section>
<section id="future-annotations-import-pep-563">
<span id="future-annotations"></span><h4>Future annotations import (PEP 563)<a class="headerlink" href="#future-annotations-import-pep-563" title="Permalink to this headline">#</a></h4>
<p>Many of the issues described here are caused by Python trying to evaluate
annotations. Future Python versions (potentially Python 3.12) will by default no
longer attempt to evaluate function and variable annotations. This behaviour is
made available in Python 3.7 and later through the use of
<code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">annotations</span></code>.</p>
<p>This can be thought of as automatic string literal-ification of all function and
variable annotations. Note that function and variable annotations are still
required to be valid Python syntax. For more details, see <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0563/"><strong>PEP 563</strong></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Even with the <code class="docutils literal notranslate"><span class="pre">__future__</span></code> import, there are some scenarios that could
still require string literals or result in errors, typically involving use
of forward references or generics in:</p>
<ul class="simple">
<li><p><a class="reference internal" href="index.html#type-aliases"><span class="std std-ref">type aliases</span></a>;</p></li>
<li><p><a class="reference internal" href="index.html#type-narrowing"><span class="std std-ref">type narrowing</span></a>;</p></li>
<li><p>type definitions (see <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.TypeVar" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NewType" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NewType</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NamedTuple" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NamedTuple</span></code></a>);</p></li>
<li><p>base classes.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># base class example</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]):</span> <span class="o">...</span> <span class="c1"># String literal types needed here</span>
<span class="k">class</span> <span class="nc">B</span><span class="p">:</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">C</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Some libraries may have use cases for dynamic evaluation of annotations, for
instance, through use of <code class="docutils literal notranslate"><span class="pre">typing.get_type_hints</span></code> or <code class="docutils literal notranslate"><span class="pre">eval</span></code>. If your
annotation would raise an error when evaluated (say by using <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0604/"><strong>PEP 604</strong></a>
syntax with Python 3.9), you may need to be careful when using such
libraries.</p>
</div>
</section>
<section id="typing-type-checking">
<span id="id1"></span><h4>typing.TYPE_CHECKING<a class="headerlink" href="#typing-type-checking" title="Permalink to this headline">#</a></h4>
<p>The <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> module defines a <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.TYPE_CHECKING" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">TYPE_CHECKING</span></code></a> constant
that is <code class="docutils literal notranslate"><span class="pre">False</span></code> at runtime but treated as <code class="docutils literal notranslate"><span class="pre">True</span></code> while type checking.</p>
<p>Since code inside <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">TYPE_CHECKING:</span></code> is not executed at runtime, it provides
a convenient way to tell mypy something without the code being evaluated at
runtime. This is most useful for resolving <a class="reference internal" href="#import-cycles"><span class="std std-ref">import cycles</span></a>.</p>
</section>
<section id="class-name-forward-references">
<span id="forward-references"></span><h4>Class name forward references<a class="headerlink" href="#class-name-forward-references" title="Permalink to this headline">#</a></h4>
<p>Python does not allow references to a class object before the class is
defined (aka forward reference). Thus this code does not work as expected:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>  <span class="c1"># NameError: name &quot;A&quot; is not defined</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
<p>Starting from Python 3.7, you can add <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">annotations</span></code> to
resolve this, as discussed earlier:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>  <span class="c1"># OK</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
<p>For Python 3.6 and below, you can enter the type as a string literal or type comment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>  <span class="c1"># OK</span>

<span class="c1"># Also OK</span>
<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>  <span class="c1"># type: (A) -&gt; None</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
<p>Of course, instead of using future annotations import or string literal types,
you could move the function definition after the class definition. This is not
always desirable or even possible, though.</p>
</section>
<section id="import-cycles">
<span id="id2"></span><h4>Import cycles<a class="headerlink" href="#import-cycles" title="Permalink to this headline">#</a></h4>
<p>An import cycle occurs where module A imports module B and module B
imports module A (perhaps indirectly, e.g. <code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">-&gt;</span> <span class="pre">B</span> <span class="pre">-&gt;</span> <span class="pre">C</span> <span class="pre">-&gt;</span> <span class="pre">A</span></code>).
Sometimes in order to add type annotations you have to add extra
imports to a module and those imports cause cycles that didn’t exist
before. This can lead to errors at runtime like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ImportError: cannot import name &#39;b&#39; from partially initialized module &#39;A&#39; (most likely due to a circular import)
</pre></div>
</div>
<p>If those cycles do become a problem when running your program, there’s a trick:
if the import is only needed for type annotations and you’re using a) the
<a class="reference internal" href="#future-annotations"><span class="std std-ref">future annotations import</span></a>, or b) string literals or type
comments for the relevant annotations, you can write the imports inside <code class="docutils literal notranslate"><span class="pre">if</span>
<span class="pre">TYPE_CHECKING:</span></code> so that they are not executed at runtime. Example:</p>
<p>File <code class="docutils literal notranslate"><span class="pre">foo.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">bar</span>

<span class="k">def</span> <span class="nf">listify</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="s1">&#39;bar.BarClass&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;list[bar.BarClass]&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">arg</span><span class="p">]</span>
</pre></div>
</div>
<p>File <code class="docutils literal notranslate"><span class="pre">bar.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">foo</span> <span class="kn">import</span> <span class="n">listify</span>

<span class="k">class</span> <span class="nc">BarClass</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">listifyme</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;list[BarClass]&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">listify</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="using-classes-that-are-generic-in-stubs-but-not-at-runtime">
<span id="not-generic-runtime"></span><h4>Using classes that are generic in stubs but not at runtime<a class="headerlink" href="#using-classes-that-are-generic-in-stubs-but-not-at-runtime" title="Permalink to this headline">#</a></h4>
<p>Some classes are declared as <a class="reference internal" href="index.html#generic-classes"><span class="std std-ref">generic</span></a> in stubs, but not
at runtime.</p>
<p>In Python 3.8 and earlier, there are several examples within the standard library,
for instance, <a class="reference external" href="https://docs.python.org/3/library/os.html#os.PathLike" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">os.PathLike</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/queue.html#queue.Queue" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">queue.Queue</span></code></a>. Subscripting
such a class will result in a runtime error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Queue</span>

<span class="k">class</span> <span class="nc">Tasks</span><span class="p">(</span><span class="n">Queue</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>  <span class="c1"># TypeError: &#39;type&#39; object is not subscriptable</span>
    <span class="o">...</span>

<span class="n">results</span><span class="p">:</span> <span class="n">Queue</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>  <span class="c1"># TypeError: &#39;type&#39; object is not subscriptable</span>
</pre></div>
</div>
<p>To avoid errors from use of these generics in annotations, just use the
<a class="reference internal" href="#future-annotations"><span class="std std-ref">future annotations import</span></a> (or string literals or type
comments for Python 3.6 and below).</p>
<p>To avoid errors when inheriting from these classes, things are a little more
complicated and you need to use <a class="reference internal" href="#typing-type-checking"><span class="std std-ref">typing.TYPE_CHECKING</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
<span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Queue</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="n">BaseQueue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># this is only processed by mypy</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">BaseQueue</span> <span class="o">=</span> <span class="n">Queue</span>  <span class="c1"># this is not seen by mypy but will be executed at runtime</span>

<span class="k">class</span> <span class="nc">Tasks</span><span class="p">(</span><span class="n">BaseQueue</span><span class="p">):</span>  <span class="c1"># OK</span>
    <span class="o">...</span>

<span class="n">task_queue</span><span class="p">:</span> <span class="n">Tasks</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">task_queue</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>  <span class="c1"># Reveals str</span>
</pre></div>
</div>
<p>If your subclass is also generic, you can use the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Generic</span>
<span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Queue</span>

<span class="n">_T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">_MyQueueBase</span><span class="p">(</span><span class="n">Queue</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span> <span class="k">pass</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">_MyQueueBase</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_T</span><span class="p">],</span> <span class="n">Queue</span><span class="p">):</span> <span class="k">pass</span>

<span class="k">class</span> <span class="nc">MyQueue</span><span class="p">(</span><span class="n">_MyQueueBase</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span> <span class="k">pass</span>

<span class="n">task_queue</span><span class="p">:</span> <span class="n">MyQueue</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">task_queue</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>  <span class="c1"># Reveals str</span>
</pre></div>
</div>
<p>In Python 3.9, we can just inherit directly from <code class="docutils literal notranslate"><span class="pre">Queue[str]</span></code> or <code class="docutils literal notranslate"><span class="pre">Queue[T]</span></code>
since its <a class="reference external" href="https://docs.python.org/3/library/queue.html#queue.Queue" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">queue.Queue</span></code></a> implements <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__class_getitem__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__class_getitem__()</span></code></a>, so
the class object can be subscripted at runtime without issue.</p>
</section>
<section id="using-types-defined-in-stubs-but-not-at-runtime">
<h4>Using types defined in stubs but not at runtime<a class="headerlink" href="#using-types-defined-in-stubs-but-not-at-runtime" title="Permalink to this headline">#</a></h4>
<p>Sometimes stubs that you’re using may define types you wish to re-use that do
not exist at runtime. Importing these types naively will cause your code to fail
at runtime with <code class="docutils literal notranslate"><span class="pre">ImportError</span></code> or <code class="docutils literal notranslate"><span class="pre">ModuleNotFoundError</span></code>. Similar to previous
sections, these can be dealt with by using <a class="reference internal" href="#typing-type-checking"><span class="std std-ref">typing.TYPE_CHECKING</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">_typeshed</span> <span class="kn">import</span> <span class="n">SupportsRichComparison</span>

 <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">SupportsRichComparison</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">annotations</span></code> is required to avoid
a <code class="docutils literal notranslate"><span class="pre">NameError</span></code> when using the imported symbol.
For more information and caveats, see the section on
<a class="reference internal" href="#future-annotations"><span class="std std-ref">future annotations</span></a>.</p>
</section>
<section id="using-generic-builtins">
<span id="generic-builtins"></span><h4>Using generic builtins<a class="headerlink" href="#using-generic-builtins" title="Permalink to this headline">#</a></h4>
<p>Starting with Python 3.9 (<span class="target" id="index-3"></span><a class="pep reference external" href="https://peps.python.org/pep-0585/"><strong>PEP 585</strong></a>), the type objects of many collections in
the standard library support subscription at runtime. This means that you no
longer have to import the equivalents from <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a>; you can simply use
the built-in collections or those from <a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#module-collections.abc" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">collections.abc</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Sequence</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="n">y</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="n">z</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
</pre></div>
</div>
<p>There is limited support for using this syntax in Python 3.7 and later as well:
if you use <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">annotations</span></code>, mypy will understand this
syntax in annotations. However, since this will not be supported by the Python
interpreter at runtime, make sure you’re aware of the caveats mentioned in the
notes at <a class="reference internal" href="#future-annotations"><span class="std std-ref">future annotations import</span></a>.</p>
</section>
<section id="using-x-y-syntax-for-unions">
<h4>Using X | Y syntax for Unions<a class="headerlink" href="#using-x-y-syntax-for-unions" title="Permalink to this headline">#</a></h4>
<p>Starting with Python 3.10 (<span class="target" id="index-4"></span><a class="pep reference external" href="https://peps.python.org/pep-0604/"><strong>PEP 604</strong></a>), you can spell union types as <code class="docutils literal notranslate"><span class="pre">x:</span> <span class="pre">int</span> <span class="pre">|</span>
<span class="pre">str</span></code>, instead of <code class="docutils literal notranslate"><span class="pre">x:</span> <span class="pre">typing.Union[int,</span> <span class="pre">str]</span></code>.</p>
<p>There is limited support for using this syntax in Python 3.7 and later as well:
if you use <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">annotations</span></code>, mypy will understand this
syntax in annotations, string literal types, type comments and stub files.
However, since this will not be supported by the Python interpreter at runtime
(if evaluated, <code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">|</span> <span class="pre">str</span></code> will raise <code class="docutils literal notranslate"><span class="pre">TypeError:</span> <span class="pre">unsupported</span> <span class="pre">operand</span> <span class="pre">type(s)</span>
<span class="pre">for</span> <span class="pre">|:</span> <span class="pre">'type'</span> <span class="pre">and</span> <span class="pre">'type'</span></code>), make sure you’re aware of the caveats mentioned in
the notes at <a class="reference internal" href="#future-annotations"><span class="std std-ref">future annotations import</span></a>.</p>
</section>
<section id="using-new-additions-to-the-typing-module">
<h4>Using new additions to the typing module<a class="headerlink" href="#using-new-additions-to-the-typing-module" title="Permalink to this headline">#</a></h4>
<p>You may find yourself wanting to use features added to the <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a>
module in earlier versions of Python than the addition, for example, using any
of <code class="docutils literal notranslate"><span class="pre">Literal</span></code>, <code class="docutils literal notranslate"><span class="pre">Protocol</span></code>, <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> with Python 3.6.</p>
<p>The easiest way to do this is to install and use the <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code>
package from PyPI for the relevant imports, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>
<span class="n">x</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>If you don’t want to rely on <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> being installed on newer
Pythons, you could alternatively use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="n">x</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>This plays nicely well with following <span class="target" id="index-5"></span><a class="pep reference external" href="https://peps.python.org/pep-0508/"><strong>PEP 508</strong></a> dependency specification:
<code class="docutils literal notranslate"><span class="pre">typing_extensions;</span> <span class="pre">python_version&lt;&quot;3.8&quot;</span></code></p>
</section>
</section>
<span id="document-protocols"></span><section id="protocols-and-structural-subtyping">
<span id="protocol-types"></span><h3>Protocols and structural subtyping<a class="headerlink" href="#protocols-and-structural-subtyping" title="Permalink to this headline">#</a></h3>
<p>The Python type system supports two ways of deciding whether two objects are
compatible as types: nominal subtyping and structural subtyping.</p>
<p><em>Nominal</em> subtyping is strictly based on the class hierarchy. If class <code class="docutils literal notranslate"><span class="pre">Dog</span></code>
inherits class <code class="docutils literal notranslate"><span class="pre">Animal</span></code>, it’s a subtype of <code class="docutils literal notranslate"><span class="pre">Animal</span></code>. Instances of <code class="docutils literal notranslate"><span class="pre">Dog</span></code>
can be used when <code class="docutils literal notranslate"><span class="pre">Animal</span></code> instances are expected. This form of subtyping
subtyping is what Python’s type system predominantly uses: it’s easy to
understand and produces clear and concise error messages, and matches how the
native <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance</span></code></a> check works – based on class
hierarchy.</p>
<p><em>Structural</em> subtyping is based on the operations that can be performed with an
object. Class <code class="docutils literal notranslate"><span class="pre">Dog</span></code> is a structural subtype of class <code class="docutils literal notranslate"><span class="pre">Animal</span></code> if the former
has all attributes and methods of the latter, and with compatible types.</p>
<p>Structural subtyping can be seen as a static equivalent of duck typing, which is
well known to Python programmers. See <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0544/"><strong>PEP 544</strong></a> for the detailed specification
of protocols and structural subtyping in Python.</p>
<section id="predefined-protocols">
<span id="id1"></span><h4>Predefined protocols<a class="headerlink" href="#predefined-protocols" title="Permalink to this headline">#</a></h4>
<p>The <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> module defines various protocol classes that correspond
to common Python protocols, such as <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable[T]</span></code></a>. If a class
defines a suitable <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__iter__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__iter__</span></code></a> method, mypy understands that it
implements the iterable protocol and is compatible with <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable[T]</span></code></a>.
For example, <code class="docutils literal notranslate"><span class="pre">IntList</span></code> below is iterable, over <code class="docutils literal notranslate"><span class="pre">int</span></code> values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">class</span> <span class="nc">IntList</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">next</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;IntList&#39;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">next</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="n">current</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">current</span><span class="o">.</span><span class="n">value</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">next</span>

<span class="k">def</span> <span class="nf">print_numbered</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">IntList</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">IntList</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="n">print_numbered</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="n">print_numbered</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>  <span class="c1"># Also OK</span>
</pre></div>
</div>
<p><a class="reference internal" href="#predefined-protocols-reference"><span class="std std-ref">Predefined protocol reference</span></a> lists all protocols defined in
<a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> and the signatures of the corresponding methods you need to define
to implement each protocol.</p>
</section>
<section id="simple-user-defined-protocols">
<h4>Simple user-defined protocols<a class="headerlink" href="#simple-user-defined-protocols" title="Permalink to this headline">#</a></h4>
<p>You can define your own protocol class by inheriting the special <code class="docutils literal notranslate"><span class="pre">Protocol</span></code>
class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="k">class</span> <span class="nc">SupportsClose</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="c1"># Empty method body (explicit &#39;...&#39;)</span>
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">Resource</span><span class="p">:</span>  <span class="c1"># No SupportsClose base class!</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

    <span class="c1"># ... other methods ...</span>

<span class="k">def</span> <span class="nf">close_all</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">SupportsClose</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">item</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">close_all</span><span class="p">([</span><span class="n">Resource</span><span class="p">(),</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;some/file&#39;</span><span class="p">)])</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Resource</span></code> is a subtype of the <code class="docutils literal notranslate"><span class="pre">SupportsClose</span></code> protocol since it defines
a compatible <code class="docutils literal notranslate"><span class="pre">close</span></code> method. Regular file objects returned by <a class="reference external" href="https://docs.python.org/3/library/functions.html#open" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">open()</span></code></a> are
similarly compatible with the protocol, as they support <code class="docutils literal notranslate"><span class="pre">close()</span></code>.</p>
</section>
<section id="defining-subprotocols-and-subclassing-protocols">
<h4>Defining subprotocols and subclassing protocols<a class="headerlink" href="#defining-subprotocols-and-subclassing-protocols" title="Permalink to this headline">#</a></h4>
<p>You can also define subprotocols. Existing protocols can be extended
and merged using multiple inheritance. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ... continuing from the previous example</span>

<span class="k">class</span> <span class="nc">SupportsRead</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">TaggedReadableResource</span><span class="p">(</span><span class="n">SupportsClose</span><span class="p">,</span> <span class="n">SupportsRead</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">):</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">class</span> <span class="nc">AdvancedResource</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="c1"># some implementation</span>
        <span class="o">...</span>

<span class="n">resource</span><span class="p">:</span> <span class="n">TaggedReadableResource</span>
<span class="n">resource</span> <span class="o">=</span> <span class="n">AdvancedResource</span><span class="p">(</span><span class="s1">&#39;handle with care&#39;</span><span class="p">)</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<p>Note that inheriting from an existing protocol does not automatically
turn the subclass into a protocol – it just creates a regular
(non-protocol) class or ABC that implements the given protocol (or
protocols). The <code class="docutils literal notranslate"><span class="pre">Protocol</span></code> base class must always be explicitly
present if you are defining a protocol:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NotAProtocol</span><span class="p">(</span><span class="n">SupportsClose</span><span class="p">):</span>  <span class="c1"># This is NOT a protocol</span>
    <span class="n">new_attr</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">Concrete</span><span class="p">:</span>
   <span class="n">new_attr</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

   <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
       <span class="o">...</span>

<span class="c1"># Error: nominal subtyping used by default</span>
<span class="n">x</span><span class="p">:</span> <span class="n">NotAProtocol</span> <span class="o">=</span> <span class="n">Concrete</span><span class="p">()</span>  <span class="c1"># Error!</span>
</pre></div>
</div>
<p>You can also include default implementations of methods in
protocols. If you explicitly subclass these protocols you can inherit
these default implementations.</p>
<p>Explicitly including a protocol as a
base class is also a way of documenting that your class implements a
particular protocol, and it forces mypy to verify that your class
implementation is actually compatible with the protocol. In particular,
omitting a value for an attribute or a method body will make it implicitly
abstract:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomeProto</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="n">attr</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Note, no right hand side</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">...</span>  <span class="c1"># Literally just ... here</span>

<span class="k">class</span> <span class="nc">ExplicitSubclass</span><span class="p">(</span><span class="n">SomeProto</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">ExplicitSubclass</span><span class="p">()</span>  <span class="c1"># error: Cannot instantiate abstract class &#39;ExplicitSubclass&#39;</span>
                    <span class="c1"># with abstract attributes &#39;attr&#39; and &#39;method&#39;</span>
</pre></div>
</div>
<p>Similarly, explicitly assigning to a protocol instance can be a way to ask the
type checker to verify that your class implements a protocol:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">_proto</span><span class="p">:</span> <span class="n">SomeProto</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">ExplicitSubclass</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="invariance-of-protocol-attributes">
<h4>Invariance of protocol attributes<a class="headerlink" href="#invariance-of-protocol-attributes" title="Permalink to this headline">#</a></h4>
<p>A common issue with protocols is that protocol attributes are invariant.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Box</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
      <span class="n">content</span><span class="p">:</span> <span class="nb">object</span>

<span class="k">class</span> <span class="nc">IntBox</span><span class="p">:</span>
      <span class="n">content</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">takes_box</span><span class="p">(</span><span class="n">box</span><span class="p">:</span> <span class="n">Box</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="n">takes_box</span><span class="p">(</span><span class="n">IntBox</span><span class="p">())</span>  <span class="c1"># error: Argument 1 to &quot;takes_box&quot; has incompatible type &quot;IntBox&quot;; expected &quot;Box&quot;</span>
                     <span class="c1"># note:  Following member(s) of &quot;IntBox&quot; have conflicts:</span>
                     <span class="c1"># note:      content: expected &quot;object&quot;, got &quot;int&quot;</span>
</pre></div>
</div>
<p>This is because <code class="docutils literal notranslate"><span class="pre">Box</span></code> defines <code class="docutils literal notranslate"><span class="pre">content</span></code> as a mutable attribute.
Here’s why this is problematic:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">takes_box_evil</span><span class="p">(</span><span class="n">box</span><span class="p">:</span> <span class="n">Box</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">box</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;asdf&quot;</span>  <span class="c1"># This is bad, since box.content is supposed to be an object</span>

<span class="n">my_int_box</span> <span class="o">=</span> <span class="n">IntBox</span><span class="p">()</span>
<span class="n">takes_box_evil</span><span class="p">(</span><span class="n">my_int_box</span><span class="p">)</span>
<span class="n">my_int_box</span><span class="o">.</span><span class="n">content</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Oops, TypeError!</span>
</pre></div>
</div>
<p>This can be fixed by declaring <code class="docutils literal notranslate"><span class="pre">content</span></code> to be read-only in the <code class="docutils literal notranslate"><span class="pre">Box</span></code>
protocol using <code class="docutils literal notranslate"><span class="pre">&#64;property</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Box</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">IntBox</span><span class="p">:</span>
    <span class="n">content</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">takes_box</span><span class="p">(</span><span class="n">box</span><span class="p">:</span> <span class="n">Box</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="n">takes_box</span><span class="p">(</span><span class="n">IntBox</span><span class="p">(</span><span class="mi">42</span><span class="p">))</span>  <span class="c1"># OK</span>
</pre></div>
</div>
</section>
<section id="recursive-protocols">
<h4>Recursive protocols<a class="headerlink" href="#recursive-protocols" title="Permalink to this headline">#</a></h4>
<p>Protocols can be recursive (self-referential) and mutually
recursive. This is useful for declaring abstract recursive collections
such as trees and linked lists:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="k">class</span> <span class="nc">TreeLike</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">int</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">left</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;TreeLike&#39;</span><span class="p">]:</span> <span class="o">...</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">right</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;TreeLike&#39;</span><span class="p">]:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">SimpleTree</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;SimpleTree&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s1">&#39;SimpleTree&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">root</span><span class="p">:</span> <span class="n">TreeLike</span> <span class="o">=</span> <span class="n">SimpleTree</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># OK</span>
</pre></div>
</div>
</section>
<section id="using-isinstance-with-protocols">
<h4>Using isinstance() with protocols<a class="headerlink" href="#using-isinstance-with-protocols" title="Permalink to this headline">#</a></h4>
<p>You can use a protocol class with <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> if you decorate it
with the <code class="docutils literal notranslate"><span class="pre">&#64;runtime_checkable</span></code> class decorator. The decorator adds
rudimentary support for runtime structural checks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">runtime_checkable</span>

<span class="nd">@runtime_checkable</span>
<span class="k">class</span> <span class="nc">Portable</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="n">handles</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">Mug</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">use</span><span class="p">(</span><span class="n">handles</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="n">mug</span> <span class="o">=</span> <span class="n">Mug</span><span class="p">()</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mug</span><span class="p">,</span> <span class="n">Portable</span><span class="p">):</span>  <span class="c1"># Works at runtime!</span>
   <span class="n">use</span><span class="p">(</span><span class="n">mug</span><span class="o">.</span><span class="n">handles</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> also works with the <a class="reference internal" href="#predefined-protocols"><span class="std std-ref">predefined protocols</span></a>
in <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> such as <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> with protocols is not completely safe at runtime.
For example, signatures of methods are not checked. The runtime
implementation only checks that all protocol members exist,
not that they have the correct type. <a class="reference external" href="https://docs.python.org/3/library/functions.html#issubclass" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">issubclass()</span></code></a> with protocols
will only check for the existence of methods.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> with protocols can also be surprisingly slow.
In many cases, you’re better served by using <a class="reference external" href="https://docs.python.org/3/library/functions.html#hasattr" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">hasattr()</span></code></a> to
check for the presence of attributes.</p>
</div>
</section>
<section id="callback-protocols">
<span id="id2"></span><h4>Callback protocols<a class="headerlink" href="#callback-protocols" title="Permalink to this headline">#</a></h4>
<p>Protocols can be used to define flexible callback types that are hard
(or even impossible) to express using the <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable[...]</span></code></a> syntax, such as variadic,
overloaded, and complex generic callbacks. They are defined with a special <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__call__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__call__</span></code></a>
member:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="k">class</span> <span class="nc">Combiner</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">vals</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">batch_proc</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">bytes</span><span class="p">],</span> <span class="n">cb_results</span><span class="p">:</span> <span class="n">Combiner</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="o">...</span>

<span class="k">def</span> <span class="nf">good_cb</span><span class="p">(</span><span class="o">*</span><span class="n">vals</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">maxlen</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span>
    <span class="o">...</span>
<span class="k">def</span> <span class="nf">bad_cb</span><span class="p">(</span><span class="o">*</span><span class="n">vals</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">maxitems</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span>
    <span class="o">...</span>

<span class="n">batch_proc</span><span class="p">([],</span> <span class="n">good_cb</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="n">batch_proc</span><span class="p">([],</span> <span class="n">bad_cb</span><span class="p">)</span>   <span class="c1"># Error! Argument 2 has incompatible type because of</span>
                         <span class="c1"># different name and kind in the callback</span>
</pre></div>
</div>
<p>Callback protocols and <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a> types can be used mostly interchangeably.
Argument names in <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__call__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__call__</span></code></a> methods must be identical, unless
a double underscore prefix is used. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">TypeVar</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Copy</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">__origin</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span> <span class="o">...</span>

<span class="n">copy_a</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="n">T</span><span class="p">]</span>
<span class="n">copy_b</span><span class="p">:</span> <span class="n">Copy</span>

<span class="n">copy_a</span> <span class="o">=</span> <span class="n">copy_b</span>  <span class="c1"># OK</span>
<span class="n">copy_b</span> <span class="o">=</span> <span class="n">copy_a</span>  <span class="c1"># Also OK</span>
</pre></div>
</div>
</section>
<section id="predefined-protocol-reference">
<span id="predefined-protocols-reference"></span><h4>Predefined protocol reference<a class="headerlink" href="#predefined-protocol-reference" title="Permalink to this headline">#</a></h4>
<section id="iteration-protocols">
<h5>Iteration protocols<a class="headerlink" href="#iteration-protocols" title="Permalink to this headline">#</a></h5>
<p>The iteration protocols are useful in many contexts. For example, they allow
iteration of objects in for loops.</p>
<section id="iterable-t">
<h6>Iterable[T]<a class="headerlink" href="#iterable-t" title="Permalink to this headline">#</a></h6>
<p>The <a class="reference internal" href="#predefined-protocols"><span class="std std-ref">example above</span></a> has a simple implementation of an
<a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__iter__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__iter__</span></code></a> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a>.</p>
</section>
<section id="iterator-t">
<h6>Iterator[T]<a class="headerlink" href="#iterator-t" title="Permalink to this headline">#</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span>
<span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterator" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterator</span></code></a>.</p>
</section>
</section>
<section id="collection-protocols">
<h5>Collection protocols<a class="headerlink" href="#collection-protocols" title="Permalink to this headline">#</a></h5>
<p>Many of these are implemented by built-in container types such as
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, and these are also useful for user-defined
collection objects.</p>
<section id="sized">
<h6>Sized<a class="headerlink" href="#sized" title="Permalink to this headline">#</a></h6>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#len" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">len(x)</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sized" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sized</span></code></a>.</p>
</section>
<section id="container-t">
<h6>Container[T]<a class="headerlink" href="#container-t" title="Permalink to this headline">#</a></h6>
<p>This is a type for objects that support the <code class="docutils literal notranslate"><span class="pre">in</span></code> operator.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Container" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Container</span></code></a>.</p>
</section>
<section id="collection-t">
<h6>Collection[T]<a class="headerlink" href="#collection-t" title="Permalink to this headline">#</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
<span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
<span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Collection" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Collection</span></code></a>.</p>
</section>
</section>
<section id="one-off-protocols">
<h5>One-off protocols<a class="headerlink" href="#one-off-protocols" title="Permalink to this headline">#</a></h5>
<p>These protocols are typically only useful with a single standard
library function or class.</p>
<section id="reversible-t">
<h6>Reversible[T]<a class="headerlink" href="#reversible-t" title="Permalink to this headline">#</a></h6>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#reversed" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">reversed(x)</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__reversed__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Reversible" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Reversible</span></code></a>.</p>
</section>
<section id="supportsabs-t">
<h6>SupportsAbs[T]<a class="headerlink" href="#supportsabs-t" title="Permalink to this headline">#</a></h6>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#abs" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">abs(x)</span></code></a>. <code class="docutils literal notranslate"><span class="pre">T</span></code> is the type of
value returned by <a class="reference external" href="https://docs.python.org/3/library/functions.html#abs" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">abs(x)</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.SupportsAbs" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupportsAbs</span></code></a>.</p>
</section>
<section id="supportsbytes">
<h6>SupportsBytes<a class="headerlink" href="#supportsbytes" title="Permalink to this headline">#</a></h6>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bytes(x)</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__bytes__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.SupportsBytes" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupportsBytes</span></code></a>.</p>
</section>
<section id="supportscomplex">
<span id="supports-int-etc"></span><h6>SupportsComplex<a class="headerlink" href="#supportscomplex" title="Permalink to this headline">#</a></h6>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#complex" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">complex(x)</span></code></a>. Note that no arithmetic operations
are supported.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__complex__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">complex</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.SupportsComplex" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupportsComplex</span></code></a>.</p>
</section>
<section id="supportsfloat">
<h6>SupportsFloat<a class="headerlink" href="#supportsfloat" title="Permalink to this headline">#</a></h6>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float(x)</span></code></a>. Note that no arithmetic operations
are supported.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.SupportsFloat" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupportsFloat</span></code></a>.</p>
</section>
<section id="supportsint">
<h6>SupportsInt<a class="headerlink" href="#supportsint" title="Permalink to this headline">#</a></h6>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int(x)</span></code></a>. Note that no arithmetic operations
are supported.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.SupportsInt" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupportsInt</span></code></a>.</p>
</section>
<section id="supportsround-t">
<h6>SupportsRound[T]<a class="headerlink" href="#supportsround-t" title="Permalink to this headline">#</a></h6>
<p>This is a type for objects that support <a class="reference external" href="https://docs.python.org/3/library/functions.html#round" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">round(x)</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__round__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.SupportsRound" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">SupportsRound</span></code></a>.</p>
</section>
</section>
<section id="async-protocols">
<h5>Async protocols<a class="headerlink" href="#async-protocols" title="Permalink to this headline">#</a></h5>
<p>These protocols can be useful in async code. See <a class="reference internal" href="index.html#async-and-await"><span class="std std-ref">Typing async/await</span></a>
for more information.</p>
<section id="awaitable-t">
<h6>Awaitable[T]<a class="headerlink" href="#awaitable-t" title="Permalink to this headline">#</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__await__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Awaitable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Awaitable</span></code></a>.</p>
</section>
<section id="asynciterable-t">
<h6>AsyncIterable[T]<a class="headerlink" href="#asynciterable-t" title="Permalink to this headline">#</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__aiter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.AsyncIterable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncIterable</span></code></a>.</p>
</section>
<section id="asynciterator-t">
<h6>AsyncIterator[T]<a class="headerlink" href="#asynciterator-t" title="Permalink to this headline">#</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__anext__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Awaitable</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
<span class="k">def</span> <span class="fm">__aiter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.AsyncIterator" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncIterator</span></code></a>.</p>
</section>
</section>
<section id="context-manager-protocols">
<h5>Context manager protocols<a class="headerlink" href="#context-manager-protocols" title="Permalink to this headline">#</a></h5>
<p>There are two protocols for context managers – one for regular context
managers and one for async ones. These allow defining objects that can
be used in <code class="docutils literal notranslate"><span class="pre">with</span></code> and <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">with</span></code> statements.</p>
<section id="contextmanager-t">
<h6>ContextManager[T]<a class="headerlink" href="#contextmanager-t" title="Permalink to this headline">#</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span>
<span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">exc_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
             <span class="n">exc_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
             <span class="n">traceback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracebackType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ContextManager" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ContextManager</span></code></a>.</p>
</section>
<section id="asynccontextmanager-t">
<h6>AsyncContextManager[T]<a class="headerlink" href="#asynccontextmanager-t" title="Permalink to this headline">#</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Awaitable</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>
<span class="k">def</span> <span class="fm">__aexit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
              <span class="n">exc_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]],</span>
              <span class="n">exc_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">],</span>
              <span class="n">traceback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracebackType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Awaitable</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.AsyncContextManager" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncContextManager</span></code></a>.</p>
</section>
</section>
</section>
</section>
<span id="document-dynamic_typing"></span><section id="dynamically-typed-code">
<span id="dynamic-typing"></span><h3>Dynamically typed code<a class="headerlink" href="#dynamically-typed-code" title="Permalink to this headline">#</a></h3>
<p>In <a class="reference internal" href="index.html#getting-started-dynamic-vs-static"><span class="std std-ref">Dynamic vs static typing</span></a>, we discussed how bodies of functions
that don’t have any explicit type annotations in their function are “dynamically typed”
and that mypy will not check them. In this section, we’ll talk a little bit more
about what that means and how you can enable dynamic typing on a more fine grained basis.</p>
<p>In cases where your code is too magical for mypy to understand, you can make a
variable or parameter dynamically typed by explicitly giving it the type
<code class="docutils literal notranslate"><span class="pre">Any</span></code>. Mypy will let you do basically anything with a value of type <code class="docutils literal notranslate"><span class="pre">Any</span></code>,
including assigning a value of type <code class="docutils literal notranslate"><span class="pre">Any</span></code> to a variable of any type (or vice
versa).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1"># Statically typed (inferred to be int)</span>
<span class="n">num</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>       <span class="c1"># error: Incompatible types in assignment (expression has type &quot;str&quot;, variable has type &quot;int&quot;)</span>

<span class="n">dyn</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">1</span>    <span class="c1"># Dynamically typed (type Any)</span>
<span class="n">dyn</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>       <span class="c1"># OK</span>

<span class="n">num</span> <span class="o">=</span> <span class="n">dyn</span>       <span class="c1"># No error, mypy will let you assign a value of type Any to any variable</span>
<span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>        <span class="c1"># Oops, mypy still thinks num is an int</span>
</pre></div>
</div>
<p>You can think of <code class="docutils literal notranslate"><span class="pre">Any</span></code> as a way to locally disable type checking.
See <a class="reference internal" href="index.html#silencing-type-errors"><span class="std std-ref">Silencing type errors</span></a> for other ways you can shut up
the type checker.</p>
<section id="operations-on-any-values">
<h4>Operations on Any values<a class="headerlink" href="#operations-on-any-values" title="Permalink to this headline">#</a></h4>
<p>You can do anything using a value with type <code class="docutils literal notranslate"><span class="pre">Any</span></code>, and the type checker
will not complain:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="c1"># All of these are valid!</span>
    <span class="n">x</span><span class="o">.</span><span class="n">foobar</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">x</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<p>Values derived from an <code class="docutils literal notranslate"><span class="pre">Any</span></code> value also usually have the type <code class="docutils literal notranslate"><span class="pre">Any</span></code>
implicitly, as mypy can’t infer a more precise result type. For
example, if you get the attribute of an <code class="docutils literal notranslate"><span class="pre">Any</span></code> value or call a
<code class="docutils literal notranslate"><span class="pre">Any</span></code> value the result is <code class="docutils literal notranslate"><span class="pre">Any</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;Any&quot;</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="s2">&quot;mypy will let you do anything to y&quot;</span><span class="p">)</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;Any&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Any</span></code> types may propagate through your program, making type checking
less effective, unless you are careful.</p>
<p>Function parameters without annotations are also implicitly <code class="docutils literal notranslate"><span class="pre">Any</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;Any&quot;</span>
    <span class="n">x</span><span class="o">.</span><span class="n">can</span><span class="o">.</span><span class="n">do</span><span class="p">[</span><span class="s2">&quot;anything&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">](</span><span class="s2">&quot;wants&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>You can make mypy warn you about untyped function parameters using the
<a class="reference internal" href="index.html#cmdoption-mypy-disallow-untyped-defs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-untyped-defs</span></code></a> flag.</p>
<p>Generic types missing type parameters will have those parameters implicitly
treated as <code class="docutils literal notranslate"><span class="pre">Any</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">List</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>        <span class="c1"># Revealed type is &quot;builtins.list[Any]&quot;</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>     <span class="c1"># Revealed type is &quot;Any&quot;</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">anything_goes</span><span class="p">()</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<p>You can make mypy warn you about untyped function parameters using the
<a class="reference internal" href="index.html#cmdoption-mypy-disallow-any-generics"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-any-generics</span></code></a> flag.</p>
<p>Finally, another major source of <code class="docutils literal notranslate"><span class="pre">Any</span></code> types leaking into your program is from
third party libraries that mypy does not know about. This is particularly the case
when using the <a class="reference internal" href="index.html#cmdoption-mypy-ignore-missing-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--ignore-missing-imports</span></code></a>
flag. See <a class="reference internal" href="index.html#fix-missing-imports"><span class="std std-ref">Missing imports</span></a> for more information about this.</p>
</section>
<section id="any-vs-object">
<h4>Any vs. object<a class="headerlink" href="#any-vs-object" title="Permalink to this headline">#</a></h4>
<p>The type <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a> is another type that can have an instance of arbitrary
type as a value. Unlike <code class="docutils literal notranslate"><span class="pre">Any</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a> is an ordinary static type (it
is similar to <code class="docutils literal notranslate"><span class="pre">Object</span></code> in Java), and only operations valid for <em>all</em>
types are accepted for <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a> values. These are all valid:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">o</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">o</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span>
    <span class="n">o</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">o</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span>
</pre></div>
</div>
<p>These are, however, flagged as errors, since not all objects support these
operations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">o</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">o</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>       <span class="c1"># Error!</span>
    <span class="n">o</span> <span class="o">+</span> <span class="mi">2</span>         <span class="c1"># Error!</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>       <span class="c1"># Error!</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">o</span>         <span class="c1"># Error!</span>
</pre></div>
</div>
<p>If you’re not sure whether you need to use <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a> or <code class="docutils literal notranslate"><span class="pre">Any</span></code>, use
<a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a> – only switch to using <code class="docutils literal notranslate"><span class="pre">Any</span></code> if you get a type checker
complaint.</p>
<p>You can use different <a class="reference internal" href="index.html#type-narrowing"><span class="std std-ref">type narrowing</span></a>
techniques to narrow <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a> to a more specific
type (subtype) such as <code class="docutils literal notranslate"><span class="pre">int</span></code>. Type narrowing is not needed with
dynamically typed values (values with type <code class="docutils literal notranslate"><span class="pre">Any</span></code>).</p>
</section>
</section>
<span id="document-type_narrowing"></span><section id="type-narrowing">
<span id="id1"></span><h3>Type narrowing<a class="headerlink" href="#type-narrowing" title="Permalink to this headline">#</a></h3>
<p>This section is dedicated to  several type narrowing
techniques which are supported by mypy.</p>
<p>Type narrowing is when you convince a type checker that a broader type is actually more specific, for instance, that an object of type <code class="docutils literal notranslate"><span class="pre">Shape</span></code> is actually of the narrower type <code class="docutils literal notranslate"><span class="pre">Square</span></code>.</p>
<section id="type-narrowing-expressions">
<h4>Type narrowing expressions<a class="headerlink" href="#type-narrowing-expressions" title="Permalink to this headline">#</a></h4>
<p>The simplest way to narrow a type is to use one of the supported expressions:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> like in <code class="docutils literal notranslate"><span class="pre">isinstance(obj,</span> <span class="pre">float)</span></code> will narrow <code class="docutils literal notranslate"><span class="pre">obj</span></code> to have <code class="docutils literal notranslate"><span class="pre">float</span></code> type</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#issubclass" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">issubclass()</span></code></a> like in <code class="docutils literal notranslate"><span class="pre">issubclass(cls,</span> <span class="pre">MyClass)</span></code> will narrow <code class="docutils literal notranslate"><span class="pre">cls</span></code> to be <code class="docutils literal notranslate"><span class="pre">Type[MyClass]</span></code></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#type" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">type</span></code></a> like in <code class="docutils literal notranslate"><span class="pre">type(obj)</span> <span class="pre">is</span> <span class="pre">int</span></code> will narrow <code class="docutils literal notranslate"><span class="pre">obj</span></code> to have <code class="docutils literal notranslate"><span class="pre">int</span></code> type</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#callable" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">callable()</span></code></a> like in <code class="docutils literal notranslate"><span class="pre">callable(obj)</span></code> will narrow object to callable type</p></li>
</ul>
<p>Type narrowing is contextual. For example, based on the condition, mypy will narrow an expression only within an <code class="docutils literal notranslate"><span class="pre">if</span></code> branch:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="nb">object</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="c1"># Type is narrowed within the ``if`` branch only</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>  <span class="c1"># Revealed type: &quot;builtins.int&quot;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="c1"># Type is narrowed differently within this ``elif`` branch:</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>  <span class="c1"># Revealed type: &quot;builtins.str | builtins.bool&quot;</span>

        <span class="c1"># Subsequent narrowing operations will narrow the type further</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="n">reveal_type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>  <span class="c1"># Revealed type: &quot;builtins.bool&quot;</span>

    <span class="c1"># Back outside of the ``if`` statement, the type isn&#39;t narrowed:</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>  <span class="c1"># Revealed type: &quot;builtins.object&quot;</span>
</pre></div>
</div>
<p>Mypy understands the implications <code class="docutils literal notranslate"><span class="pre">return</span></code> or exception raising can have
for what type an object could be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="c1"># `arg` can&#39;t be `int` at this point:</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>  <span class="c1"># Revealed type: &quot;builtins.str&quot;</span>
</pre></div>
</div>
<p>We can also use <code class="docutils literal notranslate"><span class="pre">assert</span></code> to narrow types in the same context:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>  <span class="c1"># Revealed type: &quot;builtins.int&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With <a class="reference internal" href="index.html#cmdoption-mypy-warn-unreachable"><code class="xref std std-option docutils literal notranslate"><span class="pre">--warn-unreachable</span></code></a>
narrowing types to some impossible state will be treated as an error.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="c1"># error: Subclass of &quot;int&quot; and &quot;str&quot; cannot exist:</span>
    <span class="c1"># would have incompatible method signatures</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="c1"># error: Statement is unreachable</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;so mypy concludes the assert will always trigger&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Without <code class="docutils literal notranslate"><span class="pre">--warn-unreachable</span></code> mypy will simply not check code it deems to be
unreachable. See <a class="reference internal" href="index.html#unreachable"><span class="std std-ref">Unreachable code</span></a> for more information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;builtins.int&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="s1">&#39;!&#39;</span><span class="p">)</span>  <span class="c1"># Typechecks with `mypy`, but fails in runtime.</span>
</pre></div>
</div>
</div>
<section id="issubclass">
<h5>issubclass<a class="headerlink" href="#issubclass" title="Permalink to this headline">#</a></h5>
<p>Mypy can also use <a class="reference external" href="https://docs.python.org/3/library/functions.html#issubclass" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">issubclass()</span></code></a>
for better type inference when working with types and metaclasses:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyCalcMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="o">...</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">o</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>  <span class="c1"># We must use a variable here</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;builtins.type&quot;</span>

    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">MyCalcMeta</span><span class="p">):</span>  <span class="c1"># `issubclass(type(o), MyCalcMeta)` won&#39;t work</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;Type[MyCalcMeta]&quot;</span>
        <span class="n">t</span><span class="o">.</span><span class="n">calc</span><span class="p">()</span>  <span class="c1"># Okay</span>
</pre></div>
</div>
</section>
<section id="callable">
<h5>callable<a class="headerlink" href="#callable" title="Permalink to this headline">#</a></h5>
<p>Mypy knows what types are callable and which ones are not during type checking.
So, we know what <code class="docutils literal notranslate"><span class="pre">callable()</span></code> will return. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>

<span class="n">x</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="nb">int</span><span class="p">]</span>

<span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># N: Revealed type is &quot;def () -&gt; builtins.int&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="o">...</span>  <span class="c1"># Will never be executed and will raise error with `--warn-unreachable`</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">callable</span></code> function can even split <code class="docutils literal notranslate"><span class="pre">Union</span></code> type
for callable and non-callable parts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Union</span>

<span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="nb">int</span><span class="p">]]</span>

<span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># N: Revealed type is &quot;def () -&gt; builtins.int&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># N: Revealed type is &quot;builtins.int&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="casts">
<span id="id2"></span><h4>Casts<a class="headerlink" href="#casts" title="Permalink to this headline">#</a></h4>
<p>Mypy supports type casts that are usually used to coerce a statically
typed value to a subtype. Unlike languages such as Java or C#,
however, mypy casts are only used as hints for the type checker, and they
don’t perform a runtime type check. Use the function <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.cast" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">cast()</span></code></a>
to perform a cast:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">cast</span>

<span class="n">o</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">o</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">o</span><span class="p">)</span>  <span class="c1"># OK (cast performs no actual runtime check)</span>
</pre></div>
</div>
<p>To support runtime checking of casts such as the above, we’d have to check
the types of all list items, which would be very inefficient for large lists.
Casts are used to silence spurious
type checker warnings and give the type checker a little help when it can’t
quite understand what is going on.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can use an assertion if you want to perform an actual runtime check:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">o</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">o</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># Error: can&#39;t add &#39;object&#39; and &#39;int&#39;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">o</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># OK: type of &#39;o&#39; is &#39;int&#39; here</span>
</pre></div>
</div>
</div>
<p>You don’t need a cast for expressions with type <code class="docutils literal notranslate"><span class="pre">Any</span></code>, or when
assigning to a variable with type <code class="docutils literal notranslate"><span class="pre">Any</span></code>, as was explained earlier.
You can also use <code class="docutils literal notranslate"><span class="pre">Any</span></code> as the cast target type – this lets you perform
any operations on the result. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">cast</span><span class="p">,</span> <span class="n">Any</span>

<span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">x</span><span class="o">.</span><span class="n">whatever</span><span class="p">()</span>  <span class="c1"># Type check error</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Any</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">y</span><span class="o">.</span><span class="n">whatever</span><span class="p">()</span>  <span class="c1"># Type check OK (runtime error)</span>
</pre></div>
</div>
</section>
<section id="user-defined-type-guards">
<span id="type-guards"></span><h4>User-Defined Type Guards<a class="headerlink" href="#user-defined-type-guards" title="Permalink to this headline">#</a></h4>
<p>Mypy supports User-Defined Type Guards (<span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0647/"><strong>PEP 647</strong></a>).</p>
<p>A type guard is a way for programs to influence conditional
type narrowing employed by a type checker based on runtime checks.</p>
<p>Basically, a <code class="docutils literal notranslate"><span class="pre">TypeGuard</span></code> is a “smart” alias for a <code class="docutils literal notranslate"><span class="pre">bool</span></code> type.
Let’s have a look at the regular <code class="docutils literal notranslate"><span class="pre">bool</span></code> example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">is_str_list</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Determines whether all objects in the list are strings&quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">is_str_list</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>  <span class="c1"># Reveals list[object]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="c1"># Error: incompatible type</span>
</pre></div>
</div>
<p>The same example with <code class="docutils literal notranslate"><span class="pre">TypeGuard</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeGuard</span>  <span class="c1"># use `typing_extensions` for Python 3.9 and below</span>

<span class="k">def</span> <span class="nf">is_str_list</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines whether all objects in the list are strings&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">is_str_list</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>  <span class="c1"># list[str]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="c1"># ok</span>
</pre></div>
</div>
<p>How does it work? <code class="docutils literal notranslate"><span class="pre">TypeGuard</span></code> narrows the first function argument (<code class="docutils literal notranslate"><span class="pre">val</span></code>)
to the type specified as the first type parameter (<code class="docutils literal notranslate"><span class="pre">list[str]</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Narrowing is
<a class="reference external" href="https://www.python.org/dev/peps/pep-0647/#enforcing-strict-narrowing">not strict</a>.
For example, you can narrow <code class="docutils literal notranslate"><span class="pre">str</span></code> to <code class="docutils literal notranslate"><span class="pre">int</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Note: since strict narrowing is not enforced, it’s easy
to break type safety.</p>
<p>However, there are many ways a determined or uninformed developer can
subvert type safety – most commonly by using cast or Any.
If a Python developer takes the time to learn about and implement
user-defined type guards within their code,
it is safe to assume that they are interested in type safety
and will not write their type guard functions in a way
that will undermine type safety or produce nonsensical results.</p>
</div>
<section id="generic-typeguards">
<h5>Generic TypeGuards<a class="headerlink" href="#generic-typeguards" title="Permalink to this headline">#</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">TypeGuard</span></code> can also work with generic types:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeGuard</span>  <span class="c1"># use `typing_extensions` for `python&lt;3.10`</span>

<span class="n">_T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">is_two_element_tuple</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">_T</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">_T</span><span class="p">,</span> <span class="n">_T</span><span class="p">]]:</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">names</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]):</span>
    <span class="k">if</span> <span class="n">is_two_element_tuple</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>  <span class="c1"># tuple[str, str]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>  <span class="c1"># tuple[str, ...]</span>
</pre></div>
</div>
</section>
<section id="typeguards-with-parameters">
<h5>TypeGuards with parameters<a class="headerlink" href="#typeguards-with-parameters" title="Permalink to this headline">#</a></h5>
<p>Type guard functions can accept extra arguments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Type</span><span class="p">,</span> <span class="n">TypeVar</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeGuard</span>  <span class="c1"># use `typing_extensions` for `python&lt;3.10`</span>

<span class="n">_T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">is_set_of</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="nb">type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="nb">set</span><span class="p">[</span><span class="n">_T</span><span class="p">]]:</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">)</span>

<span class="n">items</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
<span class="k">if</span> <span class="n">is_set_of</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>  <span class="c1"># set[str]</span>
</pre></div>
</div>
</section>
<section id="typeguards-as-methods">
<h5>TypeGuards as methods<a class="headerlink" href="#typeguards-as-methods" title="Permalink to this headline">#</a></h5>
<p>A method can also serve as a <code class="docutils literal notranslate"><span class="pre">TypeGuard</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">StrValidator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">to_validate</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">StrValidator</span><span class="p">()</span><span class="o">.</span><span class="n">is_valid</span><span class="p">(</span><span class="n">to_validate</span><span class="p">):</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">to_validate</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;builtins.str&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note, that <code class="docutils literal notranslate"><span class="pre">TypeGuard</span></code>
<a class="reference external" href="https://www.python.org/dev/peps/pep-0647/#narrowing-of-implicit-self-and-cls-parameters">does not narrow</a>
types of <code class="docutils literal notranslate"><span class="pre">self</span></code> or <code class="docutils literal notranslate"><span class="pre">cls</span></code> implicit arguments.</p>
<p>If narrowing of <code class="docutils literal notranslate"><span class="pre">self</span></code> or <code class="docutils literal notranslate"><span class="pre">cls</span></code> is required,
the value can be passed as an explicit argument to a type guard function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Parent</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;Parent&quot;</span>
        <span class="k">if</span> <span class="n">is_child</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">reveal_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;Child&quot;</span>

<span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">Parent</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">is_child</span><span class="p">(</span><span class="n">instance</span><span class="p">:</span> <span class="n">Parent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="n">Child</span><span class="p">]:</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">Child</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="assignment-expressions-as-typeguards">
<h5>Assignment expressions as TypeGuards<a class="headerlink" href="#assignment-expressions-as-typeguards" title="Permalink to this headline">#</a></h5>
<p>Sometimes you might need to create a new variable and narrow it
to some specific type at the same time.
This can be achieved by using <code class="docutils literal notranslate"><span class="pre">TypeGuard</span></code> together
with <a class="reference external" href="https://docs.python.org/3/whatsnew/3.8.html#assignment-expressions">:= operator</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeGuard</span>  <span class="c1"># use `typing_extensions` for `python&lt;3.10`</span>

<span class="k">def</span> <span class="nf">is_float</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeGuard</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">is_float</span><span class="p">(</span><span class="n">x</span> <span class="o">:=</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># N: Revealed type is &#39;builtins.float&#39;</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># N: Revealed type is &#39;builtins.object&#39;</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># N: Revealed type is &#39;builtins.object&#39;</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># N: Revealed type is &#39;builtins.object&#39;</span>
</pre></div>
</div>
<p>What happens here?</p>
<ol class="arabic simple">
<li><p>We create a new variable <code class="docutils literal notranslate"><span class="pre">x</span></code> and assign a value of <code class="docutils literal notranslate"><span class="pre">a</span></code> to it</p></li>
<li><p>We run <code class="docutils literal notranslate"><span class="pre">is_float()</span></code> type guard on <code class="docutils literal notranslate"><span class="pre">x</span></code></p></li>
<li><p>It narrows <code class="docutils literal notranslate"><span class="pre">x</span></code> to be <code class="docutils literal notranslate"><span class="pre">float</span></code> in the <code class="docutils literal notranslate"><span class="pre">if</span></code> context and does not touch <code class="docutils literal notranslate"><span class="pre">a</span></code></p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The same will work with <code class="docutils literal notranslate"><span class="pre">isinstance(x</span> <span class="pre">:=</span> <span class="pre">a,</span> <span class="pre">float)</span></code> as well.</p>
</div>
</section>
</section>
</section>
<span id="document-duck_type_compatibility"></span><section id="duck-type-compatibility">
<h3>Duck type compatibility<a class="headerlink" href="#duck-type-compatibility" title="Permalink to this headline">#</a></h3>
<p>In Python, certain types are compatible even though they aren’t subclasses of
each other. For example, <code class="docutils literal notranslate"><span class="pre">int</span></code> objects are valid whenever <code class="docutils literal notranslate"><span class="pre">float</span></code> objects
are expected. Mypy supports this idiom via <em>duck type compatibility</em>. This is
supported for a small set of built-in types:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">int</span></code> is duck type compatible with <code class="docutils literal notranslate"><span class="pre">float</span></code> and <code class="docutils literal notranslate"><span class="pre">complex</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">float</span></code> is duck type compatible with <code class="docutils literal notranslate"><span class="pre">complex</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bytearray</span></code> and <code class="docutils literal notranslate"><span class="pre">memoryview</span></code> are duck type compatible with <code class="docutils literal notranslate"><span class="pre">bytes</span></code>.</p></li>
</ul>
<p>For example, mypy considers an <code class="docutils literal notranslate"><span class="pre">int</span></code> object to be valid whenever a
<code class="docutils literal notranslate"><span class="pre">float</span></code> object is expected.  Thus code like this is nice and clean
and also behaves as expected:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">degrees_to_radians</span><span class="p">(</span><span class="n">degrees</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">degrees</span> <span class="o">/</span> <span class="mi">180</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">90</span>  <span class="c1"># Inferred type &#39;int&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">degrees_to_radians</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>  <span class="c1"># Okay!</span>
</pre></div>
</div>
<p>You can also often use <a class="reference internal" href="index.html#protocol-types"><span class="std std-ref">Protocols and structural subtyping</span></a> to achieve a similar effect in
a more principled and extensible fashion. Protocols don’t apply to
cases like <code class="docutils literal notranslate"><span class="pre">int</span></code> being compatible with <code class="docutils literal notranslate"><span class="pre">float</span></code>, since <code class="docutils literal notranslate"><span class="pre">float</span></code> is not
a protocol class but a regular, concrete class, and many standard library
functions expect concrete instances of <code class="docutils literal notranslate"><span class="pre">float</span></code> (or <code class="docutils literal notranslate"><span class="pre">int</span></code>).</p>
</section>
<span id="document-stubs"></span><section id="stub-files">
<span id="id1"></span><h3>Stub files<a class="headerlink" href="#stub-files" title="Permalink to this headline">#</a></h3>
<p>A <em>stub file</em> is a file containing a skeleton of the public interface
of that Python module, including classes, variables, functions – and
most importantly, their types.</p>
<p>Mypy uses stub files stored in the
<a class="reference external" href="https://github.com/python/typeshed">typeshed</a> repository to determine
the types of standard library and third-party library functions, classes,
and other definitions. You can also create your own stubs that will be
used to type check your code.</p>
<section id="creating-a-stub">
<h4>Creating a stub<a class="headerlink" href="#creating-a-stub" title="Permalink to this headline">#</a></h4>
<p>Here is an overview of how to create a stub file:</p>
<ul>
<li><p>Write a stub file for the library (or an arbitrary module) and store it as
a <code class="docutils literal notranslate"><span class="pre">.pyi</span></code> file in the same directory as the library module.</p></li>
<li><p>Alternatively, put your stubs (<code class="docutils literal notranslate"><span class="pre">.pyi</span></code> files) in a directory
reserved for stubs (e.g., <code class="file docutils literal notranslate"><span class="pre">myproject/stubs</span></code>). In this case you
have to set the environment variable <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> to refer to the
directory.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export MYPYPATH=~/work/myproject/stubs
</pre></div>
</div>
</li>
</ul>
<p>Use the normal Python file name conventions for modules, e.g. <code class="file docutils literal notranslate"><span class="pre">csv.pyi</span></code>
for module <code class="docutils literal notranslate"><span class="pre">csv</span></code>. Use a subdirectory with <code class="file docutils literal notranslate"><span class="pre">__init__.pyi</span></code> for packages. Note
that <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0561/"><strong>PEP 561</strong></a> stub-only packages must be installed, and may not be pointed
at through the <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> (see <a class="reference internal" href="index.html#installed-packages"><span class="std std-ref">PEP 561 support</span></a>).</p>
<p>If a directory contains both a <code class="docutils literal notranslate"><span class="pre">.py</span></code> and a <code class="docutils literal notranslate"><span class="pre">.pyi</span></code> file for the
same module, the <code class="docutils literal notranslate"><span class="pre">.pyi</span></code> file takes precedence. This way you can
easily add annotations for a module even if you don’t want to modify
the source code. This can be useful, for example, if you use 3rd party
open source libraries in your program (and there are no stubs in
typeshed yet).</p>
<p>That’s it!</p>
<p>Now you can access the module in mypy programs and type check
code that uses the library. If you write a stub for a library module,
consider making it available for other programmers that use mypy
by contributing it back to the typeshed repo.</p>
<p>Mypy also ships with two tools for making it easier to create and maintain
stubs: <a class="reference internal" href="index.html#stubgen"><span class="std std-ref">Automatic stub generation (stubgen)</span></a> and <a class="reference internal" href="index.html#stubtest"><span class="std std-ref">Automatic stub testing (stubtest)</span></a>.</p>
<p>The following sections explain the kinds of type annotations you can use
in your programs and stub files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may be tempted to point <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> to the standard library or
to the <code class="file docutils literal notranslate"><span class="pre">site-packages</span></code> directory where your 3rd party packages
are installed. This is almost always a bad idea – you will likely
get tons of error messages about code you didn’t write and that
mypy can’t analyze all that well yet, and in the worst case
scenario mypy may crash due to some construct in a 3rd party
package that it didn’t expect.</p>
</div>
</section>
<section id="stub-file-syntax">
<h4>Stub file syntax<a class="headerlink" href="#stub-file-syntax" title="Permalink to this headline">#</a></h4>
<p>Stub files are written in normal Python syntax, but generally
leaving out runtime logic like variable initializers, function bodies,
and default arguments.</p>
<p>If it is not possible to completely leave out some piece of runtime
logic, the recommended convention is to replace or elide them with ellipsis
expressions (<code class="docutils literal notranslate"><span class="pre">...</span></code>). Each ellipsis below is literally written in the
stub file as three dots:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Variables with annotations do not need to be assigned a value.</span>
<span class="c1"># So by convention, we omit them in the stub file.</span>
<span class="n">x</span><span class="p">:</span> <span class="nb">int</span>

<span class="c1"># Function bodies cannot be completely removed. By convention,</span>
<span class="c1"># we replace them with `...` instead of the `pass` statement.</span>
<span class="k">def</span> <span class="nf">func_1</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>

<span class="c1"># We can do the same with default arguments.</span>
<span class="k">def</span> <span class="nf">func_2</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The ellipsis <code class="docutils literal notranslate"><span class="pre">...</span></code> is also used with a different meaning in
<a class="reference internal" href="index.html#callable-types"><span class="std std-ref">callable types</span></a> and <a class="reference internal" href="index.html#tuple-types"><span class="std std-ref">tuple types</span></a>.</p>
</div>
</section>
<section id="using-stub-file-syntax-at-runtime">
<h4>Using stub file syntax at runtime<a class="headerlink" href="#using-stub-file-syntax-at-runtime" title="Permalink to this headline">#</a></h4>
<p>You may also occasionally need to elide actual logic in regular
Python code – for example, when writing methods in
<a class="reference internal" href="index.html#function-overloading"><span class="std std-ref">overload variants</span></a> or
<a class="reference internal" href="index.html#protocol-types"><span class="std std-ref">custom protocols</span></a>.</p>
<p>The recommended style is to use ellipses to do so, just like in
stub files. It is also considered stylistically acceptable to
throw a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#NotImplementedError" title="(in Python v3.11)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NotImplementedError</span></code></a> in cases where the user of the
code may accidentally call functions with no actual logic.</p>
<p>You can also elide default arguments as long as the function body
also contains no runtime logic: the function body only contains
a single ellipsis, the pass statement, or a <code class="docutils literal notranslate"><span class="pre">raise</span> <span class="pre">NotImplementedError()</span></code>.
It is also acceptable for the function body to contain a docstring.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="k">class</span> <span class="nc">Resource</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">ok_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">def</span> <span class="nf">ok_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">ok_3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Some docstring&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="c1"># Error: Incompatible default for argument &quot;foo&quot; (default has</span>
    <span class="c1"># type &quot;ellipsis&quot;, argument has type &quot;list[str]&quot;)</span>
    <span class="k">def</span> <span class="nf">not_ok</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<span id="document-generics"></span><section id="generics">
<h3>Generics<a class="headerlink" href="#generics" title="Permalink to this headline">#</a></h3>
<p>This section explains how you can define your own generic classes that take
one or more type parameters, similar to built-in types such as <code class="docutils literal notranslate"><span class="pre">list[X]</span></code>.
User-defined generics are a moderately advanced feature and you can get far
without ever using them – feel free to skip this section and come back later.</p>
<section id="defining-generic-classes">
<span id="generic-classes"></span><h4>Defining generic classes<a class="headerlink" href="#defining-generic-classes" title="Permalink to this headline">#</a></h4>
<p>The built-in collection classes are generic classes. Generic types
have one or more type parameters, which can be arbitrary types. For
example, <code class="docutils literal notranslate"><span class="pre">dict[int,</span> <span class="pre">str]</span></code> has the type parameters <code class="docutils literal notranslate"><span class="pre">int</span></code> and
<code class="docutils literal notranslate"><span class="pre">str</span></code>, and <code class="docutils literal notranslate"><span class="pre">list[int]</span></code> has a type parameter <code class="docutils literal notranslate"><span class="pre">int</span></code>.</p>
<p>Programs can also define new generic classes. Here is a very simple
generic class that represents a stack:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Generic</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Stack</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Create an empty list with items of type T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Stack</span></code> class can be used to represent a stack of any type:
<code class="docutils literal notranslate"><span class="pre">Stack[int]</span></code>, <code class="docutils literal notranslate"><span class="pre">Stack[tuple[int,</span> <span class="pre">str]]</span></code>, etc.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">Stack</span></code> is similar to built-in container types:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construct an empty Stack[int] instance</span>
<span class="n">stack</span> <span class="o">=</span> <span class="n">Stack</span><span class="p">[</span><span class="nb">int</span><span class="p">]()</span>
<span class="n">stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="n">stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>  <span class="c1"># error: Argument 1 to &quot;push&quot; of &quot;Stack&quot; has incompatible type &quot;str&quot;; expected &quot;int&quot;</span>
</pre></div>
</div>
<p>Construction of instances of generic types is type checked:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Box</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>

<span class="n">Box</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>       <span class="c1"># OK, inferred type is Box[int]</span>
<span class="n">Box</span><span class="p">[</span><span class="nb">int</span><span class="p">](</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Also OK</span>
<span class="n">Box</span><span class="p">[</span><span class="nb">int</span><span class="p">](</span><span class="s1">&#39;some string&#39;</span><span class="p">)</span>  <span class="c1"># error: Argument 1 to &quot;Box&quot; has incompatible type &quot;str&quot;; expected &quot;int&quot;</span>
</pre></div>
</div>
</section>
<section id="defining-subclasses-of-generic-classes">
<span id="generic-subclasses"></span><h4>Defining subclasses of generic classes<a class="headerlink" href="#defining-subclasses-of-generic-classes" title="Permalink to this headline">#</a></h4>
<p>User-defined generic classes and generic classes defined in <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a>
can be used as a base class for another class (generic or non-generic). For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Iterator</span>

<span class="n">KT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;KT&#39;</span><span class="p">)</span>
<span class="n">VT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;VT&#39;</span><span class="p">)</span>

<span class="c1"># This is a generic subclass of Mapping</span>
<span class="k">class</span> <span class="nc">MyMap</span><span class="p">(</span><span class="n">Mapping</span><span class="p">[</span><span class="n">KT</span><span class="p">,</span> <span class="n">VT</span><span class="p">]):</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="n">KT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VT</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">KT</span><span class="p">]:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>

<span class="n">items</span><span class="p">:</span> <span class="n">MyMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>  <span class="c1"># OK</span>

<span class="c1"># This is a non-generic subclass of dict</span>
<span class="k">class</span> <span class="nc">StrDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;StrDict(</span><span class="si">{</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="si">}</span><span class="s1">)&#39;</span>


<span class="n">data</span><span class="p">:</span> <span class="n">StrDict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>  <span class="c1"># Error! StrDict is not generic</span>
<span class="n">data2</span><span class="p">:</span> <span class="n">StrDict</span>  <span class="c1"># OK</span>

<span class="c1"># This is a user-defined generic class</span>
<span class="k">class</span> <span class="nc">Receiver</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="c1"># This is a generic subclass of Receiver</span>
<span class="k">class</span> <span class="nc">AdvancedReceiver</span><span class="p">(</span><span class="n">Receiver</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span> <span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You have to add an explicit <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Mapping" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code></a> base class
if you want mypy to consider a user-defined class as a mapping (and
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> for sequences, etc.). This is because mypy doesn’t use
<em>structural subtyping</em> for these ABCs, unlike simpler protocols
like <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a>, which use <a class="reference internal" href="index.html#protocol-types"><span class="std std-ref">structural subtyping</span></a>.</p>
</div>
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Generic" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Generic</span></code></a> can be omitted from bases if there are
other base classes that include type variables, such as <code class="docutils literal notranslate"><span class="pre">Mapping[KT,</span> <span class="pre">VT]</span></code>
in the above example. If you include <code class="docutils literal notranslate"><span class="pre">Generic[...]</span></code> in bases, then
it should list all type variables present in other bases (or more,
if needed). The order of type variables is defined by the following
rules:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">Generic[...]</span></code> is present, then the order of variables is
always determined by their order in <code class="docutils literal notranslate"><span class="pre">Generic[...]</span></code>.</p></li>
<li><p>If there are no <code class="docutils literal notranslate"><span class="pre">Generic[...]</span></code> in bases, then all type variables
are collected in the lexicographic order (i.e. by first appearance).</p></li>
</ul>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Any</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">One</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">Another</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">First</span><span class="p">(</span><span class="n">One</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">Another</span><span class="p">[</span><span class="n">S</span><span class="p">]):</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">Second</span><span class="p">(</span><span class="n">One</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">Another</span><span class="p">[</span><span class="n">S</span><span class="p">],</span> <span class="n">Generic</span><span class="p">[</span><span class="n">S</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">T</span><span class="p">]):</span> <span class="o">...</span>

<span class="n">x</span><span class="p">:</span> <span class="n">First</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>        <span class="c1"># Here T is bound to int, S is bound to str</span>
<span class="n">y</span><span class="p">:</span> <span class="n">Second</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>  <span class="c1"># Here T is Any, S is int, and U is str</span>
</pre></div>
</div>
</section>
<section id="generic-functions">
<span id="id1"></span><h4>Generic functions<a class="headerlink" href="#generic-functions" title="Permalink to this headline">#</a></h4>
<p>Type variables can be used to define generic functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Sequence</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="c1"># A generic function!</span>
<span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">seq</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>As with generic classes, the type variable can be replaced with any
type. That means <code class="docutils literal notranslate"><span class="pre">first</span></code> can be used with any sequence type, and the
return type is derived from the sequence item type. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reveal_type</span><span class="p">(</span><span class="n">first</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>   <span class="c1"># Revealed type is &quot;builtins.int&quot;</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">first</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]))</span>  <span class="c1"># Revealed type is &quot;builtins.str&quot;</span>
</pre></div>
</div>
<p>Note also that a single definition of a type variable (such as <code class="docutils literal notranslate"><span class="pre">T</span></code>
above) can be used in multiple generic functions or classes. In this
example we use the same type variable in two generic functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Sequence</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>      <span class="c1"># Declare type variable</span>

<span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">seq</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">last</span><span class="p">(</span><span class="n">seq</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">seq</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>A variable cannot have a type variable in its type unless the type
variable is bound in a containing generic class or function.</p>
</section>
<section id="generic-methods-and-generic-self">
<span id="id2"></span><h4>Generic methods and generic self<a class="headerlink" href="#generic-methods-and-generic-self" title="Permalink to this headline">#</a></h4>
<p>You can also define generic methods — just use a type variable in the
method signature that is different from class type variables. In
particular, the <code class="docutils literal notranslate"><span class="pre">self</span></code> argument may also be generic, allowing a
method to return the most precise type known at the point of access.
In this way, for example, you can type check a chain of setter
methods:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;Shape&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Shape</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">set_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">return</span> <span class="bp">self</span>

<span class="k">class</span> <span class="nc">Circle</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">set_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Circle&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">r</span>
        <span class="k">return</span> <span class="bp">self</span>

<span class="k">class</span> <span class="nc">Square</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">set_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Square&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">w</span>
        <span class="k">return</span> <span class="bp">self</span>

<span class="n">circle</span><span class="p">:</span> <span class="n">Circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">()</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">set_radius</span><span class="p">(</span><span class="mf">2.7</span><span class="p">)</span>
<span class="n">square</span><span class="p">:</span> <span class="n">Square</span> <span class="o">=</span> <span class="n">Square</span><span class="p">()</span><span class="o">.</span><span class="n">set_scale</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">set_width</span><span class="p">(</span><span class="mf">3.2</span><span class="p">)</span>
</pre></div>
</div>
<p>Without using generic <code class="docutils literal notranslate"><span class="pre">self</span></code>, the last two lines could not be type
checked properly, since the return type of <code class="docutils literal notranslate"><span class="pre">set_scale</span></code> would be
<code class="docutils literal notranslate"><span class="pre">Shape</span></code>, which doesn’t define <code class="docutils literal notranslate"><span class="pre">set_radius</span></code> or <code class="docutils literal notranslate"><span class="pre">set_width</span></code>.</p>
<p>Other uses are factory methods, such as copy and deserialization.
For class methods, you can also define generic <code class="docutils literal notranslate"><span class="pre">cls</span></code>, using <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Type" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Type[T]</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Type</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;Friend&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Friend</span><span class="p">:</span>
    <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;Friend&quot;</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">make_pair</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(),</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">a</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">b</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

<span class="k">class</span> <span class="nc">SuperFriend</span><span class="p">(</span><span class="n">Friend</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">SuperFriend</span><span class="o">.</span><span class="n">make_pair</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that when overriding a method with generic <code class="docutils literal notranslate"><span class="pre">self</span></code>, you must either
return a generic <code class="docutils literal notranslate"><span class="pre">self</span></code> too, or return an instance of the current class.
In the latter case, you must implement this method in all future subclasses.</p>
<p>Note also that mypy cannot always verify that the implementation of a copy
or a deserialization method returns the actual type of self. Therefore
you may need to silence mypy inside these methods (but not at the call site),
possibly by making use of the <code class="docutils literal notranslate"><span class="pre">Any</span></code> type or a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment.</p>
<p>Note that mypy lets you use generic self types in certain unsafe ways
in order to support common idioms. For example, using a generic
self type in an argument type is accepted even though it’s unsafe:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">class</span> <span class="nc">Sub</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>

    <span class="c1"># This is unsafe (see below) but allowed because it&#39;s</span>
    <span class="c1"># a common pattern and rarely causes issues in practice.</span>
    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Sub</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">x</span>

<span class="n">b</span><span class="p">:</span> <span class="n">Base</span> <span class="o">=</span> <span class="n">Sub</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">Base</span><span class="p">())</span>  <span class="c1"># Runtime error here: &#39;Base&#39; object has no attribute &#39;x&#39;</span>
</pre></div>
</div>
<p>For some advanced uses of self types, see <a class="reference internal" href="index.html#advanced-self"><span class="std std-ref">additional examples</span></a>.</p>
</section>
<section id="automatic-self-types-using-typing-self">
<h4>Automatic self types using typing.Self<a class="headerlink" href="#automatic-self-types-using-typing-self" title="Permalink to this headline">#</a></h4>
<p>Since the patterns described above are quite common, mypy supports a
simpler syntax, introduced in <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0673/"><strong>PEP 673</strong></a>, to make them easier to use.
Instead of defining a type variable and using an explicit annotation
for <code class="docutils literal notranslate"><span class="pre">self</span></code>, you can import the special type <code class="docutils literal notranslate"><span class="pre">typing.Self</span></code> that is
automatically transformed into a type variable with the current class
as the upper bound, and you don’t need an annotation for <code class="docutils literal notranslate"><span class="pre">self</span></code> (or
<code class="docutils literal notranslate"><span class="pre">cls</span></code> in class methods). The example from the previous section can
be made simpler by using <code class="docutils literal notranslate"><span class="pre">Self</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Self</span>

<span class="k">class</span> <span class="nc">Friend</span><span class="p">:</span>
    <span class="n">other</span><span class="p">:</span> <span class="n">Self</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">make_pair</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Self</span><span class="p">,</span> <span class="n">Self</span><span class="p">]:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(),</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">a</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">b</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

<span class="k">class</span> <span class="nc">SuperFriend</span><span class="p">(</span><span class="n">Friend</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">SuperFriend</span><span class="o">.</span><span class="n">make_pair</span><span class="p">()</span>
</pre></div>
</div>
<p>This is more compact than using explicit type variables. Also, you can
use <code class="docutils literal notranslate"><span class="pre">Self</span></code> in attribute annotations in addition to methods.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use this feature on Python versions earlier than 3.11, you will need to
import <code class="docutils literal notranslate"><span class="pre">Self</span></code> from <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> (version 4.0 or newer).</p>
</div>
</section>
<section id="variance-of-generic-types">
<span id="variance-of-generics"></span><h4>Variance of generic types<a class="headerlink" href="#variance-of-generic-types" title="Permalink to this headline">#</a></h4>
<p>There are three main kinds of generic types with respect to subtype
relations between them: invariant, covariant, and contravariant.
Assuming that we have a pair of types <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code>, and <code class="docutils literal notranslate"><span class="pre">B</span></code> is
a subtype of <code class="docutils literal notranslate"><span class="pre">A</span></code>, these are defined as follows:</p>
<ul class="simple">
<li><p>A generic class <code class="docutils literal notranslate"><span class="pre">MyCovGen[T]</span></code> is called covariant in type variable
<code class="docutils literal notranslate"><span class="pre">T</span></code> if <code class="docutils literal notranslate"><span class="pre">MyCovGen[B]</span></code> is always a subtype of <code class="docutils literal notranslate"><span class="pre">MyCovGen[A]</span></code>.</p></li>
<li><p>A generic class <code class="docutils literal notranslate"><span class="pre">MyContraGen[T]</span></code> is called contravariant in type
variable <code class="docutils literal notranslate"><span class="pre">T</span></code> if <code class="docutils literal notranslate"><span class="pre">MyContraGen[A]</span></code> is always a subtype of
<code class="docutils literal notranslate"><span class="pre">MyContraGen[B]</span></code>.</p></li>
<li><p>A generic class <code class="docutils literal notranslate"><span class="pre">MyInvGen[T]</span></code> is called invariant in <code class="docutils literal notranslate"><span class="pre">T</span></code> if neither
of the above is true.</p></li>
</ul>
<p>Let us illustrate this by few simple examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># We&#39;ll use these classes in the examples below</span>
<span class="k">class</span> <span class="nc">Shape</span><span class="p">:</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">Triangle</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">Square</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<ul>
<li><p>Most immutable containers, such as <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> and
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.FrozenSet" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrozenSet</span></code></a> are covariant. <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a> is
also covariant in all variables: <code class="docutils literal notranslate"><span class="pre">Union[Triangle,</span> <span class="pre">int]</span></code> is
a subtype of <code class="docutils literal notranslate"><span class="pre">Union[Shape,</span> <span class="pre">int]</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">count_lines</span><span class="p">(</span><span class="n">shapes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Shape</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">shape</span><span class="o">.</span><span class="n">num_sides</span> <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">)</span>

<span class="n">triangles</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Triangle</span><span class="p">]</span>
<span class="n">count_lines</span><span class="p">(</span><span class="n">triangles</span><span class="p">)</span>  <span class="c1"># OK</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">triangle</span><span class="p">:</span> <span class="n">Triangle</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="n">shape_or_number</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Shape</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
    <span class="c1"># a Triangle is a Shape, and a Shape is a valid Union[Shape, int]</span>
    <span class="n">shape_or_number</span> <span class="o">=</span> <span class="n">triangle</span>
</pre></div>
</div>
<p>Covariance should feel relatively intuitive, but contravariance and invariance
can be harder to reason about.</p>
</li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a> is an example of type that behaves contravariant
in types of arguments. That is, <code class="docutils literal notranslate"><span class="pre">Callable[[Shape],</span> <span class="pre">int]</span></code> is a subtype of
<code class="docutils literal notranslate"><span class="pre">Callable[[Triangle],</span> <span class="pre">int]</span></code>, despite <code class="docutils literal notranslate"><span class="pre">Shape</span></code> being a supertype of
<code class="docutils literal notranslate"><span class="pre">Triangle</span></code>. To understand this, consider:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cost_of_paint_required</span><span class="p">(</span>
    <span class="n">triangle</span><span class="p">:</span> <span class="n">Triangle</span><span class="p">,</span>
    <span class="n">area_calculator</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Triangle</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">area_calculator</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span> <span class="o">*</span> <span class="n">DOLLAR_PER_SQ_FT</span>

<span class="c1"># This straightforwardly works</span>
<span class="k">def</span> <span class="nf">area_of_triangle</span><span class="p">(</span><span class="n">triangle</span><span class="p">:</span> <span class="n">Triangle</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="o">...</span>
<span class="n">cost_of_paint_required</span><span class="p">(</span><span class="n">triangle</span><span class="p">,</span> <span class="n">area_of_triangle</span><span class="p">)</span>  <span class="c1"># OK</span>

<span class="c1"># But this works as well!</span>
<span class="k">def</span> <span class="nf">area_of_any_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span> <span class="n">Shape</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="o">...</span>
<span class="n">cost_of_paint_required</span><span class="p">(</span><span class="n">triangle</span><span class="p">,</span> <span class="n">area_of_any_shape</span><span class="p">)</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">cost_of_paint_required</span></code> needs a callable that can calculate the area of a
triangle. If we give it a callable that can calculate the area of an
arbitrary shape (not just triangles), everything still works.</p>
</li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a> is an invariant generic type. Naively, one would think
that it is covariant, like <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> above, but consider this code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Circle</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span>
    <span class="c1"># The rotate method is only defined on Circle, not on Shape</span>
    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">add_one</span><span class="p">(</span><span class="n">things</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Shape</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">things</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Shape</span><span class="p">())</span>

<span class="n">my_circles</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Circle</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">add_one</span><span class="p">(</span><span class="n">my_circles</span><span class="p">)</span>     <span class="c1"># This may appear safe, but...</span>
<span class="n">my_circles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rotate</span><span class="p">()</span>  <span class="c1"># ...this will fail, since my_circles[0] is now a Shape, not a Circle</span>
</pre></div>
</div>
<p>Another example of invariant type is <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>. Most mutable containers
are invariant.</p>
</li>
</ul>
<p>By default, mypy assumes that all user-defined generics are invariant.
To declare a given generic class as covariant or contravariant use
type variables defined with special keyword arguments <code class="docutils literal notranslate"><span class="pre">covariant</span></code> or
<code class="docutils literal notranslate"><span class="pre">contravariant</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">T_co</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T_co&#39;</span><span class="p">,</span> <span class="n">covariant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Box</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T_co</span><span class="p">]):</span>  <span class="c1"># this type is declared covariant</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">T_co</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="n">content</span>

    <span class="k">def</span> <span class="nf">get_content</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span>

<span class="k">def</span> <span class="nf">look_into</span><span class="p">(</span><span class="n">box</span><span class="p">:</span> <span class="n">Box</span><span class="p">[</span><span class="n">Animal</span><span class="p">]):</span> <span class="o">...</span>

<span class="n">my_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">Cat</span><span class="p">())</span>
<span class="n">look_into</span><span class="p">(</span><span class="n">my_box</span><span class="p">)</span>  <span class="c1"># OK, but mypy would complain here for an invariant type</span>
</pre></div>
</div>
</section>
<section id="type-variables-with-upper-bounds">
<span id="type-variable-upper-bound"></span><h4>Type variables with upper bounds<a class="headerlink" href="#type-variables-with-upper-bounds" title="Permalink to this headline">#</a></h4>
<p>A type variable can also be restricted to having values that are
subtypes of a specific type. This type is called the upper bound of
the type variable, and is specified with the <code class="docutils literal notranslate"><span class="pre">bound=...</span></code> keyword
argument to <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.TypeVar" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">SupportsAbs</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">SupportsAbs</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span>
</pre></div>
</div>
<p>In the definition of a generic function that uses such a type variable
<code class="docutils literal notranslate"><span class="pre">T</span></code>, the type represented by <code class="docutils literal notranslate"><span class="pre">T</span></code> is assumed to be a subtype of
its upper bound, so the function can use methods of the upper bound on
values of type <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">largest_in_absolute_value</span><span class="p">(</span><span class="o">*</span><span class="n">xs</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">abs</span><span class="p">)</span>  <span class="c1"># Okay, because T is a subtype of SupportsAbs[float].</span>
</pre></div>
</div>
<p>In a call to such a function, the type <code class="docutils literal notranslate"><span class="pre">T</span></code> must be replaced by a
type that is a subtype of its upper bound. Continuing the example
above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">largest_in_absolute_value</span><span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>   <span class="c1"># Okay, has type float.</span>
<span class="n">largest_in_absolute_value</span><span class="p">(</span><span class="mi">5</span><span class="o">+</span><span class="mi">6</span><span class="n">j</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>   <span class="c1"># Okay, has type complex.</span>
<span class="n">largest_in_absolute_value</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>  <span class="c1"># Error: &#39;str&#39; is not a subtype of SupportsAbs[float].</span>
</pre></div>
</div>
<p>Type parameters of generic classes may also have upper bounds, which
restrict the valid values for the type parameter in the same way.</p>
</section>
<section id="type-variables-with-value-restriction">
<span id="type-variable-value-restriction"></span><h4>Type variables with value restriction<a class="headerlink" href="#type-variables-with-value-restriction" title="Permalink to this headline">#</a></h4>
<p>By default, a type variable can be replaced with any type. However, sometimes
it’s useful to have a type variable that can only have some specific types
as its value. A typical example is a type variable that can only have values
<code class="docutils literal notranslate"><span class="pre">str</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span>

<span class="n">AnyStr</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;AnyStr&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
</pre></div>
</div>
<p>This is actually such a common type variable that <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.AnyStr" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">AnyStr</span></code></a> is
defined in <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> and we don’t need to define it ourselves.</p>
<p>We can use <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.AnyStr" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">AnyStr</span></code></a> to define a function that can concatenate
two strings or bytes objects, but it can’t be called with other
argument types:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">AnyStr</span>

<span class="k">def</span> <span class="nf">concat</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">AnyStr</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">AnyStr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnyStr</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">concat</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>    <span class="c1"># Okay</span>
<span class="n">concat</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>  <span class="c1"># Okay</span>
<span class="n">concat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>        <span class="c1"># Error!</span>
</pre></div>
</div>
<p>Importantly, this is different from a union type, since combinations
of <code class="docutils literal notranslate"><span class="pre">str</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes</span></code> are not accepted:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">concat</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;bytes&#39;</span><span class="p">)</span>   <span class="c1"># Error!</span>
</pre></div>
</div>
<p>In this case, this is exactly what we want, since it’s not possible
to concatenate a string and a bytes object! If we tried to use
<code class="docutils literal notranslate"><span class="pre">Union</span></code>, the type checker would complain about this possibility:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">union_concat</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>  <span class="c1"># Error: can&#39;t concatenate str and bytes</span>
</pre></div>
</div>
<p>Another interesting special case is calling <code class="docutils literal notranslate"><span class="pre">concat()</span></code> with a
subtype of <code class="docutils literal notranslate"><span class="pre">str</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">S</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">ss</span> <span class="o">=</span> <span class="n">concat</span><span class="p">(</span><span class="n">S</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">),</span> <span class="n">S</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">))</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;builtins.str&quot;</span>
</pre></div>
</div>
<p>You may expect that the type of <code class="docutils literal notranslate"><span class="pre">ss</span></code> is <code class="docutils literal notranslate"><span class="pre">S</span></code>, but the type is
actually <code class="docutils literal notranslate"><span class="pre">str</span></code>: a subtype gets promoted to one of the valid values
for the type variable, which in this case is <code class="docutils literal notranslate"><span class="pre">str</span></code>.</p>
<p>This is thus
subtly different from <em>bounded quantification</em> in languages such as
Java, where the return type would be <code class="docutils literal notranslate"><span class="pre">S</span></code>. The way mypy implements
this is correct for <code class="docutils literal notranslate"><span class="pre">concat</span></code>, since <code class="docutils literal notranslate"><span class="pre">concat</span></code> actually returns a
<code class="docutils literal notranslate"><span class="pre">str</span></code> instance in the above example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ss</span><span class="p">))</span>
<span class="go">&lt;class &#39;str&#39;&gt;</span>
</pre></div>
</div>
<p>You can also use a <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.TypeVar" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeVar</span></code></a> with a restricted set of possible
values when defining a generic class. For example, mypy uses the type
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Pattern" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pattern[AnyStr]</span></code></a> for the return value of <a class="reference external" href="https://docs.python.org/3/library/re.html#re.compile" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">re.compile()</span></code></a>,
since regular expressions can be based on a string or a bytes pattern.</p>
<p>A type variable may not have both a value restriction (see
<a class="reference internal" href="#type-variable-upper-bound"><span class="std std-ref">Type variables with upper bounds</span></a>) and an upper bound.</p>
</section>
<section id="declaring-decorators">
<span id="id3"></span><h4>Declaring decorators<a class="headerlink" href="#declaring-decorators" title="Permalink to this headline">#</a></h4>
<p>Decorators are typically functions that take a function as an argument and
return another function. Describing this behaviour in terms of types can
be a little tricky; we’ll show how you can use <code class="docutils literal notranslate"><span class="pre">TypeVar</span></code> and a special
kind of type variable called a <em>parameter specification</em> to do so.</p>
<p>Suppose we have the following decorator, not type annotated yet,
that preserves the original function’s signature and merely prints the decorated function’s name:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">printing_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calling&quot;</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>
</div>
<p>and we use it to decorate function <code class="docutils literal notranslate"><span class="pre">add_forty_two</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># A decorated function.</span>
<span class="nd">@printing_decorator</span>
<span class="k">def</span> <span class="nf">add_forty_two</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">42</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">add_forty_two</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">printing_decorator</span></code> is not type-annotated, the following won’t get type checked:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reveal_type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>        <span class="c1"># Revealed type is &quot;Any&quot;</span>
<span class="n">add_forty_two</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>  <span class="c1"># No type checker error :(</span>
</pre></div>
</div>
<p>This is a sorry state of affairs! If you run with <code class="docutils literal notranslate"><span class="pre">--strict</span></code>, mypy will
even alert you to this fact:
<code class="docutils literal notranslate"><span class="pre">Untyped</span> <span class="pre">decorator</span> <span class="pre">makes</span> <span class="pre">function</span> <span class="pre">&quot;add_forty_two&quot;</span> <span class="pre">untyped</span></code></p>
<p>Note that class decorators are handled differently than function decorators in
mypy: decorating a class does not erase its type, even if the decorator has
incomplete type annotations.</p>
<p>Here’s how one could annotate the decorator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">cast</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span>

<span class="c1"># A decorator that preserves the signature.</span>
<span class="k">def</span> <span class="nf">printing_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">F</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">F</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calling&quot;</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">wrapper</span><span class="p">)</span>

<span class="nd">@printing_decorator</span>
<span class="k">def</span> <span class="nf">add_forty_two</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">42</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">add_forty_two</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>      <span class="c1"># Revealed type is &quot;builtins.int&quot;</span>
<span class="n">add_forty_two</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>  <span class="c1"># Argument 1 to &quot;add_forty_two&quot; has incompatible type &quot;str&quot;; expected &quot;int&quot;</span>
</pre></div>
</div>
<p>This still has some shortcomings. First, we need to use the unsafe
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.cast" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">cast()</span></code></a> to convince mypy that <code class="docutils literal notranslate"><span class="pre">wrapper()</span></code> has the same
signature as <code class="docutils literal notranslate"><span class="pre">func</span></code>. See <a class="reference internal" href="index.html#casts"><span class="std std-ref">casts</span></a>.</p>
<p>Second, the <code class="docutils literal notranslate"><span class="pre">wrapper()</span></code> function is not tightly type checked, although
wrapper functions are typically small enough that this is not a big
problem. This is also the reason for the <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.cast" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">cast()</span></code></a> call in the
<code class="docutils literal notranslate"><span class="pre">return</span></code> statement in <code class="docutils literal notranslate"><span class="pre">printing_decorator()</span></code>.</p>
<p>However, we can use a parameter specification (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ParamSpec" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ParamSpec</span></code></a>),
for a more faithful type annotation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">TypeVar</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">ParamSpec</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">printing_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">]:</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calling&quot;</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></div>
</div>
<p>Parameter specifications also allow you to describe decorators that
alter the signature of the input function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">TypeVar</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">ParamSpec</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

 <span class="c1"># We reuse &#39;P&#39; in the return type, but replace &#39;T&#39; with &#39;str&#39;</span>
<span class="k">def</span> <span class="nf">stringify</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">wrapper</span>

 <span class="nd">@stringify</span>
 <span class="k">def</span> <span class="nf">add_forty_two</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
     <span class="k">return</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">42</span>

 <span class="n">a</span> <span class="o">=</span> <span class="n">add_forty_two</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
 <span class="n">reveal_type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>      <span class="c1"># Revealed type is &quot;builtins.str&quot;</span>
 <span class="n">add_forty_two</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>  <span class="c1"># error: Argument 1 to &quot;add_forty_two&quot; has incompatible type &quot;str&quot;; expected &quot;int&quot;</span>
</pre></div>
</div>
<p>Or insert an argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">TypeVar</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Concatenate</span><span class="p">,</span> <span class="n">ParamSpec</span>

<span class="n">P</span> <span class="o">=</span> <span class="n">ParamSpec</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">printing_decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="n">P</span><span class="p">,</span> <span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="n">Concatenate</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">P</span><span class="p">],</span> <span class="n">T</span><span class="p">]:</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">:</span> <span class="n">P</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calling&quot;</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="s2">&quot;with&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@printing_decorator</span>
<span class="k">def</span> <span class="nf">add_forty_two</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">42</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">add_forty_two</span><span class="p">(</span><span class="s1">&#39;three&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<section id="decorator-factories">
<span id="id4"></span><h5>Decorator factories<a class="headerlink" href="#decorator-factories" title="Permalink to this headline">#</a></h5>
<p>Functions that take arguments and return a decorator (also called second-order decorators), are
similarly supported via generics:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">F</span><span class="p">],</span> <span class="n">F</span><span class="p">]:</span>
    <span class="o">...</span>

<span class="nd">@route</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s1">&#39;Hello world&#39;</span>
</pre></div>
</div>
<p>Sometimes the same decorator supports both bare calls and calls with arguments. This can be
achieved by combining with <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.overload" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;overload</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">overload</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span>

<span class="c1"># Bare decorator usage</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">atomic</span><span class="p">(</span><span class="n">__func</span><span class="p">:</span> <span class="n">F</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">F</span><span class="p">:</span> <span class="o">...</span>
<span class="c1"># Decorator with arguments</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">atomic</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">savepoint</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">F</span><span class="p">],</span> <span class="n">F</span><span class="p">]:</span> <span class="o">...</span>

<span class="c1"># Implementation</span>
<span class="k">def</span> <span class="nf">atomic</span><span class="p">(</span><span class="n">__func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">savepoint</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="o">...</span>  <span class="c1"># Code goes here</span>
    <span class="k">if</span> <span class="n">__func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">decorator</span><span class="p">(</span><span class="n">__func</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">decorator</span>

<span class="c1"># Usage</span>
<span class="nd">@atomic</span>
<span class="k">def</span> <span class="nf">func1</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="nd">@atomic</span><span class="p">(</span><span class="n">savepoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func2</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
</section>
</section>
<section id="generic-protocols">
<h4>Generic protocols<a class="headerlink" href="#generic-protocols" title="Permalink to this headline">#</a></h4>
<p>Mypy supports generic protocols (see also <a class="reference internal" href="index.html#protocol-types"><span class="std std-ref">Protocols and structural subtyping</span></a>). Several
<a class="reference internal" href="index.html#predefined-protocols"><span class="std std-ref">predefined protocols</span></a> are generic, such as
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable[T]</span></code></a>, and you can define additional generic protocols. Generic
protocols mostly follow the normal rules for generic classes. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Box</span><span class="p">(</span><span class="n">Protocol</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="n">content</span><span class="p">:</span> <span class="n">T</span>

<span class="k">def</span> <span class="nf">do_stuff</span><span class="p">(</span><span class="n">one</span><span class="p">:</span> <span class="n">Box</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">other</span><span class="p">:</span> <span class="n">Box</span><span class="p">[</span><span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">StringWrapper</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>

<span class="k">class</span> <span class="nc">BytesWrapper</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>

<span class="n">do_stuff</span><span class="p">(</span><span class="n">StringWrapper</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">),</span> <span class="n">BytesWrapper</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;other&#39;</span><span class="p">))</span>  <span class="c1"># OK</span>

<span class="n">x</span><span class="p">:</span> <span class="n">Box</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">y</span><span class="p">:</span> <span class="n">Box</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">y</span>  <span class="c1"># Error -- Box is invariant</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">ClassName(Protocol[T])</span></code> is allowed as a shorthand for
<code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">ClassName(Protocol,</span> <span class="pre">Generic[T])</span></code>, as per <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0544/#generic-protocols"><strong>PEP 544: Generic protocols</strong></a>,</p>
<p>The main difference between generic protocols and ordinary generic
classes is that mypy checks that the declared variances of generic
type variables in a protocol match how they are used in the protocol
definition.  The protocol in this example is rejected, since the type
variable <code class="docutils literal notranslate"><span class="pre">T</span></code> is used covariantly as a return type, but the type
variable is invariant:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ReadOnlyBox</span><span class="p">(</span><span class="n">Protocol</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>  <span class="c1"># error: Invariant type variable &quot;T&quot; used in protocol where covariant one is expected</span>
    <span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
<p>This example correctly uses a covariant type variable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">T_co</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T_co&#39;</span><span class="p">,</span> <span class="n">covariant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ReadOnlyBox</span><span class="p">(</span><span class="n">Protocol</span><span class="p">[</span><span class="n">T_co</span><span class="p">]):</span>  <span class="c1"># OK</span>
    <span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span> <span class="o">...</span>

<span class="n">ax</span><span class="p">:</span> <span class="n">ReadOnlyBox</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">ay</span><span class="p">:</span> <span class="n">ReadOnlyBox</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">ay</span>  <span class="c1"># OK -- ReadOnlyBox is covariant</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#variance-of-generics"><span class="std std-ref">Variance of generic types</span></a> for more about variance.</p>
<p>Generic protocols can also be recursive. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Linked</span><span class="p">(</span><span class="n">Protocol</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="n">val</span><span class="p">:</span> <span class="n">T</span>
    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Linked[T]&#39;</span><span class="p">:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">L</span><span class="p">:</span>
    <span class="n">val</span><span class="p">:</span> <span class="nb">int</span>
    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">last</span><span class="p">(</span><span class="n">seq</span><span class="p">:</span> <span class="n">Linked</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span> <span class="o">...</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">last</span><span class="p">(</span><span class="n">L</span><span class="p">())</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;builtins.int&quot;</span>
</pre></div>
</div>
</section>
<section id="generic-type-aliases">
<span id="id5"></span><h4>Generic type aliases<a class="headerlink" href="#generic-type-aliases" title="Permalink to this headline">#</a></h4>
<p>Type aliases can be generic. In this case they can be used in two ways:
Subscripted aliases are equivalent to original types with substituted type
variables, so the number of type arguments must match the number of free type variables
in the generic type alias. Unsubscripted aliases are treated as original types with free
variables replaced with <code class="docutils literal notranslate"><span class="pre">Any</span></code>. Examples (following <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/#type-aliases"><strong>PEP 484: Type aliases</strong></a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Callable</span>

<span class="n">S</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>

<span class="n">TInt</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span>
<span class="n">UInt</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">S</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="n">CBack</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">S</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">response</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UInt</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>  <span class="c1"># Same as Union[str, int]</span>
    <span class="o">...</span>
<span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="n">cb</span><span class="p">:</span> <span class="n">CBack</span><span class="p">[</span><span class="n">S</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">S</span><span class="p">:</span>        <span class="c1"># Same as Callable[..., S]</span>
    <span class="o">...</span>
<span class="n">table_entry</span><span class="p">:</span> <span class="n">TInt</span>  <span class="c1"># Same as tuple[int, Any]</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)</span>

<span class="n">Vec</span> <span class="o">=</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">]]</span>

<span class="k">def</span> <span class="nf">inproduct</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Vec</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">v</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">dilate</span><span class="p">(</span><span class="n">v</span><span class="p">:</span> <span class="n">Vec</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">scale</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Vec</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">x</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">y</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">v</span><span class="p">)</span>

<span class="n">v1</span><span class="p">:</span> <span class="n">Vec</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>      <span class="c1"># Same as Iterable[tuple[int, int]]</span>
<span class="n">v2</span><span class="p">:</span> <span class="n">Vec</span> <span class="o">=</span> <span class="p">[]</span>           <span class="c1"># Same as Iterable[tuple[Any, Any]]</span>
<span class="n">v3</span><span class="p">:</span> <span class="n">Vec</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Error: Invalid alias, too many type arguments!</span>
</pre></div>
</div>
<p>Type aliases can be imported from modules just like other names. An
alias can also target another alias, although building complex chains
of aliases is not recommended – this impedes code readability, thus
defeating the purpose of using aliases.  Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">example1</span> <span class="kn">import</span> <span class="n">AliasType</span>
<span class="kn">from</span> <span class="nn">example2</span> <span class="kn">import</span> <span class="n">Vec</span>

<span class="c1"># AliasType and Vec are type aliases (Vec as defined above)</span>

<span class="k">def</span> <span class="nf">fun</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AliasType</span><span class="p">:</span>
    <span class="o">...</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">NewVec</span><span class="p">(</span><span class="n">Vec</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="o">...</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">NewVec</span><span class="p">[</span><span class="nb">int</span><span class="p">]():</span>
    <span class="o">...</span>

<span class="n">OIntVec</span> <span class="o">=</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Vec</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>
</pre></div>
</div>
<p>Using type variable bounds or values in generic aliases has the same effect
as in generic classes/functions.</p>
</section>
<section id="generic-class-internals">
<h4>Generic class internals<a class="headerlink" href="#generic-class-internals" title="Permalink to this headline">#</a></h4>
<p>You may wonder what happens at runtime when you index a generic class.
Indexing returns a <em>generic alias</em> to the original class that returns instances
of the original class on instantiation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Generic</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Stack</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Stack</span>
<span class="go">__main__.Stack</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Stack</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="go">__main__.Stack[int]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span> <span class="o">=</span> <span class="n">Stack</span><span class="p">[</span><span class="nb">int</span><span class="p">]()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">instance</span><span class="o">.</span><span class="vm">__class__</span>
<span class="go">__main__.Stack</span>
</pre></div>
</div>
<p>Generic aliases can be instantiated or subclassed, similar to real
classes, but the above examples illustrate that type variables are
erased at runtime. Generic <code class="docutils literal notranslate"><span class="pre">Stack</span></code> instances are just ordinary
Python objects, and they have no extra runtime overhead or magic due
to being generic, other than a metaclass that overloads the indexing
operator.</p>
<p>Note that in Python 3.8 and lower, the built-in types
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> and others do not support indexing.
This is why we have the aliases <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a>,
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a> and so on in the <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a>
module. Indexing these aliases gives you a generic alias that
resembles generic aliases constructed by directly indexing the target
class in more recent versions of Python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Only relevant for Python 3.8 and below</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># For Python 3.9 onwards, prefer `list[int]` syntax</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="go">typing.List[int]</span>
</pre></div>
</div>
<p>Note that the generic aliases in <code class="docutils literal notranslate"><span class="pre">typing</span></code> don’t support constructing
instances:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]()</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">Type List cannot be instantiated; use list() instead</span>
</pre></div>
</div>
</section>
</section>
<span id="document-more_types"></span><section id="more-types">
<h3>More types<a class="headerlink" href="#more-types" title="Permalink to this headline">#</a></h3>
<p>This section introduces a few additional kinds of types, including <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NoReturn" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">NoReturn</span></code></a>,
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NewType" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NewType</span></code></a>, and types for async code. It also discusses
how to give functions more precise types using overloads. All of these are only
situationally useful, so feel free to skip this section and come back when you
have a need for some of them.</p>
<p>Here’s a quick summary of what’s covered here:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NoReturn" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">NoReturn</span></code></a> lets you tell mypy that a function never returns normally.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NewType" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NewType</span></code></a> lets you define a variant of a type that is treated as a
separate type by mypy but is identical to the original type at runtime.
For example, you can have <code class="docutils literal notranslate"><span class="pre">UserId</span></code> as a variant of <code class="docutils literal notranslate"><span class="pre">int</span></code> that is
just an <code class="docutils literal notranslate"><span class="pre">int</span></code> at runtime.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.overload" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;overload</span></code></a> lets you define a function that can accept multiple distinct
signatures. This is useful if you need to encode a relationship between the
arguments and the return type that would be difficult to express normally.</p></li>
<li><p>Async types let you type check programs using <code class="docutils literal notranslate"><span class="pre">async</span></code> and <code class="docutils literal notranslate"><span class="pre">await</span></code>.</p></li>
</ul>
<section id="the-noreturn-type">
<span id="noreturn"></span><h4>The NoReturn type<a class="headerlink" href="#the-noreturn-type" title="Permalink to this headline">#</a></h4>
<p>Mypy provides support for functions that never return. For
example, a function that unconditionally raises an exception:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NoReturn</span>

<span class="k">def</span> <span class="nf">stop</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;no way&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Mypy will ensure that functions annotated as returning <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NoReturn" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">NoReturn</span></code></a>
truly never return, either implicitly or explicitly. Mypy will also
recognize that the code after calls to such functions is unreachable
and will behave accordingly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="n">stop</span><span class="p">()</span>
    <span class="k">return</span> <span class="s1">&#39;whatever works&#39;</span>  <span class="c1"># No error in an unreachable block</span>
</pre></div>
</div>
<p>In earlier Python versions you need to install <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> using
pip to use <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NoReturn" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">NoReturn</span></code></a> in your code. Python 3 command line:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>python3 -m pip install --upgrade typing-extensions
</pre></div>
</div>
</section>
<section id="newtypes">
<span id="id1"></span><h4>NewTypes<a class="headerlink" href="#newtypes" title="Permalink to this headline">#</a></h4>
<p>There are situations where you may want to avoid programming errors by
creating simple derived classes that are only used to distinguish
certain values from base class instances. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">UserId</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">get_by_user_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="n">UserId</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>However, this approach introduces some runtime overhead. To avoid this, the typing
module provides a helper object <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NewType" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NewType</span></code></a> that creates simple unique types with
almost zero runtime overhead. Mypy will treat the statement
<code class="docutils literal notranslate"><span class="pre">Derived</span> <span class="pre">=</span> <span class="pre">NewType('Derived',</span> <span class="pre">Base)</span></code> as being roughly equivalent to the following
definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Derived</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_x</span><span class="p">:</span> <span class="n">Base</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>However, at runtime, <code class="docutils literal notranslate"><span class="pre">NewType('Derived',</span> <span class="pre">Base)</span></code> will return a dummy callable that
simply returns its argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Derived</span><span class="p">(</span><span class="n">_x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_x</span>
</pre></div>
</div>
<p>Mypy will require explicit casts from <code class="docutils literal notranslate"><span class="pre">int</span></code> where <code class="docutils literal notranslate"><span class="pre">UserId</span></code> is expected, while
implicitly casting from <code class="docutils literal notranslate"><span class="pre">UserId</span></code> where <code class="docutils literal notranslate"><span class="pre">int</span></code> is expected. Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NewType</span>

<span class="n">UserId</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s1">&#39;UserId&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">name_by_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="n">UserId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="o">...</span>

<span class="n">UserId</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>          <span class="c1"># Fails type check</span>

<span class="n">name_by_id</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>          <span class="c1"># Fails type check</span>
<span class="n">name_by_id</span><span class="p">(</span><span class="n">UserId</span><span class="p">(</span><span class="mi">42</span><span class="p">))</span>  <span class="c1"># OK</span>

<span class="n">num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">UserId</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NewType" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NewType</span></code></a> accepts exactly two arguments. The first argument must be a string literal
containing the name of the new type and must equal the name of the variable to which the new
type is assigned. The second argument must be a properly subclassable class, i.e.,
not a type construct like <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>, etc.</p>
<p>The callable returned by <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NewType" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NewType</span></code></a> accepts only one argument; this is equivalent to
supporting only one constructor accepting an instance of the base class (see above).
Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NewType</span>

<span class="k">class</span> <span class="nc">PacketId</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">major</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">minor</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_major</span> <span class="o">=</span> <span class="n">major</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_minor</span> <span class="o">=</span> <span class="n">minor</span>

<span class="n">TcpPacketId</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s1">&#39;TcpPacketId&#39;</span><span class="p">,</span> <span class="n">PacketId</span><span class="p">)</span>

<span class="n">packet</span> <span class="o">=</span> <span class="n">PacketId</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">tcp_packet</span> <span class="o">=</span> <span class="n">TcpPacketId</span><span class="p">(</span><span class="n">packet</span><span class="p">)</span>  <span class="c1"># OK</span>

<span class="n">tcp_packet</span> <span class="o">=</span> <span class="n">TcpPacketId</span><span class="p">(</span><span class="mi">127</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Fails in type checker and at runtime</span>
</pre></div>
</div>
<p>You cannot use <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/functions.html#issubclass" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">issubclass()</span></code></a> on the object returned by
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NewType" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NewType</span></code></a>, nor can you subclass an object returned by <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NewType" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NewType</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike type aliases, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NewType" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NewType</span></code></a> will create an entirely new and
unique type when used. The intended purpose of <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NewType" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NewType</span></code></a> is to help you
detect cases where you accidentally mixed together the old base type and the
new derived type.</p>
<p>For example, the following will successfully typecheck when using type
aliases:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">UserId</span> <span class="o">=</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">name_by_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="n">UserId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="o">...</span>

<span class="n">name_by_id</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># ints and UserId are synonymous</span>
</pre></div>
</div>
<p>But a similar example using <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NewType" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NewType</span></code></a> will not typecheck:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NewType</span>

<span class="n">UserId</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s1">&#39;UserId&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">name_by_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="n">UserId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="o">...</span>

<span class="n">name_by_id</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># int is not the same as UserId</span>
</pre></div>
</div>
</div>
</section>
<section id="function-overloading">
<span id="id2"></span><h4>Function overloading<a class="headerlink" href="#function-overloading" title="Permalink to this headline">#</a></h4>
<p>Sometimes the arguments and types in a function depend on each other
in ways that can’t be captured with a <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>. For example, suppose
we want to write a function that can accept x-y coordinates. If we pass
in just a single x-y coordinate, we return a <code class="docutils literal notranslate"><span class="pre">ClickEvent</span></code> object. However,
if we pass in two x-y coordinates, we return a <code class="docutils literal notranslate"><span class="pre">DragEvent</span></code> object.</p>
<p>Our first attempt at writing this function might look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">def</span> <span class="nf">mouse_event</span><span class="p">(</span><span class="n">x1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">y1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">x2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">y2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ClickEvent</span><span class="p">,</span> <span class="n">DragEvent</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">x2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ClickEvent</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">x2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DragEvent</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Bad arguments&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>While this function signature works, it’s too loose: it implies <code class="docutils literal notranslate"><span class="pre">mouse_event</span></code>
could return either object regardless of the number of arguments
we pass in. It also does not prohibit a caller from passing in the wrong
number of ints: mypy would treat calls like <code class="docutils literal notranslate"><span class="pre">mouse_event(1,</span> <span class="pre">2,</span> <span class="pre">20)</span></code> as being
valid, for example.</p>
<p>We can do better by using <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/#function-method-overloading"><strong>overloading</strong></a>
which lets us give the same function multiple type annotations (signatures)
to more accurately describe the function’s behavior:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">overload</span>

<span class="c1"># Overload *variants* for &#39;mouse_event&#39;.</span>
<span class="c1"># These variants give extra information to the type checker.</span>
<span class="c1"># They are ignored at runtime.</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">mouse_event</span><span class="p">(</span><span class="n">x1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y1</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ClickEvent</span><span class="p">:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">mouse_event</span><span class="p">(</span><span class="n">x1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y2</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DragEvent</span><span class="p">:</span> <span class="o">...</span>

<span class="c1"># The actual *implementation* of &#39;mouse_event&#39;.</span>
<span class="c1"># The implementation contains the actual runtime logic.</span>
<span class="c1">#</span>
<span class="c1"># It may or may not have type hints. If it does, mypy</span>
<span class="c1"># will check the body of the implementation against the</span>
<span class="c1"># type hints.</span>
<span class="c1">#</span>
<span class="c1"># Mypy will also check and make sure the signature is</span>
<span class="c1"># consistent with the provided variants.</span>

<span class="k">def</span> <span class="nf">mouse_event</span><span class="p">(</span><span class="n">x1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">y1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">x2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">y2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ClickEvent</span><span class="p">,</span> <span class="n">DragEvent</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">x2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ClickEvent</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">x2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DragEvent</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Bad arguments&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This allows mypy to understand calls to <code class="docutils literal notranslate"><span class="pre">mouse_event</span></code> much more precisely.
For example, mypy will understand that <code class="docutils literal notranslate"><span class="pre">mouse_event(5,</span> <span class="pre">25)</span></code> will
always have a return type of <code class="docutils literal notranslate"><span class="pre">ClickEvent</span></code> and will report errors for
calls like <code class="docutils literal notranslate"><span class="pre">mouse_event(5,</span> <span class="pre">25,</span> <span class="pre">2)</span></code>.</p>
<p>As another example, suppose we want to write a custom container class that
implements the <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__getitem__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__getitem__</span></code></a> method (<code class="docutils literal notranslate"><span class="pre">[]</span></code> bracket indexing). If this
method receives an integer we return a single item. If it receives a
<code class="docutils literal notranslate"><span class="pre">slice</span></code>, we return a <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Sequence" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sequence</span></code></a> of items.</p>
<p>We can precisely encode this relationship between the argument and the
return type by using overloads like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">overload</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyList</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span> <span class="o">...</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="c1"># Return a T here</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="c1"># Return a sequence of Ts here</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you just need to constrain a type variable to certain types or
subtypes, you can use a <a class="reference internal" href="index.html#type-variable-value-restriction"><span class="std std-ref">value restriction</span></a>.</p>
</div>
<p>The default values of a function’s arguments don’t affect its signature – only
the absence or presence of a default value does. So in order to reduce
redundancy, it’s possible to replace default values in overload definitions with
<code class="docutils literal notranslate"><span class="pre">...</span></code> as a placeholder:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">overload</span>

<span class="k">class</span> <span class="nc">M</span><span class="p">:</span> <span class="o">...</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="n">model_or_pk</span><span class="p">:</span> <span class="n">M</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">M</span><span class="p">:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="n">model_or_pk</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">M</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">get_model</span><span class="p">(</span><span class="n">model_or_pk</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">M</span><span class="p">,</span> <span class="n">flag</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">M</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<section id="runtime-behavior">
<h5>Runtime behavior<a class="headerlink" href="#runtime-behavior" title="Permalink to this headline">#</a></h5>
<p>An overloaded function must consist of two or more overload <em>variants</em>
followed by an <em>implementation</em>. The variants and the implementations
must be adjacent in the code: think of them as one indivisible unit.</p>
<p>The variant bodies must all be empty; only the implementation is allowed
to contain code. This is because at runtime, the variants are completely
ignored: they’re overridden by the final implementation function.</p>
<p>This means that an overloaded function is still an ordinary Python
function! There is no automatic dispatch handling and you must manually
handle the different types in the implementation (e.g. by using
<code class="docutils literal notranslate"><span class="pre">if</span></code> statements and <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance</span></code></a> checks).</p>
<p>If you are adding an overload within a stub file, the implementation
function should be omitted: stubs do not contain runtime logic.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While we can leave the variant body empty using the <code class="docutils literal notranslate"><span class="pre">pass</span></code> keyword,
the more common convention is to instead use the ellipsis (<code class="docutils literal notranslate"><span class="pre">...</span></code>) literal.</p>
</div>
</section>
<section id="type-checking-calls-to-overloads">
<h5>Type checking calls to overloads<a class="headerlink" href="#type-checking-calls-to-overloads" title="Permalink to this headline">#</a></h5>
<p>When you call an overloaded function, mypy will infer the correct return
type by picking the best matching variant, after taking into consideration
both the argument types and arity. However, a call is never type
checked against the implementation. This is why mypy will report calls
like <code class="docutils literal notranslate"><span class="pre">mouse_event(5,</span> <span class="pre">25,</span> <span class="pre">3)</span></code> as being invalid even though it matches the
implementation signature.</p>
<p>If there are multiple equally good matching variants, mypy will select
the variant that was defined first. For example, consider the following
program:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># For Python 3.8 and below you must use `typing.List` instead of `list`. e.g.</span>
<span class="c1"># from typing import List</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">overload</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="o">...</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
        <span class="c1"># Do int specific code</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Do str-specific code</span>

<span class="c1"># What is the type of &#39;output&#39;? float or str?</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">([])</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">summarize([])</span></code> call matches both variants: an empty list could
be either a <code class="docutils literal notranslate"><span class="pre">list[int]</span></code> or a <code class="docutils literal notranslate"><span class="pre">list[str]</span></code>. In this case, mypy
will break the tie by picking the first matching variant: <code class="docutils literal notranslate"><span class="pre">output</span></code>
will have an inferred type of <code class="docutils literal notranslate"><span class="pre">float</span></code>. The implementor is responsible
for making sure <code class="docutils literal notranslate"><span class="pre">summarize</span></code> breaks ties in the same way at runtime.</p>
<p>However, there are two exceptions to the “pick the first match” rule.
First, if multiple variants match due to an argument being of type
<code class="docutils literal notranslate"><span class="pre">Any</span></code>, mypy will make the inferred type also be <code class="docutils literal notranslate"><span class="pre">Any</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dynamic_var</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">some_dynamic_function</span><span class="p">()</span>

<span class="c1"># output2 is of type &#39;Any&#39;</span>
<span class="n">output2</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span><span class="n">dynamic_var</span><span class="p">)</span>
</pre></div>
</div>
<p>Second, if multiple variants match due to one or more of the arguments
being a union, mypy will make the inferred type be the union of the
matching variant returns:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">some_list</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>

<span class="c1"># output3 is of type &#39;Union[float, str]&#39;</span>
<span class="n">output3</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span><span class="n">some_list</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Due to the “pick the first match” rule, changing the order of your
overload variants can change how mypy type checks your program.</p>
<p>To minimize potential issues, we recommend that you:</p>
<ol class="arabic simple">
<li><p>Make sure your overload variants are listed in the same order as
the runtime checks (e.g. <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance</span></code></a> checks) in your implementation.</p></li>
<li><p>Order your variants and runtime checks from most to least specific.
(See the following section for an example).</p></li>
</ol>
</div>
</section>
<section id="type-checking-the-variants">
<h5>Type checking the variants<a class="headerlink" href="#type-checking-the-variants" title="Permalink to this headline">#</a></h5>
<p>Mypy will perform several checks on your overload variant definitions
to ensure they behave as expected. First, mypy will check and make sure
that no overload variant is shadowing a subsequent one. For example,
consider the following function which adds together two <code class="docutils literal notranslate"><span class="pre">Expression</span></code>
objects, and contains a special-case to handle receiving two <code class="docutils literal notranslate"><span class="pre">Literal</span></code>
types:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">overload</span><span class="p">,</span> <span class="n">Union</span>

<span class="k">class</span> <span class="nc">Expression</span><span class="p">:</span>
    <span class="c1"># ...snip...</span>

<span class="k">class</span> <span class="nc">Literal</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="c1"># ...snip...</span>

<span class="c1"># Warning -- the first overload variant shadows the second!</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="n">Expression</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">Expression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span> <span class="o">...</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">Literal</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Literal</span><span class="p">:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="n">Expression</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">Expression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span>
    <span class="c1"># ...snip...</span>
</pre></div>
</div>
<p>While this code snippet is technically type-safe, it does contain an
anti-pattern: the second variant will never be selected! If we try calling
<code class="docutils literal notranslate"><span class="pre">add(Literal(3),</span> <span class="pre">Literal(4))</span></code>, mypy will always pick the first variant
and evaluate the function call to be of type <code class="docutils literal notranslate"><span class="pre">Expression</span></code>, not <code class="docutils literal notranslate"><span class="pre">Literal</span></code>.
This is because <code class="docutils literal notranslate"><span class="pre">Literal</span></code> is a subtype of <code class="docutils literal notranslate"><span class="pre">Expression</span></code>, which means
the “pick the first match” rule will always halt after considering the
first overload.</p>
<p>Because having an overload variant that can never be matched is almost
certainly a mistake, mypy will report an error. To fix the error, we can
either 1) delete the second overload or 2) swap the order of the overloads:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Everything is ok now -- the variants are correctly ordered</span>
<span class="c1"># from most to least specific.</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">Literal</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Literal</span><span class="p">:</span> <span class="o">...</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="n">Expression</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">Expression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="n">Expression</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">Expression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span>
    <span class="c1"># ...snip...</span>
</pre></div>
</div>
<p>Mypy will also type check the different variants and flag any overloads
that have inherently unsafely overlapping variants. For example, consider
the following unsafe overload definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">overload</span><span class="p">,</span> <span class="n">Union</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">unsafe_func</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">unsafe_func</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">unsafe_func</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">42</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;some string&quot;</span>
</pre></div>
</div>
<p>On the surface, this function definition appears to be fine. However, it will
result in a discrepancy between the inferred type and the actual runtime type
when we try using it like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">some_obj</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">unsafe_func</span><span class="p">(</span><span class="n">some_obj</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; danger danger&quot;</span>  <span class="c1"># Type checks, yet crashes at runtime!</span>
</pre></div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">some_obj</span></code> is of type <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a>, mypy will decide that <code class="docutils literal notranslate"><span class="pre">unsafe_func</span></code>
must return something of type <code class="docutils literal notranslate"><span class="pre">str</span></code> and concludes the above will type check.
But in reality, <code class="docutils literal notranslate"><span class="pre">unsafe_func</span></code> will return an int, causing the code to crash
at runtime!</p>
<p>To prevent these kinds of issues, mypy will detect and prohibit inherently unsafely
overlapping overloads on a best-effort basis. Two variants are considered unsafely
overlapping when both of the following are true:</p>
<ol class="arabic simple">
<li><p>All of the arguments of the first variant are compatible with the second.</p></li>
<li><p>The return type of the first variant is <em>not</em> compatible with (e.g. is not a
subtype of) the second.</p></li>
</ol>
<p>So in this example, the <code class="docutils literal notranslate"><span class="pre">int</span></code> argument in the first variant is a subtype of
the <code class="docutils literal notranslate"><span class="pre">object</span></code> argument in the second, yet the <code class="docutils literal notranslate"><span class="pre">int</span></code> return type is not a subtype of
<code class="docutils literal notranslate"><span class="pre">str</span></code>. Both conditions are true, so mypy will correctly flag <code class="docutils literal notranslate"><span class="pre">unsafe_func</span></code> as
being unsafe.</p>
<p>However, mypy will not detect <em>all</em> unsafe uses of overloads. For example,
suppose we modify the above snippet so it calls <code class="docutils literal notranslate"><span class="pre">summarize</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">unsafe_func</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">some_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">summarize</span><span class="p">(</span><span class="n">some_list</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;danger danger&quot;</span>  <span class="c1"># Type safe, yet crashes at runtime!</span>
</pre></div>
</div>
<p>We run into a similar issue here. This program type checks if we look just at the
annotations on the overloads. But since <code class="docutils literal notranslate"><span class="pre">summarize(...)</span></code> is designed to be biased
towards returning a float when it receives an empty list, this program will actually
crash during runtime.</p>
<p>The reason mypy does not flag definitions like <code class="docutils literal notranslate"><span class="pre">summarize</span></code> as being potentially
unsafe is because if it did, it would be extremely difficult to write a safe
overload. For example, suppose we define an overload with two variants that accept
types <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code> respectively. Even if those two types were completely unrelated,
the user could still potentially trigger a runtime error similar to the ones above by
passing in a value of some third type <code class="docutils literal notranslate"><span class="pre">C</span></code> that inherits from both <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p>
<p>Thankfully, these types of situations are relatively rare. What this does mean,
however, is that you should exercise caution when designing or using an overloaded
function that can potentially receive values that are an instance of two seemingly
unrelated types.</p>
</section>
<section id="type-checking-the-implementation">
<h5>Type checking the implementation<a class="headerlink" href="#type-checking-the-implementation" title="Permalink to this headline">#</a></h5>
<p>The body of an implementation is type-checked against the
type hints provided on the implementation. For example, in the
<code class="docutils literal notranslate"><span class="pre">MyList</span></code> example up above, the code in the body is checked with
argument list <code class="docutils literal notranslate"><span class="pre">index:</span> <span class="pre">Union[int,</span> <span class="pre">slice]</span></code> and a return type of
<code class="docutils literal notranslate"><span class="pre">Union[T,</span> <span class="pre">Sequence[T]]</span></code>. If there are no annotations on the
implementation, then the body is not type checked. If you want to
force mypy to check the body anyways, use the <a class="reference internal" href="index.html#cmdoption-mypy-check-untyped-defs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--check-untyped-defs</span></code></a>
flag (<a class="reference internal" href="index.html#untyped-definitions-and-calls"><span class="std std-ref">more details here</span></a>).</p>
<p>The variants must also also be compatible with the implementation
type hints. In the <code class="docutils literal notranslate"><span class="pre">MyList</span></code> example, mypy will check that the
parameter type <code class="docutils literal notranslate"><span class="pre">int</span></code> and the return type <code class="docutils literal notranslate"><span class="pre">T</span></code> are compatible with
<code class="docutils literal notranslate"><span class="pre">Union[int,</span> <span class="pre">slice]</span></code> and <code class="docutils literal notranslate"><span class="pre">Union[T,</span> <span class="pre">Sequence]</span></code> for the
first variant. For the second variant it verifies the parameter
type <code class="docutils literal notranslate"><span class="pre">slice</span></code> and the return type <code class="docutils literal notranslate"><span class="pre">Sequence[T]</span></code> are compatible
with <code class="docutils literal notranslate"><span class="pre">Union[int,</span> <span class="pre">slice]</span></code> and <code class="docutils literal notranslate"><span class="pre">Union[T,</span> <span class="pre">Sequence]</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The overload semantics documented above are new as of mypy 0.620.</p>
<p>Previously, mypy used to perform type erasure on all overload variants. For
example, the <code class="docutils literal notranslate"><span class="pre">summarize</span></code> example from the previous section used to be
illegal because <code class="docutils literal notranslate"><span class="pre">list[str]</span></code> and <code class="docutils literal notranslate"><span class="pre">list[int]</span></code> both erased to just <code class="docutils literal notranslate"><span class="pre">list[Any]</span></code>.
This restriction was removed in mypy 0.620.</p>
<p>Mypy also previously used to select the best matching variant using a different
algorithm. If this algorithm failed to find a match, it would default to returning
<code class="docutils literal notranslate"><span class="pre">Any</span></code>. The new algorithm uses the “pick the first match” rule and will fall back
to returning <code class="docutils literal notranslate"><span class="pre">Any</span></code> only if the input arguments also contain <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p>
</div>
</section>
<section id="conditional-overloads">
<h5>Conditional overloads<a class="headerlink" href="#conditional-overloads" title="Permalink to this headline">#</a></h5>
<p>Sometimes it is useful to define overloads conditionally.
Common use cases include types that are unavailable at runtime or that
only exist in a certain Python version. All existing overload rules still apply.
For example, there must be at least two overloads.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Mypy can only infer a limited number of conditions.
Supported ones currently include <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.TYPE_CHECKING" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">TYPE_CHECKING</span></code></a>, <code class="docutils literal notranslate"><span class="pre">MYPY</span></code>,
<a class="reference internal" href="index.html#version-and-platform-checks"><span class="std std-ref">Python version and system platform checks</span></a>, <a class="reference internal" href="index.html#cmdoption-mypy-always-true"><code class="xref std std-option docutils literal notranslate"><span class="pre">--always-true</span></code></a>,
and <a class="reference internal" href="index.html#cmdoption-mypy-always-false"><code class="xref std std-option docutils literal notranslate"><span class="pre">--always-false</span></code></a> values.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">overload</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">class</span> <span class="nc">B</span><span class="p">:</span> <span class="o">...</span>


<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="p">:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">var</span>


<span class="n">reveal_type</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">A</span><span class="p">()))</span>  <span class="c1"># Revealed type is &quot;A&quot;</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># flags: --python-version 3.10</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">overload</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">B</span><span class="p">:</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">C</span><span class="p">:</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">D</span><span class="p">:</span> <span class="o">...</span>


<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">:</span> <span class="o">...</span>

<span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="p">:</span> <span class="o">...</span>

<span class="k">else</span><span class="p">:</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">C</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">:</span> <span class="o">...</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">D</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">D</span><span class="p">:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">var</span>


<span class="n">reveal_type</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">B</span><span class="p">()))</span>  <span class="c1"># Revealed type is &quot;B&quot;</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">C</span><span class="p">()))</span>  <span class="c1"># No overload variant of &quot;func&quot; matches argument type &quot;C&quot;</span>
    <span class="c1"># Possible overload variants:</span>
    <span class="c1">#     def func(var: B) -&gt; B</span>
    <span class="c1">#     def func(var: D) -&gt; D</span>
    <span class="c1"># Revealed type is &quot;Any&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the last example, mypy is executed with
<a class="reference internal" href="index.html#cmdoption-mypy-python-version"><code class="xref std std-option docutils literal notranslate"><span class="pre">--python-version</span> <span class="pre">3.10</span></code></a>.
Therefore, the condition <code class="docutils literal notranslate"><span class="pre">sys.version_info</span> <span class="pre">&gt;=</span> <span class="pre">(3,</span> <span class="pre">10)</span></code> will match and
the overload for <code class="docutils literal notranslate"><span class="pre">B</span></code> will be added.
The overloads for <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">C</span></code> are ignored!
The overload for <code class="docutils literal notranslate"><span class="pre">D</span></code> is not defined conditionally and thus is also added.</p>
</div>
<p>When mypy cannot infer a condition to be always <code class="docutils literal notranslate"><span class="pre">True</span></code> or always <code class="docutils literal notranslate"><span class="pre">False</span></code>,
an error is emitted.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">overload</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">B</span><span class="p">:</span> <span class="o">...</span>


<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">bool_var</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">bool_var</span><span class="p">:</span>  <span class="c1"># Condition can&#39;t be inferred, unable to merge overloads</span>
        <span class="nd">@overload</span>
        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">:</span> <span class="o">...</span>

        <span class="nd">@overload</span>
        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">B</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">var</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span> <span class="o">...</span>

    <span class="n">reveal_type</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">A</span><span class="p">()))</span>  <span class="c1"># Revealed type is &quot;Any&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="advanced-uses-of-self-types">
<span id="advanced-self"></span><h4>Advanced uses of self-types<a class="headerlink" href="#advanced-uses-of-self-types" title="Permalink to this headline">#</a></h4>
<p>Normally, mypy doesn’t require annotations for the first arguments of instance and
class methods. However, they may be needed to have more precise static typing
for certain programming patterns.</p>
<section id="restricted-methods-in-generic-classes">
<h5>Restricted methods in generic classes<a class="headerlink" href="#restricted-methods-in-generic-classes" title="Permalink to this headline">#</a></h5>
<p>In generic classes some methods may be allowed to be called only
for certain values of type arguments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">T</span>
    <span class="k">def</span> <span class="nf">uppercase_item</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Tag</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="n">ti</span><span class="p">:</span> <span class="n">Tag</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">ts</span><span class="p">:</span> <span class="n">Tag</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">ti</span><span class="o">.</span><span class="n">uppercase_item</span><span class="p">()</span>  <span class="c1"># E: Invalid self argument &quot;Tag[int]&quot; to attribute function</span>
                         <span class="c1"># &quot;uppercase_item&quot; with type &quot;Callable[[Tag[str]], str]&quot;</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">uppercase_item</span><span class="p">()</span>  <span class="c1"># This is OK</span>
</pre></div>
</div>
<p>This pattern also allows matching on nested types in situations where the type
argument is itself generic:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">covariant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>

 <span class="k">class</span> <span class="nc">Storage</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
     <span class="k">def</span> <span class="nf">first_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Storage</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">S</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">S</span><span class="p">:</span>
         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

 <span class="n">page</span><span class="p">:</span> <span class="n">Storage</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
 <span class="n">page</span><span class="o">.</span><span class="n">first_chunk</span><span class="p">()</span>  <span class="c1"># OK, type is &quot;str&quot;</span>

 <span class="n">Storage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">first_chunk</span><span class="p">()</span>  <span class="c1"># Error: Invalid self argument &quot;Storage[int]&quot; to attribute function</span>
                           <span class="c1"># &quot;first_chunk&quot; with type &quot;Callable[[Storage[Sequence[S]]], S]&quot;</span>
</pre></div>
</div>
<p>Finally, one can use overloads on self-type to express precise types of
some tricky methods:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Tag</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">...</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">converter</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T</span><span class="p">],</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">converter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">item</span>
        <span class="k">return</span> <span class="n">converter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
</pre></div>
</div>
<p>In particular, an <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code></a> method overloaded on self-type
may be useful to annotate generic class constructors where type arguments
depend on constructor parameters in a non-trivial way, see e.g. <a class="reference external" href="https://docs.python.org/3/library/subprocess.html#subprocess.Popen" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Popen</span></code></a>.</p>
</section>
<section id="mixin-classes">
<h5>Mixin classes<a class="headerlink" href="#mixin-classes" title="Permalink to this headline">#</a></h5>
<p>Using host class protocol as a self-type in mixin methods allows
more code re-usability for static typing of mixin classes. For example,
one can define a protocol that defines common functionality for
host classes instead of adding required abstract methods to every mixin:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Lockable</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Lock</span><span class="p">:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">AtomicCloseMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">atomic_close</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Lockable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="c1"># perform actions</span>

<span class="k">class</span> <span class="nc">AtomicOpenMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">atomic_open</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Lockable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="c1"># perform actions</span>

<span class="k">class</span> <span class="nc">File</span><span class="p">(</span><span class="n">AtomicCloseMixin</span><span class="p">,</span> <span class="n">AtomicOpenMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Bad</span><span class="p">(</span><span class="n">AtomicCloseMixin</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">File</span><span class="p">()</span>
<span class="n">b</span><span class="p">:</span> <span class="n">Bad</span>
<span class="n">f</span><span class="o">.</span><span class="n">atomic_close</span><span class="p">()</span>  <span class="c1"># OK</span>
<span class="n">b</span><span class="o">.</span><span class="n">atomic_close</span><span class="p">()</span>  <span class="c1"># Error: Invalid self type for &quot;atomic_close&quot;</span>
</pre></div>
</div>
<p>Note that the explicit self-type is <em>required</em> to be a protocol whenever it
is not a supertype of the current class. In this case mypy will check the validity
of the self-type only at the call site.</p>
</section>
<section id="precise-typing-of-alternative-constructors">
<h5>Precise typing of alternative constructors<a class="headerlink" href="#precise-typing-of-alternative-constructors" title="Permalink to this headline">#</a></h5>
<p>Some classes may define alternative constructors. If these
classes are generic, self-type allows giving them precise signatures:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;Base[T]&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">item</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">make_pair</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Q</span><span class="p">],</span> <span class="n">item</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Q</span><span class="p">,</span> <span class="n">Q</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">item</span><span class="p">),</span> <span class="bp">cls</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Sub</span><span class="p">(</span><span class="n">Base</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="o">...</span>

<span class="n">pair</span> <span class="o">=</span> <span class="n">Sub</span><span class="o">.</span><span class="n">make_pair</span><span class="p">(</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>  <span class="c1"># Type is &quot;tuple[Sub[str], Sub[str]]&quot;</span>
<span class="n">bad</span> <span class="o">=</span> <span class="n">Sub</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">make_pair</span><span class="p">(</span><span class="s1">&#39;no&#39;</span><span class="p">)</span>  <span class="c1"># Error: Argument 1 to &quot;make_pair&quot; of &quot;Base&quot;</span>
                                <span class="c1"># has incompatible type &quot;str&quot;; expected &quot;int&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="typing-async-await">
<span id="async-and-await"></span><h4>Typing async/await<a class="headerlink" href="#typing-async-await" title="Permalink to this headline">#</a></h4>
<p>Mypy lets you type coroutines that use the <code class="docutils literal notranslate"><span class="pre">async/await</span></code> syntax.
For more information regarding coroutines, see <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0492/"><strong>PEP 492</strong></a> and the
<a class="reference external" href="https://docs.python.org/3/library/asyncio.html">asyncio documentation</a>.</p>
<p>Functions defined using <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> are typed similar to normal functions.
The return type annotation should be the same as the type of the value you
expect to get back when <code class="docutils literal notranslate"><span class="pre">await</span></code>-ing the coroutine.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">format_string</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;T-minus </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">)&#39;</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">countdown</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">while</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">my_str</span> <span class="o">=</span> <span class="k">await</span> <span class="n">format_string</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>  <span class="c1"># type is inferred to be str</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">my_str</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="s2">&quot;Blastoff!&quot;</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">countdown</span><span class="p">(</span><span class="s2">&quot;Millennium Falcon&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<p>The result of calling an <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> function <em>without awaiting</em> will
automatically be inferred to be a value of type
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Coroutine" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Coroutine[Any,</span> <span class="pre">Any,</span> <span class="pre">T]</span></code></a>, which is a subtype of
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Awaitable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Awaitable[T]</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_coroutine</span> <span class="o">=</span> <span class="n">countdown</span><span class="p">(</span><span class="s2">&quot;Millennium Falcon&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">my_coroutine</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;typing.Coroutine[Any, Any, builtins.str]&quot;</span>
</pre></div>
</div>
<section id="asynchronous-iterators">
<span id="async-iterators"></span><h5>Asynchronous iterators<a class="headerlink" href="#asynchronous-iterators" title="Permalink to this headline">#</a></h5>
<p>If you have an asynchronous iterator, you can use the
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.AsyncIterator" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncIterator</span></code></a> type in your annotations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">AsyncIterator</span>
<span class="kn">import</span> <span class="nn">asyncio</span>

<span class="k">class</span> <span class="nc">arange</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">start</span> <span class="o">-</span> <span class="n">step</span>

    <span class="k">def</span> <span class="fm">__aiter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__anext__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">StopAsyncIteration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">run_countdown</span><span class="p">(</span><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">countdown</span><span class="p">:</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">countdown</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;T-minus </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;Blastoff!&quot;</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_countdown</span><span class="p">(</span><span class="s2">&quot;Serenity&quot;</span><span class="p">,</span> <span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
<p>Async generators (introduced in <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0525/"><strong>PEP 525</strong></a>) are an easy way to create
async iterators:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">AsyncGenerator</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">asyncio</span>

<span class="c1"># Could also type this as returning AsyncIterator[int]</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">arange</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="n">current</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">step</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">step</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">current</span> <span class="o">&gt;</span> <span class="n">stop</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">current</span>
        <span class="n">current</span> <span class="o">+=</span> <span class="n">step</span>

<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_countdown</span><span class="p">(</span><span class="s2">&quot;Battlestar Galactica&quot;</span><span class="p">,</span> <span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
<p>One common confusion is that the presence of a <code class="docutils literal notranslate"><span class="pre">yield</span></code> statement in an
<code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> function has an effect on the type of the function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">AsyncIterator</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">arange</span><span class="p">(</span><span class="n">stop</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="c1"># When called, arange gives you an async iterator</span>
    <span class="c1"># Equivalent to Callable[[int], AsyncIterator[int]]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">i</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">coroutine</span><span class="p">(</span><span class="n">stop</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="c1"># When called, coroutine gives you something you can await to get an async iterator</span>
    <span class="c1"># Equivalent to Callable[[int], Coroutine[Any, Any, AsyncIterator[int]]]</span>
    <span class="k">return</span> <span class="n">arange</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>  <span class="c1"># Revealed type is &quot;typing.AsyncIterator[builtins.int]&quot;</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="n">coroutine</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>  <span class="c1"># Revealed type is &quot;typing.Coroutine[Any, Any, typing.AsyncIterator[builtins.int]]&quot;</span>

    <span class="k">await</span> <span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Error: Incompatible types in &quot;await&quot; (actual type &quot;AsyncIterator[int]&quot;, expected type &quot;Awaitable[Any]&quot;)</span>
    <span class="n">reveal_type</span><span class="p">(</span><span class="k">await</span> <span class="n">coroutine</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>  <span class="c1"># Revealed type is &quot;typing.AsyncIterator[builtins.int]&quot;</span>
</pre></div>
</div>
<p>This can sometimes come up when trying to define base classes, Protocols or overloads:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">AsyncIterator</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">overload</span>

<span class="k">class</span> <span class="nc">LauncherIncorrect</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="c1"># Because launch does not have yield, this has type</span>
    <span class="c1"># Callable[[], Coroutine[Any, Any, AsyncIterator[int]]]</span>
    <span class="c1"># instead of</span>
    <span class="c1"># Callable[[], AsyncIterator[int]]</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<span class="k">class</span> <span class="nc">LauncherCorrect</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<span class="k">class</span> <span class="nc">LauncherAlsoCorrect</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">yield</span> <span class="mi">0</span>

<span class="c1"># The type of the overloads is independent of the implementation.</span>
<span class="c1"># In particular, their type is not affected by whether or not the</span>
<span class="c1"># implementation contains a `yield`.</span>
<span class="c1"># Use of `def`` makes it clear the type is Callable[..., AsyncIterator[int]],</span>
<span class="c1"># whereas with `async def` it would be Callable[..., Coroutine[Any, Any, AsyncIterator[int]]]</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span> <span class="o">...</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="c1"># The implementation of launch is an async generator and contains a yield</span>
    <span class="k">yield</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
</section>
</section>
<span id="document-literal_types"></span><section id="literal-types-and-enums">
<h3>Literal types and Enums<a class="headerlink" href="#literal-types-and-enums" title="Permalink to this headline">#</a></h3>
<section id="literal-types">
<span id="id1"></span><h4>Literal types<a class="headerlink" href="#literal-types" title="Permalink to this headline">#</a></h4>
<p>Literal types let you indicate that an expression is equal to some specific
primitive value. For example, if we annotate a variable with type <code class="docutils literal notranslate"><span class="pre">Literal[&quot;foo&quot;]</span></code>,
mypy will understand that variable is not only of type <code class="docutils literal notranslate"><span class="pre">str</span></code>, but is also
equal to specifically the string <code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code>.</p>
<p>This feature is primarily useful when annotating functions that behave
differently based on the exact value the caller provides. For example,
suppose we have a function <code class="docutils literal notranslate"><span class="pre">fetch_data(...)</span></code> that returns <code class="docutils literal notranslate"><span class="pre">bytes</span></code> if the
first argument is <code class="docutils literal notranslate"><span class="pre">True</span></code>, and <code class="docutils literal notranslate"><span class="pre">str</span></code> if it’s <code class="docutils literal notranslate"><span class="pre">False</span></code>. We can construct a
precise type signature for this function using <code class="docutils literal notranslate"><span class="pre">Literal[...]</span></code> and overloads:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">overload</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Literal</span>

<span class="c1"># The first two overloads use Literal[...] so we can</span>
<span class="c1"># have precise return types:</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">fetch_data</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">fetch_data</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">...</span>

<span class="c1"># The last overload is a fallback in case the caller</span>
<span class="c1"># provides a regular bool:</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">fetch_data</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">fetch_data</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="c1"># Implementation is omitted</span>
    <span class="o">...</span>

<span class="n">reveal_type</span><span class="p">(</span><span class="n">fetch_data</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>        <span class="c1"># Revealed type is &quot;bytes&quot;</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">fetch_data</span><span class="p">(</span><span class="kc">False</span><span class="p">))</span>       <span class="c1"># Revealed type is &quot;str&quot;</span>

<span class="c1"># Variables declared without annotations will continue to have an</span>
<span class="c1"># inferred type of &#39;bool&#39;.</span>

<span class="n">variable</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">fetch_data</span><span class="p">(</span><span class="n">variable</span><span class="p">))</span>    <span class="c1"># Revealed type is &quot;Union[bytes, str]&quot;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The examples in this page import <code class="docutils literal notranslate"><span class="pre">Literal</span></code> as well as <code class="docutils literal notranslate"><span class="pre">Final</span></code> and
<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> from the <code class="docutils literal notranslate"><span class="pre">typing</span></code> module. These types were added to
<code class="docutils literal notranslate"><span class="pre">typing</span></code> in Python 3.8, but are also available for use in Python
3.4 - 3.7 via the <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> package.</p>
</div>
<section id="parameterizing-literals">
<h5>Parameterizing Literals<a class="headerlink" href="#parameterizing-literals" title="Permalink to this headline">#</a></h5>
<p>Literal types may contain one or more literal bools, ints, strs, bytes, and
enum values. However, literal types <strong>cannot</strong> contain arbitrary expressions:
types like <code class="docutils literal notranslate"><span class="pre">Literal[my_string.trim()]</span></code>, <code class="docutils literal notranslate"><span class="pre">Literal[x</span> <span class="pre">&gt;</span> <span class="pre">3]</span></code>, or <code class="docutils literal notranslate"><span class="pre">Literal[3j</span> <span class="pre">+</span> <span class="pre">4]</span></code>
are all illegal.</p>
<p>Literals containing two or more values are equivalent to the union of those values.
So, <code class="docutils literal notranslate"><span class="pre">Literal[-3,</span> <span class="pre">b&quot;foo&quot;,</span> <span class="pre">MyEnum.A]</span></code> is equivalent to
<code class="docutils literal notranslate"><span class="pre">Union[Literal[-3],</span> <span class="pre">Literal[b&quot;foo&quot;],</span> <span class="pre">Literal[MyEnum.A]]</span></code>. This makes writing more
complex types involving literals a little more convenient.</p>
<p>Literal types may also contain <code class="docutils literal notranslate"><span class="pre">None</span></code>. Mypy will treat <code class="docutils literal notranslate"><span class="pre">Literal[None]</span></code> as being
equivalent to just <code class="docutils literal notranslate"><span class="pre">None</span></code>. This means that <code class="docutils literal notranslate"><span class="pre">Literal[4,</span> <span class="pre">None]</span></code>,
<code class="docutils literal notranslate"><span class="pre">Union[Literal[4],</span> <span class="pre">None]</span></code>, and <code class="docutils literal notranslate"><span class="pre">Optional[Literal[4]]</span></code> are all equivalent.</p>
<p>Literals may also contain aliases to other literal types. For example, the
following program is legal:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PrimaryColors</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">]</span>
<span class="n">SecondaryColors</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">]</span>
<span class="n">AllowedColors</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="n">PrimaryColors</span><span class="p">,</span> <span class="n">SecondaryColors</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="n">color</span><span class="p">:</span> <span class="n">AllowedColors</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="n">paint</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>        <span class="c1"># Type checks!</span>
<span class="n">paint</span><span class="p">(</span><span class="s2">&quot;turquoise&quot;</span><span class="p">)</span>  <span class="c1"># Does not type check</span>
</pre></div>
</div>
<p>Literals may not contain any other kind of type or expression. This means doing
<code class="docutils literal notranslate"><span class="pre">Literal[my_instance]</span></code>, <code class="docutils literal notranslate"><span class="pre">Literal[Any]</span></code>, <code class="docutils literal notranslate"><span class="pre">Literal[3.14]</span></code>, or
<code class="docutils literal notranslate"><span class="pre">Literal[{&quot;foo&quot;:</span> <span class="pre">2,</span> <span class="pre">&quot;bar&quot;:</span> <span class="pre">5}]</span></code> are all illegal.</p>
</section>
<section id="declaring-literal-variables">
<h5>Declaring literal variables<a class="headerlink" href="#declaring-literal-variables" title="Permalink to this headline">#</a></h5>
<p>You must explicitly add an annotation to a variable to declare that it has
a literal type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="mi">19</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>          <span class="c1"># Revealed type is &quot;Literal[19]&quot;</span>
</pre></div>
</div>
<p>In order to preserve backwards-compatibility, variables without this annotation
are <strong>not</strong> assumed to be literals:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="mi">19</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>          <span class="c1"># Revealed type is &quot;int&quot;</span>
</pre></div>
</div>
<p>If you find repeating the value of the variable in the type hint to be tedious,
you can instead change the variable to be <code class="docutils literal notranslate"><span class="pre">Final</span></code> (see <a class="reference internal" href="index.html#final-attrs"><span class="std std-ref">Final names, methods and classes</span></a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Final</span><span class="p">,</span> <span class="n">Literal</span>

<span class="k">def</span> <span class="nf">expects_literal</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">19</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>

<span class="n">c</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="mi">19</span>

<span class="n">reveal_type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>          <span class="c1"># Revealed type is &quot;Literal[19]?&quot;</span>
<span class="n">expects_literal</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>      <span class="c1"># ...and this type checks!</span>
</pre></div>
</div>
<p>If you do not provide an explicit type in the <code class="docutils literal notranslate"><span class="pre">Final</span></code>, the type of <code class="docutils literal notranslate"><span class="pre">c</span></code> becomes
<em>context-sensitive</em>: mypy will basically try “substituting” the original assigned
value whenever it’s used before performing type checking. This is why the revealed
type of <code class="docutils literal notranslate"><span class="pre">c</span></code> is <code class="docutils literal notranslate"><span class="pre">Literal[19]?</span></code>: the question mark at the end reflects this
context-sensitive nature.</p>
<p>For example, mypy will type check the above program almost as if it were written like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Final</span><span class="p">,</span> <span class="n">Literal</span>

<span class="k">def</span> <span class="nf">expects_literal</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">19</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>

<span class="n">reveal_type</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>
<span class="n">expects_literal</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>
</pre></div>
</div>
<p>This means that while changing a variable to be <code class="docutils literal notranslate"><span class="pre">Final</span></code> is not quite the same thing
as adding an explicit <code class="docutils literal notranslate"><span class="pre">Literal[...]</span></code> annotation, it often leads to the same effect
in practice.</p>
<p>The main cases where the behavior of context-sensitive vs true literal types differ are
when you try using those types in places that are not explicitly expecting a <code class="docutils literal notranslate"><span class="pre">Literal[...]</span></code>.
For example, compare and contrast what happens when you try appending these types to a list:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Final</span><span class="p">,</span> <span class="n">Literal</span>

<span class="n">a</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="mi">19</span>
<span class="n">b</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="o">=</span> <span class="mi">19</span>

<span class="c1"># Mypy will choose to infer list[int] here.</span>
<span class="n">list_of_ints</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">list_of_ints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">list_of_ints</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;list[int]&quot;</span>

<span class="c1"># But if the variable you&#39;re appending is an explicit Literal, mypy</span>
<span class="c1"># will infer list[Literal[19]].</span>
<span class="n">list_of_lits</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">list_of_lits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">list_of_lits</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;list[Literal[19]]&quot;</span>
</pre></div>
</div>
</section>
<section id="intelligent-indexing">
<h5>Intelligent indexing<a class="headerlink" href="#intelligent-indexing" title="Permalink to this headline">#</a></h5>
<p>We can use Literal types to more precisely index into structured heterogeneous
types such as tuples, NamedTuples, and TypedDicts. This feature is known as
<em>intelligent indexing</em>.</p>
<p>For example, when we index into a tuple using some int, the inferred type is
normally the union of the tuple item types. However, if we want just the type
corresponding to some particular index, we can use Literal types like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span>

<span class="n">tup</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">)</span>

<span class="c1"># Indexing with an int literal gives us the exact type for that index</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Revealed type is &quot;str&quot;</span>

<span class="c1"># But what if we want the index to be a variable? Normally mypy won&#39;t</span>
<span class="c1"># know exactly what the index is and so will return a less precise type:</span>
<span class="n">int_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="n">int_index</span><span class="p">])</span>  <span class="c1"># Revealed type is &quot;Union[str, float]&quot;</span>

<span class="c1"># But if we use either Literal types or a Final int, we can gain back</span>
<span class="c1"># the precision we originally had:</span>
<span class="n">lit_index</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fin_index</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="n">lit_index</span><span class="p">])</span>  <span class="c1"># Revealed type is &quot;str&quot;</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">tup</span><span class="p">[</span><span class="n">fin_index</span><span class="p">])</span>  <span class="c1"># Revealed type is &quot;str&quot;</span>

<span class="c1"># We can do the same thing with with TypedDict and str keys:</span>
<span class="k">class</span> <span class="nc">MyDict</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">main_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">backup_id</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">d</span><span class="p">:</span> <span class="n">MyDict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Saanvi&quot;</span><span class="p">,</span> <span class="s2">&quot;main_id&quot;</span><span class="p">:</span> <span class="mi">111</span><span class="p">,</span> <span class="s2">&quot;backup_id&quot;</span><span class="p">:</span> <span class="mi">222</span><span class="p">}</span>
<span class="n">name_key</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;name&quot;</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">name_key</span><span class="p">])</span>  <span class="c1"># Revealed type is &quot;str&quot;</span>

<span class="c1"># You can also index using unions of literals</span>
<span class="n">id_key</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;main_id&quot;</span><span class="p">,</span> <span class="s2">&quot;backup_id&quot;</span><span class="p">]</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">id_key</span><span class="p">])</span>    <span class="c1"># Revealed type is &quot;int&quot;</span>
</pre></div>
</div>
</section>
<section id="tagged-unions">
<span id="id2"></span><h5>Tagged unions<a class="headerlink" href="#tagged-unions" title="Permalink to this headline">#</a></h5>
<p>When you have a union of types, you can normally discriminate between each type
in the union by using <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> checks. For example, if you had a variable <code class="docutils literal notranslate"><span class="pre">x</span></code> of
type <code class="docutils literal notranslate"><span class="pre">Union[int,</span> <span class="pre">str]</span></code>, you could write some code that runs only if <code class="docutils literal notranslate"><span class="pre">x</span></code> is an int
by doing <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">isinstance(x,</span> <span class="pre">int):</span> <span class="pre">...</span></code>.</p>
<p>However, it is not always possible or convenient to do this. For example, it is not
possible to use <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> to distinguish between two different TypedDicts since
at runtime, your variable will simply be just a dict.</p>
<p>Instead, what you can do is <em>label</em> or <em>tag</em> your TypedDicts with a distinct Literal
type. Then, you can discriminate between each kind of TypedDict by checking the label:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">TypedDict</span><span class="p">,</span> <span class="n">Union</span>

<span class="k">class</span> <span class="nc">NewJobEvent</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;new-job&quot;</span><span class="p">]</span>
    <span class="n">job_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">config_file_path</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">class</span> <span class="nc">CancelJobEvent</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;cancel-job&quot;</span><span class="p">]</span>
    <span class="n">job_id</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">Event</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">NewJobEvent</span><span class="p">,</span> <span class="n">CancelJobEvent</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">process_event</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">Event</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Since we made sure both TypedDicts have a key named &#39;tag&#39;, it&#39;s</span>
    <span class="c1"># safe to do &#39;event[&quot;tag&quot;]&#39;. This expression normally has the type</span>
    <span class="c1"># Literal[&quot;new-job&quot;, &quot;cancel-job&quot;], but the check below will narrow</span>
    <span class="c1"># the type to either Literal[&quot;new-job&quot;] or Literal[&quot;cancel-job&quot;].</span>
    <span class="c1">#</span>
    <span class="c1"># This in turns narrows the type of &#39;event&#39; to either NewJobEvent</span>
    <span class="c1"># or CancelJobEvent.</span>
    <span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;new-job&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;job_name&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;job_id&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>While this feature is mostly useful when working with TypedDicts, you can also
use the same technique with regular objects, tuples, or namedtuples.</p>
<p>Similarly, tags do not need to be specifically str Literals: they can be any type
you can normally narrow within <code class="docutils literal notranslate"><span class="pre">if</span></code> statements and the like. For example, you
could have your tags be int or Enum Literals or even regular classes you narrow
using <code class="docutils literal notranslate"><span class="pre">isinstance()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Union</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Wrapper</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inner</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner</span> <span class="o">=</span> <span class="n">inner</span>

<span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">w</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Wrapper</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Wrapper</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Doing `if isinstance(w, Wrapper[int])` does not work: isinstance requires</span>
    <span class="c1"># that the second argument always be an *erased* type, with no generics.</span>
    <span class="c1"># This is because generics are a typing-only concept and do not exist at</span>
    <span class="c1"># runtime in a way `isinstance` can always check.</span>
    <span class="c1">#</span>
    <span class="c1"># However, we can side-step this by checking the type of `w.inner` to</span>
    <span class="c1"># narrow `w` itself:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">inner</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;Wrapper[int]&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;Wrapper[str]&quot;</span>
</pre></div>
</div>
<p>This feature is sometimes called “sum types” or “discriminated union types”
in other programming languages.</p>
</section>
<section id="exhaustiveness-checking">
<h5>Exhaustiveness checking<a class="headerlink" href="#exhaustiveness-checking" title="Permalink to this headline">#</a></h5>
<p>You may want to check that some code covers all possible
<code class="docutils literal notranslate"><span class="pre">Literal</span></code> or <code class="docutils literal notranslate"><span class="pre">Enum</span></code> cases. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="n">PossibleValues</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">PossibleValues</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;one&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid value: </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">validate</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span>
<span class="k">assert</span> <span class="n">validate</span><span class="p">(</span><span class="s1">&#39;two&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span>
</pre></div>
</div>
<p>In the code above, it’s easy to make a mistake. You can
add a new literal value to <code class="docutils literal notranslate"><span class="pre">PossibleValues</span></code> but forget
to handle it in the <code class="docutils literal notranslate"><span class="pre">validate</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PossibleValues</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Mypy won’t catch that <code class="docutils literal notranslate"><span class="pre">'three'</span></code> is not covered.  If you want mypy to
perform an exhaustiveness check, you need to update your code to use an
<code class="docutils literal notranslate"><span class="pre">assert_never()</span></code> check:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">NoReturn</span>

<span class="n">PossibleValues</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">assert_never</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">NoReturn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
    <span class="c1"># This also works at runtime as well</span>
    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;This code should never be reached, got: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">PossibleValues</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;one&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="n">assert_never</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>Now if you add a new value to <code class="docutils literal notranslate"><span class="pre">PossibleValues</span></code> but don’t update <code class="docutils literal notranslate"><span class="pre">validate</span></code>,
mypy will spot the error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PossibleValues</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">PossibleValues</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;one&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># Error: Argument 1 to &quot;assert_never&quot; has incompatible type &quot;Literal[&#39;three&#39;]&quot;;</span>
    <span class="c1"># expected &quot;NoReturn&quot;</span>
    <span class="n">assert_never</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>If runtime checking against unexpected values is not needed, you can
leave out the <code class="docutils literal notranslate"><span class="pre">assert_never</span></code> call in the above example, and mypy
will still generate an error about function <code class="docutils literal notranslate"><span class="pre">validate</span></code> returning
without a value:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">PossibleValues</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">]</span>

<span class="c1"># Error: Missing return statement</span>
<span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">PossibleValues</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;one&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Exhaustiveness checking is also supported for match statements (Python 3.10 and later):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">PossibleValues</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">match</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">case</span> <span class="s1">&#39;one&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">case</span> <span class="s1">&#39;two&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="n">assert_never</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="limitations">
<h5>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">#</a></h5>
<p>Mypy will not understand expressions that use variables of type <code class="docutils literal notranslate"><span class="pre">Literal[..]</span></code>
on a deep level. For example, if you have a variable <code class="docutils literal notranslate"><span class="pre">a</span></code> of type <code class="docutils literal notranslate"><span class="pre">Literal[3]</span></code>
and another variable <code class="docutils literal notranslate"><span class="pre">b</span></code> of type <code class="docutils literal notranslate"><span class="pre">Literal[5]</span></code>, mypy will infer that
<code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+</span> <span class="pre">b</span></code> has type <code class="docutils literal notranslate"><span class="pre">int</span></code>, <strong>not</strong> type <code class="docutils literal notranslate"><span class="pre">Literal[8]</span></code>.</p>
<p>The basic rule is that literal types are treated as just regular subtypes of
whatever type the parameter has. For example, <code class="docutils literal notranslate"><span class="pre">Literal[3]</span></code> is treated as a
subtype of <code class="docutils literal notranslate"><span class="pre">int</span></code> and so will inherit all of <code class="docutils literal notranslate"><span class="pre">int</span></code>’s methods directly. This
means that <code class="docutils literal notranslate"><span class="pre">Literal[3].__add__</span></code> accepts the same arguments and has the same
return type as <code class="docutils literal notranslate"><span class="pre">int.__add__</span></code>.</p>
</section>
</section>
<section id="enums">
<h4>Enums<a class="headerlink" href="#enums" title="Permalink to this headline">#</a></h4>
<p>Mypy has special support for <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Enum" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></a> and its subclasses:
<a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.IntEnum" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.IntEnum</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Flag" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Flag</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.IntFlag" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.IntFlag</span></code></a>,
and <a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.StrEnum" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">enum.StrEnum</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span> <span class="nc">Direction</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">up</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span>
    <span class="n">down</span> <span class="o">=</span> <span class="s1">&#39;down&#39;</span>

<span class="n">reveal_type</span><span class="p">(</span><span class="n">Direction</span><span class="o">.</span><span class="n">up</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;Literal[Direction.up]?&quot;</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">Direction</span><span class="o">.</span><span class="n">down</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;Literal[Direction.down]?&quot;</span>
</pre></div>
</div>
<p>You can use enums to annotate types as you would expect:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Movement</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">Direction</span><span class="p">,</span> <span class="n">speed</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span>

<span class="n">Movement</span><span class="p">(</span><span class="n">Direction</span><span class="o">.</span><span class="n">up</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>  <span class="c1"># ok</span>
<span class="n">Movement</span><span class="p">(</span><span class="s1">&#39;up&#39;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>  <span class="c1"># E: Argument 1 to &quot;Movement&quot; has incompatible type &quot;str&quot;; expected &quot;Direction&quot;</span>
</pre></div>
</div>
<section id="id3">
<h5>Exhaustiveness checking<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h5>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">Literal</span></code> types, <code class="docutils literal notranslate"><span class="pre">Enum</span></code> supports exhaustiveness checking.
Let’s start with a definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NoReturn</span>

<span class="k">def</span> <span class="nf">assert_never</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">NoReturn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
    <span class="c1"># This also works in runtime as well:</span>
    <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;This code should never be reached, got: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="k">class</span> <span class="nc">Direction</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">up</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span>
    <span class="n">down</span> <span class="o">=</span> <span class="s1">&#39;down&#39;</span>
</pre></div>
</div>
<p>Now, let’s use an exhaustiveness check:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">choose_direction</span><span class="p">(</span><span class="n">direction</span><span class="p">:</span> <span class="n">Direction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="ow">is</span> <span class="n">Direction</span><span class="o">.</span><span class="n">up</span><span class="p">:</span>
        <span class="n">reveal_type</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>  <span class="c1"># N: Revealed type is &quot;Literal[Direction.up]&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Going up!&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">elif</span> <span class="n">direction</span> <span class="ow">is</span> <span class="n">Direction</span><span class="o">.</span><span class="n">down</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Down&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="c1"># This line is never reached</span>
    <span class="n">assert_never</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
</pre></div>
</div>
<p>If we forget to handle one of the cases, mypy will generate an error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">choose_direction</span><span class="p">(</span><span class="n">direction</span><span class="p">:</span> <span class="n">Direction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="n">Direction</span><span class="o">.</span><span class="n">up</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Going up!&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">assert_never</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>  <span class="c1"># E: Argument 1 to &quot;assert_never&quot; has incompatible type &quot;Direction&quot;; expected &quot;NoReturn&quot;</span>
</pre></div>
</div>
<p>Exhaustiveness checking is also supported for match statements (Python 3.10 and later).</p>
</section>
<section id="extra-enum-checks">
<h5>Extra Enum checks<a class="headerlink" href="#extra-enum-checks" title="Permalink to this headline">#</a></h5>
<p>Mypy also tries to support special features of <code class="docutils literal notranslate"><span class="pre">Enum</span></code>
the same way Python’s runtime does:</p>
<ul>
<li><p>Any <code class="docutils literal notranslate"><span class="pre">Enum</span></code> class with values is implicitly <a class="reference internal" href="index.html#final-attrs"><span class="std std-ref">final</span></a>.
This is what happens in CPython:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">AllDirection</span><span class="p">(</span><span class="n">Direction</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">left</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
<span class="gp">... </span>    <span class="n">right</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">TypeError</span>: <span class="n">AllDirection: cannot extend enumeration &#39;Direction&#39;</span>
</pre></div>
</div>
<p>Mypy also catches this error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AllDirection</span><span class="p">(</span><span class="n">Direction</span><span class="p">):</span>  <span class="c1"># E: Cannot inherit from final class &quot;Direction&quot;</span>
    <span class="n">left</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
    <span class="n">right</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
</pre></div>
</div>
</li>
<li><p>All <code class="docutils literal notranslate"><span class="pre">Enum</span></code> fields are implicitly <code class="docutils literal notranslate"><span class="pre">final</span></code> as well.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Direction</span><span class="o">.</span><span class="n">up</span> <span class="o">=</span> <span class="s1">&#39;^&#39;</span>  <span class="c1"># E: Cannot assign to final attribute &quot;up&quot;</span>
</pre></div>
</div>
</li>
<li><p>All field names are checked to be unique.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Some</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
   <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
   <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># E: Attempted to reuse member name &quot;x&quot; in Enum definition &quot;Some&quot;</span>
</pre></div>
</div>
</li>
<li><p>Base classes have no conflicts and mixin types are correct.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WrongEnum</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="c1"># E: Only a single data type mixin is allowed for Enum subtypes, found extra &quot;int&quot;</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">MixinAfterEnum</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">,</span> <span class="n">Mixin</span><span class="p">):</span> <span class="c1"># E: No base classes are allowed after &quot;enum.Enum&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
</section>
<span id="document-typed_dict"></span><section id="typeddict">
<span id="id1"></span><h3>TypedDict<a class="headerlink" href="#typeddict" title="Permalink to this headline">#</a></h3>
<p>Python programs often use dictionaries with string keys to represent objects.
<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> lets you give precise types for dictionaries that represent
objects with a fixed schema, such as <code class="docutils literal notranslate"><span class="pre">{'id':</span> <span class="pre">1,</span> <span class="pre">'items':</span> <span class="pre">['x']}</span></code>.</p>
<p>Here is a typical example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">movie</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Blade Runner&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">1982</span><span class="p">}</span>
</pre></div>
</div>
<p>Only a fixed set of string keys is expected (<code class="docutils literal notranslate"><span class="pre">'name'</span></code> and
<code class="docutils literal notranslate"><span class="pre">'year'</span></code> above), and each key has an independent value type (<code class="docutils literal notranslate"><span class="pre">str</span></code>
for <code class="docutils literal notranslate"><span class="pre">'name'</span></code> and <code class="docutils literal notranslate"><span class="pre">int</span></code> for <code class="docutils literal notranslate"><span class="pre">'year'</span></code> above). We’ve previously
seen the <code class="docutils literal notranslate"><span class="pre">dict[K,</span> <span class="pre">V]</span></code> type, which lets you declare uniform
dictionary types, where every value has the same type, and arbitrary keys
are supported. This is clearly not a good fit for
<code class="docutils literal notranslate"><span class="pre">movie</span></code> above. Instead, you can use a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> to give a precise
type for objects like <code class="docutils literal notranslate"><span class="pre">movie</span></code>, where the type of each
dictionary value depends on the key:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">TypedDict</span>

<span class="n">Movie</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s1">&#39;Movie&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">})</span>

<span class="n">movie</span><span class="p">:</span> <span class="n">Movie</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Blade Runner&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">1982</span><span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Movie</span></code> is a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> type with two items: <code class="docutils literal notranslate"><span class="pre">'name'</span></code> (with type <code class="docutils literal notranslate"><span class="pre">str</span></code>)
and <code class="docutils literal notranslate"><span class="pre">'year'</span></code> (with type <code class="docutils literal notranslate"><span class="pre">int</span></code>). Note that we used an explicit type
annotation for the <code class="docutils literal notranslate"><span class="pre">movie</span></code> variable. This type annotation is
important – without it, mypy will try to infer a regular, uniform
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> type for <code class="docutils literal notranslate"><span class="pre">movie</span></code>, which is not what we want here.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you pass a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> object as an argument to a function, no
type annotation is usually necessary since mypy can infer the
desired type based on the declared argument type. Also, if an
assignment target has been previously defined, and it has a
<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> type, mypy will treat the assigned value as a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>,
not <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>.</p>
</div>
<p>Now mypy will recognize these as valid:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">movie</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>  <span class="c1"># Okay; type of name is str</span>
<span class="n">year</span> <span class="o">=</span> <span class="n">movie</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>  <span class="c1"># Okay; type of year is int</span>
</pre></div>
</div>
<p>Mypy will detect an invalid key as an error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">director</span> <span class="o">=</span> <span class="n">movie</span><span class="p">[</span><span class="s1">&#39;director&#39;</span><span class="p">]</span>  <span class="c1"># Error: &#39;director&#39; is not a valid key</span>
</pre></div>
</div>
<p>Mypy will also reject a runtime-computed expression as a key, as
it can’t verify that it’s a valid key. You can only use string
literals as <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> keys.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> type object can also act as a constructor. It
returns a normal <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> object at runtime – a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> does
not define a new runtime type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">toy_story</span> <span class="o">=</span> <span class="n">Movie</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Toy Story&#39;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">1995</span><span class="p">)</span>
</pre></div>
</div>
<p>This is equivalent to just constructing a dictionary directly using
<code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> or <code class="docutils literal notranslate"><span class="pre">dict(key=value,</span> <span class="pre">...)</span></code>. The constructor form is
sometimes convenient, since it can be used without a type annotation,
and it also makes the type of the object explicit.</p>
<p>Like all types, <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>s can be used as components to build
arbitrarily complex types. For example, you can define nested
<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>s and containers with <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> items.
Unlike most other types, mypy uses structural compatibility checking
(or structural subtyping) with <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>s. A <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> object with
extra items is compatible with (a subtype of) a narrower
<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>, assuming item types are compatible (<em>totality</em> also affects
subtyping, as discussed below).</p>
<p>A <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> object is not a subtype of the regular <code class="docutils literal notranslate"><span class="pre">dict[...]</span></code>
type (and vice versa), since <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a> allows arbitrary keys to be
added and removed, unlike <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>. However, any <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> object is
a subtype of (that is, compatible with) <code class="docutils literal notranslate"><span class="pre">Mapping[str,</span> <span class="pre">object]</span></code>, since
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Mapping" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code></a> only provides read-only access to the dictionary items:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_typed_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">print_typed_dict</span><span class="p">(</span><span class="n">Movie</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Toy Story&#39;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="mi">1995</span><span class="p">))</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unless you are on Python 3.8 or newer (where <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> is available in
standard library <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> module) you need to install <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code>
using pip to use <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>python3 -m pip install --upgrade typing-extensions
</pre></div>
</div>
</div>
<section id="totality">
<h4>Totality<a class="headerlink" href="#totality" title="Permalink to this headline">#</a></h4>
<p>By default mypy ensures that a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> object has all the specified
keys. This will be flagged as an error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error: &#39;year&#39; missing</span>
<span class="n">toy_story</span><span class="p">:</span> <span class="n">Movie</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Toy Story&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Sometimes you want to allow keys to be left out when creating a
<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> object. You can provide the <code class="docutils literal notranslate"><span class="pre">total=False</span></code> argument to
<code class="docutils literal notranslate"><span class="pre">TypedDict(...)</span></code> to achieve this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">GuiOptions</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span>
    <span class="s1">&#39;GuiOptions&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">},</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">options</span><span class="p">:</span> <span class="n">GuiOptions</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Okay</span>
<span class="n">options</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span>
</pre></div>
</div>
<p>You may need to use <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.get" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> to access items of a partial (non-total)
<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>, since indexing using <code class="docutils literal notranslate"><span class="pre">[]</span></code> could fail at runtime.
However, mypy still lets use <code class="docutils literal notranslate"><span class="pre">[]</span></code> with a partial <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> – you
just need to be careful with it, as it could result in a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#KeyError" title="(in Python v3.11)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code></a>.
Requiring <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.get" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> everywhere would be too cumbersome. (Note that you
are free to use <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.get" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> with total <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>s as well.)</p>
<p>Keys that aren’t required are shown with a <code class="docutils literal notranslate"><span class="pre">?</span></code> in error messages:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Revealed type is &quot;TypedDict(&#39;GuiOptions&#39;, {&#39;language&#39;?: builtins.str,</span>
<span class="c1">#                                            &#39;color&#39;?: builtins.str})&quot;</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
<p>Totality also affects structural compatibility. You can’t use a partial
<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> when a total one is expected. Also, a total <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> is not
valid when a partial one is expected.</p>
</section>
<section id="supported-operations">
<h4>Supported operations<a class="headerlink" href="#supported-operations" title="Permalink to this headline">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> objects support a subset of dictionary operations and methods.
You must use string literals as keys when calling most of the methods,
as otherwise mypy won’t be able to check that the key is valid. List
of supported operations:</p>
<ul class="simple">
<li><p>Anything included in <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Mapping" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mapping</span></code></a>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">d[key]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">in</span> <span class="pre">d</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">len(d)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">key</span> <span class="pre">in</span> <span class="pre">d</span></code> (iteration)</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.get" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.get(key[,</span> <span class="pre">default])</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.keys" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.keys()</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.values" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.values()</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.items" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.items()</span></code></a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.copy" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.copy()</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.setdefault" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.setdefault(key,</span> <span class="pre">default)</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.update" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d1.update(d2)</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.pop" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">d.pop(key[,</span> <span class="pre">default])</span></code></a> (partial <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>s only)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">d[key]</span></code> (partial <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>s only)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.clear" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">clear()</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.popitem" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">popitem()</span></code></a> are not supported since they are unsafe
– they could delete required <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> items that are not visible to
mypy because of structural subtyping.</p>
</div>
</section>
<section id="class-based-syntax">
<h4>Class-based syntax<a class="headerlink" href="#class-based-syntax" title="Permalink to this headline">#</a></h4>
<p>An alternative, class-based syntax to define a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> is supported
in Python 3.6 and later:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">TypedDict</span>

<span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>The above definition is equivalent to the original <code class="docutils literal notranslate"><span class="pre">Movie</span></code>
definition. It doesn’t actually define a real class. This syntax also
supports a form of inheritance – subclasses can define additional
items. However, this is primarily a notational shortcut. Since mypy
uses structural compatibility with <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>s, inheritance is not
required for compatibility. Here is an example of inheritance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">BookBasedMovie</span><span class="p">(</span><span class="n">Movie</span><span class="p">):</span>
    <span class="n">based_on</span><span class="p">:</span> <span class="nb">str</span>
</pre></div>
</div>
<p>Now <code class="docutils literal notranslate"><span class="pre">BookBasedMovie</span></code> has keys <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">year</span></code> and <code class="docutils literal notranslate"><span class="pre">based_on</span></code>.</p>
</section>
<section id="mixing-required-and-non-required-items">
<h4>Mixing required and non-required items<a class="headerlink" href="#mixing-required-and-non-required-items" title="Permalink to this headline">#</a></h4>
<p>In addition to allowing reuse across <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> types, inheritance also allows
you to mix required and non-required (using <code class="docutils literal notranslate"><span class="pre">total=False</span></code>) items
in a single <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MovieBase</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">year</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">MovieBase</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">based_on</span><span class="p">:</span> <span class="nb">str</span>
</pre></div>
</div>
<p>Now <code class="docutils literal notranslate"><span class="pre">Movie</span></code> has required keys <code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">year</span></code>, while <code class="docutils literal notranslate"><span class="pre">based_on</span></code>
can be left out when constructing an object. A <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> with a mix of required
and non-required keys, such as <code class="docutils literal notranslate"><span class="pre">Movie</span></code> above, will only be compatible with
another <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> if all required keys in the other <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> are required keys in the
first <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>, and all non-required keys of the other <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> are also non-required keys
in the first <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>.</p>
</section>
<section id="unions-of-typeddicts">
<h4>Unions of TypedDicts<a class="headerlink" href="#unions-of-typeddicts" title="Permalink to this headline">#</a></h4>
<p>Since TypedDicts are really just regular dicts at runtime, it is not possible to
use <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> checks to distinguish between different variants of a Union of
TypedDict in the same way you can with regular objects.</p>
<p>Instead, you can use the <a class="reference internal" href="index.html#tagged-unions"><span class="std std-ref">tagged union pattern</span></a>. The referenced
section of the docs has a full description with an example, but in short, you will
need to give each TypedDict the same key where each value has a unique
<a class="reference internal" href="index.html#literal-types"><span class="std std-ref">Literal type</span></a>. Then, check that key to distinguish
between your TypedDicts.</p>
</section>
</section>
<span id="document-final_attrs"></span><section id="final-names-methods-and-classes">
<span id="final-attrs"></span><h3>Final names, methods and classes<a class="headerlink" href="#final-names-methods-and-classes" title="Permalink to this headline">#</a></h3>
<p>This section introduces these related features:</p>
<ol class="arabic simple">
<li><p><em>Final names</em> are variables or attributes that should not be reassigned after
initialization. They are useful for declaring constants.</p></li>
<li><p><em>Final methods</em> should not be overridden in a subclass.</p></li>
<li><p><em>Final classes</em> should not be subclassed.</p></li>
</ol>
<p>All of these are only enforced by mypy, and only in annotated code.
There is no runtime enforcement by the Python runtime.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The examples in this page import <code class="docutils literal notranslate"><span class="pre">Final</span></code> and <code class="docutils literal notranslate"><span class="pre">final</span></code> from the
<code class="docutils literal notranslate"><span class="pre">typing</span></code> module. These types were added to <code class="docutils literal notranslate"><span class="pre">typing</span></code> in Python 3.8,
but are also available for use in Python 3.4 - 3.7 via the
<code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> package.</p>
</div>
<section id="final-names">
<h4>Final names<a class="headerlink" href="#final-names" title="Permalink to this headline">#</a></h4>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">typing.Final</span></code> qualifier to indicate that
a name or attribute should not be reassigned, redefined, or
overridden.  This is often useful for module and class level constants
as a way to prevent unintended modification.  Mypy will prevent
further assignments to final names in type-checked code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Final</span>

<span class="n">RATE</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="mi">3_000</span>

<span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="n">DEFAULT_ID</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">RATE</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># Error: can&#39;t assign to final attribute</span>
<span class="n">Base</span><span class="o">.</span><span class="n">DEFAULT_ID</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Error: can&#39;t override a final attribute</span>
</pre></div>
</div>
<p>Another use case for final attributes is to protect certain attributes
from being overridden in a subclass:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Final</span>

<span class="k">class</span> <span class="nc">Window</span><span class="p">:</span>
    <span class="n">BORDER_WIDTH</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="mf">2.5</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">ListView</span><span class="p">(</span><span class="n">Window</span><span class="p">):</span>
    <span class="n">BORDER_WIDTH</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Error: can&#39;t override a final attribute</span>
</pre></div>
</div>
<p>You can use <a class="reference external" href="https://docs.python.org/3/library/functions.html#property" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">&#64;property</span></code></a> to make an attribute read-only, but unlike <code class="docutils literal notranslate"><span class="pre">Final</span></code>,
it doesn’t work with module attributes, and it doesn’t prevent overriding in
subclasses.</p>
<section id="syntax-variants">
<h5>Syntax variants<a class="headerlink" href="#syntax-variants" title="Permalink to this headline">#</a></h5>
<p>You can use <code class="docutils literal notranslate"><span class="pre">Final</span></code> in one of these forms:</p>
<ul>
<li><p>You can provide an explicit type using the syntax <code class="docutils literal notranslate"><span class="pre">Final[&lt;type&gt;]</span></code>. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ID</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Here mypy will infer type <code class="docutils literal notranslate"><span class="pre">int</span></code> for <code class="docutils literal notranslate"><span class="pre">ID</span></code>.</p>
</li>
<li><p>You can omit the type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ID</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Here mypy will infer type <code class="docutils literal notranslate"><span class="pre">Literal[1]</span></code> for <code class="docutils literal notranslate"><span class="pre">ID</span></code>. Note that unlike for
generic classes this is <em>not</em> the same as <code class="docutils literal notranslate"><span class="pre">Final[Any]</span></code>.</p>
</li>
<li><p>In class bodies and stub files you can omit the right hand side and just write
<code class="docutils literal notranslate"><span class="pre">ID:</span> <span class="pre">Final[int]</span></code>.</p></li>
<li><p>Finally, you can write <code class="docutils literal notranslate"><span class="pre">self.id:</span> <span class="pre">Final</span> <span class="pre">=</span> <span class="pre">1</span></code> (also optionally with
a type in square brackets). This is allowed <em>only</em> in
<a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a> methods, so that the final instance attribute is
assigned only once when an instance is created.</p></li>
</ul>
</section>
<section id="details-of-using-final">
<h5>Details of using <code class="docutils literal notranslate"><span class="pre">Final</span></code><a class="headerlink" href="#details-of-using-final" title="Permalink to this headline">#</a></h5>
<p>These are the two main rules for defining a final name:</p>
<ul class="simple">
<li><p>There can be <em>at most one</em> final declaration per module or class for
a given attribute. There can’t be separate class-level and instance-level
constants with the same name.</p></li>
<li><p>There must be <em>exactly one</em> assignment to a final name.</p></li>
</ul>
<p>A final attribute declared in a class body without an initializer must
be initialized in the <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a> method (you can skip the
initializer in stub files):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ImmutablePoint</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>  <span class="c1"># Error: final attribute without an initializer</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Good</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Final</span></code> can only be used as the outermost type in assignments or variable
annotations. Using it in any other position is an error. In particular,
<code class="docutils literal notranslate"><span class="pre">Final</span></code> can’t be used in annotations for function arguments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Final</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Error!</span>

<span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span>  <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Error!</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Final</span></code> and <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.ClassVar" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">ClassVar</span></code></a> should not be used together. Mypy will infer
the scope of a final declaration automatically depending on whether it was
initialized in the class body or in <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a>.</p>
<p>A final attribute can’t be overridden by a subclass (even with another
explicit final declaration). Note however that a final attribute can
override a read-only property:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ID</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">ID</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<p>Declaring a name as final only guarantees that the name will not be re-bound
to another value. It doesn’t make the value immutable. You can use immutable ABCs
and containers to prevent mutating such values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>  <span class="c1"># OK</span>

<span class="n">y</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>  <span class="c1"># Error: Sequence is immutable</span>
<span class="n">z</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>  <span class="c1"># Also an option</span>
</pre></div>
</div>
</section>
</section>
<section id="final-methods">
<h4>Final methods<a class="headerlink" href="#final-methods" title="Permalink to this headline">#</a></h4>
<p>Like with attributes, sometimes it is useful to protect a method from
overriding. You can use the <code class="docutils literal notranslate"><span class="pre">typing.final</span></code> decorator for this purpose:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">final</span>

<span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="nd">@final</span>
    <span class="k">def</span> <span class="nf">common_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">common_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Error: cannot override a final method</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">&#64;final</span></code> decorator can be used with instance methods, class methods,
static methods, and properties.</p>
<p>For overloaded methods you should add <code class="docutils literal notranslate"><span class="pre">&#64;final</span></code> on the implementation
to make it final (or on the first overload in stubs):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">overload</span>

<span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="nd">@overload</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>
    <span class="nd">@final</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="final-classes">
<h4>Final classes<a class="headerlink" href="#final-classes" title="Permalink to this headline">#</a></h4>
<p>You can apply the <code class="docutils literal notranslate"><span class="pre">typing.final</span></code> decorator to a class to indicate
to mypy that it should not be subclassed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">final</span>

<span class="nd">@final</span>
<span class="k">class</span> <span class="nc">Leaf</span><span class="p">:</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">MyLeaf</span><span class="p">(</span><span class="n">Leaf</span><span class="p">):</span>  <span class="c1"># Error: Leaf can&#39;t be subclassed</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The decorator acts as a declaration for mypy (and as documentation for
humans), but it doesn’t actually prevent subclassing at runtime.</p>
<p>Here are some situations where using a final class may be useful:</p>
<ul class="simple">
<li><p>A class wasn’t designed to be subclassed. Perhaps subclassing would not
work as expected, or subclassing would be error-prone.</p></li>
<li><p>Subclassing would make code harder to understand or maintain.
For example, you may want to prevent unnecessarily tight coupling between
base classes and subclasses.</p></li>
<li><p>You want to retain the freedom to arbitrarily change the class implementation
in the future, and these changes might break subclasses.</p></li>
</ul>
<p>An abstract class that defines at least one abstract method or
property and has <code class="docutils literal notranslate"><span class="pre">&#64;final</span></code> decorator will generate an error from
mypy, since those attributes could never be implemented.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">final</span>

<span class="nd">@final</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>  <span class="c1"># error: Final class A has abstract attributes &quot;f&quot;</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>
</pre></div>
</div>
</section>
</section>
<span id="document-metaclasses"></span><section id="metaclasses">
<span id="id1"></span><h3>Metaclasses<a class="headerlink" href="#metaclasses" title="Permalink to this headline">#</a></h3>
<p>A <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#metaclasses" title="(in Python v3.11)"><span class="xref std std-ref">metaclass</span></a> is a class that describes
the construction and behavior of other classes, similarly to how classes
describe the construction and behavior of objects.
The default metaclass is <a class="reference external" href="https://docs.python.org/3/library/functions.html#type" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">type</span></code></a>, but it’s possible to use other metaclasses.
Metaclasses allows one to create “a different kind of class”, such as
<a class="reference external" href="https://docs.python.org/3/library/enum.html#enum.Enum" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></a>s, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NamedTuple" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NamedTuple</span></code></a>s and singletons.</p>
<p>Mypy has some special understanding of <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.ABCMeta" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ABCMeta</span></code></a> and <code class="docutils literal notranslate"><span class="pre">EnumMeta</span></code>.</p>
<section id="defining-a-metaclass">
<span id="defining"></span><h4>Defining a metaclass<a class="headerlink" href="#defining-a-metaclass" title="Permalink to this headline">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">M</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="metaclass-usage-example">
<span id="examples"></span><h4>Metaclass usage example<a class="headerlink" href="#metaclass-usage-example" title="Permalink to this headline">#</a></h4>
<p>Mypy supports the lookup of attributes in the metaclass:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Type</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">ClassVar</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">M</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="n">count</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="n">M</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">M</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">a</span><span class="p">:</span> <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">make</span><span class="p">()</span>  <span class="c1"># make() is looked up at M; the result is an object of type A</span>
<span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">b</span><span class="p">:</span> <span class="n">B</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">make</span><span class="p">()</span>  <span class="c1"># metaclasses are inherited</span>
<span class="nb">print</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="s2">&quot; objects were created&quot;</span><span class="p">)</span>  <span class="c1"># Error: Unsupported operand types for + (&quot;int&quot; and &quot;str&quot;)</span>
</pre></div>
</div>
</section>
<section id="gotchas-and-limitations-of-metaclass-support">
<span id="limitations"></span><h4>Gotchas and limitations of metaclass support<a class="headerlink" href="#gotchas-and-limitations-of-metaclass-support" title="Permalink to this headline">#</a></h4>
<p>Note that metaclasses pose some requirements on the inheritance structure,
so it’s better not to combine metaclasses and class hierarchies:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">M1</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">M2</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span> <span class="k">pass</span>

<span class="k">class</span> <span class="nc">A1</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">M1</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">A2</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">M2</span><span class="p">):</span> <span class="k">pass</span>

<span class="k">class</span> <span class="nc">B1</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">M2</span><span class="p">):</span> <span class="k">pass</span>  <span class="c1"># Mypy Error: metaclass conflict</span>
<span class="c1"># At runtime the above definition raises an exception</span>
<span class="c1"># TypeError: metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its bases</span>

<span class="k">class</span> <span class="nc">B12</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">):</span> <span class="k">pass</span>  <span class="c1"># Mypy Error: metaclass conflict</span>

<span class="c1"># This can be solved via a common metaclass subtype:</span>
<span class="k">class</span> <span class="nc">CorrectMeta</span><span class="p">(</span><span class="n">M1</span><span class="p">,</span> <span class="n">M2</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">B2</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">CorrectMeta</span><span class="p">):</span> <span class="k">pass</span>  <span class="c1"># OK, runtime is also OK</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Mypy does not understand dynamically-computed metaclasses,
such as <code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">A(metaclass=f()):</span> <span class="pre">...</span></code></p></li>
<li><p>Mypy does not and cannot understand arbitrary metaclass code.</p></li>
<li><p>Mypy only recognizes subclasses of <a class="reference external" href="https://docs.python.org/3/library/functions.html#type" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">type</span></code></a> as potential metaclasses.</p></li>
</ul>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-running_mypy"></span><section id="running-mypy-and-managing-imports">
<span id="running-mypy"></span><h3>Running mypy and managing imports<a class="headerlink" href="#running-mypy-and-managing-imports" title="Permalink to this headline">#</a></h3>
<p>The <a class="reference internal" href="index.html#getting-started"><span class="std std-ref">Getting started</span></a> page should have already introduced you
to the basics of how to run mypy – pass in the files and directories
you want to type check via the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mypy foo.py bar.py some_directory
</pre></div>
</div>
<p>This page discusses in more detail how exactly to specify what files
you want mypy to type check, how mypy discovers imported modules,
and recommendations on how to handle any issues you may encounter
along the way.</p>
<p>If you are interested in learning about how to configure the
actual way mypy type checks your code, see our
<a class="reference internal" href="index.html#command-line"><span class="std std-ref">The mypy command line</span></a> guide.</p>
<section id="specifying-code-to-be-checked">
<span id="id1"></span><h4>Specifying code to be checked<a class="headerlink" href="#specifying-code-to-be-checked" title="Permalink to this headline">#</a></h4>
<p>Mypy lets you specify what files it should type check in several different ways.</p>
<ol class="arabic">
<li><p>First, you can pass in paths to Python files and directories you
want to type check. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mypy file_1.py foo/file_2.py file_3.pyi some/directory
</pre></div>
</div>
<p>The above command tells mypy it should type check all of the provided
files together. In addition, mypy will recursively type check the
entire contents of any provided directories.</p>
<p>For more details about how exactly this is done, see
<a class="reference internal" href="#mapping-paths-to-modules"><span class="std std-ref">Mapping file paths to modules</span></a>.</p>
</li>
<li><p>Second, you can use the <a class="reference internal" href="index.html#cmdoption-mypy-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">-m</span></code></a> flag (long form: <a class="reference internal" href="index.html#cmdoption-mypy-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">--module</span></code></a>) to
specify a module name to be type checked. The name of a module
is identical to the name you would use to import that module
within a Python program. For example, running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mypy -m html.parser
</pre></div>
</div>
<p>…will type check the module <code class="docutils literal notranslate"><span class="pre">html.parser</span></code> (this happens to be
a library stub).</p>
<p>Mypy will use an algorithm very similar to the one Python uses to
find where modules and imports are located on the file system.
For more details, see <a class="reference internal" href="#finding-imports"><span class="std std-ref">How imports are found</span></a>.</p>
</li>
<li><p>Third, you can use the <a class="reference internal" href="index.html#cmdoption-mypy-p"><code class="xref std std-option docutils literal notranslate"><span class="pre">-p</span></code></a> (long form: <a class="reference internal" href="index.html#cmdoption-mypy-p"><code class="xref std std-option docutils literal notranslate"><span class="pre">--package</span></code></a>) flag to
specify a package to be (recursively) type checked. This flag
is almost identical to the <a class="reference internal" href="index.html#cmdoption-mypy-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">-m</span></code></a> flag except that if you give it
a package name, mypy will recursively type check all submodules
and subpackages of that package. For example, running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mypy -p html
</pre></div>
</div>
<p>…will type check the entire <code class="docutils literal notranslate"><span class="pre">html</span></code> package (of library stubs).
In contrast, if we had used the <a class="reference internal" href="index.html#cmdoption-mypy-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">-m</span></code></a> flag, mypy would have type
checked just <code class="docutils literal notranslate"><span class="pre">html</span></code>’s <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> file and anything imported
from there.</p>
<p>Note that we can specify multiple packages and modules on the
command line. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mypy --package p.a --package p.b --module c
</pre></div>
</div>
</li>
<li><p>Fourth, you can also instruct mypy to directly type check small
strings as programs by using the <a class="reference internal" href="index.html#cmdoption-mypy-c"><code class="xref std std-option docutils literal notranslate"><span class="pre">-c</span></code></a> (long form: <a class="reference internal" href="index.html#cmdoption-mypy-c"><code class="xref std std-option docutils literal notranslate"><span class="pre">--command</span></code></a>)
flag. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mypy -c &#39;x = [1, 2]; print(x())&#39;
</pre></div>
</div>
<p>…will type check the above string as a mini-program (and in this case,
will report that <code class="docutils literal notranslate"><span class="pre">list[int]</span></code> is not callable).</p>
</li>
</ol>
<p>You can also use the <a class="reference internal" href="index.html#confval-files"><code class="xref std std-confval docutils literal notranslate"><span class="pre">files</span></code></a> option in your <code class="file docutils literal notranslate"><span class="pre">mypy.ini</span></code> file to specify which
files to check, in which case you can simply run <code class="docutils literal notranslate"><span class="pre">mypy</span></code> with no arguments.</p>
</section>
<section id="reading-a-list-of-files-from-a-file">
<h4>Reading a list of files from a file<a class="headerlink" href="#reading-a-list-of-files-from-a-file" title="Permalink to this headline">#</a></h4>
<p>Finally, any command-line argument starting with <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> reads additional
command-line arguments from the file following the <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> character.
This is primarily useful if you have a file containing a list of files
that you want to be type-checked: instead of using shell syntax like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mypy $(cat file_of_files.txt)
</pre></div>
</div>
<p>you can use this instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mypy @file_of_files.txt
</pre></div>
</div>
<p>This file can technically also contain any command line flag, not
just file paths. However, if you want to configure many different
flags, the recommended approach is to use a
<a class="reference internal" href="index.html#config-file"><span class="std std-ref">configuration file</span></a> instead.</p>
</section>
<section id="mapping-file-paths-to-modules">
<span id="mapping-paths-to-modules"></span><h4>Mapping file paths to modules<a class="headerlink" href="#mapping-file-paths-to-modules" title="Permalink to this headline">#</a></h4>
<p>One of the main ways you can tell mypy what to type check
is by providing mypy a list of paths. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mypy file_1.py foo/file_2.py file_3.pyi some/directory
</pre></div>
</div>
<p>This section describes how exactly mypy maps the provided paths
to modules to type check.</p>
<ul class="simple">
<li><p>Mypy will check all paths provided that correspond to files.</p></li>
<li><p>Mypy will recursively discover and check all files ending in <code class="docutils literal notranslate"><span class="pre">.py</span></code> or
<code class="docutils literal notranslate"><span class="pre">.pyi</span></code> in directory paths provided, after accounting for
<a class="reference internal" href="index.html#cmdoption-mypy-exclude"><code class="xref std std-option docutils literal notranslate"><span class="pre">--exclude</span></code></a>.</p></li>
<li><p>For each file to be checked, mypy will attempt to associate the file (e.g.
<code class="docutils literal notranslate"><span class="pre">project/foo/bar/baz.py</span></code>) with a fully qualified module name (e.g.
<code class="docutils literal notranslate"><span class="pre">foo.bar.baz</span></code>). The directory the package is in (<code class="docutils literal notranslate"><span class="pre">project</span></code>) is then
added to mypy’s module search paths.</p></li>
</ul>
<p>How mypy determines fully qualified module names depends on if the options
<a class="reference internal" href="index.html#cmdoption-mypy-no-namespace-packages"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-namespace-packages</span></code></a> and
<a class="reference internal" href="index.html#cmdoption-mypy-explicit-package-bases"><code class="xref std std-option docutils literal notranslate"><span class="pre">--explicit-package-bases</span></code></a> are set.</p>
<ol class="arabic">
<li><p>If <a class="reference internal" href="index.html#cmdoption-mypy-no-namespace-packages"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-namespace-packages</span></code></a> is set,
mypy will rely solely upon the presence of <code class="docutils literal notranslate"><span class="pre">__init__.py[i]</span></code> files to
determine the fully qualified module name. That is, mypy will crawl up the
directory tree for as long as it continues to find <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> (or
<code class="docutils literal notranslate"><span class="pre">__init__.pyi</span></code>) files.</p>
<p>For example, if your directory tree consists of <code class="docutils literal notranslate"><span class="pre">pkg/subpkg/mod.py</span></code>, mypy
would require <code class="docutils literal notranslate"><span class="pre">pkg/__init__.py</span></code> and <code class="docutils literal notranslate"><span class="pre">pkg/subpkg/__init__.py</span></code> to exist in
order correctly associate <code class="docutils literal notranslate"><span class="pre">mod.py</span></code> with <code class="docutils literal notranslate"><span class="pre">pkg.subpkg.mod</span></code></p>
</li>
<li><p>The default case. If <a class="reference internal" href="index.html#cmdoption-mypy-no-namespace-packages"><code class="xref std std-option docutils literal notranslate"><span class="pre">--namespace-packages</span></code></a> is on, but <a class="reference internal" href="index.html#cmdoption-mypy-explicit-package-bases"><code class="xref std std-option docutils literal notranslate"><span class="pre">--explicit-package-bases</span></code></a> is off, mypy will allow for the possibility that
directories without <code class="docutils literal notranslate"><span class="pre">__init__.py[i]</span></code> are packages. Specifically, mypy will
look at all parent directories of the file and use the location of the
highest <code class="docutils literal notranslate"><span class="pre">__init__.py[i]</span></code> in the directory tree to determine the top-level
package.</p>
<p>For example, say your directory tree consists solely of <code class="docutils literal notranslate"><span class="pre">pkg/__init__.py</span></code>
and <code class="docutils literal notranslate"><span class="pre">pkg/a/b/c/d/mod.py</span></code>. When determining <code class="docutils literal notranslate"><span class="pre">mod.py</span></code>’s fully qualified
module name, mypy will look at <code class="docutils literal notranslate"><span class="pre">pkg/__init__.py</span></code> and conclude that the
associated module name is <code class="docutils literal notranslate"><span class="pre">pkg.a.b.c.d.mod</span></code>.</p>
</li>
<li><p>You’ll notice that the above case still relies on <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>. If
you can’t put an <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> in your top-level package, but still wish to
pass paths (as opposed to packages or modules using the <code class="docutils literal notranslate"><span class="pre">-p</span></code> or <code class="docutils literal notranslate"><span class="pre">-m</span></code>
flags), <a class="reference internal" href="index.html#cmdoption-mypy-explicit-package-bases"><code class="xref std std-option docutils literal notranslate"><span class="pre">--explicit-package-bases</span></code></a>
provides a solution.</p>
<p>With <a class="reference internal" href="index.html#cmdoption-mypy-explicit-package-bases"><code class="xref std std-option docutils literal notranslate"><span class="pre">--explicit-package-bases</span></code></a>, mypy
will locate the nearest parent directory that is a member of the <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code>
environment variable, the <a class="reference internal" href="index.html#confval-mypy_path"><code class="xref std std-confval docutils literal notranslate"><span class="pre">mypy_path</span></code></a> config or is the current
working directory. Mypy will then use the relative path to determine the
fully qualified module name.</p>
<p>For example, say your directory tree consists solely of
<code class="docutils literal notranslate"><span class="pre">src/namespace_pkg/mod.py</span></code>. If you run the following command, mypy
will correctly associate <code class="docutils literal notranslate"><span class="pre">mod.py</span></code> with <code class="docutils literal notranslate"><span class="pre">namespace_pkg.mod</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ MYPYPATH=src mypy --namespace-packages --explicit-package-bases .
</pre></div>
</div>
</li>
</ol>
<p>If you pass a file not ending in <code class="docutils literal notranslate"><span class="pre">.py[i]</span></code>, the module name assumed is
<code class="docutils literal notranslate"><span class="pre">__main__</span></code> (matching the behavior of the Python interpreter), unless
<a class="reference internal" href="index.html#cmdoption-mypy-scripts-are-modules"><code class="xref std std-option docutils literal notranslate"><span class="pre">--scripts-are-modules</span></code></a> is passed.</p>
<p>Passing <a class="reference internal" href="index.html#cmdoption-mypy-v"><code class="xref std std-option docutils literal notranslate"><span class="pre">-v</span></code></a> will show you the files and associated module
names that mypy will check.</p>
</section>
<section id="how-mypy-handles-imports">
<h4>How mypy handles imports<a class="headerlink" href="#how-mypy-handles-imports" title="Permalink to this headline">#</a></h4>
<p>When mypy encounters an <code class="docutils literal notranslate"><span class="pre">import</span></code> statement, it will first
<a class="reference internal" href="#finding-imports"><span class="std std-ref">attempt to locate</span></a> that module
or type stubs for that module in the file system. Mypy will then
type check the imported module. There are three different outcomes
of this process:</p>
<ol class="arabic simple">
<li><p>Mypy is unable to follow the import: the module either does not
exist, or is a third party library that does not use type hints.</p></li>
<li><p>Mypy is able to follow and type check the import, but you did
not want mypy to type check that module at all.</p></li>
<li><p>Mypy is able to successfully both follow and type check the
module, and you want mypy to type check that module.</p></li>
</ol>
<p>The third outcome is what mypy will do in the ideal case. The following
sections will discuss what to do in the other two cases.</p>
</section>
<section id="missing-imports">
<span id="fix-missing-imports"></span><span id="ignore-missing-imports"></span><h4>Missing imports<a class="headerlink" href="#missing-imports" title="Permalink to this headline">#</a></h4>
<p>When you import a module, mypy may report that it is unable to follow
the import. This can cause errors that look like the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>main.py:1: error: Skipping analyzing &#39;django&#39;: module is installed, but missing library stubs or py.typed marker
main.py:2: error: Library stubs not installed for &quot;requests&quot;
main.py:3: error: Cannot find implementation or library stub for module named &quot;this_module_does_not_exist&quot;
</pre></div>
</div>
<p>If you get any of these errors on an import, mypy will assume the type of that
module is <code class="docutils literal notranslate"><span class="pre">Any</span></code>, the dynamic type. This means attempting to access any
attribute of the module will automatically succeed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error: Cannot find implementation or library stub for module named &#39;does_not_exist&#39;</span>
<span class="kn">import</span> <span class="nn">does_not_exist</span>

<span class="c1"># But this type checks, and x will have type &#39;Any&#39;</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">does_not_exist</span><span class="o">.</span><span class="n">foobar</span><span class="p">()</span>
</pre></div>
</div>
<p>This can result in mypy failing to warn you about errors in your code. Since
operations on <code class="docutils literal notranslate"><span class="pre">Any</span></code> result in <code class="docutils literal notranslate"><span class="pre">Any</span></code>, these dynamic types can propagate
through your code, making type checking less effective. See
<a class="reference internal" href="index.html#dynamic-typing"><span class="std std-ref">Dynamically typed code</span></a> for more information.</p>
<p>The next sections describe what each of these errors means and recommended next steps; scroll to
the section that matches your error.</p>
<section id="missing-library-stubs-or-py-typed-marker">
<h5>Missing library stubs or py.typed marker<a class="headerlink" href="#missing-library-stubs-or-py-typed-marker" title="Permalink to this headline">#</a></h5>
<p>If you are getting a <code class="docutils literal notranslate"><span class="pre">Skipping</span> <span class="pre">analyzing</span> <span class="pre">X:</span> <span class="pre">module</span> <span class="pre">is</span> <span class="pre">installed,</span> <span class="pre">but</span> <span class="pre">missing</span> <span class="pre">library</span> <span class="pre">stubs</span> <span class="pre">or</span> <span class="pre">py.typed</span> <span class="pre">marker</span></code>,
error, this means mypy was able to find the module you were importing, but no
corresponding type hints.</p>
<p>Mypy will not try inferring the types of any 3rd party libraries you have installed
unless they either have declared themselves to be
<a class="reference internal" href="index.html#installed-packages"><span class="std std-ref">PEP 561 compliant stub package</span></a> (e.g. with a <code class="docutils literal notranslate"><span class="pre">py.typed</span></code> file) or have registered
themselves on <a class="reference external" href="https://github.com/python/typeshed">typeshed</a>, the repository
of types for the standard library and some 3rd party libraries.</p>
<p>If you are getting this error, try to obtain type hints for the library you’re using:</p>
<ol class="arabic">
<li><p>Upgrading the version of the library you’re using, in case a newer version
has started to include type hints.</p></li>
<li><p>Searching to see if there is a <a class="reference internal" href="index.html#installed-packages"><span class="std std-ref">PEP 561 compliant stub package</span></a>
corresponding to your third party library. Stub packages let you install
type hints independently from the library itself.</p>
<p>For example, if you want type hints for the <code class="docutils literal notranslate"><span class="pre">django</span></code> library, you can
install the <a class="reference external" href="https://pypi.org/project/django-stubs/">django-stubs</a> package.</p>
</li>
<li><p><a class="reference internal" href="index.html#stub-files"><span class="std std-ref">Writing your own stub files</span></a> containing type hints for
the library. You can point mypy at your type hints either by passing
them in via the command line, by using the  <a class="reference internal" href="index.html#confval-files"><code class="xref std std-confval docutils literal notranslate"><span class="pre">files</span></code></a> or <a class="reference internal" href="index.html#confval-mypy_path"><code class="xref std std-confval docutils literal notranslate"><span class="pre">mypy_path</span></code></a>
config file options, or by
adding the location to the <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> environment variable.</p>
<p>These stub files do not need to be complete! A good strategy is to use
<a class="reference internal" href="index.html#stubgen"><span class="std std-ref">stubgen</span></a>, a program that comes bundled with mypy, to generate a first
rough draft of the stubs. You can then iterate on just the parts of the
library you need.</p>
<p>If you want to share your work, you can try contributing your stubs back
to the library – see our documentation on creating
<a class="reference internal" href="index.html#installed-packages"><span class="std std-ref">PEP 561 compliant packages</span></a>.</p>
</li>
</ol>
<p>If you are unable to find any existing type hints nor have time to write your
own, you can instead <em>suppress</em> the errors.</p>
<p>All this will do is make mypy stop reporting an error on the line containing the
import: the imported module will continue to be of type <code class="docutils literal notranslate"><span class="pre">Any</span></code>, and mypy may
not catch errors in its use.</p>
<ol class="arabic">
<li><p>To suppress a <em>single</em> missing import error, add a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> at the end of the
line containing the import.</p></li>
<li><p>To suppress <em>all</em> missing import errors from a single library, add
a per-module section to your <a class="reference internal" href="index.html#config-file"><span class="std std-ref">mypy config file</span></a> setting
<a class="reference internal" href="index.html#confval-ignore_missing_imports"><code class="xref std std-confval docutils literal notranslate"><span class="pre">ignore_missing_imports</span></code></a> to True for that library. For example,
suppose your codebase
makes heavy use of an (untyped) library named <code class="docutils literal notranslate"><span class="pre">foobar</span></code>. You can silence
all import errors associated with that library and that library alone by
adding the following section to your config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">mypy</span><span class="o">-</span><span class="n">foobar</span><span class="o">.*</span><span class="p">]</span>
<span class="n">ignore_missing_imports</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Note: this option is equivalent to adding a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> to every
import of <code class="docutils literal notranslate"><span class="pre">foobar</span></code> in your codebase. For more information, see the
documentation about configuring
<a class="reference internal" href="index.html#config-file-import-discovery"><span class="std std-ref">import discovery</span></a> in config files.
The <code class="docutils literal notranslate"><span class="pre">.*</span></code> after <code class="docutils literal notranslate"><span class="pre">foobar</span></code> will ignore imports of <code class="docutils literal notranslate"><span class="pre">foobar</span></code> modules
and subpackages in addition to the <code class="docutils literal notranslate"><span class="pre">foobar</span></code> top-level package namespace.</p>
</li>
<li><p>To suppress <em>all</em> missing import errors for <em>all</em> libraries in your codebase,
invoke mypy with the <a class="reference internal" href="index.html#cmdoption-mypy-ignore-missing-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--ignore-missing-imports</span></code></a> command line flag or set
the <a class="reference internal" href="index.html#confval-ignore_missing_imports"><code class="xref std std-confval docutils literal notranslate"><span class="pre">ignore_missing_imports</span></code></a>
config file option to True
in the <em>global</em> section of your mypy config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">mypy</span><span class="p">]</span>
<span class="n">ignore_missing_imports</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>We recommend using this approach only as a last resort: it’s equivalent
to adding a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> to all unresolved imports in your codebase.</p>
</li>
</ol>
</section>
<section id="library-stubs-not-installed">
<h5>Library stubs not installed<a class="headerlink" href="#library-stubs-not-installed" title="Permalink to this headline">#</a></h5>
<p>If mypy can’t find stubs for a third-party library, and it knows that stubs exist for
the library, you will get a message like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>main.py:1: error: Library stubs not installed for &quot;yaml&quot;
main.py:1: note: Hint: &quot;python3 -m pip install types-PyYAML&quot;
main.py:1: note: (or run &quot;mypy --install-types&quot; to install all missing stub packages)
</pre></div>
</div>
<p>You can resolve the issue by running the suggested pip commands.
If you’re running mypy in CI, you can ensure the presence of any stub packages
you need the same as you would any other test dependency, e.g. by adding them to
the appropriate <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file.</p>
<p>Alternatively, add the <a class="reference internal" href="index.html#cmdoption-mypy-install-types"><code class="xref std std-option docutils literal notranslate"><span class="pre">--install-types</span></code></a>
to your mypy command to install all known missing stubs:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mypy --install-types
</pre></div>
</div>
<p>This is slower than explicitly installing stubs, since it effectively
runs mypy twice – the first time to find the missing stubs, and
the second time to type check your code properly after mypy has
installed the stubs. It also can make controlling stub versions harder,
resulting in less reproducible type checking.</p>
<p>By default, <a class="reference internal" href="index.html#cmdoption-mypy-install-types"><code class="xref std std-option docutils literal notranslate"><span class="pre">--install-types</span></code></a> shows a confirmation prompt.
Use <a class="reference internal" href="index.html#cmdoption-mypy-non-interactive"><code class="xref std std-option docutils literal notranslate"><span class="pre">--non-interactive</span></code></a> to install all suggested
stub packages without asking for confirmation <em>and</em> type check your code:</p>
<p>If you’ve already installed the relevant third-party libraries in an environment
other than the one mypy is running in, you can use <a class="reference internal" href="index.html#cmdoption-mypy-python-executable"><code class="xref std std-option docutils literal notranslate"><span class="pre">--python-executable</span></code></a> flag to point to the Python executable for that
environment, and mypy will find packages installed for that Python executable.</p>
<p>If you’ve installed the relevant stub packages and are still getting this error,
see the <a class="reference internal" href="#missing-type-hints-for-third-party-library"><span class="std std-ref">section below</span></a>.</p>
</section>
<section id="cannot-find-implementation-or-library-stub">
<span id="missing-type-hints-for-third-party-library"></span><h5>Cannot find implementation or library stub<a class="headerlink" href="#cannot-find-implementation-or-library-stub" title="Permalink to this headline">#</a></h5>
<p>If you are getting a <code class="docutils literal notranslate"><span class="pre">Cannot</span> <span class="pre">find</span> <span class="pre">implementation</span> <span class="pre">or</span> <span class="pre">library</span> <span class="pre">stub</span> <span class="pre">for</span> <span class="pre">module</span></code>
error, this means mypy was not able to find the module you are trying to
import, whether it comes bundled with type hints or not. If you are getting
this error, try:</p>
<ol class="arabic">
<li><p>Making sure your import does not contain a typo.</p></li>
<li><p>If the module is a third party library, making sure that mypy is able
to find the interpreter containing the installed library.</p>
<p>For example, if you are running your code in a virtualenv, make sure
to install and use mypy within the virtualenv. Alternatively, if you
want to use a globally installed mypy, set the
<a class="reference internal" href="index.html#cmdoption-mypy-python-executable"><code class="xref std std-option docutils literal notranslate"><span class="pre">--python-executable</span></code></a> command
line flag to point the Python interpreter containing your installed
third party packages.</p>
<p>You can confirm that you are running mypy from the environment you expect
by running it like <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">mypy</span> <span class="pre">...</span></code>. You can confirm that you are
installing into the environment you expect by running pip like
<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">...</span></code>.</p>
</li>
</ol>
<ol class="arabic" start="2">
<li><p>Reading the <a class="reference internal" href="#finding-imports"><span class="std std-ref">How imports are found</span></a> section below to make sure you
understand how exactly mypy searches for and finds modules and modify
how you’re invoking mypy accordingly.</p></li>
<li><p>Directly specifying the directory containing the module you want to
type check from the command line, by using the <a class="reference internal" href="index.html#confval-mypy_path"><code class="xref std std-confval docutils literal notranslate"><span class="pre">mypy_path</span></code></a>
or <a class="reference internal" href="index.html#confval-files"><code class="xref std std-confval docutils literal notranslate"><span class="pre">files</span></code></a> config file options,
or by using the <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> environment variable.</p>
<p>Note: if the module you are trying to import is actually a <em>submodule</em> of
some package, you should specify the directory containing the <em>entire</em> package.
For example, suppose you are trying to add the module <code class="docutils literal notranslate"><span class="pre">foo.bar.baz</span></code>
which is located at <code class="docutils literal notranslate"><span class="pre">~/foo-project/src/foo/bar/baz.py</span></code>. In this case,
you must run <code class="docutils literal notranslate"><span class="pre">mypy</span> <span class="pre">~/foo-project/src</span></code> (or set the <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> to
<code class="docutils literal notranslate"><span class="pre">~/foo-project/src</span></code>.</p>
</li>
</ol>
</section>
</section>
<section id="how-imports-are-found">
<span id="finding-imports"></span><h4>How imports are found<a class="headerlink" href="#how-imports-are-found" title="Permalink to this headline">#</a></h4>
<p>When mypy encounters an <code class="docutils literal notranslate"><span class="pre">import</span></code> statement or receives module
names from the command line via the <a class="reference internal" href="index.html#cmdoption-mypy-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">--module</span></code></a> or <a class="reference internal" href="index.html#cmdoption-mypy-p"><code class="xref std std-option docutils literal notranslate"><span class="pre">--package</span></code></a>
flags, mypy tries to find the module on the file system similar
to the way Python finds it. However, there are some differences.</p>
<p>First, mypy has its own search path.
This is computed from the following items:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> environment variable
(a list of directories, colon-separated on UNIX systems, semicolon-separated on Windows).</p></li>
<li><p>The <a class="reference internal" href="index.html#confval-mypy_path"><code class="xref std std-confval docutils literal notranslate"><span class="pre">mypy_path</span></code></a> config file option.</p></li>
<li><p>The directories containing the sources given on the command line
(see <a class="reference internal" href="#mapping-paths-to-modules"><span class="std std-ref">Mapping file paths to modules</span></a>).</p></li>
<li><p>The installed packages marked as safe for type checking (see
<a class="reference internal" href="index.html#installed-packages"><span class="std std-ref">PEP 561 support</span></a>)</p></li>
<li><p>The relevant directories of the
<a class="reference external" href="https://github.com/python/typeshed">typeshed</a> repo.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You cannot point to a stub-only package (<span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0561/"><strong>PEP 561</strong></a>) via the <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code>, it must be
installed (see <a class="reference internal" href="index.html#installed-packages"><span class="std std-ref">PEP 561 support</span></a>)</p>
</div>
<p>Second, mypy searches for stub files in addition to regular Python files
and packages.
The rules for searching for a module <code class="docutils literal notranslate"><span class="pre">foo</span></code> are as follows:</p>
<ul class="simple">
<li><p>The search looks in each of the directories in the search path
(see above) until a match is found.</p></li>
<li><p>If a package named <code class="docutils literal notranslate"><span class="pre">foo</span></code> is found (i.e. a directory
<code class="docutils literal notranslate"><span class="pre">foo</span></code> containing an <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> or <code class="docutils literal notranslate"><span class="pre">__init__.pyi</span></code> file)
that’s a match.</p></li>
<li><p>If a stub file named <code class="docutils literal notranslate"><span class="pre">foo.pyi</span></code> is found, that’s a match.</p></li>
<li><p>If a Python module named <code class="docutils literal notranslate"><span class="pre">foo.py</span></code> is found, that’s a match.</p></li>
</ul>
<p>These matches are tried in order, so that if multiple matches are found
in the same directory on the search path
(e.g. a package and a Python file, or a stub file and a Python file)
the first one in the above list wins.</p>
<p>In particular, if a Python file and a stub file are both present in the
same directory on the search path, only the stub file is used.
(However, if the files are in different directories, the one found
in the earlier directory is used.)</p>
<p>Setting <a class="reference internal" href="index.html#confval-mypy_path"><code class="xref std std-confval docutils literal notranslate"><span class="pre">mypy_path</span></code></a>/<code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> is mostly useful in the case
where you want to try running mypy against multiple distinct
sets of files that happen to share some common dependencies.</p>
<p>For example, if you have multiple projects that happen to be
using the same set of work-in-progress stubs, it could be
convenient to just have your <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> point to a single
directory containing the stubs.</p>
</section>
<section id="following-imports">
<span id="follow-imports"></span><h4>Following imports<a class="headerlink" href="#following-imports" title="Permalink to this headline">#</a></h4>
<p>Mypy is designed to <a class="reference internal" href="#finding-imports"><span class="std std-ref">doggedly follow all imports</span></a>,
even if the imported module is not a file you explicitly wanted mypy to check.</p>
<p>For example, suppose we have two modules <code class="docutils literal notranslate"><span class="pre">mycode.foo</span></code> and <code class="docutils literal notranslate"><span class="pre">mycode.bar</span></code>:
the former has type hints and the latter does not. We run
<a class="reference internal" href="index.html#cmdoption-mypy-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">mypy</span> <span class="pre">-m</span> <span class="pre">mycode.foo</span></code></a> and mypy discovers that <code class="docutils literal notranslate"><span class="pre">mycode.foo</span></code> imports
<code class="docutils literal notranslate"><span class="pre">mycode.bar</span></code>.</p>
<p>How do we want mypy to type check <code class="docutils literal notranslate"><span class="pre">mycode.bar</span></code>? Mypy’s behaviour here is
configurable – although we <strong>strongly recommend</strong> using the default –
by using the <a class="reference internal" href="index.html#cmdoption-mypy-follow-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--follow-imports</span></code></a> flag. This flag
accepts one of four string values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">normal</span></code> (the default, recommended) follows all imports normally and
type checks all top level code (as well as the bodies of all
functions and methods with at least one type annotation in
the signature).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">silent</span></code> behaves in the same way as <code class="docutils literal notranslate"><span class="pre">normal</span></code> but will
additionally <em>suppress</em> any error messages.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skip</span></code> will <em>not</em> follow imports and instead will silently
replace the module (and <em>anything imported from it</em>) with an
object of type <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code> behaves in the same way as <code class="docutils literal notranslate"><span class="pre">skip</span></code> but is not quite as
silent – it will flag the import as an error, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">main</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span> <span class="n">note</span><span class="p">:</span> <span class="n">Import</span> <span class="n">of</span> <span class="s2">&quot;mycode.bar&quot;</span> <span class="n">ignored</span>
<span class="n">main</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span> <span class="n">note</span><span class="p">:</span> <span class="p">(</span><span class="n">Using</span> <span class="o">--</span><span class="n">follow</span><span class="o">-</span><span class="n">imports</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">module</span> <span class="ow">not</span> <span class="n">passed</span> <span class="n">on</span> <span class="n">command</span> <span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>If you are starting a new codebase and plan on using type hints from
the start, we recommend you use either <a class="reference internal" href="index.html#cmdoption-mypy-follow-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--follow-imports=normal</span></code></a>
(the default) or <a class="reference internal" href="index.html#cmdoption-mypy-follow-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--follow-imports=error</span></code></a>. Either option will help
make sure you are not skipping checking any part of your codebase by
accident.</p>
<p>If you are planning on adding type hints to a large, existing code base,
we recommend you start by trying to make your entire codebase (including
files that do not use type hints) pass under <a class="reference internal" href="index.html#cmdoption-mypy-follow-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--follow-imports=normal</span></code></a>.
This is usually not too difficult to do: mypy is designed to report as
few error messages as possible when it is looking at unannotated code.</p>
<p>Only if doing this is intractable, we recommend passing mypy just the files
you want to type check and use <a class="reference internal" href="index.html#cmdoption-mypy-follow-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--follow-imports=silent</span></code></a>. Even if
mypy is unable to perfectly type check a file, it can still glean some
useful information by parsing it (for example, understanding what methods
a given object has). See <a class="reference internal" href="index.html#existing-code"><span class="std std-ref">Using mypy with an existing codebase</span></a> for more recommendations.</p>
<p>We do not recommend using <code class="docutils literal notranslate"><span class="pre">skip</span></code> unless you know what you are doing:
while this option can be quite powerful, it can also cause many
hard-to-debug errors.</p>
<p>Adjusting import following behaviour is often most useful when restricted to
specific modules. This can be accomplished by setting a per-module
<a class="reference internal" href="index.html#confval-follow_imports"><code class="xref std std-confval docutils literal notranslate"><span class="pre">follow_imports</span></code></a> config option.</p>
</section>
</section>
<span id="document-command_line"></span><section id="the-mypy-command-line">
<span id="command-line"></span><h3>The mypy command line<a class="headerlink" href="#the-mypy-command-line" title="Permalink to this headline">#</a></h3>
<p>This section documents mypy’s command line interface. You can view
a quick summary of the available flags by running <a class="reference internal" href="#cmdoption-mypy-h"><code class="xref std std-option docutils literal notranslate"><span class="pre">mypy</span> <span class="pre">--help</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Command line flags are liable to change between releases.</p>
</div>
<section id="specifying-what-to-type-check">
<h4>Specifying what to type check<a class="headerlink" href="#specifying-what-to-type-check" title="Permalink to this headline">#</a></h4>
<p>By default, you can specify what code you want mypy to type check
by passing in the paths to what you want to have type checked:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mypy foo.py bar.py some_directory
</pre></div>
</div>
<p>Note that directories are checked recursively.</p>
<p>Mypy also lets you specify what code to type check in several other
ways. A short summary of the relevant flags is included below:
for full details, see <a class="reference internal" href="index.html#running-mypy"><span class="std std-ref">Running mypy and managing imports</span></a>.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-m">
<span id="cmdoption-mypy-module"></span><span class="sig-name descname"><span class="pre">-m</span></span><span class="sig-prename descclassname"> <span class="pre">MODULE</span></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--module</span></span><span class="sig-prename descclassname"> <span class="pre">MODULE</span></span><a class="headerlink" href="#cmdoption-mypy-m" title="Permalink to this definition">#</a></dt>
<dd><p>Asks mypy to type check the provided module. This flag may be
repeated multiple times.</p>
<p>Mypy <em>will not</em> recursively type check any submodules of the provided
module.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-p">
<span id="cmdoption-mypy-package"></span><span class="sig-name descname"><span class="pre">-p</span></span><span class="sig-prename descclassname"> <span class="pre">PACKAGE</span></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--package</span></span><span class="sig-prename descclassname"> <span class="pre">PACKAGE</span></span><a class="headerlink" href="#cmdoption-mypy-p" title="Permalink to this definition">#</a></dt>
<dd><p>Asks mypy to type check the provided package. This flag may be
repeated multiple times.</p>
<p>Mypy <em>will</em> recursively type check any submodules of the provided
package. This flag is identical to <a class="reference internal" href="#cmdoption-mypy-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">--module</span></code></a> apart from this
behavior.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-c">
<span id="cmdoption-mypy-command"></span><span class="sig-name descname"><span class="pre">-c</span></span><span class="sig-prename descclassname"> <span class="pre">PROGRAM_TEXT</span></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--command</span></span><span class="sig-prename descclassname"> <span class="pre">PROGRAM_TEXT</span></span><a class="headerlink" href="#cmdoption-mypy-c" title="Permalink to this definition">#</a></dt>
<dd><p>Asks mypy to type check the provided string as a program.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-exclude">
<span class="sig-name descname"><span class="pre">--exclude</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-exclude" title="Permalink to this definition">#</a></dt>
<dd><p>A regular expression that matches file names, directory names and paths
which mypy should ignore while recursively discovering files to check.
Use forward slashes on all platforms.</p>
<p>For instance, to avoid discovering any files named <cite>setup.py</cite> you could
pass <code class="docutils literal notranslate"><span class="pre">--exclude</span> <span class="pre">'/setup\.py$'</span></code>. Similarly, you can ignore discovering
directories with a given name by e.g. <code class="docutils literal notranslate"><span class="pre">--exclude</span> <span class="pre">/build/</span></code> or
those matching a subpath with <code class="docutils literal notranslate"><span class="pre">--exclude</span> <span class="pre">/project/vendor/</span></code>. To ignore
multiple files / directories / paths, you can provide the –exclude
flag more than once, e.g <code class="docutils literal notranslate"><span class="pre">--exclude</span> <span class="pre">'/setup\.py$'</span> <span class="pre">--exclude</span> <span class="pre">'/build/'</span></code>.</p>
<p>Note that this flag only affects recursive directory tree discovery, that
is, when mypy is discovering files within a directory tree or submodules of
a package to check. If you pass a file or module explicitly it will still be
checked. For instance, <code class="docutils literal notranslate"><span class="pre">mypy</span> <span class="pre">--exclude</span> <span class="pre">'/setup.py$'</span>
<span class="pre">but_still_check/setup.py</span></code>.</p>
<p>In particular, <code class="docutils literal notranslate"><span class="pre">--exclude</span></code> does not affect mypy’s <a class="reference internal" href="index.html#follow-imports"><span class="std std-ref">import following</span></a>. You can use a per-module <a class="reference internal" href="index.html#confval-follow_imports"><code class="xref std std-confval docutils literal notranslate"><span class="pre">follow_imports</span></code></a> config
option to additionally avoid mypy from following imports and checking code
you do not wish to be checked.</p>
<p>Note that mypy will never recursively discover files and directories named
“site-packages”, “node_modules” or “__pycache__”, or those whose name starts
with a period, exactly as <code class="docutils literal notranslate"><span class="pre">--exclude</span>
<span class="pre">'/(site-packages|node_modules|__pycache__|\..*)/$'</span></code> would. Mypy will also
never recursively discover files with extensions other than <code class="docutils literal notranslate"><span class="pre">.py</span></code> or
<code class="docutils literal notranslate"><span class="pre">.pyi</span></code>.</p>
</dd></dl>

</section>
<section id="optional-arguments">
<h4>Optional arguments<a class="headerlink" href="#optional-arguments" title="Permalink to this headline">#</a></h4>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-h">
<span id="cmdoption-mypy-help"></span><span class="sig-name descname"><span class="pre">-h</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--help</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-h" title="Permalink to this definition">#</a></dt>
<dd><p>Show help message and exit.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-v">
<span id="cmdoption-mypy-verbose"></span><span class="sig-name descname"><span class="pre">-v</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--verbose</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-v" title="Permalink to this definition">#</a></dt>
<dd><p>More verbose messages.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-V">
<span id="cmdoption-mypy-version"></span><span class="sig-name descname"><span class="pre">-V</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--version</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-V" title="Permalink to this definition">#</a></dt>
<dd><p>Show program’s version number and exit.</p>
</dd></dl>

</section>
<section id="config-file">
<span id="config-file-flag"></span><h4>Config file<a class="headerlink" href="#config-file" title="Permalink to this headline">#</a></h4>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-config-file">
<span class="sig-name descname"><span class="pre">--config-file</span></span><span class="sig-prename descclassname"> <span class="pre">CONFIG_FILE</span></span><a class="headerlink" href="#cmdoption-mypy-config-file" title="Permalink to this definition">#</a></dt>
<dd><p>This flag makes mypy read configuration settings from the given file.</p>
<p>By default settings are read from <code class="docutils literal notranslate"><span class="pre">mypy.ini</span></code>, <code class="docutils literal notranslate"><span class="pre">.mypy.ini</span></code>, <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code>, or <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code>
in the current directory. Settings override mypy’s built-in defaults and
command line flags can override settings.</p>
<p>Specifying <a class="reference internal" href="#cmdoption-mypy-config-file"><code class="xref std std-option docutils literal notranslate"><span class="pre">--config-file=</span></code></a> (with no filename) will ignore <em>all</em>
config files.</p>
<p>See <a class="reference internal" href="index.html#config-file"><span class="std std-ref">The mypy configuration file</span></a> for the syntax of configuration files.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-warn-unused-configs">
<span class="sig-name descname"><span class="pre">--warn-unused-configs</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-warn-unused-configs" title="Permalink to this definition">#</a></dt>
<dd><p>This flag makes mypy warn about unused <code class="docutils literal notranslate"><span class="pre">[mypy-&lt;pattern&gt;]</span></code> config
file sections.
(This requires turning off incremental mode using <a class="reference internal" href="#cmdoption-mypy-no-incremental"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-incremental</span></code></a>.)</p>
</dd></dl>

</section>
<section id="import-discovery">
<span id="id1"></span><h4>Import discovery<a class="headerlink" href="#import-discovery" title="Permalink to this headline">#</a></h4>
<p>The following flags customize how exactly mypy discovers and follows
imports.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-explicit-package-bases">
<span class="sig-name descname"><span class="pre">--explicit-package-bases</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-explicit-package-bases" title="Permalink to this definition">#</a></dt>
<dd><p>This flag tells mypy that top-level packages will be based in either the
current directory, or a member of the <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> environment variable or
<a class="reference internal" href="index.html#confval-mypy_path"><code class="xref std std-confval docutils literal notranslate"><span class="pre">mypy_path</span></code></a> config option. This option is only useful in
in the absence of <cite>__init__.py</cite>. See <a class="reference internal" href="index.html#mapping-paths-to-modules"><span class="std std-ref">Mapping file
paths to modules</span></a> for details.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-ignore-missing-imports">
<span class="sig-name descname"><span class="pre">--ignore-missing-imports</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-ignore-missing-imports" title="Permalink to this definition">#</a></dt>
<dd><p>This flag makes mypy ignore all missing imports. It is equivalent
to adding <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comments to all unresolved imports
within your codebase.</p>
<p>Note that this flag does <em>not</em> suppress errors about missing names
in successfully resolved modules. For example, if one has the
following files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
<span class="n">package</span><span class="o">/</span><span class="n">mod</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Then mypy will generate the following errors with <a class="reference internal" href="#cmdoption-mypy-ignore-missing-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--ignore-missing-imports</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">package.unknown</span>      <span class="c1"># No error, ignored</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">package</span><span class="o">.</span><span class="n">unknown</span><span class="o">.</span><span class="n">func</span><span class="p">()</span>  <span class="c1"># OK. &#39;func&#39; is assumed to be of type &#39;Any&#39;</span>

<span class="kn">from</span> <span class="nn">package</span> <span class="kn">import</span> <span class="n">unknown</span>          <span class="c1"># No error, ignored</span>
<span class="kn">from</span> <span class="nn">package.mod</span> <span class="kn">import</span> <span class="n">NonExisting</span>  <span class="c1"># Error: Module has no attribute &#39;NonExisting&#39;</span>
</pre></div>
</div>
<p>For more details, see <a class="reference internal" href="index.html#ignore-missing-imports"><span class="std std-ref">Missing imports</span></a>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-follow-imports">
<span class="sig-name descname"><span class="pre">--follow-imports</span></span><span class="sig-prename descclassname"> <span class="pre">{normal,silent,skip,error}</span></span><a class="headerlink" href="#cmdoption-mypy-follow-imports" title="Permalink to this definition">#</a></dt>
<dd><p>This flag adjusts how mypy follows imported modules that were not
explicitly passed in via the command line.</p>
<p>The default option is <code class="docutils literal notranslate"><span class="pre">normal</span></code>: mypy will follow and type check
all modules. For more information on what the other options do,
see <a class="reference internal" href="index.html#follow-imports"><span class="std std-ref">Following imports</span></a>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-python-executable">
<span class="sig-name descname"><span class="pre">--python-executable</span></span><span class="sig-prename descclassname"> <span class="pre">EXECUTABLE</span></span><a class="headerlink" href="#cmdoption-mypy-python-executable" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will have mypy collect type information from <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0561/"><strong>PEP 561</strong></a>
compliant packages installed for the Python executable <code class="docutils literal notranslate"><span class="pre">EXECUTABLE</span></code>.
If not provided, mypy will use PEP 561 compliant packages installed for
the Python executable running mypy.</p>
<p>See <a class="reference internal" href="index.html#installed-packages"><span class="std std-ref">Using installed packages</span></a> for more on making PEP 561 compliant packages.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-no-site-packages">
<span class="sig-name descname"><span class="pre">--no-site-packages</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-no-site-packages" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will disable searching for <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0561/"><strong>PEP 561</strong></a> compliant packages. This
will also disable searching for a usable Python executable.</p>
<p>Use this  flag if mypy cannot find a Python executable for the version of
Python being checked, and you don’t need to use PEP 561 typed packages.
Otherwise, use <a class="reference internal" href="#cmdoption-mypy-python-executable"><code class="xref std std-option docutils literal notranslate"><span class="pre">--python-executable</span></code></a>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-no-silence-site-packages">
<span class="sig-name descname"><span class="pre">--no-silence-site-packages</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-no-silence-site-packages" title="Permalink to this definition">#</a></dt>
<dd><p>By default, mypy will suppress any error messages generated within <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0561/"><strong>PEP 561</strong></a>
compliant packages. Adding this flag will disable this behavior.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-fast-module-lookup">
<span class="sig-name descname"><span class="pre">--fast-module-lookup</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-fast-module-lookup" title="Permalink to this definition">#</a></dt>
<dd><p>The default logic used to scan through search paths to resolve imports has a
quadratic worse-case behavior in some cases, which is for instance triggered
by a large number of folders sharing a top-level namespace as in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span><span class="o">/</span>
    <span class="n">company</span><span class="o">/</span>
        <span class="n">foo</span><span class="o">/</span>
            <span class="n">a</span><span class="o">.</span><span class="n">py</span>
<span class="n">bar</span><span class="o">/</span>
    <span class="n">company</span><span class="o">/</span>
        <span class="n">bar</span><span class="o">/</span>
            <span class="n">b</span><span class="o">.</span><span class="n">py</span>
<span class="n">baz</span><span class="o">/</span>
    <span class="n">company</span><span class="o">/</span>
        <span class="n">baz</span><span class="o">/</span>
            <span class="n">c</span><span class="o">.</span><span class="n">py</span>
<span class="o">...</span>
</pre></div>
</div>
<p>If you are in this situation, you can enable an experimental fast path by
setting the <a class="reference internal" href="#cmdoption-mypy-fast-module-lookup"><code class="xref std std-option docutils literal notranslate"><span class="pre">--fast-module-lookup</span></code></a> option.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-no-namespace-packages">
<span class="sig-name descname"><span class="pre">--no-namespace-packages</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-no-namespace-packages" title="Permalink to this definition">#</a></dt>
<dd><p>This flag disables import discovery of namespace packages (see <span class="target" id="index-3"></span><a class="pep reference external" href="https://peps.python.org/pep-0420/"><strong>PEP 420</strong></a>).
In particular, this prevents discovery of packages that don’t have an
<code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> (or <code class="docutils literal notranslate"><span class="pre">__init__.pyi</span></code>) file.</p>
<p>This flag affects how mypy finds modules and packages explicitly passed on
the command line. It also affects how mypy determines fully qualified module
names for files passed on the command line. See <a class="reference internal" href="index.html#mapping-paths-to-modules"><span class="std std-ref">Mapping file paths to
modules</span></a> for details.</p>
</dd></dl>

</section>
<section id="platform-configuration">
<span id="id2"></span><h4>Platform configuration<a class="headerlink" href="#platform-configuration" title="Permalink to this headline">#</a></h4>
<p>By default, mypy will assume that you intend to run your code using the same
operating system and Python version you are using to run mypy itself. The
following flags let you modify this behavior.</p>
<p>For more information on how to use these flags, see <a class="reference internal" href="index.html#version-and-platform-checks"><span class="std std-ref">Python version and system platform checks</span></a>.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-python-version">
<span class="sig-name descname"><span class="pre">--python-version</span></span><span class="sig-prename descclassname"> <span class="pre">X.Y</span></span><a class="headerlink" href="#cmdoption-mypy-python-version" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will make mypy type check your code as if it were
run under Python version X.Y. Without this option, mypy will default to using
whatever version of Python is running mypy.</p>
<p>This flag will attempt to find a Python executable of the corresponding
version to search for <span class="target" id="index-4"></span><a class="pep reference external" href="https://peps.python.org/pep-0561/"><strong>PEP 561</strong></a> compliant packages. If you’d like to
disable this, use the <a class="reference internal" href="#cmdoption-mypy-no-site-packages"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-site-packages</span></code></a> flag (see
<a class="reference internal" href="#import-discovery"><span class="std std-ref">Import discovery</span></a> for more details).</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-platform">
<span class="sig-name descname"><span class="pre">--platform</span></span><span class="sig-prename descclassname"> <span class="pre">PLATFORM</span></span><a class="headerlink" href="#cmdoption-mypy-platform" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will make mypy type check your code as if it were
run under the given operating system. Without this option, mypy will
default to using whatever operating system you are currently using.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">PLATFORM</span></code> parameter may be any string supported by
<a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.platform" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.platform</span></code></a>.</p>
</dd></dl>

<span class="target" id="always-true"></span><dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-always-true">
<span class="sig-name descname"><span class="pre">--always-true</span></span><span class="sig-prename descclassname"> <span class="pre">NAME</span></span><a class="headerlink" href="#cmdoption-mypy-always-true" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will treat all variables named <code class="docutils literal notranslate"><span class="pre">NAME</span></code> as
compile-time constants that are always true.  This flag may
be repeated.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-always-false">
<span class="sig-name descname"><span class="pre">--always-false</span></span><span class="sig-prename descclassname"> <span class="pre">NAME</span></span><a class="headerlink" href="#cmdoption-mypy-always-false" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will treat all variables named <code class="docutils literal notranslate"><span class="pre">NAME</span></code> as
compile-time constants that are always false.  This flag may
be repeated.</p>
</dd></dl>

</section>
<section id="disallow-dynamic-typing">
<span id="id3"></span><h4>Disallow dynamic typing<a class="headerlink" href="#disallow-dynamic-typing" title="Permalink to this headline">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Any</span></code> type is used to represent a value that has a <a class="reference internal" href="index.html#dynamic-typing"><span class="std std-ref">dynamic type</span></a>.
The <code class="docutils literal notranslate"><span class="pre">--disallow-any</span></code> family of flags will disallow various uses of the <code class="docutils literal notranslate"><span class="pre">Any</span></code> type in
a module – this lets us strategically disallow the use of dynamic typing in a controlled way.</p>
<p>The following options are available:</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-disallow-any-unimported">
<span class="sig-name descname"><span class="pre">--disallow-any-unimported</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-disallow-any-unimported" title="Permalink to this definition">#</a></dt>
<dd><p>This flag disallows usage of types that come from unfollowed imports
(such types become aliases for <code class="docutils literal notranslate"><span class="pre">Any</span></code>). Unfollowed imports occur either
when the imported module does not exist or when <a class="reference internal" href="#cmdoption-mypy-follow-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--follow-imports=skip</span></code></a>
is set.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-disallow-any-expr">
<span class="sig-name descname"><span class="pre">--disallow-any-expr</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-disallow-any-expr" title="Permalink to this definition">#</a></dt>
<dd><p>This flag disallows all expressions in the module that have type <code class="docutils literal notranslate"><span class="pre">Any</span></code>.
If an expression of type <code class="docutils literal notranslate"><span class="pre">Any</span></code> appears anywhere in the module
mypy will output an error unless the expression is immediately
used as an argument to <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.cast" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">cast()</span></code></a> or assigned to a variable with an
explicit type annotation.</p>
<p>In addition, declaring a variable of type <code class="docutils literal notranslate"><span class="pre">Any</span></code>
or casting to type <code class="docutils literal notranslate"><span class="pre">Any</span></code> is not allowed. Note that calling functions
that take parameters of type <code class="docutils literal notranslate"><span class="pre">Any</span></code> is still allowed.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-disallow-any-decorated">
<span class="sig-name descname"><span class="pre">--disallow-any-decorated</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-disallow-any-decorated" title="Permalink to this definition">#</a></dt>
<dd><p>This flag disallows functions that have <code class="docutils literal notranslate"><span class="pre">Any</span></code> in their signature
after decorator transformation.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-disallow-any-explicit">
<span class="sig-name descname"><span class="pre">--disallow-any-explicit</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-disallow-any-explicit" title="Permalink to this definition">#</a></dt>
<dd><p>This flag disallows explicit <code class="docutils literal notranslate"><span class="pre">Any</span></code> in type positions such as type
annotations and generic type parameters.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-disallow-any-generics">
<span class="sig-name descname"><span class="pre">--disallow-any-generics</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-disallow-any-generics" title="Permalink to this definition">#</a></dt>
<dd><p>This flag disallows usage of generic types that do not specify explicit
type parameters. For example, you can’t use a bare <code class="docutils literal notranslate"><span class="pre">x:</span> <span class="pre">list</span></code>. Instead, you
must always write something like <code class="docutils literal notranslate"><span class="pre">x:</span> <span class="pre">list[int]</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-disallow-subclassing-any">
<span class="sig-name descname"><span class="pre">--disallow-subclassing-any</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-disallow-subclassing-any" title="Permalink to this definition">#</a></dt>
<dd><p>This flag reports an error whenever a class subclasses a value of
type <code class="docutils literal notranslate"><span class="pre">Any</span></code>.  This may occur when the base class is imported from
a module that doesn’t exist (when using
<a class="reference internal" href="#cmdoption-mypy-ignore-missing-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--ignore-missing-imports</span></code></a>) or is
ignored due to <a class="reference internal" href="#cmdoption-mypy-follow-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--follow-imports=skip</span></code></a> or a
<code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment on the <code class="docutils literal notranslate"><span class="pre">import</span></code> statement.</p>
<p>Since the module is silenced, the imported class is given a type of <code class="docutils literal notranslate"><span class="pre">Any</span></code>.
By default mypy will assume that the subclass correctly inherited
the base class even though that may not actually be the case.  This
flag makes mypy raise an error instead.</p>
</dd></dl>

</section>
<section id="untyped-definitions-and-calls">
<span id="id4"></span><h4>Untyped definitions and calls<a class="headerlink" href="#untyped-definitions-and-calls" title="Permalink to this headline">#</a></h4>
<p>The following flags configure how mypy handles untyped function
definitions or calls.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-disallow-untyped-calls">
<span class="sig-name descname"><span class="pre">--disallow-untyped-calls</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-disallow-untyped-calls" title="Permalink to this definition">#</a></dt>
<dd><p>This flag reports an error whenever a function with type annotations
calls a function defined without annotations.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-untyped-calls-exclude">
<span class="sig-name descname"><span class="pre">--untyped-calls-exclude</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-untyped-calls-exclude" title="Permalink to this definition">#</a></dt>
<dd><p>This flag allows to selectively disable <a class="reference internal" href="#cmdoption-mypy-disallow-untyped-calls"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-untyped-calls</span></code></a>
for functions and methods defined in specific packages, modules, or classes.
Note that each exclude entry acts as a prefix. For example (assuming there
are no type annotations for <code class="docutils literal notranslate"><span class="pre">third_party_lib</span></code> available):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy --disallow-untyped-calls</span>
<span class="c1">#      --untyped-calls-exclude=third_party_lib.module_a</span>
<span class="c1">#      --untyped-calls-exclude=foo.A</span>
<span class="kn">from</span> <span class="nn">third_party_lib.module_a</span> <span class="kn">import</span> <span class="n">some_func</span>
<span class="kn">from</span> <span class="nn">third_party_lib.module_b</span> <span class="kn">import</span> <span class="n">other_func</span>
<span class="kn">import</span> <span class="nn">foo</span>

<span class="n">some_func</span><span class="p">()</span>  <span class="c1"># OK, function comes from module `third_party_lib.module_a`</span>
<span class="n">other_func</span><span class="p">()</span>  <span class="c1"># E: Call to untyped function &quot;other_func&quot; in typed context</span>

<span class="n">foo</span><span class="o">.</span><span class="n">A</span><span class="p">()</span><span class="o">.</span><span class="n">meth</span><span class="p">()</span>  <span class="c1"># OK, method was defined in class `foo.A`</span>
<span class="n">foo</span><span class="o">.</span><span class="n">B</span><span class="p">()</span><span class="o">.</span><span class="n">meth</span><span class="p">()</span>  <span class="c1"># E: Call to untyped function &quot;meth&quot; in typed context</span>

<span class="c1"># file foo.py</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">meth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">meth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-disallow-untyped-defs">
<span class="sig-name descname"><span class="pre">--disallow-untyped-defs</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-disallow-untyped-defs" title="Permalink to this definition">#</a></dt>
<dd><p>This flag reports an error whenever it encounters a function definition
without type annotations or with incomplete type annotations.
(a superset of <a class="reference internal" href="#cmdoption-mypy-disallow-incomplete-defs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-incomplete-defs</span></code></a>).</p>
<p>For example, it would report an error for <code class="code docutils literal notranslate"><span class="pre">def</span> <span class="pre">f(a,</span> <span class="pre">b)</span></code> and <code class="code docutils literal notranslate"><span class="pre">def</span> <span class="pre">f(a:</span> <span class="pre">int,</span> <span class="pre">b)</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-disallow-incomplete-defs">
<span class="sig-name descname"><span class="pre">--disallow-incomplete-defs</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-disallow-incomplete-defs" title="Permalink to this definition">#</a></dt>
<dd><p>This flag reports an error whenever it encounters a partly annotated
function definition, while still allowing entirely unannotated definitions.</p>
<p>For example, it would report an error for <code class="code docutils literal notranslate"><span class="pre">def</span> <span class="pre">f(a:</span> <span class="pre">int,</span> <span class="pre">b)</span></code> but not <code class="code docutils literal notranslate"><span class="pre">def</span> <span class="pre">f(a,</span> <span class="pre">b)</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-check-untyped-defs">
<span class="sig-name descname"><span class="pre">--check-untyped-defs</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-check-untyped-defs" title="Permalink to this definition">#</a></dt>
<dd><p>This flag is less severe than the previous two options – it type checks
the body of every function, regardless of whether it has type annotations.
(By default the bodies of functions without annotations are not type
checked.)</p>
<p>It will assume all arguments have type <code class="docutils literal notranslate"><span class="pre">Any</span></code> and always infer <code class="docutils literal notranslate"><span class="pre">Any</span></code>
as the return type.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-disallow-untyped-decorators">
<span class="sig-name descname"><span class="pre">--disallow-untyped-decorators</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-disallow-untyped-decorators" title="Permalink to this definition">#</a></dt>
<dd><p>This flag reports an error whenever a function with type annotations
is decorated with a decorator without annotations.</p>
</dd></dl>

</section>
<section id="none-and-optional-handling">
<span id="id5"></span><h4>None and Optional handling<a class="headerlink" href="#none-and-optional-handling" title="Permalink to this headline">#</a></h4>
<p>The following flags adjust how mypy handles values of type <code class="docutils literal notranslate"><span class="pre">None</span></code>.
For more details, see <a class="reference internal" href="index.html#no-strict-optional"><span class="std std-ref">Disabling strict optional checking</span></a>.</p>
<span class="target" id="implicit-optional"></span><dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-implicit-optional">
<span class="sig-name descname"><span class="pre">--implicit-optional</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-implicit-optional" title="Permalink to this definition">#</a></dt>
<dd><p>This flag causes mypy to treat arguments with a <code class="docutils literal notranslate"><span class="pre">None</span></code>
default value as having an implicit <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a> type.</p>
<p>For example, if this flag is set, mypy would assume that the <code class="docutils literal notranslate"><span class="pre">x</span></code>
parameter is actually of type <code class="docutils literal notranslate"><span class="pre">Optional[int]</span></code> in the code snippet below
since the default parameter is <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Note:</strong> This was disabled by default starting in mypy 0.980.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-no-strict-optional">
<span class="sig-name descname"><span class="pre">--no-strict-optional</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-no-strict-optional" title="Permalink to this definition">#</a></dt>
<dd><p>This flag disables strict checking of <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>
types and <code class="docutils literal notranslate"><span class="pre">None</span></code> values. With this option, mypy doesn’t
generally check the use of <code class="docutils literal notranslate"><span class="pre">None</span></code> values – they are valid
everywhere. See <a class="reference internal" href="index.html#no-strict-optional"><span class="std std-ref">Disabling strict optional checking</span></a> for more about this feature.</p>
<p><strong>Note:</strong> Strict optional checking was enabled by default starting in
mypy 0.600, and in previous versions it had to be explicitly enabled
using <code class="docutils literal notranslate"><span class="pre">--strict-optional</span></code> (which is still accepted).</p>
</dd></dl>

</section>
<section id="configuring-warnings">
<span id="id6"></span><h4>Configuring warnings<a class="headerlink" href="#configuring-warnings" title="Permalink to this headline">#</a></h4>
<p>The following flags enable warnings for code that is sound but is
potentially problematic or redundant in some way.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-warn-redundant-casts">
<span class="sig-name descname"><span class="pre">--warn-redundant-casts</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-warn-redundant-casts" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will make mypy report an error whenever your code uses
an unnecessary cast that can safely be removed.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-warn-unused-ignores">
<span class="sig-name descname"><span class="pre">--warn-unused-ignores</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-warn-unused-ignores" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will make mypy report an error whenever your code uses
a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment on a line that is not actually
generating an error message.</p>
<p>This flag, along with the <a class="reference internal" href="#cmdoption-mypy-warn-redundant-casts"><code class="xref std std-option docutils literal notranslate"><span class="pre">--warn-redundant-casts</span></code></a> flag, are both
particularly useful when you are upgrading mypy. Previously,
you may have needed to add casts or <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> annotations
to work around bugs in mypy or missing stubs for 3rd party libraries.</p>
<p>These two flags let you discover cases where either workarounds are
no longer necessary.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-no-warn-no-return">
<span class="sig-name descname"><span class="pre">--no-warn-no-return</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-no-warn-no-return" title="Permalink to this definition">#</a></dt>
<dd><p>By default, mypy will generate errors when a function is missing
return statements in some execution paths. The only exceptions
are when:</p>
<ul class="simple">
<li><p>The function has a <code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">Any</span></code> return type</p></li>
<li><p>The function has an empty body and is marked as an abstract method,
is in a protocol class, or is in a stub file</p></li>
<li><dl class="simple">
<dt>The execution path can never return; for example, if an exception</dt><dd><p>is always raised</p>
</dd>
</dl>
</li>
</ul>
<p>Passing in <a class="reference internal" href="#cmdoption-mypy-no-warn-no-return"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-warn-no-return</span></code></a> will disable these error
messages in all cases.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-warn-return-any">
<span class="sig-name descname"><span class="pre">--warn-return-any</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-warn-return-any" title="Permalink to this definition">#</a></dt>
<dd><p>This flag causes mypy to generate a warning when returning a value
with type <code class="docutils literal notranslate"><span class="pre">Any</span></code> from a function declared with a non-<code class="docutils literal notranslate"><span class="pre">Any</span></code> return type.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-warn-unreachable">
<span class="sig-name descname"><span class="pre">--warn-unreachable</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-warn-unreachable" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will make mypy report an error whenever it encounters
code determined to be unreachable or redundant after performing type analysis.
This can be a helpful way of detecting certain kinds of bugs in your code.</p>
<p>For example, enabling this flag will make mypy report that the <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;</span> <span class="pre">7</span></code>
check is redundant and that the <code class="docutils literal notranslate"><span class="pre">else</span></code> block below is unreachable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Error: Right operand of &quot;or&quot; is never evaluated</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
        <span class="c1"># Error: Unsupported operand types for + (&quot;int&quot; and &quot;str&quot;)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;bad&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Error: &#39;Statement is unreachable&#39; error</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;bad&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To help prevent mypy from generating spurious warnings, the “Statement is
unreachable” warning will be silenced in exactly two cases:</p>
<ol class="arabic simple">
<li><p>When the unreachable statement is a <code class="docutils literal notranslate"><span class="pre">raise</span></code> statement, is an
<code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">False</span></code> statement, or calls a function that has the <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NoReturn" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">NoReturn</span></code></a>
return type hint. In other words, when the unreachable statement
throws an error or terminates the program in some way.</p></li>
<li><p>When the unreachable statement was <em>intentionally</em> marked as unreachable
using <a class="reference internal" href="index.html#version-and-platform-checks"><span class="std std-ref">Python version and system platform checks</span></a>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Mypy currently cannot detect and report unreachable or redundant code
inside any functions using <a class="reference internal" href="index.html#type-variable-value-restriction"><span class="std std-ref">Type variables with value restriction</span></a>.</p>
<p>This limitation will be removed in future releases of mypy.</p>
</div>
</dd></dl>

</section>
<section id="miscellaneous-strictness-flags">
<span id="id7"></span><h4>Miscellaneous strictness flags<a class="headerlink" href="#miscellaneous-strictness-flags" title="Permalink to this headline">#</a></h4>
<p>This section documents any other flags that do not neatly fall under any
of the above sections.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-allow-untyped-globals">
<span class="sig-name descname"><span class="pre">--allow-untyped-globals</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-allow-untyped-globals" title="Permalink to this definition">#</a></dt>
<dd><p>This flag causes mypy to suppress errors caused by not being able to fully
infer the types of global and class variables.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-allow-redefinition">
<span class="sig-name descname"><span class="pre">--allow-redefinition</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-allow-redefinition" title="Permalink to this definition">#</a></dt>
<dd><p>By default, mypy won’t allow a variable to be redefined with an
unrelated type. This flag enables redefinition of a variable with an
arbitrary type <em>in some contexts</em>: only redefinitions within the
same block and nesting depth as the original definition are allowed.
Example where this can be useful:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># &#39;items&#39; has type list[str]</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
    <span class="c1"># &#39;items&#39; now has type list[list[str]]</span>
</pre></div>
</div>
<p>The variable must be used before it can be redefined:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
   <span class="n">items</span> <span class="o">=</span> <span class="s2">&quot;mypy&quot;</span>  <span class="c1"># invalid redefinition to str because the variable hasn&#39;t been used yet</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
   <span class="n">items</span> <span class="o">=</span> <span class="s2">&quot;100&quot;</span>  <span class="c1"># valid, items now has type str</span>
   <span class="n">items</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>  <span class="c1"># valid, items now has type int</span>
</pre></div>
</div>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-local-partial-types">
<span class="sig-name descname"><span class="pre">--local-partial-types</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-local-partial-types" title="Permalink to this definition">#</a></dt>
<dd><p>In mypy, the most common cases for partial types are variables initialized using <code class="docutils literal notranslate"><span class="pre">None</span></code>,
but without explicit <code class="docutils literal notranslate"><span class="pre">Optional</span></code> annotations. By default, mypy won’t check partial types
spanning module top level or class top level. This flag changes the behavior to only allow
partial types at local level, therefore it disallows inferring variable type for <code class="docutils literal notranslate"><span class="pre">None</span></code>
from two assignments in different scopes. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Need type annotation here if using --local-partial-types</span>
<span class="n">b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Need type annotation here if using --local-partial-types</span>
    <span class="n">baz</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">reveal_type</span><span class="p">(</span><span class="n">Foo</span><span class="p">()</span><span class="o">.</span><span class="n">bar</span><span class="p">)</span>  <span class="c1"># Union[int, None] without --local-partial-types</span>
</pre></div>
</div>
<p>Note: this option is always implicitly enabled in mypy daemon and will become
enabled by default for mypy in a future release.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-no-implicit-reexport">
<span class="sig-name descname"><span class="pre">--no-implicit-reexport</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-no-implicit-reexport" title="Permalink to this definition">#</a></dt>
<dd><p>By default, imported values to a module are treated as exported and mypy allows
other modules to import them. This flag changes the behavior to not re-export unless
the item is imported using from-as or is included in <code class="docutils literal notranslate"><span class="pre">__all__</span></code>. Note this is
always treated as enabled for stub files. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This won&#39;t re-export the value</span>
<span class="kn">from</span> <span class="nn">foo</span> <span class="kn">import</span> <span class="n">bar</span>

<span class="c1"># Neither will this</span>
<span class="kn">from</span> <span class="nn">foo</span> <span class="kn">import</span> <span class="n">bar</span> <span class="k">as</span> <span class="n">bang</span>

<span class="c1"># This will re-export it as bar and allow other modules to import it</span>
<span class="kn">from</span> <span class="nn">foo</span> <span class="kn">import</span> <span class="n">bar</span> <span class="k">as</span> <span class="n">bar</span>

<span class="c1"># This will also re-export bar</span>
<span class="kn">from</span> <span class="nn">foo</span> <span class="kn">import</span> <span class="n">bar</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-strict-equality">
<span class="sig-name descname"><span class="pre">--strict-equality</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-strict-equality" title="Permalink to this definition">#</a></dt>
<dd><p>By default, mypy allows always-false comparisons like <code class="docutils literal notranslate"><span class="pre">42</span> <span class="pre">==</span> <span class="pre">'no'</span></code>.
Use this flag to prohibit such comparisons of non-overlapping types, and
similar identity and container checks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Text</span>

<span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="k">if</span> <span class="s1">&#39;some string&#39;</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>  <span class="c1"># Error: non-overlapping container check!</span>
    <span class="o">...</span>

<span class="n">text</span><span class="p">:</span> <span class="n">Text</span>
<span class="k">if</span> <span class="n">text</span> <span class="o">!=</span> <span class="sa">b</span><span class="s1">&#39;other bytes&#39;</span><span class="p">:</span>  <span class="c1"># Error: non-overlapping equality check!</span>
    <span class="o">...</span>

<span class="k">assert</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="c1"># OK, check against None is allowed as a special case.</span>
</pre></div>
</div>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-extra-checks">
<span class="sig-name descname"><span class="pre">--extra-checks</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-extra-checks" title="Permalink to this definition">#</a></dt>
<dd><p>This flag enables additional checks that are technically correct but may be
impractical in real code. In particular, it prohibits partial overlap in
<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> updates, and makes arguments prepended via <code class="docutils literal notranslate"><span class="pre">Concatenate</span></code>
positional-only. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">a</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">foo</span><span class="p">:</span> <span class="n">Foo</span><span class="p">,</span> <span class="n">bar</span><span class="p">:</span> <span class="n">Bar</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># This is technically unsafe since foo can have a subtype of Foo at</span>
    <span class="c1"># runtime, where type of key &quot;b&quot; is incompatible with int, see below</span>
    <span class="n">bar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Bad</span><span class="p">(</span><span class="n">Foo</span><span class="p">):</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">str</span>
<span class="n">bad</span><span class="p">:</span> <span class="n">Bad</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="s2">&quot;no&quot;</span><span class="p">}</span>
<span class="n">test</span><span class="p">(</span><span class="n">bad</span><span class="p">,</span> <span class="n">bar</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-strict">
<span class="sig-name descname"><span class="pre">--strict</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-strict" title="Permalink to this definition">#</a></dt>
<dd><p>This flag mode enables all optional error checking flags.  You can see the
list of flags enabled by strict mode in the full <a class="reference internal" href="#cmdoption-mypy-h"><code class="xref std std-option docutils literal notranslate"><span class="pre">mypy</span> <span class="pre">--help</span></code></a> output.</p>
<p>Note: the exact list of flags enabled by running <a class="reference internal" href="#cmdoption-mypy-strict"><code class="xref std std-option docutils literal notranslate"><span class="pre">--strict</span></code></a> may change
over time.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-disable-error-code">
<span class="sig-name descname"><span class="pre">--disable-error-code</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-disable-error-code" title="Permalink to this definition">#</a></dt>
<dd><p>This flag allows disabling one or multiple error codes globally.
See <a class="reference internal" href="index.html#error-codes"><span class="std std-ref">Error codes</span></a> for more information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># no flag</span>
<span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;a string&#39;</span>
<span class="n">x</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span>  <span class="c1"># error: &quot;str&quot; has no attribute &quot;trim&quot;  [attr-defined]</span>

<span class="c1"># When using --disable-error-code attr-defined</span>
<span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;a string&#39;</span>
<span class="n">x</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-enable-error-code">
<span class="sig-name descname"><span class="pre">--enable-error-code</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-enable-error-code" title="Permalink to this definition">#</a></dt>
<dd><p>This flag allows enabling one or multiple error codes globally.
See <a class="reference internal" href="index.html#error-codes"><span class="std std-ref">Error codes</span></a> for more information.</p>
<p>Note: This flag will override disabled error codes from the
<a class="reference internal" href="#cmdoption-mypy-disable-error-code"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disable-error-code</span></code></a> flag.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># When using --disable-error-code attr-defined</span>
<span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;a string&#39;</span>
<span class="n">x</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span>

<span class="c1"># --disable-error-code attr-defined --enable-error-code attr-defined</span>
<span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;a string&#39;</span>
<span class="n">x</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span>  <span class="c1"># error: &quot;str&quot; has no attribute &quot;trim&quot;  [attr-defined]</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="configuring-error-messages">
<span id="id8"></span><h4>Configuring error messages<a class="headerlink" href="#configuring-error-messages" title="Permalink to this headline">#</a></h4>
<p>The following flags let you adjust how much detail mypy displays
in error messages.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-show-error-context">
<span class="sig-name descname"><span class="pre">--show-error-context</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-show-error-context" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will precede all errors with “note” messages explaining the
context of the error. For example, consider the following program:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Test</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="s2">&quot;bar&quot;</span>
</pre></div>
</div>
<p>Mypy normally displays an error message that looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">main</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">Unsupported</span> <span class="n">operand</span> <span class="n">types</span> <span class="k">for</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;int&quot;</span> <span class="ow">and</span> <span class="s2">&quot;str&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If we enable this flag, the error message now looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>main.py: note: In member &quot;foo&quot; of class &quot;Test&quot;:
main.py:3: error: Unsupported operand types for + (&quot;int&quot; and &quot;str&quot;)
</pre></div>
</div>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-show-column-numbers">
<span class="sig-name descname"><span class="pre">--show-column-numbers</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-show-column-numbers" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will add column offsets to error messages.
For example, the following indicates an error in line 12, column 9
(note that column offsets are 0-based):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">main</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="mi">9</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">Unsupported</span> <span class="n">operand</span> <span class="n">types</span> <span class="k">for</span> <span class="o">/</span> <span class="p">(</span><span class="s2">&quot;int&quot;</span> <span class="ow">and</span> <span class="s2">&quot;str&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-show-error-end">
<span class="sig-name descname"><span class="pre">--show-error-end</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-show-error-end" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will make mypy show not just that start position where
an error was detected, but also the end position of the relevant expression.
This way various tools can easily highlight the whole error span. The format is
<code class="docutils literal notranslate"><span class="pre">file:line:column:end_line:end_column</span></code>. This option implies
<code class="docutils literal notranslate"><span class="pre">--show-column-numbers</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-hide-error-codes">
<span class="sig-name descname"><span class="pre">--hide-error-codes</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-hide-error-codes" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will hide the error code <code class="docutils literal notranslate"><span class="pre">[&lt;code&gt;]</span></code> from error messages. By default, the error
code is shown after each error message:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prog</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span> <span class="n">has</span> <span class="n">no</span> <span class="n">attribute</span> <span class="s2">&quot;trim&quot;</span>  <span class="p">[</span><span class="n">attr</span><span class="o">-</span><span class="n">defined</span><span class="p">]</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#error-codes"><span class="std std-ref">Error codes</span></a> for more information.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-pretty">
<span class="sig-name descname"><span class="pre">--pretty</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-pretty" title="Permalink to this definition">#</a></dt>
<dd><p>Use visually nicer output in error messages: use soft word wrap,
show source code snippets, and show error location markers.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-no-color-output">
<span class="sig-name descname"><span class="pre">--no-color-output</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-no-color-output" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will disable color output in error messages, enabled by default.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-no-error-summary">
<span class="sig-name descname"><span class="pre">--no-error-summary</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-no-error-summary" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will disable error summary. By default mypy shows a summary line
including total number of errors, number of files with errors, and number
of files checked.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-show-absolute-path">
<span class="sig-name descname"><span class="pre">--show-absolute-path</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-show-absolute-path" title="Permalink to this definition">#</a></dt>
<dd><p>Show absolute paths to files.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-soft-error-limit">
<span class="sig-name descname"><span class="pre">--soft-error-limit</span></span><span class="sig-prename descclassname"> <span class="pre">N</span></span><a class="headerlink" href="#cmdoption-mypy-soft-error-limit" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will adjust the limit after which mypy will (sometimes)
disable reporting most additional errors. The limit only applies
if it seems likely that most of the remaining errors will not be
useful or they may be overly noisy. If <code class="docutils literal notranslate"><span class="pre">N</span></code> is negative, there is
no limit. The default limit is 200.</p>
</dd></dl>

</section>
<section id="incremental-mode">
<span id="incremental"></span><h4>Incremental mode<a class="headerlink" href="#incremental-mode" title="Permalink to this headline">#</a></h4>
<p>By default, mypy will store type information into a cache. Mypy
will use this information to avoid unnecessary recomputation when
it type checks your code again.  This can help speed up the type
checking process, especially when most parts of your program have
not changed since the previous mypy run.</p>
<p>If you want to speed up how long it takes to recheck your code
beyond what incremental mode can offer, try running mypy in
<a class="reference internal" href="index.html#mypy-daemon"><span class="std std-ref">daemon mode</span></a>.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-no-incremental">
<span class="sig-name descname"><span class="pre">--no-incremental</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-no-incremental" title="Permalink to this definition">#</a></dt>
<dd><p>This flag disables incremental mode: mypy will no longer reference
the cache when re-run.</p>
<p>Note that mypy will still write out to the cache even when
incremental mode is disabled: see the <a class="reference internal" href="#cmdoption-mypy-cache-dir"><code class="xref std std-option docutils literal notranslate"><span class="pre">--cache-dir</span></code></a> flag below
for more details.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-cache-dir">
<span class="sig-name descname"><span class="pre">--cache-dir</span></span><span class="sig-prename descclassname"> <span class="pre">DIR</span></span><a class="headerlink" href="#cmdoption-mypy-cache-dir" title="Permalink to this definition">#</a></dt>
<dd><p>By default, mypy stores all cache data inside of a folder named
<code class="docutils literal notranslate"><span class="pre">.mypy_cache</span></code> in the current directory. This flag lets you
change this folder. This flag can also be useful for controlling
cache use when using <a class="reference internal" href="index.html#remote-cache"><span class="std std-ref">remote caching</span></a>.</p>
<p>This setting will override the <code class="docutils literal notranslate"><span class="pre">MYPY_CACHE_DIR</span></code> environment
variable if it is set.</p>
<p>Mypy will also always write to the cache even when incremental
mode is disabled so it can “warm up” the cache. To disable
writing to the cache, use <code class="docutils literal notranslate"><span class="pre">--cache-dir=/dev/null</span></code> (UNIX)
or <code class="docutils literal notranslate"><span class="pre">--cache-dir=nul</span></code> (Windows).</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-sqlite-cache">
<span class="sig-name descname"><span class="pre">--sqlite-cache</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-sqlite-cache" title="Permalink to this definition">#</a></dt>
<dd><p>Use an <a class="reference external" href="https://www.sqlite.org/">SQLite</a> database to store the cache.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-cache-fine-grained">
<span class="sig-name descname"><span class="pre">--cache-fine-grained</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-cache-fine-grained" title="Permalink to this definition">#</a></dt>
<dd><p>Include fine-grained dependency information in the cache for the mypy daemon.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-skip-version-check">
<span class="sig-name descname"><span class="pre">--skip-version-check</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-skip-version-check" title="Permalink to this definition">#</a></dt>
<dd><p>By default, mypy will ignore cache data generated by a different
version of mypy. This flag disables that behavior.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-skip-cache-mtime-checks">
<span class="sig-name descname"><span class="pre">--skip-cache-mtime-checks</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-skip-cache-mtime-checks" title="Permalink to this definition">#</a></dt>
<dd><p>Skip cache internal consistency checks based on mtime.</p>
</dd></dl>

</section>
<section id="advanced-options">
<h4>Advanced options<a class="headerlink" href="#advanced-options" title="Permalink to this headline">#</a></h4>
<p>The following flags are useful mostly for people who are interested
in developing or debugging mypy internals.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-pdb">
<span class="sig-name descname"><span class="pre">--pdb</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-pdb" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will invoke the Python debugger when mypy encounters
a fatal error.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-show-traceback">
<span id="cmdoption-mypy-tb"></span><span class="sig-name descname"><span class="pre">--show-traceback</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--tb</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-show-traceback" title="Permalink to this definition">#</a></dt>
<dd><p>If set, this flag will display a full traceback when mypy
encounters a fatal error.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-raise-exceptions">
<span class="sig-name descname"><span class="pre">--raise-exceptions</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-raise-exceptions" title="Permalink to this definition">#</a></dt>
<dd><p>Raise exception on fatal error.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-custom-typing-module">
<span class="sig-name descname"><span class="pre">--custom-typing-module</span></span><span class="sig-prename descclassname"> <span class="pre">MODULE</span></span><a class="headerlink" href="#cmdoption-mypy-custom-typing-module" title="Permalink to this definition">#</a></dt>
<dd><p>This flag lets you use a custom module as a substitute for the
<a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> module.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-custom-typeshed-dir">
<span class="sig-name descname"><span class="pre">--custom-typeshed-dir</span></span><span class="sig-prename descclassname"> <span class="pre">DIR</span></span><a class="headerlink" href="#cmdoption-mypy-custom-typeshed-dir" title="Permalink to this definition">#</a></dt>
<dd><p>This flag specifies the directory where mypy looks for standard library typeshed
stubs, instead of the typeshed that ships with mypy.  This is
primarily intended to make it easier to test typeshed changes before
submitting them upstream, but also allows you to use a forked version of
typeshed.</p>
<p>Note that this doesn’t affect third-party library stubs. To test third-party stubs,
for example try <code class="docutils literal notranslate"><span class="pre">MYPYPATH=stubs/six</span> <span class="pre">mypy</span> <span class="pre">...</span></code>.</p>
</dd></dl>

<span class="target" id="warn-incomplete-stub"></span><dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-warn-incomplete-stub">
<span class="sig-name descname"><span class="pre">--warn-incomplete-stub</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-warn-incomplete-stub" title="Permalink to this definition">#</a></dt>
<dd><p>This flag modifies both the <a class="reference internal" href="#cmdoption-mypy-disallow-untyped-defs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-untyped-defs</span></code></a> and
<a class="reference internal" href="#cmdoption-mypy-disallow-incomplete-defs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-incomplete-defs</span></code></a> flags so they also report errors
if stubs in typeshed are missing type annotations or has incomplete
annotations. If both flags are missing, <a class="reference internal" href="#cmdoption-mypy-warn-incomplete-stub"><code class="xref std std-option docutils literal notranslate"><span class="pre">--warn-incomplete-stub</span></code></a>
also does nothing.</p>
<p>This flag is mainly intended to be used by people who want contribute
to typeshed and would like a convenient way to find gaps and omissions.</p>
<p>If you want mypy to report an error when your codebase <em>uses</em> an untyped
function, whether that function is defined in typeshed or not, use the
<a class="reference internal" href="#cmdoption-mypy-disallow-untyped-calls"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-untyped-calls</span></code></a> flag. See <a class="reference internal" href="#untyped-definitions-and-calls"><span class="std std-ref">Untyped definitions and calls</span></a>
for more details.</p>
</dd></dl>

<span class="target" id="shadow-file"></span><dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-shadow-file">
<span class="sig-name descname"><span class="pre">--shadow-file</span></span><span class="sig-prename descclassname"> <span class="pre">SOURCE_FILE</span> <span class="pre">SHADOW_FILE</span></span><a class="headerlink" href="#cmdoption-mypy-shadow-file" title="Permalink to this definition">#</a></dt>
<dd><p>When mypy is asked to type check <code class="docutils literal notranslate"><span class="pre">SOURCE_FILE</span></code>, this flag makes mypy
read from and type check the contents of <code class="docutils literal notranslate"><span class="pre">SHADOW_FILE</span></code> instead. However,
diagnostics will continue to refer to <code class="docutils literal notranslate"><span class="pre">SOURCE_FILE</span></code>.</p>
<p>Specifying this argument multiple times (<code class="docutils literal notranslate"><span class="pre">--shadow-file</span> <span class="pre">X1</span> <span class="pre">Y1</span> <span class="pre">--shadow-file</span> <span class="pre">X2</span> <span class="pre">Y2</span></code>)
will allow mypy to perform multiple substitutions.</p>
<p>This allows tooling to create temporary files with helpful modifications
without having to change the source file in place. For example, suppose we
have a pipeline that adds <code class="docutils literal notranslate"><span class="pre">reveal_type</span></code> for certain variables.
This pipeline is run on <code class="docutils literal notranslate"><span class="pre">original.py</span></code> to produce <code class="docutils literal notranslate"><span class="pre">temp.py</span></code>.
Running <code class="docutils literal notranslate"><span class="pre">mypy</span> <span class="pre">--shadow-file</span> <span class="pre">original.py</span> <span class="pre">temp.py</span> <span class="pre">original.py</span></code> will then
cause mypy to type check the contents of <code class="docutils literal notranslate"><span class="pre">temp.py</span></code> instead of  <code class="docutils literal notranslate"><span class="pre">original.py</span></code>,
but error messages will still reference <code class="docutils literal notranslate"><span class="pre">original.py</span></code>.</p>
</dd></dl>

</section>
<section id="report-generation">
<h4>Report generation<a class="headerlink" href="#report-generation" title="Permalink to this headline">#</a></h4>
<p>If these flags are set, mypy will generate a report in the specified
format into the specified directory.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-any-exprs-report">
<span class="sig-name descname"><span class="pre">--any-exprs-report</span></span><span class="sig-prename descclassname"> <span class="pre">DIR</span></span><a class="headerlink" href="#cmdoption-mypy-any-exprs-report" title="Permalink to this definition">#</a></dt>
<dd><p>Causes mypy to generate a text file report documenting how many
expressions of type <code class="docutils literal notranslate"><span class="pre">Any</span></code> are present within your codebase.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-cobertura-xml-report">
<span class="sig-name descname"><span class="pre">--cobertura-xml-report</span></span><span class="sig-prename descclassname"> <span class="pre">DIR</span></span><a class="headerlink" href="#cmdoption-mypy-cobertura-xml-report" title="Permalink to this definition">#</a></dt>
<dd><p>Causes mypy to generate a Cobertura XML type checking coverage report.</p>
<p>To generate this report, you must either manually install the <a class="reference external" href="https://pypi.org/project/lxml/">lxml</a>
library or specify mypy installation with the setuptools extra
<code class="docutils literal notranslate"><span class="pre">mypy[reports]</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-html-report">
<span class="sig-name descname"><span class="pre">--html-report</span></span><span class="sig-prename descclassname"> <span class="pre">/</span> <span class="pre">--xslt-html-report</span> <span class="pre">DIR</span></span><a class="headerlink" href="#cmdoption-mypy-html-report" title="Permalink to this definition">#</a></dt>
<dd><p>Causes mypy to generate an HTML type checking coverage report.</p>
<p>To generate this report, you must either manually install the <a class="reference external" href="https://pypi.org/project/lxml/">lxml</a>
library or specify mypy installation with the setuptools extra
<code class="docutils literal notranslate"><span class="pre">mypy[reports]</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-linecount-report">
<span class="sig-name descname"><span class="pre">--linecount-report</span></span><span class="sig-prename descclassname"> <span class="pre">DIR</span></span><a class="headerlink" href="#cmdoption-mypy-linecount-report" title="Permalink to this definition">#</a></dt>
<dd><p>Causes mypy to generate a text file report documenting the functions
and lines that are typed and untyped within your codebase.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-linecoverage-report">
<span class="sig-name descname"><span class="pre">--linecoverage-report</span></span><span class="sig-prename descclassname"> <span class="pre">DIR</span></span><a class="headerlink" href="#cmdoption-mypy-linecoverage-report" title="Permalink to this definition">#</a></dt>
<dd><p>Causes mypy to generate a JSON file that maps each source file’s
absolute filename to a list of line numbers that belong to typed
functions in that file.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-lineprecision-report">
<span class="sig-name descname"><span class="pre">--lineprecision-report</span></span><span class="sig-prename descclassname"> <span class="pre">DIR</span></span><a class="headerlink" href="#cmdoption-mypy-lineprecision-report" title="Permalink to this definition">#</a></dt>
<dd><p>Causes mypy to generate a flat text file report with per-module
statistics of how many lines are typechecked etc.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-txt-report">
<span class="sig-name descname"><span class="pre">--txt-report</span></span><span class="sig-prename descclassname"> <span class="pre">/</span> <span class="pre">--xslt-txt-report</span> <span class="pre">DIR</span></span><a class="headerlink" href="#cmdoption-mypy-txt-report" title="Permalink to this definition">#</a></dt>
<dd><p>Causes mypy to generate a text file type checking coverage report.</p>
<p>To generate this report, you must either manually install the <a class="reference external" href="https://pypi.org/project/lxml/">lxml</a>
library or specify mypy installation with the setuptools extra
<code class="docutils literal notranslate"><span class="pre">mypy[reports]</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-xml-report">
<span class="sig-name descname"><span class="pre">--xml-report</span></span><span class="sig-prename descclassname"> <span class="pre">DIR</span></span><a class="headerlink" href="#cmdoption-mypy-xml-report" title="Permalink to this definition">#</a></dt>
<dd><p>Causes mypy to generate an XML type checking coverage report.</p>
<p>To generate this report, you must either manually install the <a class="reference external" href="https://pypi.org/project/lxml/">lxml</a>
library or specify mypy installation with the setuptools extra
<code class="docutils literal notranslate"><span class="pre">mypy[reports]</span></code>.</p>
</dd></dl>

</section>
<section id="miscellaneous">
<h4>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">#</a></h4>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-install-types">
<span class="sig-name descname"><span class="pre">--install-types</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-install-types" title="Permalink to this definition">#</a></dt>
<dd><p>This flag causes mypy to install known missing stub packages for
third-party libraries using pip.  It will display the pip command
that will be run, and expects a confirmation before installing
anything. For security reasons, these stubs are limited to only a
small subset of manually selected packages that have been
verified by the typeshed team. These packages include only stub
files and no executable code.</p>
<p>If you use this option without providing any files or modules to
type check, mypy will install stub packages suggested during the
previous mypy run. If there are files or modules to type check,
mypy first type checks those, and proposes to install missing
stubs at the end of the run, but only if any missing modules were
detected.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is new in mypy 0.900. Previous mypy versions included a
selection of third-party package stubs, instead of having
them installed separately.</p>
</div>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-non-interactive">
<span class="sig-name descname"><span class="pre">--non-interactive</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-non-interactive" title="Permalink to this definition">#</a></dt>
<dd><p>When used together with <a class="reference internal" href="#cmdoption-mypy-install-types"><code class="xref std std-option docutils literal notranslate"><span class="pre">--install-types</span></code></a>, this causes mypy to install all suggested stub
packages using pip without asking for confirmation, and then
continues to perform type checking using the installed stubs, if
some files or modules are provided to type check.</p>
<p>This is implemented as up to two mypy runs internally. The first run
is used to find missing stub packages, and output is shown from
this run only if no missing stub packages were found. If missing
stub packages were found, they are installed and then another run
is performed.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-junit-xml">
<span class="sig-name descname"><span class="pre">--junit-xml</span></span><span class="sig-prename descclassname"> <span class="pre">JUNIT_XML</span></span><a class="headerlink" href="#cmdoption-mypy-junit-xml" title="Permalink to this definition">#</a></dt>
<dd><p>Causes mypy to generate a JUnit XML test result document with
type checking results. This can make it easier to integrate mypy
with continuous integration (CI) tools.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-find-occurrences">
<span class="sig-name descname"><span class="pre">--find-occurrences</span></span><span class="sig-prename descclassname"> <span class="pre">CLASS.MEMBER</span></span><a class="headerlink" href="#cmdoption-mypy-find-occurrences" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will make mypy print out all usages of a class member
based on static type information. This feature is experimental.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-mypy-scripts-are-modules">
<span class="sig-name descname"><span class="pre">--scripts-are-modules</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-mypy-scripts-are-modules" title="Permalink to this definition">#</a></dt>
<dd><p>This flag will give command line arguments that appear to be
scripts (i.e. files whose name does not end in <code class="docutils literal notranslate"><span class="pre">.py</span></code>)
a module name derived from the script name rather than the fixed
name <a class="reference external" href="https://docs.python.org/3/library/__main__.html#module-__main__" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">__main__</span></code></a>.</p>
<p>This lets you check more than one script in a single mypy invocation.
(The default <a class="reference external" href="https://docs.python.org/3/library/__main__.html#module-__main__" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">__main__</span></code></a> is technically more correct, but if you
have many scripts that import a large package, the behavior enabled
by this flag is often more convenient.)</p>
</dd></dl>

</section>
</section>
<span id="document-config_file"></span><section id="the-mypy-configuration-file">
<span id="config-file"></span><h3>The mypy configuration file<a class="headerlink" href="#the-mypy-configuration-file" title="Permalink to this headline">#</a></h3>
<p>Mypy supports reading configuration settings from a file with the following precedence order:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">./mypy.ini</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./.mypy.ini</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./pyproject.toml</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">./setup.cfg</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$XDG_CONFIG_HOME/mypy/config</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~/.config/mypy/config</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~/.mypy.ini</span></code></p></li>
</ol>
</div></blockquote>
<p>It is important to understand that there is no merging of configuration
files, as it would lead to ambiguity. The <a class="reference internal" href="index.html#cmdoption-mypy-config-file"><code class="xref std std-option docutils literal notranslate"><span class="pre">--config-file</span></code></a>
command-line flag has the highest precedence and
must be correct; otherwise mypy will report an error and exit. Without the
command line option, mypy will look for configuration files in the
precedence order above.</p>
<p>Most flags correspond closely to <a class="reference internal" href="index.html#command-line"><span class="std std-ref">command-line flags</span></a> but there are some differences in flag names and some
flags may take a different value based on the module being processed.</p>
<p>Some flags support user home directory and environment variable expansion.
To refer to the user home directory, use <code class="docutils literal notranslate"><span class="pre">~</span></code> at the beginning of the path.
To expand environment variables use <code class="docutils literal notranslate"><span class="pre">$VARNAME</span></code> or <code class="docutils literal notranslate"><span class="pre">${VARNAME}</span></code>.</p>
<section id="config-file-format">
<h4>Config file format<a class="headerlink" href="#config-file-format" title="Permalink to this headline">#</a></h4>
<p>The configuration file format is the usual
<a class="reference external" href="https://docs.python.org/3/library/configparser.html" title="(in Python v3.11)"><span class="xref std std-doc">ini file</span></a> format. It should contain
section names in square brackets and flag settings of the form
<cite>NAME = VALUE</cite>. Comments start with <code class="docutils literal notranslate"><span class="pre">#</span></code> characters.</p>
<ul>
<li><p>A section named <code class="docutils literal notranslate"><span class="pre">[mypy]</span></code> must be present.  This specifies
the global flags.</p></li>
<li><p>Additional sections named <code class="docutils literal notranslate"><span class="pre">[mypy-PATTERN1,PATTERN2,...]</span></code> may be
present, where <code class="docutils literal notranslate"><span class="pre">PATTERN1</span></code>, <code class="docutils literal notranslate"><span class="pre">PATTERN2</span></code>, etc., are comma-separated
patterns of fully-qualified module names, with some components optionally
replaced by the ‘*’ character (e.g. <code class="docutils literal notranslate"><span class="pre">foo.bar</span></code>, <code class="docutils literal notranslate"><span class="pre">foo.bar.*</span></code>, <code class="docutils literal notranslate"><span class="pre">foo.*.baz</span></code>).
These sections specify additional flags that only apply to <em>modules</em>
whose name matches at least one of the patterns.</p>
<p>A pattern of the form <code class="docutils literal notranslate"><span class="pre">qualified_module_name</span></code> matches only the named module,
while <code class="docutils literal notranslate"><span class="pre">dotted_module_name.*</span></code> matches <code class="docutils literal notranslate"><span class="pre">dotted_module_name</span></code> and any
submodules (so <code class="docutils literal notranslate"><span class="pre">foo.bar.*</span></code> would match all of <code class="docutils literal notranslate"><span class="pre">foo.bar</span></code>,
<code class="docutils literal notranslate"><span class="pre">foo.bar.baz</span></code>, and <code class="docutils literal notranslate"><span class="pre">foo.bar.baz.quux</span></code>).</p>
<p>Patterns may also be “unstructured” wildcards, in which stars may
appear in the middle of a name (e.g
<code class="docutils literal notranslate"><span class="pre">site.*.migrations.*</span></code>). Stars match zero or more module
components (so <code class="docutils literal notranslate"><span class="pre">site.*.migrations.*</span></code> can match <code class="docutils literal notranslate"><span class="pre">site.migrations</span></code>).</p>
<p id="config-precedence">When options conflict, the precedence order for configuration is:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><a class="reference internal" href="index.html#inline-config"><span class="std std-ref">Inline configuration</span></a> in the source file</p></li>
<li><p>Sections with concrete module names (<code class="docutils literal notranslate"><span class="pre">foo.bar</span></code>)</p></li>
<li><p>Sections with “unstructured” wildcard patterns (<code class="docutils literal notranslate"><span class="pre">foo.*.baz</span></code>),
with sections later in the configuration file overriding
sections earlier.</p></li>
<li><p>Sections with “well-structured” wildcard patterns
(<code class="docutils literal notranslate"><span class="pre">foo.bar.*</span></code>), with more specific overriding more general.</p></li>
<li><p>Command line options.</p></li>
<li><p>Top-level configuration file options.</p></li>
</ol>
</div></blockquote>
</li>
</ul>
<p>The difference in precedence order between “structured” patterns (by
specificity) and “unstructured” patterns (by order in the file) is
unfortunate, and is subject to change in future versions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="#confval-warn_unused_configs"><code class="xref std std-confval docutils literal notranslate"><span class="pre">warn_unused_configs</span></code></a> flag may be useful to debug misspelled
section names.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Configuration flags are liable to change between releases.</p>
</div>
</section>
<section id="per-module-and-global-options">
<h4>Per-module and global options<a class="headerlink" href="#per-module-and-global-options" title="Permalink to this headline">#</a></h4>
<p>Some of the config options may be set either globally (in the <code class="docutils literal notranslate"><span class="pre">[mypy]</span></code> section)
or on a per-module basis (in sections like <code class="docutils literal notranslate"><span class="pre">[mypy-foo.bar]</span></code>).</p>
<p>If you set an option both globally and for a specific module, the module configuration
options take precedence. This lets you set global defaults and override them on a
module-by-module basis. If multiple pattern sections match a module, <a class="reference internal" href="#config-precedence"><span class="std std-ref">the options from the
most specific section are used where they disagree</span></a>.</p>
<p>Some other options, as specified in their description,
may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
</section>
<section id="inverting-option-values">
<h4>Inverting option values<a class="headerlink" href="#inverting-option-values" title="Permalink to this headline">#</a></h4>
<p>Options that take a boolean value may be inverted by adding <code class="docutils literal notranslate"><span class="pre">no_</span></code> to
their name or by (when applicable) swapping their prefix from
<code class="docutils literal notranslate"><span class="pre">disallow</span></code> to <code class="docutils literal notranslate"><span class="pre">allow</span></code> (and vice versa).</p>
</section>
<section id="example-mypy-ini">
<h4>Example <code class="docutils literal notranslate"><span class="pre">mypy.ini</span></code><a class="headerlink" href="#example-mypy-ini" title="Permalink to this headline">#</a></h4>
<p>Here is an example of a <code class="docutils literal notranslate"><span class="pre">mypy.ini</span></code> file. To use this config file, place it at the root
of your repo and run mypy.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># Global options:</span>

<span class="k">[mypy]</span>
<span class="na">warn_return_any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<span class="na">warn_unused_configs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>

<span class="c1"># Per-module options:</span>

<span class="k">[mypy-mycode.foo.*]</span>
<span class="na">disallow_untyped_defs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>

<span class="k">[mypy-mycode.bar]</span>
<span class="na">warn_return_any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>

<span class="k">[mypy-somelibrary]</span>
<span class="na">ignore_missing_imports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
</pre></div>
</div>
<p>This config file specifies two global options in the <code class="docutils literal notranslate"><span class="pre">[mypy]</span></code> section. These two
options will:</p>
<ol class="arabic simple">
<li><p>Report an error whenever a function returns a value that is inferred
to have type <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p></li>
<li><p>Report any config options that are unused by mypy. (This will help us catch typos
when making changes to our config file).</p></li>
</ol>
<p>Next, this module specifies three per-module options. The first two options change how mypy
type checks code in <code class="docutils literal notranslate"><span class="pre">mycode.foo.*</span></code> and <code class="docutils literal notranslate"><span class="pre">mycode.bar</span></code>, which we assume here are two modules
that you wrote. The final config option changes how mypy type checks <code class="docutils literal notranslate"><span class="pre">somelibrary</span></code>, which we
assume here is some 3rd party library you’ve installed and are importing. These options will:</p>
<ol class="arabic simple">
<li><p>Selectively disallow untyped function definitions only within the <code class="docutils literal notranslate"><span class="pre">mycode.foo</span></code>
package – that is, only for function definitions defined in the
<code class="docutils literal notranslate"><span class="pre">mycode/foo</span></code> directory.</p></li>
<li><p>Selectively <em>disable</em> the “function is returning any” warnings within
<code class="docutils literal notranslate"><span class="pre">mycode.bar</span></code> only. This overrides the global default we set earlier.</p></li>
<li><p>Suppress any error messages generated when your codebase tries importing the
module <code class="docutils literal notranslate"><span class="pre">somelibrary</span></code>. This is useful if <code class="docutils literal notranslate"><span class="pre">somelibrary</span></code> is some 3rd party library
missing type hints.</p></li>
</ol>
</section>
<section id="import-discovery">
<span id="config-file-import-discovery"></span><h4>Import discovery<a class="headerlink" href="#import-discovery" title="Permalink to this headline">#</a></h4>
<p>For more information, see the <a class="reference internal" href="index.html#import-discovery"><span class="std std-ref">Import discovery</span></a>
section of the command line docs.</p>
<dl class="std confval">
<dt class="sig sig-object std" id="confval-mypy_path">
<span class="sig-name descname"><span class="pre">mypy_path</span></span><a class="headerlink" href="#confval-mypy_path" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Specifies the paths to use, after trying the paths from <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> environment
variable.  Useful if you’d like to keep stubs in your repo, along with the config file.
Multiple paths are always separated with a <code class="docutils literal notranslate"><span class="pre">:</span></code> or <code class="docutils literal notranslate"><span class="pre">,</span></code> regardless of the platform.
User home directory and environment variables will be expanded.</p>
<p>Relative paths are treated relative to the working directory of the mypy command,
not the config file.
Use the <code class="docutils literal notranslate"><span class="pre">MYPY_CONFIG_FILE_DIR</span></code> environment variable to refer to paths relative to
the config file (e.g. <code class="docutils literal notranslate"><span class="pre">mypy_path</span> <span class="pre">=</span> <span class="pre">$MYPY_CONFIG_FILE_DIR/src</span></code>).</p>
<p>This option may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
<p><strong>Note:</strong> On Windows, use UNC paths to avoid using <code class="docutils literal notranslate"><span class="pre">:</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">\\127.0.0.1\X$\MyDir</span></code> where <code class="docutils literal notranslate"><span class="pre">X</span></code> is the drive letter).</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-files">
<span class="sig-name descname"><span class="pre">files</span></span><a class="headerlink" href="#confval-files" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>comma-separated list of strings</p>
</dd>
</dl>
<p>A comma-separated list of paths which should be checked by mypy if none are given on the command
line. Supports recursive file globbing using <a class="reference external" href="https://docs.python.org/3/library/glob.html#module-glob" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">glob</span></code></a>, where <code class="docutils literal notranslate"><span class="pre">*</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">*.py</span></code>) matches
files in the current directory and <code class="docutils literal notranslate"><span class="pre">**/</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">**/*.py</span></code>) matches files in any directories below
the current one. User home directory and environment variables will be expanded.</p>
<p>This option may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-modules">
<span class="sig-name descname"><span class="pre">modules</span></span><a class="headerlink" href="#confval-modules" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>comma-separated list of strings</p>
</dd>
</dl>
<p>A comma-separated list of packages which should be checked by mypy if none are given on the command
line. Mypy <em>will not</em> recursively type check any submodules of the provided
module.</p>
<p>This option may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-packages">
<span class="sig-name descname"><span class="pre">packages</span></span><a class="headerlink" href="#confval-packages" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>comma-separated list of strings</p>
</dd>
</dl>
<p>A comma-separated list of packages which should be checked by mypy if none are given on the command
line.  Mypy <em>will</em> recursively type check any submodules of the provided
package. This flag is identical to <a class="reference internal" href="#confval-modules"><code class="xref std std-confval docutils literal notranslate"><span class="pre">modules</span></code></a> apart from this
behavior.</p>
<p>This option may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-exclude">
<span class="sig-name descname"><span class="pre">exclude</span></span><a class="headerlink" href="#confval-exclude" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>regular expression</p>
</dd>
</dl>
<p>A regular expression that matches file names, directory names and paths
which mypy should ignore while recursively discovering files to check.
Use forward slashes (<code class="docutils literal notranslate"><span class="pre">/</span></code>) as directory separators on all platforms.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[mypy]</span>
<span class="na">exclude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">(?x)(</span>
<span class="w">    </span><span class="na">^one\.py$    # files named &quot;one.py&quot;</span>
<span class="w">    </span><span class="na">| two\.pyi$  # or files ending with &quot;two.pyi&quot;</span>
<span class="w">    </span><span class="na">| ^three\.   # or files starting with &quot;three.&quot;</span>
<span class="w">  </span><span class="na">)</span>
</pre></div>
</div>
<p>Crafting a single regular expression that excludes multiple files while remaining
human-readable can be a challenge. The above example demonstrates one approach.
<code class="docutils literal notranslate"><span class="pre">(?x)</span></code> enables the <code class="docutils literal notranslate"><span class="pre">VERBOSE</span></code> flag for the subsequent regular expression, which
<a class="reference external" href="https://docs.python.org/3/library/re.html#re.X">ignores most whitespace and supports comments</a>. The above is equivalent to:
<code class="docutils literal notranslate"><span class="pre">(^one\.py$|two\.pyi$|^three\.)</span></code>.</p>
<p>For more details, see <a class="reference internal" href="index.html#cmdoption-mypy-exclude"><code class="xref std std-option docutils literal notranslate"><span class="pre">--exclude</span></code></a>.</p>
<p>This option may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the TOML equivalent differs slightly. It can be either a single string
(including a multi-line string) – which is treated as a single regular
expression – or an array of such strings. The following TOML examples are
equivalent to the above INI example.</p>
<p>Array of strings:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.mypy]</span>
<span class="n">exclude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s">&quot;^one\\.py$&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1"># TOML&#39;s double-quoted strings require escaping backslashes</span>
<span class="w">    </span><span class="s">&#39;two\.pyi$&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1"># but TOML&#39;s single-quoted strings do not</span>
<span class="w">    </span><span class="s">&#39;^three\.&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>A single, multi-line string:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[tool.mypy]</span>
<span class="n">exclude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;&#39;&#39;(?x)(</span>
<span class="s">    ^one\.py$    # files named &quot;one.py&quot;</span>
<span class="s">    | two\.pyi$  # or files ending with &quot;two.pyi&quot;</span>
<span class="s">    | ^three\.   # or files starting with &quot;three.&quot;</span>
<span class="s">)&#39;&#39;&#39;</span><span class="w">  </span><span class="c1"># TOML&#39;s single-quoted strings do not require escaping backslashes</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#using-a-pyproject-toml"><span class="std std-ref">Using a pyproject.toml file</span></a>.</p>
</div>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-namespace_packages">
<span class="sig-name descname"><span class="pre">namespace_packages</span></span><a class="headerlink" href="#confval-namespace_packages" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>True</p>
</dd>
</dl>
<p>Enables <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0420/"><strong>PEP 420</strong></a> style namespace packages.  See the
corresponding flag <a class="reference internal" href="index.html#cmdoption-mypy-no-namespace-packages"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-namespace-packages</span></code></a>
for more information.</p>
<p>This option may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-explicit_package_bases">
<span class="sig-name descname"><span class="pre">explicit_package_bases</span></span><a class="headerlink" href="#confval-explicit_package_bases" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>This flag tells mypy that top-level packages will be based in either the
current directory, or a member of the <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> environment variable or
<a class="reference internal" href="#confval-mypy_path"><code class="xref std std-confval docutils literal notranslate"><span class="pre">mypy_path</span></code></a> config option. This option is only useful in
the absence of <cite>__init__.py</cite>. See <a class="reference internal" href="index.html#mapping-paths-to-modules"><span class="std std-ref">Mapping file
paths to modules</span></a> for details.</p>
<p>This option may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-ignore_missing_imports">
<span class="sig-name descname"><span class="pre">ignore_missing_imports</span></span><a class="headerlink" href="#confval-ignore_missing_imports" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Suppresses error messages about imports that cannot be resolved.</p>
<p>If this option is used in a per-module section, the module name should
match the name of the <em>imported</em> module, not the module containing the
import statement.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-follow_imports">
<span class="sig-name descname"><span class="pre">follow_imports</span></span><a class="headerlink" href="#confval-follow_imports" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">normal</span></code></p>
</dd>
</dl>
<p>Directs what to do with imports when the imported module is found
as a <code class="docutils literal notranslate"><span class="pre">.py</span></code> file and not part of the files, modules and packages
provided on the command line.</p>
<p>The four possible values are <code class="docutils literal notranslate"><span class="pre">normal</span></code>, <code class="docutils literal notranslate"><span class="pre">silent</span></code>, <code class="docutils literal notranslate"><span class="pre">skip</span></code> and
<code class="docutils literal notranslate"><span class="pre">error</span></code>.  For explanations see the discussion for the
<a class="reference internal" href="index.html#cmdoption-mypy-follow-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--follow-imports</span></code></a> command line flag.</p>
<p>Using this option in a per-module section (potentially with a wildcard,
as described at the top of this page) is a good way to prevent mypy from
checking portions of your code.</p>
<p>If this option is used in a per-module section, the module name should
match the name of the <em>imported</em> module, not the module containing the
import statement.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-follow_imports_for_stubs">
<span class="sig-name descname"><span class="pre">follow_imports_for_stubs</span></span><a class="headerlink" href="#confval-follow_imports_for_stubs" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Determines whether to respect the <a class="reference internal" href="#confval-follow_imports"><code class="xref std std-confval docutils literal notranslate"><span class="pre">follow_imports</span></code></a> setting even for
stub (<code class="docutils literal notranslate"><span class="pre">.pyi</span></code>) files.</p>
<p>Used in conjunction with <a class="reference internal" href="#confval-follow_imports"><code class="xref std std-confval docutils literal notranslate"><span class="pre">follow_imports=skip</span></code></a>, this can be used
to suppress the import of a module from <code class="docutils literal notranslate"><span class="pre">typeshed</span></code>, replacing it
with <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p>
<p>Used in conjunction with <a class="reference internal" href="#confval-follow_imports"><code class="xref std std-confval docutils literal notranslate"><span class="pre">follow_imports=error</span></code></a>, this can be used
to make any use of a particular <code class="docutils literal notranslate"><span class="pre">typeshed</span></code> module an error.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is not supported by the mypy daemon.</p>
</div>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-python_executable">
<span class="sig-name descname"><span class="pre">python_executable</span></span><a class="headerlink" href="#confval-python_executable" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Specifies the path to the Python executable to inspect to collect
a list of available <a class="reference internal" href="index.html#installed-packages"><span class="std std-ref">PEP 561 packages</span></a>. User
home directory and environment variables will be expanded. Defaults to
the executable used to run mypy.</p>
<p>This option may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-no_site_packages">
<span class="sig-name descname"><span class="pre">no_site_packages</span></span><a class="headerlink" href="#confval-no_site_packages" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Disables using type information in installed packages (see <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0561/"><strong>PEP 561</strong></a>).
This will also disable searching for a usable Python executable. This acts
the same as <a class="reference internal" href="index.html#cmdoption-mypy-no-site-packages"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-site-packages</span></code></a> command
line flag.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-no_silence_site_packages">
<span class="sig-name descname"><span class="pre">no_silence_site_packages</span></span><a class="headerlink" href="#confval-no_silence_site_packages" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Enables reporting error messages generated within installed packages (see
<span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0561/"><strong>PEP 561</strong></a> for more details on distributing type information). Those error
messages are suppressed by default, since you are usually not able to
control errors in 3rd party code.</p>
<p>This option may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
</dd></dl>

</section>
<section id="platform-configuration">
<h4>Platform configuration<a class="headerlink" href="#platform-configuration" title="Permalink to this headline">#</a></h4>
<dl class="std confval">
<dt class="sig sig-object std" id="confval-python_version">
<span class="sig-name descname"><span class="pre">python_version</span></span><a class="headerlink" href="#confval-python_version" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Specifies the Python version used to parse and check the target
program.  The string should be in the format <code class="docutils literal notranslate"><span class="pre">MAJOR.MINOR</span></code> –
for example <code class="docutils literal notranslate"><span class="pre">2.7</span></code>.  The default is the version of the Python
interpreter used to run mypy.</p>
<p>This option may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-platform">
<span class="sig-name descname"><span class="pre">platform</span></span><a class="headerlink" href="#confval-platform" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Specifies the OS platform for the target program, for example
<code class="docutils literal notranslate"><span class="pre">darwin</span></code> or <code class="docutils literal notranslate"><span class="pre">win32</span></code> (meaning OS X or Windows, respectively).
The default is the current platform as revealed by Python’s
<a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.platform" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.platform</span></code></a> variable.</p>
<p>This option may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-always_true">
<span class="sig-name descname"><span class="pre">always_true</span></span><a class="headerlink" href="#confval-always_true" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>comma-separated list of strings</p>
</dd>
</dl>
<p>Specifies a list of variables that mypy will treat as
compile-time constants that are always true.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-always_false">
<span class="sig-name descname"><span class="pre">always_false</span></span><a class="headerlink" href="#confval-always_false" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>comma-separated list of strings</p>
</dd>
</dl>
<p>Specifies a list of variables that mypy will treat as
compile-time constants that are always false.</p>
</dd></dl>

</section>
<section id="disallow-dynamic-typing">
<h4>Disallow dynamic typing<a class="headerlink" href="#disallow-dynamic-typing" title="Permalink to this headline">#</a></h4>
<p>For more information, see the <a class="reference internal" href="index.html#disallow-dynamic-typing"><span class="std std-ref">Disallow dynamic typing</span></a>
section of the command line docs.</p>
<dl class="std confval">
<dt class="sig sig-object std" id="confval-disallow_any_unimported">
<span class="sig-name descname"><span class="pre">disallow_any_unimported</span></span><a class="headerlink" href="#confval-disallow_any_unimported" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Disallows usage of types that come from unfollowed imports (anything imported from
an unfollowed import is automatically given a type of <code class="docutils literal notranslate"><span class="pre">Any</span></code>).</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-disallow_any_expr">
<span class="sig-name descname"><span class="pre">disallow_any_expr</span></span><a class="headerlink" href="#confval-disallow_any_expr" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Disallows all expressions in the module that have type <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-disallow_any_decorated">
<span class="sig-name descname"><span class="pre">disallow_any_decorated</span></span><a class="headerlink" href="#confval-disallow_any_decorated" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Disallows functions that have <code class="docutils literal notranslate"><span class="pre">Any</span></code> in their signature after decorator transformation.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-disallow_any_explicit">
<span class="sig-name descname"><span class="pre">disallow_any_explicit</span></span><a class="headerlink" href="#confval-disallow_any_explicit" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Disallows explicit <code class="docutils literal notranslate"><span class="pre">Any</span></code> in type positions such as type annotations and generic
type parameters.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-disallow_any_generics">
<span class="sig-name descname"><span class="pre">disallow_any_generics</span></span><a class="headerlink" href="#confval-disallow_any_generics" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Disallows usage of generic types that do not specify explicit type parameters.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-disallow_subclassing_any">
<span class="sig-name descname"><span class="pre">disallow_subclassing_any</span></span><a class="headerlink" href="#confval-disallow_subclassing_any" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Disallows subclassing a value of type <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p>
</dd></dl>

</section>
<section id="untyped-definitions-and-calls">
<h4>Untyped definitions and calls<a class="headerlink" href="#untyped-definitions-and-calls" title="Permalink to this headline">#</a></h4>
<p>For more information, see the <a class="reference internal" href="index.html#untyped-definitions-and-calls"><span class="std std-ref">Untyped definitions and calls</span></a>
section of the command line docs.</p>
<dl class="std confval">
<dt class="sig sig-object std" id="confval-disallow_untyped_calls">
<span class="sig-name descname"><span class="pre">disallow_untyped_calls</span></span><a class="headerlink" href="#confval-disallow_untyped_calls" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Disallows calling functions without type annotations from functions with type
annotations. Note that when used in per-module options, it enables/disables
this check <strong>inside</strong> the module(s) specified, not for functions that come
from that module(s), for example config like this:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[mypy]</span>
<span class="na">disallow_untyped_calls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>

<span class="k">[mypy-some.library.*]</span>
<span class="na">disallow_untyped_calls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>
</pre></div>
</div>
<p>will disable this check inside <code class="docutils literal notranslate"><span class="pre">some.library</span></code>, not for your code that
imports <code class="docutils literal notranslate"><span class="pre">some.library</span></code>. If you want to selectively disable this check for
all your code that imports <code class="docutils literal notranslate"><span class="pre">some.library</span></code> you should instead use
<a class="reference internal" href="#confval-untyped_calls_exclude"><code class="xref std std-confval docutils literal notranslate"><span class="pre">untyped_calls_exclude</span></code></a>, for example:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[mypy]</span>
<span class="na">disallow_untyped_calls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<span class="na">untyped_calls_exclude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">some.library</span>
</pre></div>
</div>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-untyped_calls_exclude">
<span class="sig-name descname"><span class="pre">untyped_calls_exclude</span></span><a class="headerlink" href="#confval-untyped_calls_exclude" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>comma-separated list of strings</p>
</dd>
</dl>
<p>Selectively excludes functions and methods defined in specific packages,
modules, and classes from action of <a class="reference internal" href="#confval-disallow_untyped_calls"><code class="xref std std-confval docutils literal notranslate"><span class="pre">disallow_untyped_calls</span></code></a>.
This also applies to all submodules of packages (i.e. everything inside
a given prefix). Note, this option does not support per-file configuration,
the exclusions list is defined globally for all your code.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-disallow_untyped_defs">
<span class="sig-name descname"><span class="pre">disallow_untyped_defs</span></span><a class="headerlink" href="#confval-disallow_untyped_defs" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Disallows defining functions without type annotations or with incomplete type
annotations (a superset of <a class="reference internal" href="#confval-disallow_incomplete_defs"><code class="xref std std-confval docutils literal notranslate"><span class="pre">disallow_incomplete_defs</span></code></a>).</p>
<p>For example, it would report an error for <code class="code docutils literal notranslate"><span class="pre">def</span> <span class="pre">f(a,</span> <span class="pre">b)</span></code> and <code class="code docutils literal notranslate"><span class="pre">def</span> <span class="pre">f(a:</span> <span class="pre">int,</span> <span class="pre">b)</span></code>.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-disallow_incomplete_defs">
<span class="sig-name descname"><span class="pre">disallow_incomplete_defs</span></span><a class="headerlink" href="#confval-disallow_incomplete_defs" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Disallows defining functions with incomplete type annotations, while still
allowing entirely unannotated definitions.</p>
<p>For example, it would report an error for <code class="code docutils literal notranslate"><span class="pre">def</span> <span class="pre">f(a:</span> <span class="pre">int,</span> <span class="pre">b)</span></code> but not <code class="code docutils literal notranslate"><span class="pre">def</span> <span class="pre">f(a,</span> <span class="pre">b)</span></code>.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-check_untyped_defs">
<span class="sig-name descname"><span class="pre">check_untyped_defs</span></span><a class="headerlink" href="#confval-check_untyped_defs" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Type-checks the interior of functions without type annotations.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-disallow_untyped_decorators">
<span class="sig-name descname"><span class="pre">disallow_untyped_decorators</span></span><a class="headerlink" href="#confval-disallow_untyped_decorators" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Reports an error whenever a function with type annotations is decorated with a
decorator without annotations.</p>
</dd></dl>

</section>
<section id="none-and-optional-handling">
<span id="config-file-none-and-optional-handling"></span><h4>None and Optional handling<a class="headerlink" href="#none-and-optional-handling" title="Permalink to this headline">#</a></h4>
<p>For more information, see the <a class="reference internal" href="index.html#none-and-optional-handling"><span class="std std-ref">None and Optional handling</span></a>
section of the command line docs.</p>
<dl class="std confval">
<dt class="sig sig-object std" id="confval-implicit_optional">
<span class="sig-name descname"><span class="pre">implicit_optional</span></span><a class="headerlink" href="#confval-implicit_optional" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Causes mypy to treat arguments with a <code class="docutils literal notranslate"><span class="pre">None</span></code>
default value as having an implicit <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a> type.</p>
<p><strong>Note:</strong> This was True by default in mypy versions 0.980 and earlier.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-strict_optional">
<span class="sig-name descname"><span class="pre">strict_optional</span></span><a class="headerlink" href="#confval-strict_optional" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>True</p>
</dd>
</dl>
<p>Enables or disables strict Optional checks. If False, mypy treats <code class="docutils literal notranslate"><span class="pre">None</span></code>
as compatible with every type.</p>
<p><strong>Note:</strong> This was False by default in mypy versions earlier than 0.600.</p>
</dd></dl>

</section>
<section id="configuring-warnings">
<h4>Configuring warnings<a class="headerlink" href="#configuring-warnings" title="Permalink to this headline">#</a></h4>
<p>For more information, see the <a class="reference internal" href="index.html#configuring-warnings"><span class="std std-ref">Configuring warnings</span></a>
section of the command line docs.</p>
<dl class="std confval">
<dt class="sig sig-object std" id="confval-warn_redundant_casts">
<span class="sig-name descname"><span class="pre">warn_redundant_casts</span></span><a class="headerlink" href="#confval-warn_redundant_casts" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Warns about casting an expression to its inferred type.</p>
<p>This option may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-warn_unused_ignores">
<span class="sig-name descname"><span class="pre">warn_unused_ignores</span></span><a class="headerlink" href="#confval-warn_unused_ignores" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Warns about unneeded <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comments.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-warn_no_return">
<span class="sig-name descname"><span class="pre">warn_no_return</span></span><a class="headerlink" href="#confval-warn_no_return" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>True</p>
</dd>
</dl>
<p>Shows errors for missing return statements on some execution paths.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-warn_return_any">
<span class="sig-name descname"><span class="pre">warn_return_any</span></span><a class="headerlink" href="#confval-warn_return_any" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Shows a warning when returning a value with type <code class="docutils literal notranslate"><span class="pre">Any</span></code> from a function
declared with a non- <code class="docutils literal notranslate"><span class="pre">Any</span></code> return type.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-warn_unreachable">
<span class="sig-name descname"><span class="pre">warn_unreachable</span></span><a class="headerlink" href="#confval-warn_unreachable" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Shows a warning when encountering any code inferred to be unreachable or
redundant after performing type analysis.</p>
</dd></dl>

</section>
<section id="suppressing-errors">
<h4>Suppressing errors<a class="headerlink" href="#suppressing-errors" title="Permalink to this headline">#</a></h4>
<p>Note: these configuration options are available in the config file only. There is
no analog available via the command line options.</p>
<dl class="std confval">
<dt class="sig sig-object std" id="confval-ignore_errors">
<span class="sig-name descname"><span class="pre">ignore_errors</span></span><a class="headerlink" href="#confval-ignore_errors" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Ignores all non-fatal errors.</p>
</dd></dl>

</section>
<section id="miscellaneous-strictness-flags">
<h4>Miscellaneous strictness flags<a class="headerlink" href="#miscellaneous-strictness-flags" title="Permalink to this headline">#</a></h4>
<p>For more information, see the <a class="reference internal" href="index.html#miscellaneous-strictness-flags"><span class="std std-ref">Miscellaneous strictness flags</span></a>
section of the command line docs.</p>
<dl class="std confval">
<dt class="sig sig-object std" id="confval-allow_untyped_globals">
<span class="sig-name descname"><span class="pre">allow_untyped_globals</span></span><a class="headerlink" href="#confval-allow_untyped_globals" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Causes mypy to suppress errors caused by not being able to fully
infer the types of global and class variables.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-allow_redefinition">
<span class="sig-name descname"><span class="pre">allow_redefinition</span></span><a class="headerlink" href="#confval-allow_redefinition" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Allows variables to be redefined with an arbitrary type, as long as the redefinition
is in the same block and nesting level as the original definition.
Example where this can be useful:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># &#39;items&#39; has type list[str]</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
    <span class="c1"># &#39;items&#39; now has type list[list[str]]</span>
</pre></div>
</div>
<p>The variable must be used before it can be redefined:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
   <span class="n">items</span> <span class="o">=</span> <span class="s2">&quot;mypy&quot;</span>  <span class="c1"># invalid redefinition to str because the variable hasn&#39;t been used yet</span>
   <span class="nb">print</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
   <span class="n">items</span> <span class="o">=</span> <span class="s2">&quot;100&quot;</span>  <span class="c1"># valid, items now has type str</span>
   <span class="n">items</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>  <span class="c1"># valid, items now has type int</span>
</pre></div>
</div>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-local_partial_types">
<span class="sig-name descname"><span class="pre">local_partial_types</span></span><a class="headerlink" href="#confval-local_partial_types" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Disallows inferring variable type for <code class="docutils literal notranslate"><span class="pre">None</span></code> from two assignments in different scopes.
This is always implicitly enabled when using the <a class="reference internal" href="index.html#mypy-daemon"><span class="std std-ref">mypy daemon</span></a>.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-disable_error_code">
<span class="sig-name descname"><span class="pre">disable_error_code</span></span><a class="headerlink" href="#confval-disable_error_code" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>comma-separated list of strings</p>
</dd>
</dl>
<p>Allows disabling one or multiple error codes globally.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-enable_error_code">
<span class="sig-name descname"><span class="pre">enable_error_code</span></span><a class="headerlink" href="#confval-enable_error_code" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>comma-separated list of strings</p>
</dd>
</dl>
<p>Allows enabling one or multiple error codes globally.</p>
<p>Note: This option will override disabled error codes from the disable_error_code option.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-implicit_reexport">
<span class="sig-name descname"><span class="pre">implicit_reexport</span></span><a class="headerlink" href="#confval-implicit_reexport" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>True</p>
</dd>
</dl>
<p>By default, imported values to a module are treated as exported and mypy allows
other modules to import them. When false, mypy will not re-export unless
the item is imported using from-as or is included in <code class="docutils literal notranslate"><span class="pre">__all__</span></code>. Note that mypy
treats stub files as if this is always disabled. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This won&#39;t re-export the value</span>
<span class="kn">from</span> <span class="nn">foo</span> <span class="kn">import</span> <span class="n">bar</span>
<span class="c1"># This will re-export it as bar and allow other modules to import it</span>
<span class="kn">from</span> <span class="nn">foo</span> <span class="kn">import</span> <span class="n">bar</span> <span class="k">as</span> <span class="n">bar</span>
<span class="c1"># This will also re-export bar</span>
<span class="kn">from</span> <span class="nn">foo</span> <span class="kn">import</span> <span class="n">bar</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-strict_concatenate">
<span class="sig-name descname"><span class="pre">strict_concatenate</span></span><a class="headerlink" href="#confval-strict_concatenate" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Make arguments prepended via <code class="docutils literal notranslate"><span class="pre">Concatenate</span></code> be truly positional-only.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-strict_equality">
<span class="sig-name descname"><span class="pre">strict_equality</span></span><a class="headerlink" href="#confval-strict_equality" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
</div></blockquote>
<p>Prohibit equality checks, identity checks, and container checks between
non-overlapping types.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-strict">
<span class="sig-name descname"><span class="pre">strict</span></span><a class="headerlink" href="#confval-strict" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
</div></blockquote>
<p>Enable all optional error checking flags.  You can see the list of
flags enabled by strict mode in the full <a class="reference internal" href="index.html#cmdoption-mypy-h"><code class="xref std std-option docutils literal notranslate"><span class="pre">mypy</span> <span class="pre">--help</span></code></a>
output.</p>
<p>Note: the exact list of flags enabled by <a class="reference internal" href="#confval-strict"><code class="xref std std-confval docutils literal notranslate"><span class="pre">strict</span></code></a> may
change over time.</p>
</dd></dl>

</section>
<section id="configuring-error-messages">
<h4>Configuring error messages<a class="headerlink" href="#configuring-error-messages" title="Permalink to this headline">#</a></h4>
<p>For more information, see the <a class="reference internal" href="index.html#configuring-error-messages"><span class="std std-ref">Configuring error messages</span></a>
section of the command line docs.</p>
<p>These options may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
<dl class="std confval">
<dt class="sig sig-object std" id="confval-show_error_context">
<span class="sig-name descname"><span class="pre">show_error_context</span></span><a class="headerlink" href="#confval-show_error_context" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Prefixes each error with the relevant context.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-show_column_numbers">
<span class="sig-name descname"><span class="pre">show_column_numbers</span></span><a class="headerlink" href="#confval-show_column_numbers" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Shows column numbers in error messages.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-hide_error_codes">
<span class="sig-name descname"><span class="pre">hide_error_codes</span></span><a class="headerlink" href="#confval-hide_error_codes" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Hides error codes in error messages. See <a class="reference internal" href="index.html#error-codes"><span class="std std-ref">Error codes</span></a> for more information.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-pretty">
<span class="sig-name descname"><span class="pre">pretty</span></span><a class="headerlink" href="#confval-pretty" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Use visually nicer output in error messages: use soft word wrap,
show source code snippets, and show error location markers.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-color_output">
<span class="sig-name descname"><span class="pre">color_output</span></span><a class="headerlink" href="#confval-color_output" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>True</p>
</dd>
</dl>
<p>Shows error messages with color enabled.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-error_summary">
<span class="sig-name descname"><span class="pre">error_summary</span></span><a class="headerlink" href="#confval-error_summary" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>True</p>
</dd>
</dl>
<p>Shows a short summary line after error messages.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-show_absolute_path">
<span class="sig-name descname"><span class="pre">show_absolute_path</span></span><a class="headerlink" href="#confval-show_absolute_path" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Show absolute paths to files.</p>
</dd></dl>

</section>
<section id="incremental-mode">
<h4>Incremental mode<a class="headerlink" href="#incremental-mode" title="Permalink to this headline">#</a></h4>
<p>These options may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
<dl class="std confval">
<dt class="sig sig-object std" id="confval-incremental">
<span class="sig-name descname"><span class="pre">incremental</span></span><a class="headerlink" href="#confval-incremental" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>True</p>
</dd>
</dl>
<p>Enables <a class="reference internal" href="index.html#incremental"><span class="std std-ref">incremental mode</span></a>.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-cache_dir">
<span class="sig-name descname"><span class="pre">cache_dir</span></span><a class="headerlink" href="#confval-cache_dir" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">.mypy_cache</span></code></p>
</dd>
</dl>
<p>Specifies the location where mypy stores incremental cache info.
User home directory and environment variables will be expanded.
This setting will be overridden by the <code class="docutils literal notranslate"><span class="pre">MYPY_CACHE_DIR</span></code> environment
variable.</p>
<p>Note that the cache is only read when incremental mode is enabled
but is always written to, unless the value is set to <code class="docutils literal notranslate"><span class="pre">/dev/null</span></code>
(UNIX) or <code class="docutils literal notranslate"><span class="pre">nul</span></code> (Windows).</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-sqlite_cache">
<span class="sig-name descname"><span class="pre">sqlite_cache</span></span><a class="headerlink" href="#confval-sqlite_cache" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Use an <a class="reference external" href="https://www.sqlite.org/">SQLite</a> database to store the cache.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-cache_fine_grained">
<span class="sig-name descname"><span class="pre">cache_fine_grained</span></span><a class="headerlink" href="#confval-cache_fine_grained" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Include fine-grained dependency information in the cache for the mypy daemon.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-skip_version_check">
<span class="sig-name descname"><span class="pre">skip_version_check</span></span><a class="headerlink" href="#confval-skip_version_check" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Makes mypy use incremental cache data even if it was generated by a
different version of mypy. (By default, mypy will perform a version
check and regenerate the cache if it was written by older versions of mypy.)</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-skip_cache_mtime_checks">
<span class="sig-name descname"><span class="pre">skip_cache_mtime_checks</span></span><a class="headerlink" href="#confval-skip_cache_mtime_checks" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Skip cache internal consistency checks based on mtime.</p>
</dd></dl>

</section>
<section id="advanced-options">
<h4>Advanced options<a class="headerlink" href="#advanced-options" title="Permalink to this headline">#</a></h4>
<p>These options may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
<dl class="std confval">
<dt class="sig sig-object std" id="confval-plugins">
<span class="sig-name descname"><span class="pre">plugins</span></span><a class="headerlink" href="#confval-plugins" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>comma-separated list of strings</p>
</dd>
</dl>
<p>A comma-separated list of mypy plugins. See <a class="reference internal" href="index.html#extending-mypy-using-plugins"><span class="std std-ref">Extending mypy using plugins</span></a>.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-pdb">
<span class="sig-name descname"><span class="pre">pdb</span></span><a class="headerlink" href="#confval-pdb" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Invokes <a class="reference external" href="https://docs.python.org/3/library/pdb.html#module-pdb" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pdb</span></code></a> on fatal error.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-show_traceback">
<span class="sig-name descname"><span class="pre">show_traceback</span></span><a class="headerlink" href="#confval-show_traceback" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Shows traceback on fatal error.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-raise_exceptions">
<span class="sig-name descname"><span class="pre">raise_exceptions</span></span><a class="headerlink" href="#confval-raise_exceptions" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Raise exception on fatal error.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-custom_typing_module">
<span class="sig-name descname"><span class="pre">custom_typing_module</span></span><a class="headerlink" href="#confval-custom_typing_module" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Specifies a custom module to use as a substitute for the <a class="reference external" href="https://docs.python.org/3/library/typing.html#module-typing" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">typing</span></code></a> module.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-custom_typeshed_dir">
<span class="sig-name descname"><span class="pre">custom_typeshed_dir</span></span><a class="headerlink" href="#confval-custom_typeshed_dir" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>This specifies the directory where mypy looks for standard library typeshed
stubs, instead of the typeshed that ships with mypy.  This is
primarily intended to make it easier to test typeshed changes before
submitting them upstream, but also allows you to use a forked version of
typeshed.</p>
<p>User home directory and environment variables will be expanded.</p>
<p>Note that this doesn’t affect third-party library stubs. To test third-party stubs,
for example try <code class="docutils literal notranslate"><span class="pre">MYPYPATH=stubs/six</span> <span class="pre">mypy</span> <span class="pre">...</span></code>.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-warn_incomplete_stub">
<span class="sig-name descname"><span class="pre">warn_incomplete_stub</span></span><a class="headerlink" href="#confval-warn_incomplete_stub" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Warns about missing type annotations in typeshed.  This is only relevant
in combination with <a class="reference internal" href="#confval-disallow_untyped_defs"><code class="xref std std-confval docutils literal notranslate"><span class="pre">disallow_untyped_defs</span></code></a> or <a class="reference internal" href="#confval-disallow_incomplete_defs"><code class="xref std std-confval docutils literal notranslate"><span class="pre">disallow_incomplete_defs</span></code></a>.</p>
</dd></dl>

</section>
<section id="report-generation">
<h4>Report generation<a class="headerlink" href="#report-generation" title="Permalink to this headline">#</a></h4>
<p>If these options are set, mypy will generate a report in the specified
format into the specified directory.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Generating reports disables incremental mode and can significantly slow down
your workflow. It is recommended to enable reporting only for specific runs
(e.g. in CI).</p>
</div>
<dl class="std confval">
<dt class="sig sig-object std" id="confval-any_exprs_report">
<span class="sig-name descname"><span class="pre">any_exprs_report</span></span><a class="headerlink" href="#confval-any_exprs_report" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Causes mypy to generate a text file report documenting how many
expressions of type <code class="docutils literal notranslate"><span class="pre">Any</span></code> are present within your codebase.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-cobertura_xml_report">
<span class="sig-name descname"><span class="pre">cobertura_xml_report</span></span><a class="headerlink" href="#confval-cobertura_xml_report" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Causes mypy to generate a Cobertura XML type checking coverage report.</p>
<p>To generate this report, you must either manually install the <a class="reference external" href="https://pypi.org/project/lxml/">lxml</a>
library or specify mypy installation with the setuptools extra
<code class="docutils literal notranslate"><span class="pre">mypy[reports]</span></code>.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-html_report-xslt_html_report">
<span id="confval-html_report / xslt_html_report"></span><span class="sig-name descname"><span class="pre">html_report</span> <span class="pre">/</span> <span class="pre">xslt_html_report</span></span><a class="headerlink" href="#confval-html_report-xslt_html_report" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Causes mypy to generate an HTML type checking coverage report.</p>
<p>To generate this report, you must either manually install the <a class="reference external" href="https://pypi.org/project/lxml/">lxml</a>
library or specify mypy installation with the setuptools extra
<code class="docutils literal notranslate"><span class="pre">mypy[reports]</span></code>.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-linecount_report">
<span class="sig-name descname"><span class="pre">linecount_report</span></span><a class="headerlink" href="#confval-linecount_report" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Causes mypy to generate a text file report documenting the functions
and lines that are typed and untyped within your codebase.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-linecoverage_report">
<span class="sig-name descname"><span class="pre">linecoverage_report</span></span><a class="headerlink" href="#confval-linecoverage_report" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Causes mypy to generate a JSON file that maps each source file’s
absolute filename to a list of line numbers that belong to typed
functions in that file.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-lineprecision_report">
<span class="sig-name descname"><span class="pre">lineprecision_report</span></span><a class="headerlink" href="#confval-lineprecision_report" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Causes mypy to generate a flat text file report with per-module
statistics of how many lines are typechecked etc.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-txt_report-xslt_txt_report">
<span id="confval-txt_report / xslt_txt_report"></span><span class="sig-name descname"><span class="pre">txt_report</span> <span class="pre">/</span> <span class="pre">xslt_txt_report</span></span><a class="headerlink" href="#confval-txt_report-xslt_txt_report" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Causes mypy to generate a text file type checking coverage report.</p>
<p>To generate this report, you must either manually install the <a class="reference external" href="https://pypi.org/project/lxml/">lxml</a>
library or specify mypy installation with the setuptools extra
<code class="docutils literal notranslate"><span class="pre">mypy[reports]</span></code>.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-xml_report">
<span class="sig-name descname"><span class="pre">xml_report</span></span><a class="headerlink" href="#confval-xml_report" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Causes mypy to generate an XML type checking coverage report.</p>
<p>To generate this report, you must either manually install the <a class="reference external" href="https://pypi.org/project/lxml/">lxml</a>
library or specify mypy installation with the setuptools extra
<code class="docutils literal notranslate"><span class="pre">mypy[reports]</span></code>.</p>
</dd></dl>

</section>
<section id="miscellaneous">
<h4>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">#</a></h4>
<p>These options may only be set in the global section (<code class="docutils literal notranslate"><span class="pre">[mypy]</span></code>).</p>
<dl class="std confval">
<dt class="sig sig-object std" id="confval-junit_xml">
<span class="sig-name descname"><span class="pre">junit_xml</span></span><a class="headerlink" href="#confval-junit_xml" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>string</p>
</dd>
</dl>
<p>Causes mypy to generate a JUnit XML test result document with
type checking results. This can make it easier to integrate mypy
with continuous integration (CI) tools.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-scripts_are_modules">
<span class="sig-name descname"><span class="pre">scripts_are_modules</span></span><a class="headerlink" href="#confval-scripts_are_modules" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Makes script <code class="docutils literal notranslate"><span class="pre">x</span></code> become module <code class="docutils literal notranslate"><span class="pre">x</span></code> instead of <code class="docutils literal notranslate"><span class="pre">__main__</span></code>.  This is
useful when checking multiple scripts in a single run.</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-warn_unused_configs">
<span class="sig-name descname"><span class="pre">warn_unused_configs</span></span><a class="headerlink" href="#confval-warn_unused_configs" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>boolean</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>False</p>
</dd>
</dl>
<p>Warns about per-module sections in the config file that do not
match any files processed when invoking mypy.
(This requires turning off incremental mode using <a class="reference internal" href="#confval-incremental"><code class="xref std std-confval docutils literal notranslate"><span class="pre">incremental</span> <span class="pre">=</span> <span class="pre">False</span></code></a>.)</p>
</dd></dl>

<dl class="std confval">
<dt class="sig sig-object std" id="confval-verbosity">
<span class="sig-name descname"><span class="pre">verbosity</span></span><a class="headerlink" href="#confval-verbosity" title="Permalink to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>integer</p>
</dd>
<dt class="field-even">Default</dt>
<dd class="field-even"><p>0</p>
</dd>
</dl>
<p>Controls how much debug output will be generated.  Higher numbers are more verbose.</p>
</dd></dl>

</section>
<section id="using-a-pyproject-toml-file">
<span id="using-a-pyproject-toml"></span><h4>Using a pyproject.toml file<a class="headerlink" href="#using-a-pyproject-toml-file" title="Permalink to this headline">#</a></h4>
<p>Instead of using a <code class="docutils literal notranslate"><span class="pre">mypy.ini</span></code> file, a <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file (as specified by
<a class="reference external" href="https://www.python.org/dev/peps/pep-0518/">PEP 518</a>) may be used instead. A few notes on doing so:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">[mypy]</span></code> section should have <code class="docutils literal notranslate"><span class="pre">tool.</span></code> prepended to its name:</p>
<ul>
<li><p>I.e., <code class="docutils literal notranslate"><span class="pre">[mypy]</span></code> would become <code class="docutils literal notranslate"><span class="pre">[tool.mypy]</span></code></p></li>
</ul>
</li>
<li><p>The module specific sections should be moved into <code class="docutils literal notranslate"><span class="pre">[[tool.mypy.overrides]]</span></code> sections:</p>
<ul>
<li><p>For example, <code class="docutils literal notranslate"><span class="pre">[mypy-packagename]</span></code> would become:</p></li>
</ul>
</li>
</ul>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[tool.mypy.overrides]]</span>
<span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;packagename&#39;</span>
<span class="p">...</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Multi-module specific sections can be moved into a single <code class="docutils literal notranslate"><span class="pre">[[tool.mypy.overrides]]</span></code> section with a
module property set to an array of modules:</p>
<ul>
<li><p>For example, <code class="docutils literal notranslate"><span class="pre">[mypy-packagename,packagename2]</span></code> would become:</p></li>
</ul>
</li>
</ul>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[[tool.mypy.overrides]]</span>
<span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s">&#39;packagename&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&#39;packagename2&#39;</span>
<span class="p">]</span>
<span class="p">...</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The following care should be given to values in the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> files as compared to <code class="docutils literal notranslate"><span class="pre">ini</span></code> files:</p>
<ul>
<li><p>Strings must be wrapped in double quotes, or single quotes if the string contains special characters</p></li>
<li><p>Boolean values should be all lower case</p></li>
</ul>
</li>
</ul>
<p>Please see the <a class="reference external" href="https://toml.io/">TOML Documentation</a> for more details and information on
what is allowed in a <code class="docutils literal notranslate"><span class="pre">toml</span></code> file. See <a class="reference external" href="https://www.python.org/dev/peps/pep-0518/">PEP 518</a> for more information on the layout
and structure of the <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file.</p>
</section>
<section id="example-pyproject-toml">
<h4>Example <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code><a class="headerlink" href="#example-pyproject-toml" title="Permalink to this headline">#</a></h4>
<p>Here is an example of a <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file. To use this config file, place it at the root
of your repo (or append it to the end of an existing <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> file) and run mypy.</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy global options:</span>

<span class="k">[tool.mypy]</span>
<span class="n">python_version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2.7&quot;</span>
<span class="n">warn_return_any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="n">warn_unused_configs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="n">exclude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s">&#39;^file1\.py$&#39;</span><span class="p">,</span><span class="w">  </span><span class="c1"># TOML literal string (single-quotes, no escaping necessary)</span>
<span class="w">    </span><span class="s">&quot;^file2\\.py$&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1"># TOML basic string (double-quotes, backslash and other characters need escaping)</span>
<span class="p">]</span>

<span class="c1"># mypy per-module options:</span>

<span class="k">[[tool.mypy.overrides]]</span>
<span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mycode.foo.*&quot;</span>
<span class="n">disallow_untyped_defs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>

<span class="k">[[tool.mypy.overrides]]</span>
<span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mycode.bar&quot;</span>
<span class="n">warn_return_any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>

<span class="k">[[tool.mypy.overrides]]</span>
<span class="n">module</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s">&quot;somelibrary&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;some_other_library&quot;</span>
<span class="p">]</span>
<span class="n">ignore_missing_imports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</pre></div>
</div>
</section>
</section>
<span id="document-inline_config"></span><section id="inline-configuration">
<span id="inline-config"></span><h3>Inline configuration<a class="headerlink" href="#inline-configuration" title="Permalink to this headline">#</a></h3>
<p>Mypy supports setting per-file configuration options inside files themselves
using <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">mypy:</span></code> comments. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: disallow-any-generics</span>
</pre></div>
</div>
<p>Inline configuration comments take precedence over all other
configuration mechanisms.</p>
<section id="configuration-comment-format">
<h4>Configuration comment format<a class="headerlink" href="#configuration-comment-format" title="Permalink to this headline">#</a></h4>
<p>Flags correspond to <a class="reference internal" href="index.html#config-file"><span class="std std-ref">config file flags</span></a> but allow
hyphens to be substituted for underscores.</p>
<p>Values are specified using <code class="docutils literal notranslate"><span class="pre">=</span></code>, but <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">True</span></code> may be omitted:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: disallow-any-generics</span>
<span class="c1"># mypy: always-true=FOO</span>
</pre></div>
</div>
<p>Multiple flags can be separated by commas or placed on separate
lines. To include a comma as part of an option’s value, place the
value inside quotes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: disallow-untyped-defs, always-false=&quot;FOO,BAR&quot;</span>
</pre></div>
</div>
<p>Like in the configuration file, options that take a boolean value may be
inverted by adding <code class="docutils literal notranslate"><span class="pre">no-</span></code> to their name or by (when applicable)
swapping their prefix from <code class="docutils literal notranslate"><span class="pre">disallow</span></code> to <code class="docutils literal notranslate"><span class="pre">allow</span></code> (and vice versa):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: allow-untyped-defs, no-strict-optional</span>
</pre></div>
</div>
</section>
</section>
<span id="document-mypy_daemon"></span><section id="mypy-daemon-mypy-server">
<span id="mypy-daemon"></span><h3>Mypy daemon (mypy server)<a class="headerlink" href="#mypy-daemon-mypy-server" title="Permalink to this headline">#</a></h3>
<p>Instead of running mypy as a command-line tool, you can also run it as
a long-running daemon (server) process and use a command-line client to
send type-checking requests to the server.  This way mypy can perform type
checking much faster, since program state cached from previous runs is kept
in memory and doesn’t have to be read from the file system on each run.
The server also uses finer-grained dependency tracking to reduce the amount
of work that needs to be done.</p>
<p>If you have a large codebase to check, running mypy using the mypy
daemon can be <em>10 or more times faster</em> than the regular command-line
<code class="docutils literal notranslate"><span class="pre">mypy</span></code> tool, especially if your workflow involves running mypy
repeatedly after small edits – which is often a good idea, as this way
you’ll find errors sooner.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The command-line interface of mypy daemon may change in future mypy
releases.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each mypy daemon process supports one user and one set of source files,
and it can only process one type checking request at a time. You can
run multiple mypy daemon processes to type check multiple repositories.</p>
</div>
<section id="basic-usage">
<h4>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline">#</a></h4>
<p>The client utility <code class="docutils literal notranslate"><span class="pre">dmypy</span></code> is used to control the mypy daemon.
Use <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">run</span> <span class="pre">--</span> <span class="pre">&lt;flags&gt;</span> <span class="pre">&lt;files&gt;</span></code> to type check a set of files
(or directories). This will launch the daemon if it is not running.
You can use almost arbitrary mypy flags after <code class="docutils literal notranslate"><span class="pre">--</span></code>.  The daemon
will always run on the current host. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dmypy</span> <span class="n">run</span> <span class="o">--</span> <span class="n">prog</span><span class="o">.</span><span class="n">py</span> <span class="n">pkg</span><span class="o">/*.</span><span class="n">py</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">run</span></code> will automatically restart the daemon if the
configuration or mypy version changes.</p>
<p>The initial run will process all the code and may take a while to
finish, but subsequent runs will be quick, especially if you’ve only
changed a few files. (You can use <a class="reference internal" href="index.html#remote-cache"><span class="std std-ref">remote caching</span></a>
to speed up the initial run. The speedup can be significant if
you have a large codebase.)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Mypy 0.780 added support for following imports in dmypy (enabled by
default). This functionality is still experimental. You can use
<code class="docutils literal notranslate"><span class="pre">--follow-imports=skip</span></code> or <code class="docutils literal notranslate"><span class="pre">--follow-imports=error</span></code> to fall
back to the stable functionality.  See <a class="reference internal" href="index.html#follow-imports"><span class="std std-ref">Following imports</span></a> for
details on how these work.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The mypy daemon automatically enables <code class="docutils literal notranslate"><span class="pre">--local-partial-types</span></code> by default.</p>
</div>
</section>
<section id="daemon-client-commands">
<h4>Daemon client commands<a class="headerlink" href="#daemon-client-commands" title="Permalink to this headline">#</a></h4>
<p>While <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">run</span></code> is sufficient for most uses, some workflows
(ones using <a class="reference internal" href="index.html#remote-cache"><span class="std std-ref">remote caching</span></a>, perhaps),
require more precise control over the lifetime of the daemon process:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">stop</span></code> stops the daemon.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">start</span> <span class="pre">--</span> <span class="pre">&lt;flags&gt;</span></code> starts the daemon but does not check any files.
You can use almost arbitrary mypy flags after <code class="docutils literal notranslate"><span class="pre">--</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">restart</span> <span class="pre">--</span> <span class="pre">&lt;flags&gt;</span></code> restarts the daemon. The flags are the same
as with <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">start</span></code>. This is equivalent to a stop command followed
by a start.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">run</span> <span class="pre">--timeout</span> <span class="pre">SECONDS</span> <span class="pre">--</span> <span class="pre">&lt;flags&gt;</span></code> (or
<code class="docutils literal notranslate"><span class="pre">start</span></code> or <code class="docutils literal notranslate"><span class="pre">restart</span></code>) to automatically
shut down the daemon after inactivity. By default, the daemon runs
until it’s explicitly stopped.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">check</span> <span class="pre">&lt;files&gt;</span></code> checks a set of files using an already
running daemon.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">recheck</span></code> checks the same set of files as the most recent
<code class="docutils literal notranslate"><span class="pre">check</span></code> or <code class="docutils literal notranslate"><span class="pre">recheck</span></code> command. (You can also use the <a class="reference internal" href="#cmdoption-dmypy-update"><code class="xref std std-option docutils literal notranslate"><span class="pre">--update</span></code></a>
and <a class="reference internal" href="#cmdoption-dmypy-remove"><code class="xref std std-option docutils literal notranslate"><span class="pre">--remove</span></code></a> options to alter the set of files, and to define
which files should be processed.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">status</span></code> checks whether a daemon is running. It prints a
diagnostic and exits with <code class="docutils literal notranslate"><span class="pre">0</span></code> if there is a running daemon.</p></li>
</ul>
<p>Use <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">--help</span></code> for help on additional commands and command-line
options not discussed here, and <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">&lt;command&gt;</span> <span class="pre">--help</span></code> for help on
command-specific options.</p>
</section>
<section id="additional-daemon-flags">
<h4>Additional daemon flags<a class="headerlink" href="#additional-daemon-flags" title="Permalink to this headline">#</a></h4>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-status-file">
<span class="sig-name descname"><span class="pre">--status-file</span></span><span class="sig-prename descclassname"> <span class="pre">FILE</span></span><a class="headerlink" href="#cmdoption-dmypy-status-file" title="Permalink to this definition">#</a></dt>
<dd><p>Use <code class="docutils literal notranslate"><span class="pre">FILE</span></code> as the status file for storing daemon runtime state. This is
normally a JSON file that contains information about daemon process and
connection. The default path is <code class="docutils literal notranslate"><span class="pre">.dmypy.json</span></code> in the current working
directory.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-log-file">
<span class="sig-name descname"><span class="pre">--log-file</span></span><span class="sig-prename descclassname"> <span class="pre">FILE</span></span><a class="headerlink" href="#cmdoption-dmypy-log-file" title="Permalink to this definition">#</a></dt>
<dd><p>Direct daemon stdout/stderr to <code class="docutils literal notranslate"><span class="pre">FILE</span></code>. This is useful for debugging daemon
crashes, since the server traceback is not always printed by the client.
This is available for the <code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">restart</span></code>, and <code class="docutils literal notranslate"><span class="pre">run</span></code> commands.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-timeout">
<span class="sig-name descname"><span class="pre">--timeout</span></span><span class="sig-prename descclassname"> <span class="pre">TIMEOUT</span></span><a class="headerlink" href="#cmdoption-dmypy-timeout" title="Permalink to this definition">#</a></dt>
<dd><p>Automatically shut down server after <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code> seconds of inactivity.
This is available for the <code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">restart</span></code>, and <code class="docutils literal notranslate"><span class="pre">run</span></code> commands.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-update">
<span class="sig-name descname"><span class="pre">--update</span></span><span class="sig-prename descclassname"> <span class="pre">FILE</span></span><a class="headerlink" href="#cmdoption-dmypy-update" title="Permalink to this definition">#</a></dt>
<dd><p>Re-check <code class="docutils literal notranslate"><span class="pre">FILE</span></code>, or add it to the set of files being
checked (and check it). This option may be repeated, and it’s only available for
the <code class="docutils literal notranslate"><span class="pre">recheck</span></code> command.  By default, mypy finds and checks all files changed
since the previous run and files that depend on them.  However, if you use this option
(and/or <a class="reference internal" href="#cmdoption-dmypy-remove"><code class="xref std std-option docutils literal notranslate"><span class="pre">--remove</span></code></a>), mypy assumes that only the explicitly
specified files have changed. This is only useful to
speed up mypy if you type check a very large number of files, and use an
external, fast file system watcher, such as <a class="reference external" href="https://facebook.github.io/watchman/">watchman</a> or
<a class="reference external" href="https://pypi.org/project/watchdog/">watchdog</a>, to determine which files got edited or deleted.
<em>Note:</em> This option is never required and is only available for
performance tuning.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-remove">
<span class="sig-name descname"><span class="pre">--remove</span></span><span class="sig-prename descclassname"> <span class="pre">FILE</span></span><a class="headerlink" href="#cmdoption-dmypy-remove" title="Permalink to this definition">#</a></dt>
<dd><p>Remove <code class="docutils literal notranslate"><span class="pre">FILE</span></code> from the set of files being checked. This option may be
repeated. This is only available for the
<code class="docutils literal notranslate"><span class="pre">recheck</span></code> command. See <a class="reference internal" href="#cmdoption-dmypy-update"><code class="xref std std-option docutils literal notranslate"><span class="pre">--update</span></code></a> above for when this may be useful.
<em>Note:</em> This option is never required and is only available for performance
tuning.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-fswatcher-dump-file">
<span class="sig-name descname"><span class="pre">--fswatcher-dump-file</span></span><span class="sig-prename descclassname"> <span class="pre">FILE</span></span><a class="headerlink" href="#cmdoption-dmypy-fswatcher-dump-file" title="Permalink to this definition">#</a></dt>
<dd><p>Collect information about the current internal file state. This is
only available for the <code class="docutils literal notranslate"><span class="pre">status</span></code> command. This will dump JSON to
<code class="docutils literal notranslate"><span class="pre">FILE</span></code> in the format <code class="docutils literal notranslate"><span class="pre">{path:</span> <span class="pre">[modification_time,</span> <span class="pre">size,</span>
<span class="pre">content_hash]}</span></code>. This is useful for debugging the built-in file
system watcher. <em>Note:</em> This is an internal flag and the format may
change.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-perf-stats-file">
<span class="sig-name descname"><span class="pre">--perf-stats-file</span></span><span class="sig-prename descclassname"> <span class="pre">FILE</span></span><a class="headerlink" href="#cmdoption-dmypy-perf-stats-file" title="Permalink to this definition">#</a></dt>
<dd><p>Write performance profiling information to <code class="docutils literal notranslate"><span class="pre">FILE</span></code>. This is only available
for the <code class="docutils literal notranslate"><span class="pre">check</span></code>, <code class="docutils literal notranslate"><span class="pre">recheck</span></code>, and <code class="docutils literal notranslate"><span class="pre">run</span></code> commands.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-export-types">
<span class="sig-name descname"><span class="pre">--export-types</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dmypy-export-types" title="Permalink to this definition">#</a></dt>
<dd><p>Store all expression types in memory for future use. This is useful to speed
up future calls to <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">inspect</span></code> (but uses more memory). Only valid for
<code class="docutils literal notranslate"><span class="pre">check</span></code>, <code class="docutils literal notranslate"><span class="pre">recheck</span></code>, and <code class="docutils literal notranslate"><span class="pre">run</span></code> command.</p>
</dd></dl>

</section>
<section id="static-inference-of-annotations">
<h4>Static inference of annotations<a class="headerlink" href="#static-inference-of-annotations" title="Permalink to this headline">#</a></h4>
<p>The mypy daemon supports (as an experimental feature) statically inferring
draft function and method type annotations. Use <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">suggest</span> <span class="pre">FUNCTION</span></code> to
generate a draft signature in the format
<code class="docutils literal notranslate"><span class="pre">(param_type_1,</span> <span class="pre">param_type_2,</span> <span class="pre">...)</span> <span class="pre">-&gt;</span> <span class="pre">ret_type</span></code> (types are included for all
arguments, including keyword-only arguments, <code class="docutils literal notranslate"><span class="pre">*args</span></code> and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>).</p>
<p>This is a low-level feature intended to be used by editor integrations,
IDEs, and other tools (for example, the <a class="reference external" href="https://github.com/dropbox/mypy-PyCharm-plugin">mypy plugin for PyCharm</a>),
to automatically add annotations to source files, or to propose function
signatures.</p>
<p>In this example, the function <code class="docutils literal notranslate"><span class="pre">format_id()</span></code> has no annotation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">format_id</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;User: </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">format_id</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">suggest</span></code> uses call sites, return statements, and other heuristics (such as
looking for signatures in base classes) to infer that <code class="docutils literal notranslate"><span class="pre">format_id()</span></code> accepts
an <code class="docutils literal notranslate"><span class="pre">int</span></code> argument and returns a <code class="docutils literal notranslate"><span class="pre">str</span></code>. Use <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">suggest</span> <span class="pre">module.format_id</span></code> to
print the suggested signature for the function.</p>
<p>More generally, the target function may be specified in two ways:</p>
<ul class="simple">
<li><p>By its fully qualified name, i.e. <code class="docutils literal notranslate"><span class="pre">[package.]module.[class.]function</span></code>.</p></li>
<li><p>By its location in a source file, i.e. <code class="docutils literal notranslate"><span class="pre">/path/to/file.py:line</span></code>. The path can be
absolute or relative, and <code class="docutils literal notranslate"><span class="pre">line</span></code> can refer to any line number within
the function body.</p></li>
</ul>
<p>This command can also be used to find a more precise alternative for an existing,
imprecise annotation with some <code class="docutils literal notranslate"><span class="pre">Any</span></code> types.</p>
<p>The following flags customize various aspects of the <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">suggest</span></code>
command.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-json">
<span class="sig-name descname"><span class="pre">--json</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dmypy-json" title="Permalink to this definition">#</a></dt>
<dd><p>Output the signature as JSON, so that <a class="reference external" href="https://github.com/dropbox/pyannotate">PyAnnotate</a> can read it and add
the signature to the source file. Here is what the JSON looks like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="s2">&quot;func_name&quot;</span><span class="p">:</span> <span class="s2">&quot;example.format_id&quot;</span><span class="p">,</span>
  <span class="s2">&quot;line&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/absolute/path/to/example.py&quot;</span><span class="p">,</span>
  <span class="s2">&quot;samples&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;signature&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;arg_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;int&quot;</span><span class="p">],</span> <span class="s2">&quot;return_type&quot;</span><span class="p">:</span> <span class="s2">&quot;str&quot;</span><span class="p">}}]</span>
</pre></div>
</div>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-no-errors">
<span class="sig-name descname"><span class="pre">--no-errors</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dmypy-no-errors" title="Permalink to this definition">#</a></dt>
<dd><p>Only produce suggestions that cause no errors in the checked code. By default,
mypy will try to find the most precise type, even if it causes some type errors.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-no-any">
<span class="sig-name descname"><span class="pre">--no-any</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dmypy-no-any" title="Permalink to this definition">#</a></dt>
<dd><p>Only produce suggestions that don’t contain <code class="docutils literal notranslate"><span class="pre">Any</span></code> types. By default mypy
proposes the most precise signature found, even if it contains <code class="docutils literal notranslate"><span class="pre">Any</span></code> types.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-flex-any">
<span class="sig-name descname"><span class="pre">--flex-any</span></span><span class="sig-prename descclassname"> <span class="pre">FRACTION</span></span><a class="headerlink" href="#cmdoption-dmypy-flex-any" title="Permalink to this definition">#</a></dt>
<dd><p>Only allow some fraction of types in the suggested signature to be <code class="docutils literal notranslate"><span class="pre">Any</span></code> types.
The fraction ranges from <code class="docutils literal notranslate"><span class="pre">0</span></code> (same as <code class="docutils literal notranslate"><span class="pre">--no-any</span></code>) to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-callsites">
<span class="sig-name descname"><span class="pre">--callsites</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dmypy-callsites" title="Permalink to this definition">#</a></dt>
<dd><p>Only find call sites for a given function instead of suggesting a type.
This will produce a list with line numbers and types of actual
arguments for each call: <code class="docutils literal notranslate"><span class="pre">/path/to/file.py:line:</span> <span class="pre">(arg_type_1,</span> <span class="pre">arg_type_2,</span> <span class="pre">...)</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-use-fixme">
<span class="sig-name descname"><span class="pre">--use-fixme</span></span><span class="sig-prename descclassname"> <span class="pre">NAME</span></span><a class="headerlink" href="#cmdoption-dmypy-use-fixme" title="Permalink to this definition">#</a></dt>
<dd><p>Use a dummy name instead of plain <code class="docutils literal notranslate"><span class="pre">Any</span></code> for types that cannot
be inferred. This may be useful to emphasize to a user that a given type
couldn’t be inferred and needs to be entered manually.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-max-guesses">
<span class="sig-name descname"><span class="pre">--max-guesses</span></span><span class="sig-prename descclassname"> <span class="pre">NUMBER</span></span><a class="headerlink" href="#cmdoption-dmypy-max-guesses" title="Permalink to this definition">#</a></dt>
<dd><p>Set the maximum number of types to try for a function (default: <code class="docutils literal notranslate"><span class="pre">64</span></code>).</p>
</dd></dl>

</section>
<section id="statically-inspect-expressions">
<h4>Statically inspect expressions<a class="headerlink" href="#statically-inspect-expressions" title="Permalink to this headline">#</a></h4>
<p>The daemon allows to get declared or inferred type of an expression (or other
information about an expression, such as known attributes or definition location)
using <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">inspect</span> <span class="pre">LOCATION</span></code> command. The location of the expression should be
specified in the format <code class="docutils literal notranslate"><span class="pre">path/to/file.py:line:column[:end_line:end_column]</span></code>.
Both line and column are 1-based. Both start and end position are inclusive.
These rules match how mypy prints the error location in error messages.</p>
<p>If a span is given (i.e. all 4 numbers), then only an exactly matching expression
is inspected. If only a position is given (i.e. 2 numbers, line and column), mypy
will inspect all <em>expressions</em>, that include this position, starting from the
innermost one.</p>
<p>Consider this Python code snippet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">longer_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">x</span>
    <span class="n">longer_name</span>
</pre></div>
</div>
<p>Here to find the type of <code class="docutils literal notranslate"><span class="pre">x</span></code> one needs to call <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">inspect</span> <span class="pre">src.py:2:5:2:5</span></code>
or <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">inspect</span> <span class="pre">src.py:2:5</span></code>. While for <code class="docutils literal notranslate"><span class="pre">longer_name</span></code> one needs to call
<code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">inspect</span> <span class="pre">src.py:3:5:3:15</span></code> or, for example, <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">inspect</span> <span class="pre">src.py:3:10</span></code>.
Please note that this command is only valid after daemon had a successful type
check (without parse errors), so that types are populated, e.g. using
<code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">check</span></code>. In case where multiple expressions match the provided location,
their types are returned separated by a newline.</p>
<p>Important note: it is recommended to check files with <a class="reference internal" href="#cmdoption-dmypy-export-types"><code class="xref std std-option docutils literal notranslate"><span class="pre">--export-types</span></code></a>
since otherwise most inspections will not work without <a class="reference internal" href="#cmdoption-dmypy-force-reload"><code class="xref std std-option docutils literal notranslate"><span class="pre">--force-reload</span></code></a>.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-show">
<span class="sig-name descname"><span class="pre">--show</span></span><span class="sig-prename descclassname"> <span class="pre">INSPECTION</span></span><a class="headerlink" href="#cmdoption-dmypy-show" title="Permalink to this definition">#</a></dt>
<dd><p>What kind of inspection to run for expression(s) found. Currently the supported
inspections are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code> (default): Show the best known type of a given expression.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attrs</span></code>: Show which attributes are valid for an expression (e.g. for
auto-completion). Format is <code class="docutils literal notranslate"><span class="pre">{&quot;Base1&quot;:</span> <span class="pre">[&quot;name_1&quot;,</span> <span class="pre">&quot;name_2&quot;,</span> <span class="pre">...];</span> <span class="pre">&quot;Base2&quot;:</span> <span class="pre">...}</span></code>.
Names are sorted by method resolution order. If expression refers to a module,
then module attributes will be under key like <code class="docutils literal notranslate"><span class="pre">&quot;&lt;full.module.name&gt;&quot;</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">definition</span></code> (experimental): Show the definition location for a name
expression or member expression. Format is <code class="docutils literal notranslate"><span class="pre">path/to/file.py:line:column:Symbol</span></code>.
If multiple definitions are found (e.g. for a Union attribute), they are
separated by comma.</p></li>
</ul>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-verbose">
<span class="sig-name descname"><span class="pre">--verbose</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dmypy-verbose" title="Permalink to this definition">#</a></dt>
<dd><p>Increase verbosity of types string representation (can be repeated).
For example, this will print fully qualified names of instance types (like
<code class="docutils literal notranslate"><span class="pre">&quot;builtins.str&quot;</span></code>), instead of just a short name (like <code class="docutils literal notranslate"><span class="pre">&quot;str&quot;</span></code>).</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-limit">
<span class="sig-name descname"><span class="pre">--limit</span></span><span class="sig-prename descclassname"> <span class="pre">NUM</span></span><a class="headerlink" href="#cmdoption-dmypy-limit" title="Permalink to this definition">#</a></dt>
<dd><p>If the location is given as <code class="docutils literal notranslate"><span class="pre">line:column</span></code>, this will cause daemon to
return only at most <code class="docutils literal notranslate"><span class="pre">NUM</span></code> inspections of innermost expressions.
Value of 0 means no limit (this is the default). For example, if one calls
<code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">inspect</span> <span class="pre">src.py:4:10</span> <span class="pre">--limit=1</span></code> with this code</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">..</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
<span class="n">baz</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">bar</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="n">baz</span><span class="p">))</span>
</pre></div>
</div>
<p>This will output just one type <code class="docutils literal notranslate"><span class="pre">&quot;int&quot;</span></code> (for <code class="docutils literal notranslate"><span class="pre">baz</span></code> name expression).
While without the limit option, it would output all three types: <code class="docutils literal notranslate"><span class="pre">&quot;int&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;str&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;None&quot;</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-include-span">
<span class="sig-name descname"><span class="pre">--include-span</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dmypy-include-span" title="Permalink to this definition">#</a></dt>
<dd><p>With this option on, the daemon will prepend each inspection result with
the full span of corresponding expression, formatted as <code class="docutils literal notranslate"><span class="pre">1:2:1:4</span> <span class="pre">-&gt;</span> <span class="pre">&quot;int&quot;</span></code>.
This may be useful in case multiple expressions match a location.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-include-kind">
<span class="sig-name descname"><span class="pre">--include-kind</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dmypy-include-kind" title="Permalink to this definition">#</a></dt>
<dd><p>With this option on, the daemon will prepend each inspection result with
the kind of corresponding expression, formatted as <code class="docutils literal notranslate"><span class="pre">NameExpr</span> <span class="pre">-&gt;</span> <span class="pre">&quot;int&quot;</span></code>.
If both this option and <a class="reference internal" href="#cmdoption-dmypy-include-span"><code class="xref std std-option docutils literal notranslate"><span class="pre">--include-span</span></code></a> are on, the kind will
appear first, for example <code class="docutils literal notranslate"><span class="pre">NameExpr:1:2:1:4</span> <span class="pre">-&gt;</span> <span class="pre">&quot;int&quot;</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-include-object-attrs">
<span class="sig-name descname"><span class="pre">--include-object-attrs</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dmypy-include-object-attrs" title="Permalink to this definition">#</a></dt>
<dd><p>This will make the daemon include attributes of <code class="docutils literal notranslate"><span class="pre">object</span></code> (excluded by
default) in case of an <code class="docutils literal notranslate"><span class="pre">atts</span></code> inspection.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-union-attrs">
<span class="sig-name descname"><span class="pre">--union-attrs</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dmypy-union-attrs" title="Permalink to this definition">#</a></dt>
<dd><p>Include attributes valid for some of possible expression types (by default
an intersection is returned). This is useful for union types of type variables
with values. For example, with this code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">int</span>
<span class="k">class</span> <span class="nc">B</span><span class="p">:</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">int</span>
<span class="n">var</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">]</span>
<span class="n">var</span>
</pre></div>
</div>
<p>The command <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">inspect</span> <span class="pre">--show</span> <span class="pre">attrs</span> <span class="pre">src.py:10:1</span></code> will return
<code class="docutils literal notranslate"><span class="pre">{&quot;A&quot;:</span> <span class="pre">[&quot;z&quot;],</span> <span class="pre">&quot;B&quot;:</span> <span class="pre">[&quot;z&quot;]}</span></code>, while with <code class="docutils literal notranslate"><span class="pre">--union-attrs</span></code> it will return
<code class="docutils literal notranslate"><span class="pre">{&quot;A&quot;:</span> <span class="pre">[&quot;x&quot;,</span> <span class="pre">&quot;z&quot;],</span> <span class="pre">&quot;B&quot;:</span> <span class="pre">[&quot;y&quot;,</span> <span class="pre">&quot;z&quot;]}</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-dmypy-force-reload">
<span class="sig-name descname"><span class="pre">--force-reload</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-dmypy-force-reload" title="Permalink to this definition">#</a></dt>
<dd><p>Force re-parsing and re-type-checking file before inspection. By default
this is done only when needed (for example file was not loaded from cache
or daemon was initially run without <code class="docutils literal notranslate"><span class="pre">--export-types</span></code> mypy option),
since reloading may be slow (up to few seconds for very large files).</p>
</dd></dl>

</section>
</section>
<span id="document-installed_packages"></span><section id="using-installed-packages">
<span id="installed-packages"></span><h3>Using installed packages<a class="headerlink" href="#using-installed-packages" title="Permalink to this headline">#</a></h3>
<p>Packages installed with pip can declare that they support type
checking. For example, the <a class="reference external" href="https://docs.aiohttp.org/en/stable/">aiohttp</a> package has built-in support
for type checking.</p>
<p>Packages can also provide stubs for a library. For example,
<code class="docutils literal notranslate"><span class="pre">types-requests</span></code> is a stub-only package that provides stubs for the
<a class="reference external" href="https://requests.readthedocs.io/en/master/">requests</a> package.
Stub packages are usually published from <a class="reference external" href="https://github.com/python/typeshed">typeshed</a>, a shared repository for Python
library stubs, and have a name of form <code class="docutils literal notranslate"><span class="pre">types-&lt;library&gt;</span></code>. Note that
many stub packages are not maintained by the original maintainers of
the package.</p>
<p>The sections below explain how mypy can use these packages, and how
you can create such packages.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0561/"><strong>PEP 561</strong></a> specifies how a package can declare that it supports
type checking.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>New versions of stub packages often use type system features not
supported by older, and even fairly recent mypy versions. If you
pin to an older version of mypy (using <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>, for
example), it is recommended that you also pin the versions of all
your stub package dependencies.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Starting in mypy 0.900, most third-party package stubs must be
installed explicitly. This decouples mypy and stub versioning,
allowing stubs to updated without updating mypy. This also allows
stubs not originally included with mypy to be installed. Earlier
mypy versions included a fixed set of stubs for third-party
packages.</p>
</div>
<section id="using-installed-packages-with-mypy-pep-561">
<h4>Using installed packages with mypy (PEP 561)<a class="headerlink" href="#using-installed-packages-with-mypy-pep-561" title="Permalink to this headline">#</a></h4>
<p>Typically mypy will automatically find and use installed packages that
support type checking or provide stubs. This requires that you install
the packages in the Python environment that you use to run mypy.  As
many packages don’t support type checking yet, you may also have to
install a separate stub package, usually named
<code class="docutils literal notranslate"><span class="pre">types-&lt;library&gt;</span></code>. (See <a class="reference internal" href="index.html#fix-missing-imports"><span class="std std-ref">Missing imports</span></a> for how to deal
with libraries that don’t support type checking and are also missing
stubs.)</p>
<p>If you have installed typed packages in another Python installation or
environment, mypy won’t automatically find them. One option is to
install another copy of those packages in the environment in which you
installed mypy. Alternatively, you can use the
<a class="reference internal" href="index.html#cmdoption-mypy-python-executable"><code class="xref std std-option docutils literal notranslate"><span class="pre">--python-executable</span></code></a> flag to point
to the Python executable for another environment, and mypy will find
packages installed for that Python executable.</p>
<p>Note that mypy does not support some more advanced import features,
such as zip imports and custom import hooks.</p>
<p>If you don’t want to use installed packages that provide type
information at all, use the <a class="reference internal" href="index.html#cmdoption-mypy-no-site-packages"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-site-packages</span></code></a> flag to disable searching for installed packages.</p>
<p>Note that stub-only packages cannot be used with <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code>. If you
want mypy to find the package, it must be installed. For a package
<code class="docutils literal notranslate"><span class="pre">foo</span></code>, the name of the stub-only package (<code class="docutils literal notranslate"><span class="pre">foo-stubs</span></code>) is not a
legal package name, so mypy will not find it, unless it is installed
(see <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0561/#stub-only-packages"><strong>PEP 561: Stub-only Packages</strong></a> for
more information).</p>
</section>
<section id="creating-pep-561-compatible-packages">
<h4>Creating PEP 561 compatible packages<a class="headerlink" href="#creating-pep-561-compatible-packages" title="Permalink to this headline">#</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can generally ignore this section unless you maintain a package on
PyPI, or want to publish type information for an existing PyPI
package.</p>
</div>
<p><span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0561/"><strong>PEP 561</strong></a> describes three main ways to distribute type
information:</p>
<ol class="arabic simple">
<li><p>A package has inline type annotations in the Python implementation.</p></li>
<li><p>A package ships <a class="reference internal" href="index.html#stub-files"><span class="std std-ref">stub files</span></a> with type
information alongside the Python implementation.</p></li>
<li><p>A package ships type information for another package separately as
stub files (also known as a “stub-only package”).</p></li>
</ol>
<p>If you want to create a stub-only package for an existing library, the
simplest way is to contribute stubs to the <a class="reference external" href="https://github.com/python/typeshed">typeshed</a> repository, and a stub package
will automatically be uploaded to PyPI.</p>
<p>If you would like to publish a library package to a package repository
yourself (e.g. on PyPI) for either internal or external use in type
checking, packages that supply type information via type comments or
annotations in the code should put a <code class="docutils literal notranslate"><span class="pre">py.typed</span></code> file in their
package directory. For example, here is a typical directory structure:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>setup.py
package_a/
    __init__.py
    lib.py
    py.typed
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file could look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;SuperPackageA&quot;</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Me&quot;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s2">&quot;0.1&quot;</span><span class="p">,</span>
    <span class="n">package_data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;package_a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;py.typed&quot;</span><span class="p">]},</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;package_a&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Some packages have a mix of stub files and runtime files. These packages also
require a <code class="docutils literal notranslate"><span class="pre">py.typed</span></code> file. An example can be seen below:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>setup.py
package_b/
    __init__.py
    lib.py
    lib.pyi
    py.typed
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> file might look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;SuperPackageB&quot;</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Me&quot;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s2">&quot;0.1&quot;</span><span class="p">,</span>
    <span class="n">package_data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;package_b&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;py.typed&quot;</span><span class="p">,</span> <span class="s2">&quot;lib.pyi&quot;</span><span class="p">]},</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;package_b&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In this example, both <code class="docutils literal notranslate"><span class="pre">lib.py</span></code> and the <code class="docutils literal notranslate"><span class="pre">lib.pyi</span></code> stub file exist. At
runtime, the Python interpreter will use <code class="docutils literal notranslate"><span class="pre">lib.py</span></code>, but mypy will use
<code class="docutils literal notranslate"><span class="pre">lib.pyi</span></code> instead.</p>
<p>If the package is stub-only (not imported at runtime), the package should have
a prefix of the runtime package name and a suffix of <code class="docutils literal notranslate"><span class="pre">-stubs</span></code>.
A <code class="docutils literal notranslate"><span class="pre">py.typed</span></code> file is not needed for stub-only packages. For example, if we
had stubs for <code class="docutils literal notranslate"><span class="pre">package_c</span></code>, we might do the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>setup.py
package_c-stubs/
    __init__.pyi
    lib.pyi
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> might look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;SuperPackageC&quot;</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Me&quot;</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s2">&quot;0.1&quot;</span><span class="p">,</span>
    <span class="n">package_data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;package_c-stubs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;__init__.pyi&quot;</span><span class="p">,</span> <span class="s2">&quot;lib.pyi&quot;</span><span class="p">]},</span>
    <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;package_c-stubs&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The instructions above are enough to ensure that the built wheels
contain the appropriate files. However, to ensure inclusion inside the
<code class="docutils literal notranslate"><span class="pre">sdist</span></code> (<code class="docutils literal notranslate"><span class="pre">.tar.gz</span></code> archive), you may also need to modify the
inclusion rules in your <code class="docutils literal notranslate"><span class="pre">MANIFEST.in</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>global-include *.pyi
global-include *.typed
</pre></div>
</div>
</section>
</section>
<span id="document-extending_mypy"></span><section id="extending-and-integrating-mypy">
<span id="extending-mypy"></span><h3>Extending and integrating mypy<a class="headerlink" href="#extending-and-integrating-mypy" title="Permalink to this headline">#</a></h3>
<section id="integrating-mypy-into-another-python-application">
<span id="integrating-mypy"></span><h4>Integrating mypy into another Python application<a class="headerlink" href="#integrating-mypy-into-another-python-application" title="Permalink to this headline">#</a></h4>
<p>It is possible to integrate mypy into another Python 3 application by
importing <code class="docutils literal notranslate"><span class="pre">mypy.api</span></code> and calling the <code class="docutils literal notranslate"><span class="pre">run</span></code> function with a parameter of type <code class="docutils literal notranslate"><span class="pre">list[str]</span></code>, containing
what normally would have been the command line arguments to mypy.</p>
<p>Function <code class="docutils literal notranslate"><span class="pre">run</span></code> returns a <code class="docutils literal notranslate"><span class="pre">tuple[str,</span> <span class="pre">str,</span> <span class="pre">int]</span></code>, namely
<code class="docutils literal notranslate"><span class="pre">(&lt;normal_report&gt;,</span> <span class="pre">&lt;error_report&gt;,</span> <span class="pre">&lt;exit_status&gt;)</span></code>, in which <code class="docutils literal notranslate"><span class="pre">&lt;normal_report&gt;</span></code>
is what mypy normally writes to <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.stdout" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stdout</span></code></a>, <code class="docutils literal notranslate"><span class="pre">&lt;error_report&gt;</span></code> is what mypy
normally writes to <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.stderr" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.stderr</span></code></a> and <code class="docutils literal notranslate"><span class="pre">exit_status</span></code> is the exit status mypy normally
returns to the operating system.</p>
<p>A trivial example of using the api is the following</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">mypy</span> <span class="kn">import</span> <span class="n">api</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

<span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Type checking report:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># stdout</span>

<span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Error report:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># stderr</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Exit status:&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="extending-mypy-using-plugins">
<span id="id1"></span><h4>Extending mypy using plugins<a class="headerlink" href="#extending-mypy-using-plugins" title="Permalink to this headline">#</a></h4>
<p>Python is a highly dynamic language and has extensive metaprogramming
capabilities. Many popular libraries use these to create APIs that may
be more flexible and/or natural for humans, but are hard to express using
static types. Extending the <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> type system to accommodate all existing
dynamic patterns is impractical and often just impossible.</p>
<p>Mypy supports a plugin system that lets you customize the way mypy type checks
code. This can be useful if you want to extend mypy so it can type check code
that uses a library that is difficult to express using just <span class="target" id="index-1"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> types.</p>
<p>The plugin system is focused on improving mypy’s understanding
of <em>semantics</em> of third party frameworks. There is currently no way to define
new first class kinds of types.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The plugin system is experimental and prone to change. If you want to write
a mypy plugin, we recommend you start by contacting the mypy core developers
on <a class="reference external" href="https://gitter.im/python/typing">gitter</a>. In particular, there are
no guarantees about backwards compatibility.</p>
<p>Backwards incompatible changes may be made without a deprecation period,
but we will announce them in
<a class="reference external" href="https://github.com/python/mypy/issues/6617">the plugin API changes announcement issue</a>.</p>
</div>
</section>
<section id="configuring-mypy-to-use-plugins">
<h4>Configuring mypy to use plugins<a class="headerlink" href="#configuring-mypy-to-use-plugins" title="Permalink to this headline">#</a></h4>
<p>Plugins are Python files that can be specified in a mypy
<a class="reference internal" href="index.html#config-file"><span class="std std-ref">config file</span></a> using the <a class="reference internal" href="index.html#confval-plugins"><code class="xref std std-confval docutils literal notranslate"><span class="pre">plugins</span></code></a> option and one of the two formats: relative or
absolute path to the plugin file, or a module name (if the plugin
is installed using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> in the same virtual environment where mypy
is running). The two formats can be mixed, for example:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[mypy]</span>
<span class="na">plugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">/one/plugin.py, other.plugin</span>
</pre></div>
</div>
<p>Mypy will try to import the plugins and will look for an entry point function
named <code class="docutils literal notranslate"><span class="pre">plugin</span></code>. If the plugin entry point function has a different name, it
can be specified after colon:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[mypy]</span>
<span class="na">plugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">custom_plugin:custom_entry_point</span>
</pre></div>
</div>
<p>In the following sections we describe the basics of the plugin system with
some examples. For more technical details, please read the docstrings in
<a class="reference external" href="https://github.com/python/mypy/blob/master/mypy/plugin.py">mypy/plugin.py</a>
in mypy source code. Also you can find good examples in the bundled plugins
located in <a class="reference external" href="https://github.com/python/mypy/tree/master/mypy/plugins">mypy/plugins</a>.</p>
</section>
<section id="high-level-overview">
<h4>High-level overview<a class="headerlink" href="#high-level-overview" title="Permalink to this headline">#</a></h4>
<p>Every entry point function should accept a single string argument
that is a full mypy version and return a subclass of <code class="docutils literal notranslate"><span class="pre">mypy.plugin.Plugin</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mypy.plugin</span> <span class="kn">import</span> <span class="n">Plugin</span>

<span class="k">class</span> <span class="nc">CustomPlugin</span><span class="p">(</span><span class="n">Plugin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_type_analyze_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># see explanation below</span>
        <span class="o">...</span>

<span class="k">def</span> <span class="nf">plugin</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="c1"># ignore version argument if the plugin works with all mypy versions.</span>
    <span class="k">return</span> <span class="n">CustomPlugin</span>
</pre></div>
</div>
<p>During different phases of analyzing the code (first in semantic analysis,
and then in type checking) mypy calls plugin methods such as
<code class="docutils literal notranslate"><span class="pre">get_type_analyze_hook()</span></code> on user plugins. This particular method, for example,
can return a callback that mypy will use to analyze unbound types with the given
full name. See the full plugin hook method list <a class="reference internal" href="#plugin-hooks"><span class="std std-ref">below</span></a>.</p>
<p>Mypy maintains a list of plugins it gets from the config file plus the default
(built-in) plugin that is always enabled. Mypy calls a method once for each
plugin in the list until one of the methods returns a non-<code class="docutils literal notranslate"><span class="pre">None</span></code> value.
This callback will be then used to customize the corresponding aspect of
analyzing/checking the current abstract syntax tree node.</p>
<p>The callback returned by the <code class="docutils literal notranslate"><span class="pre">get_xxx</span></code> method will be given a detailed
current context and an API to create new nodes, new types, emit error messages,
etc., and the result will be used for further processing.</p>
<p>Plugin developers should ensure that their plugins work well in incremental and
daemon modes. In particular, plugins should not hold global state due to caching
of plugin hook results.</p>
</section>
<section id="current-list-of-plugin-hooks">
<span id="plugin-hooks"></span><h4>Current list of plugin hooks<a class="headerlink" href="#current-list-of-plugin-hooks" title="Permalink to this headline">#</a></h4>
<p><strong>get_type_analyze_hook()</strong> customizes behaviour of the type analyzer.
For example, <span class="target" id="index-2"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a> doesn’t support defining variadic generic types:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lib</span> <span class="kn">import</span> <span class="n">Vector</span>

<span class="n">a</span><span class="p">:</span> <span class="n">Vector</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="n">b</span><span class="p">:</span> <span class="n">Vector</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</pre></div>
</div>
<p>When analyzing this code, mypy will call <code class="docutils literal notranslate"><span class="pre">get_type_analyze_hook(&quot;lib.Vector&quot;)</span></code>,
so the plugin can return some valid type for each variable.</p>
<p><strong>get_function_hook()</strong> is used to adjust the return type of a function call.
This hook will be also called for instantiation of classes.
This is a good choice if the return type is too complex
to be expressed by regular python typing.</p>
<p><strong>get_function_signature_hook()</strong> is used to adjust the signature of a function.</p>
<p><strong>get_method_hook()</strong> is the same as <code class="docutils literal notranslate"><span class="pre">get_function_hook()</span></code> but for methods
instead of module level functions.</p>
<p><strong>get_method_signature_hook()</strong> is used to adjust the signature of a method.
This includes special Python methods except <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__()</span></code></a> and <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__new__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__new__()</span></code></a>.
For example in this code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="n">Array</span><span class="p">,</span> <span class="n">c_int</span>

<span class="n">x</span><span class="p">:</span> <span class="n">Array</span><span class="p">[</span><span class="n">c_int</span><span class="p">]</span>
<span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>
</div>
<p>mypy will call <code class="docutils literal notranslate"><span class="pre">get_method_signature_hook(&quot;ctypes.Array.__setitem__&quot;)</span></code>
so that the plugin can mimic the <a class="reference external" href="https://docs.python.org/3/library/ctypes.html#module-ctypes" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ctypes</span></code></a> auto-convert behavior.</p>
<p><strong>get_attribute_hook()</strong> overrides instance member field lookups and property
access (not assignments, and not method calls). This hook is only called for
fields which already exist on the class. <em>Exception:</em> if <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__getattr__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__getattr__</span></code></a> or
<a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__getattribute__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__getattribute__</span></code></a> is a method on the class, the hook is called for all
fields which do not refer to methods.</p>
<p><strong>get_class_attribute_hook()</strong> is similar to above, but for attributes on classes rather than instances.
Unlike above, this does not have special casing for <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__getattr__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__getattr__</span></code></a> or
<a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__getattribute__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__getattribute__</span></code></a>.</p>
<p><strong>get_class_decorator_hook()</strong> can be used to update class definition for
given class decorators. For example, you can add some attributes to the class
to match runtime behaviour:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span>  <span class="c1"># built-in plugin adds `__init__` method here</span>
<span class="k">class</span> <span class="nc">User</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;example&#39;</span><span class="p">)</span>  <span class="c1"># mypy can understand this using a plugin</span>
</pre></div>
</div>
<p><strong>get_metaclass_hook()</strong> is similar to above, but for metaclasses.</p>
<p><strong>get_base_class_hook()</strong> is similar to above, but for base classes.</p>
<p><strong>get_dynamic_class_hook()</strong> can be used to allow dynamic class definitions
in mypy. This plugin hook is called for every assignment to a simple name
where right hand side is a function call:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lib</span> <span class="kn">import</span> <span class="n">dynamic_class</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">dynamic_class</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="p">[])</span>
</pre></div>
</div>
<p>For such definition, mypy will call <code class="docutils literal notranslate"><span class="pre">get_dynamic_class_hook(&quot;lib.dynamic_class&quot;)</span></code>.
The plugin should create the corresponding <code class="docutils literal notranslate"><span class="pre">mypy.nodes.TypeInfo</span></code> object, and
place it into a relevant symbol table. (Instances of this class represent
classes in mypy and hold essential information such as qualified name,
method resolution order, etc.)</p>
<p><strong>get_customize_class_mro_hook()</strong> can be used to modify class MRO (for example
insert some entries there) before the class body is analyzed.</p>
<p><strong>get_additional_deps()</strong> can be used to add new dependencies for a
module. It is called before semantic analysis. For example, this can
be used if a library has dependencies that are dynamically loaded
based on configuration information.</p>
<p><strong>report_config_data()</strong> can be used if the plugin has some sort of
per-module configuration that can affect typechecking. In that case,
when the configuration for a module changes, we want to invalidate
mypy’s cache for that module so that it can be rechecked. This hook
should be used to report to mypy any relevant configuration data,
so that mypy knows to recheck the module if the configuration changes.
The hooks should return data encodable as JSON.</p>
</section>
</section>
<span id="document-stubgen"></span><section id="automatic-stub-generation-stubgen">
<span id="stubgen"></span><h3>Automatic stub generation (stubgen)<a class="headerlink" href="#automatic-stub-generation-stubgen" title="Permalink to this headline">#</a></h3>
<p>A stub file (see <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a>) contains only type hints for the public
interface of a module, with empty function bodies. Mypy can use a stub
file instead of the real implementation to provide type information
for the module. They are useful for third-party modules whose authors
have not yet added type hints (and when no stubs are available in
typeshed) and C extension modules (which mypy can’t directly process).</p>
<p>Mypy includes the <code class="docutils literal notranslate"><span class="pre">stubgen</span></code> tool that can automatically generate
stub files (<code class="docutils literal notranslate"><span class="pre">.pyi</span></code> files) for Python modules and C extension modules.
For example, consider this source file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">other_module</span> <span class="kn">import</span> <span class="n">dynamic</span>

<span class="n">BORDER_WIDTH</span> <span class="o">=</span> <span class="mi">15</span>

<span class="k">class</span> <span class="nc">Window</span><span class="p">:</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">dynamic</span><span class="p">()</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>

<span class="k">def</span> <span class="nf">create_empty</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Window</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Window</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Stubgen can generate this stub file based on the above file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="n">BORDER_WIDTH</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">Window</span><span class="p">:</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">width</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">height</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">create_empty</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Window</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
<p>Stubgen generates <em>draft</em> stubs. The auto-generated stub files often
require some manual updates, and most types will default to <code class="docutils literal notranslate"><span class="pre">Any</span></code>.
The stubs will be much more useful if you add more precise type annotations,
at least for the most commonly used functionality.</p>
<p>The rest of this section documents the command line interface of stubgen.
Run <a class="reference internal" href="#cmdoption-stubgen-h"><code class="xref std std-option docutils literal notranslate"><span class="pre">stubgen</span> <span class="pre">--help</span></code></a> for a quick summary of options.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The command-line flags may change between releases.</p>
</div>
<section id="specifying-what-to-stub">
<h4>Specifying what to stub<a class="headerlink" href="#specifying-what-to-stub" title="Permalink to this headline">#</a></h4>
<p>You can give stubgen paths of the source files for which you want to
generate stubs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ stubgen foo.py bar.py
</pre></div>
</div>
<p>This generates stubs <code class="docutils literal notranslate"><span class="pre">out/foo.pyi</span></code> and <code class="docutils literal notranslate"><span class="pre">out/bar.pyi</span></code>. The default
output directory <code class="docutils literal notranslate"><span class="pre">out</span></code> can be overridden with <a class="reference internal" href="#cmdoption-stubgen-o"><code class="xref std std-option docutils literal notranslate"><span class="pre">-o</span> <span class="pre">DIR</span></code></a>.</p>
<p>You can also pass directories, and stubgen will recursively search
them for any <code class="docutils literal notranslate"><span class="pre">.py</span></code> files and generate stubs for all of them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ stubgen my_pkg_dir
</pre></div>
</div>
<p>Alternatively, you can give module or package names using the
<a class="reference internal" href="#cmdoption-stubgen-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">-m</span></code></a> or <a class="reference internal" href="#cmdoption-stubgen-p"><code class="xref std std-option docutils literal notranslate"><span class="pre">-p</span></code></a> options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ stubgen -m foo -m bar -p my_pkg_dir
</pre></div>
</div>
<p>Details of the options:</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-m">
<span id="cmdoption-stubgen-module"></span><span class="sig-name descname"><span class="pre">-m</span></span><span class="sig-prename descclassname"> <span class="pre">MODULE</span></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--module</span></span><span class="sig-prename descclassname"> <span class="pre">MODULE</span></span><a class="headerlink" href="#cmdoption-stubgen-m" title="Permalink to this definition">#</a></dt>
<dd><p>Generate a stub file for the given module. This flag may be repeated
multiple times.</p>
<p>Stubgen <em>will not</em> recursively generate stubs for any submodules of
the provided module.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-p">
<span id="cmdoption-stubgen-package"></span><span class="sig-name descname"><span class="pre">-p</span></span><span class="sig-prename descclassname"> <span class="pre">PACKAGE</span></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--package</span></span><span class="sig-prename descclassname"> <span class="pre">PACKAGE</span></span><a class="headerlink" href="#cmdoption-stubgen-p" title="Permalink to this definition">#</a></dt>
<dd><p>Generate stubs for the given package. This flag maybe repeated
multiple times.</p>
<p>Stubgen <em>will</em> recursively generate stubs for all submodules of
the provided package. This flag is identical to <a class="reference internal" href="#cmdoption-stubgen-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">--module</span></code></a> apart from
this behavior.</p>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can’t mix paths and <a class="reference internal" href="#cmdoption-stubgen-m"><code class="xref std std-option docutils literal notranslate"><span class="pre">-m</span></code></a>/<a class="reference internal" href="#cmdoption-stubgen-p"><code class="xref std std-option docutils literal notranslate"><span class="pre">-p</span></code></a> options in the same stubgen
invocation.</p>
</div>
<p>Stubgen applies heuristics to avoid generating stubs for submodules
that include tests or vendored third-party packages.</p>
</section>
<section id="specifying-how-to-generate-stubs">
<h4>Specifying how to generate stubs<a class="headerlink" href="#specifying-how-to-generate-stubs" title="Permalink to this headline">#</a></h4>
<p>By default stubgen will try to import the target modules and packages.
This allows stubgen to use runtime introspection to generate stubs for C
extension modules and to improve the quality of the generated
stubs. By default, stubgen will also use mypy to perform light-weight
semantic analysis of any Python modules. Use the following flags to
alter the default behavior:</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-no-import">
<span class="sig-name descname"><span class="pre">--no-import</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubgen-no-import" title="Permalink to this definition">#</a></dt>
<dd><p>Don’t try to import modules. Instead only use mypy’s normal search mechanism to find
sources. This does not support C extension modules. This flag also disables
runtime introspection functionality, which mypy uses to find the value of
<code class="docutils literal notranslate"><span class="pre">__all__</span></code>. As result the set of exported imported names in stubs may be
incomplete. This flag is generally only useful when importing a module causes
unwanted side effects, such as the running of tests. Stubgen tries to skip test
modules even without this option, but this does not always work.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-parse-only">
<span class="sig-name descname"><span class="pre">--parse-only</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubgen-parse-only" title="Permalink to this definition">#</a></dt>
<dd><p>Don’t perform semantic analysis of source files. This may generate
worse stubs – in particular, some module, class, and function aliases may
be represented as variables with the <code class="docutils literal notranslate"><span class="pre">Any</span></code> type. This is generally only
useful if semantic analysis causes a critical mypy error.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-doc-dir">
<span class="sig-name descname"><span class="pre">--doc-dir</span></span><span class="sig-prename descclassname"> <span class="pre">PATH</span></span><a class="headerlink" href="#cmdoption-stubgen-doc-dir" title="Permalink to this definition">#</a></dt>
<dd><p>Try to infer better signatures by parsing .rst documentation in <code class="docutils literal notranslate"><span class="pre">PATH</span></code>.
This may result in better stubs, but currently it only works for C extension
modules.</p>
</dd></dl>

</section>
<section id="additional-flags">
<h4>Additional flags<a class="headerlink" href="#additional-flags" title="Permalink to this headline">#</a></h4>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-h">
<span id="cmdoption-stubgen-help"></span><span class="sig-name descname"><span class="pre">-h</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--help</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubgen-h" title="Permalink to this definition">#</a></dt>
<dd><p>Show help message and exit.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-ignore-errors">
<span class="sig-name descname"><span class="pre">--ignore-errors</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubgen-ignore-errors" title="Permalink to this definition">#</a></dt>
<dd><p>If an exception was raised during stub generation, continue to process any
remaining modules instead of immediately failing with an error.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-include-private">
<span class="sig-name descname"><span class="pre">--include-private</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubgen-include-private" title="Permalink to this definition">#</a></dt>
<dd><p>Include definitions that are considered private in stubs (with names such
as <code class="docutils literal notranslate"><span class="pre">_foo</span></code> with single leading underscore and no trailing underscores).</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-export-less">
<span class="sig-name descname"><span class="pre">--export-less</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubgen-export-less" title="Permalink to this definition">#</a></dt>
<dd><p>Don’t export all names imported from other modules within the same package.
Instead, only export imported names that are not referenced in the module
that contains the import.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-include-docstrings">
<span class="sig-name descname"><span class="pre">--include-docstrings</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubgen-include-docstrings" title="Permalink to this definition">#</a></dt>
<dd><p>Include docstrings in stubs. This will add docstrings to Python function and
classes stubs and to C extension function stubs.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-search-path">
<span class="sig-name descname"><span class="pre">--search-path</span></span><span class="sig-prename descclassname"> <span class="pre">PATH</span></span><a class="headerlink" href="#cmdoption-stubgen-search-path" title="Permalink to this definition">#</a></dt>
<dd><p>Specify module search directories, separated by colons (only used if
<a class="reference internal" href="#cmdoption-stubgen-no-import"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-import</span></code></a> is given).</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-o">
<span id="cmdoption-stubgen-output"></span><span class="sig-name descname"><span class="pre">-o</span></span><span class="sig-prename descclassname"> <span class="pre">PATH</span></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--output</span></span><span class="sig-prename descclassname"> <span class="pre">PATH</span></span><a class="headerlink" href="#cmdoption-stubgen-o" title="Permalink to this definition">#</a></dt>
<dd><p>Change the output directory. By default the stubs are written in the
<code class="docutils literal notranslate"><span class="pre">./out</span></code> directory. The output directory will be created if it doesn’t
exist. Existing stubs in the output directory will be overwritten without
warning.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-v">
<span id="cmdoption-stubgen-verbose"></span><span class="sig-name descname"><span class="pre">-v</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--verbose</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubgen-v" title="Permalink to this definition">#</a></dt>
<dd><p>Produce more verbose output.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubgen-q">
<span id="cmdoption-stubgen-quiet"></span><span class="sig-name descname"><span class="pre">-q</span></span><span class="sig-prename descclassname"></span><span class="sig-prename descclassname"><span class="pre">,</span> </span><span class="sig-name descname"><span class="pre">--quiet</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubgen-q" title="Permalink to this definition">#</a></dt>
<dd><p>Produce less verbose output.</p>
</dd></dl>

</section>
</section>
<span id="document-stubtest"></span><section id="automatic-stub-testing-stubtest">
<span id="stubtest"></span><h3>Automatic stub testing (stubtest)<a class="headerlink" href="#automatic-stub-testing-stubtest" title="Permalink to this headline">#</a></h3>
<p>Stub files are files containing type annotations. See
<a class="reference external" href="https://www.python.org/dev/peps/pep-0484/#stub-files">PEP 484</a>
for more motivation and details.</p>
<p>A common problem with stub files is that they tend to diverge from the
actual implementation. Mypy includes the <code class="docutils literal notranslate"><span class="pre">stubtest</span></code> tool that can
automatically check for discrepancies between the stubs and the
implementation at runtime.</p>
<section id="what-stubtest-does-and-does-not-do">
<h4>What stubtest does and does not do<a class="headerlink" href="#what-stubtest-does-and-does-not-do" title="Permalink to this headline">#</a></h4>
<p>Stubtest will import your code and introspect your code objects at runtime, for
example, by using the capabilities of the <a class="reference external" href="https://docs.python.org/3/library/inspect.html#module-inspect" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">inspect</span></code></a> module. Stubtest
will then analyse the stub files, and compare the two, pointing out things that
differ between stubs and the implementation at runtime.</p>
<p>It’s important to be aware of the limitations of this comparison. Stubtest will
not make any attempt to statically analyse your actual code and relies only on
dynamic runtime introspection (in particular, this approach means stubtest works
well with extension modules). However, this means that stubtest has limited
visibility; for instance, it cannot tell if a return type of a function is
accurately typed in the stubs.</p>
<p>For clarity, here are some additional things stubtest can’t do:</p>
<ul class="simple">
<li><p>Type check your code – use <code class="docutils literal notranslate"><span class="pre">mypy</span></code> instead</p></li>
<li><p>Generate stubs – use <code class="docutils literal notranslate"><span class="pre">stubgen</span></code> or <code class="docutils literal notranslate"><span class="pre">pyright</span> <span class="pre">--createstub</span></code> instead</p></li>
<li><p>Generate stubs based on running your application or test suite – use <code class="docutils literal notranslate"><span class="pre">monkeytype</span></code> instead</p></li>
<li><p>Apply stubs to code to produce inline types – use <code class="docutils literal notranslate"><span class="pre">retype</span></code> or <code class="docutils literal notranslate"><span class="pre">libcst</span></code> instead</p></li>
</ul>
<p>In summary, stubtest works very well for ensuring basic consistency between
stubs and implementation or to check for stub completeness. It’s used to
test Python’s official collection of library stubs,
<a class="reference external" href="https://github.com/python/typeshed">typeshed</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>stubtest will import and execute Python code from the packages it checks.</p>
</div>
</section>
<section id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">#</a></h4>
<p>Here’s a quick example of what stubtest can do:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>mypy

$<span class="w"> </span>cat<span class="w"> </span>library.py
<span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hello, stubtest&quot;</span>

def<span class="w"> </span>foo<span class="o">(</span><span class="nv">x</span><span class="o">=</span>None<span class="o">)</span>:
<span class="w">    </span>print<span class="o">(</span>x<span class="o">)</span>

$<span class="w"> </span>cat<span class="w"> </span>library.pyi
x:<span class="w"> </span>int

def<span class="w"> </span>foo<span class="o">(</span>x:<span class="w"> </span>int<span class="o">)</span><span class="w"> </span>-&gt;<span class="w"> </span>None:<span class="w"> </span>...

$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>mypy.stubtest<span class="w"> </span>library
error:<span class="w"> </span>library.foo<span class="w"> </span>is<span class="w"> </span>inconsistent,<span class="w"> </span>runtime<span class="w"> </span>argument<span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="w"> </span>has<span class="w"> </span>a<span class="w"> </span>default<span class="w"> </span>value<span class="w"> </span>but<span class="w"> </span>stub<span class="w"> </span>argument<span class="w"> </span>does<span class="w"> </span>not
Stub:<span class="w"> </span>at<span class="w"> </span>line<span class="w"> </span><span class="m">3</span>
def<span class="w"> </span><span class="o">(</span>x:<span class="w"> </span>builtins.int<span class="o">)</span>
Runtime:<span class="w"> </span><span class="k">in</span><span class="w"> </span>file<span class="w"> </span>~/library.py:3
def<span class="w"> </span><span class="o">(</span><span class="nv">x</span><span class="o">=</span>None<span class="o">)</span>

error:<span class="w"> </span>library.x<span class="w"> </span>variable<span class="w"> </span>differs<span class="w"> </span>from<span class="w"> </span>runtime<span class="w"> </span><span class="nb">type</span><span class="w"> </span>Literal<span class="o">[</span><span class="s1">&#39;hello, stubtest&#39;</span><span class="o">]</span>
Stub:<span class="w"> </span>at<span class="w"> </span>line<span class="w"> </span><span class="m">1</span>
builtins.int
Runtime:
<span class="s1">&#39;hello, stubtest&#39;</span>
</pre></div>
</div>
</section>
<section id="usage">
<h4>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">#</a></h4>
<p>Running stubtest can be as simple as <code class="docutils literal notranslate"><span class="pre">stubtest</span> <span class="pre">module_to_check</span></code>.
Run <a class="reference internal" href="#cmdoption-stubtest-help"><code class="xref std std-option docutils literal notranslate"><span class="pre">stubtest</span> <span class="pre">--help</span></code></a> for a quick summary of options.</p>
<p>Stubtest must be able to import the code to be checked, so make sure that mypy
is installed in the same environment as the library to be tested. In some
cases, setting <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> can help stubtest find the code to import.</p>
<p>Similarly, stubtest must be able to find the stubs to be checked. Stubtest
respects the <code class="docutils literal notranslate"><span class="pre">MYPYPATH</span></code> environment variable – consider using this if you
receive a complaint along the lines of “failed to find stubs”.</p>
<p>Note that stubtest requires mypy to be able to analyse stubs. If mypy is unable
to analyse stubs, you may get an error on the lines of “not checking stubs due
to mypy build errors”. In this case, you will need to mitigate those errors
before stubtest will run. Despite potential overlap in errors here, stubtest is
not intended as a substitute for running mypy directly.</p>
<p>If you wish to ignore some of stubtest’s complaints, stubtest supports a
pretty handy allowlist system.</p>
<p>The rest of this section documents the command line interface of stubtest.</p>
<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubtest-concise">
<span class="sig-name descname"><span class="pre">--concise</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubtest-concise" title="Permalink to this definition">#</a></dt>
<dd><p>Makes stubtest’s output more concise, one line per error</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubtest-ignore-missing-stub">
<span class="sig-name descname"><span class="pre">--ignore-missing-stub</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubtest-ignore-missing-stub" title="Permalink to this definition">#</a></dt>
<dd><p>Ignore errors for stub missing things that are present at runtime</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubtest-ignore-positional-only">
<span class="sig-name descname"><span class="pre">--ignore-positional-only</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubtest-ignore-positional-only" title="Permalink to this definition">#</a></dt>
<dd><p>Ignore errors for whether an argument should or shouldn’t be positional-only</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubtest-allowlist">
<span class="sig-name descname"><span class="pre">--allowlist</span></span><span class="sig-prename descclassname"> <span class="pre">FILE</span></span><a class="headerlink" href="#cmdoption-stubtest-allowlist" title="Permalink to this definition">#</a></dt>
<dd><p>Use file as an allowlist. Can be passed multiple times to combine multiple
allowlists. Allowlists can be created with –generate-allowlist. Allowlists
support regular expressions.</p>
<p>The presence of an entry in the allowlist means stubtest will not generate
any errors for the corresponding definition.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubtest-generate-allowlist">
<span class="sig-name descname"><span class="pre">--generate-allowlist</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubtest-generate-allowlist" title="Permalink to this definition">#</a></dt>
<dd><p>Print an allowlist (to stdout) to be used with –allowlist</p>
<p>When introducing stubtest to an existing project, this is an easy way to
silence all existing errors.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubtest-ignore-unused-allowlist">
<span class="sig-name descname"><span class="pre">--ignore-unused-allowlist</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubtest-ignore-unused-allowlist" title="Permalink to this definition">#</a></dt>
<dd><p>Ignore unused allowlist entries</p>
<p>Without this option enabled, the default is for stubtest to complain if an
allowlist entry is not necessary for stubtest to pass successfully.</p>
<p>Note if an allowlist entry is a regex that matches the empty string,
stubtest will never consider it unused. For example, to get
<cite>–ignore-unused-allowlist</cite> behaviour for a single allowlist entry like
<code class="docutils literal notranslate"><span class="pre">foo.bar</span></code> you could add an allowlist entry <code class="docutils literal notranslate"><span class="pre">(foo\.bar)?</span></code>.
This can be useful when an error only occurs on a specific platform.</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubtest-mypy-config-file">
<span class="sig-name descname"><span class="pre">--mypy-config-file</span></span><span class="sig-prename descclassname"> <span class="pre">FILE</span></span><a class="headerlink" href="#cmdoption-stubtest-mypy-config-file" title="Permalink to this definition">#</a></dt>
<dd><p>Use specified mypy config file to determine mypy plugins and mypy path</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubtest-custom-typeshed-dir">
<span class="sig-name descname"><span class="pre">--custom-typeshed-dir</span></span><span class="sig-prename descclassname"> <span class="pre">DIR</span></span><a class="headerlink" href="#cmdoption-stubtest-custom-typeshed-dir" title="Permalink to this definition">#</a></dt>
<dd><p>Use the custom typeshed in DIR</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubtest-check-typeshed">
<span class="sig-name descname"><span class="pre">--check-typeshed</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubtest-check-typeshed" title="Permalink to this definition">#</a></dt>
<dd><p>Check all stdlib modules in typeshed</p>
</dd></dl>

<dl class="std option">
<dt class="sig sig-object std" id="cmdoption-stubtest-help">
<span class="sig-name descname"><span class="pre">--help</span></span><span class="sig-prename descclassname"></span><a class="headerlink" href="#cmdoption-stubtest-help" title="Permalink to this definition">#</a></dt>
<dd><p>Show a help message :-)</p>
</dd></dl>

</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-common_issues"></span><section id="common-issues-and-solutions">
<span id="common-issues"></span><h3>Common issues and solutions<a class="headerlink" href="#common-issues-and-solutions" title="Permalink to this headline">#</a></h3>
<p>This section has examples of cases when you need to update your code
to use static typing, and ideas for working around issues if mypy
doesn’t work as expected. Statically typed code is often identical to
normal Python code (except for type annotations), but sometimes you need
to do things slightly differently.</p>
<section id="no-errors-reported-for-obviously-wrong-code">
<span id="annotations-needed"></span><h4>No errors reported for obviously wrong code<a class="headerlink" href="#no-errors-reported-for-obviously-wrong-code" title="Permalink to this headline">#</a></h4>
<p>There are several common reasons why obviously wrong code is not
flagged as an error.</p>
<p><strong>The function containing the error is not annotated.</strong></p>
<p>Functions that
do not have any annotations (neither for any argument nor for the
return type) are not type-checked, and even the most blatant type
errors (e.g. <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">+</span> <span class="pre">'a'</span></code>) pass silently.  The solution is to add
annotations. Where that isn’t possible, functions without annotations
can be checked using <a class="reference internal" href="index.html#cmdoption-mypy-check-untyped-defs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--check-untyped-defs</span></code></a>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>  <span class="c1"># No error!</span>
</pre></div>
</div>
<p>This gives no error even though <code class="docutils literal notranslate"><span class="pre">a.split()</span></code> is “obviously” a list
(the author probably meant <code class="docutils literal notranslate"><span class="pre">a.strip()</span></code>).  The error is reported
once you add annotations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
<span class="c1"># error: Unsupported operand types for + (&quot;str&quot; and List[str])</span>
</pre></div>
</div>
<p>If you don’t know what types to add, you can use <code class="docutils literal notranslate"><span class="pre">Any</span></code>, but beware:</p>
<p><strong>One of the values involved has type ‘Any’.</strong></p>
<p>Extending the above
example, if we were to leave out the annotation for <code class="docutils literal notranslate"><span class="pre">a</span></code>, we’d get
no error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>  <span class="c1"># No error!</span>
</pre></div>
</div>
<p>The reason is that if the type of <code class="docutils literal notranslate"><span class="pre">a</span></code> is unknown, the type of
<code class="docutils literal notranslate"><span class="pre">a.split()</span></code> is also unknown, so it is inferred as having type
<code class="docutils literal notranslate"><span class="pre">Any</span></code>, and it is no error to add a string to an <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p>
<p>If you’re having trouble debugging such situations,
<a class="reference internal" href="#reveal-type"><span class="std std-ref">reveal_type()</span></a> might come in handy.</p>
<p>Note that sometimes library stubs with imprecise type information
can be a source of <code class="docutils literal notranslate"><span class="pre">Any</span></code> values.</p>
<p><a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a> <strong>method has no annotated
arguments and no return type annotation.</strong></p>
<p>This is basically a combination of the two cases above, in that <code class="docutils literal notranslate"><span class="pre">__init__</span></code>
without annotations can cause <code class="docutils literal notranslate"><span class="pre">Any</span></code> types leak into instance variables:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Bad</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;asdf&quot;</span>
        <span class="mi">1</span> <span class="o">+</span> <span class="s2">&quot;asdf&quot;</span>  <span class="c1"># No error!</span>

<span class="n">bad</span> <span class="o">=</span> <span class="n">Bad</span><span class="p">()</span>
<span class="n">bad</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span>           <span class="c1"># No error!</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">bad</span><span class="p">)</span>        <span class="c1"># Revealed type is &quot;__main__.Bad&quot;</span>
<span class="n">reveal_type</span><span class="p">(</span><span class="n">bad</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># Revealed type is &quot;Any&quot;</span>

<span class="k">class</span> <span class="nc">Good</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Explicitly return None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>
</div>
<p><strong>Some imports may be silently ignored</strong>.</p>
<p>A common source of unexpected <code class="docutils literal notranslate"><span class="pre">Any</span></code> values is the
<a class="reference internal" href="index.html#cmdoption-mypy-ignore-missing-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--ignore-missing-imports</span></code></a> flag.</p>
<p>When you use <a class="reference internal" href="index.html#cmdoption-mypy-ignore-missing-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--ignore-missing-imports</span></code></a>,
any imported module that cannot be found is silently replaced with <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p>
<p>To help debug this, simply leave out
<a class="reference internal" href="index.html#cmdoption-mypy-ignore-missing-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--ignore-missing-imports</span></code></a>.
As mentioned in <a class="reference internal" href="index.html#fix-missing-imports"><span class="std std-ref">Missing imports</span></a>, setting <code class="docutils literal notranslate"><span class="pre">ignore_missing_imports=True</span></code>
on a per-module basis will make bad surprises less likely and is highly encouraged.</p>
<p>Use of the <a class="reference internal" href="index.html#cmdoption-mypy-follow-imports"><code class="xref std std-option docutils literal notranslate"><span class="pre">--follow-imports=skip</span></code></a> flags can also
cause problems. Use of these flags is strongly discouraged and only required in
relatively niche situations. See <a class="reference internal" href="index.html#follow-imports"><span class="std std-ref">Following imports</span></a> for more information.</p>
<p><strong>mypy considers some of your code unreachable</strong>.</p>
<p>See <a class="reference internal" href="#unreachable"><span class="std std-ref">Unreachable code</span></a> for more information.</p>
<p><strong>A function annotated as returning a non-optional type returns ‘None’
and mypy doesn’t complain</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># No error!</span>
</pre></div>
</div>
<p>You may have disabled strict optional checking (see
<a class="reference internal" href="index.html#no-strict-optional"><span class="std std-ref">Disabling strict optional checking</span></a> for more).</p>
</section>
<section id="spurious-errors-and-locally-silencing-the-checker">
<span id="silencing-checker"></span><h4>Spurious errors and locally silencing the checker<a class="headerlink" href="#spurious-errors-and-locally-silencing-the-checker" title="Permalink to this headline">#</a></h4>
<p>You can use a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment to silence the type checker
on a particular line. For example, let’s say our code is using
the C extension module <code class="docutils literal notranslate"><span class="pre">frobnicate</span></code>, and there’s no stub available.
Mypy will complain about this, as it has no information about the
module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">frobnicate</span>  <span class="c1"># Error: No module &quot;frobnicate&quot;</span>
<span class="n">frobnicate</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>You can add a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment to tell mypy to ignore this
error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">frobnicate</span>  <span class="c1"># type: ignore</span>
<span class="n">frobnicate</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># Okay!</span>
</pre></div>
</div>
<p>The second line is now fine, since the ignore comment causes the name
<code class="docutils literal notranslate"><span class="pre">frobnicate</span></code> to get an implicit <code class="docutils literal notranslate"><span class="pre">Any</span></code> type.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can use the form <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore[&lt;code&gt;]</span></code> to only ignore
specific errors on the line. This way you are less likely to
silence unexpected errors that are not safe to ignore, and this
will also document what the purpose of the comment is.  See
<a class="reference internal" href="index.html#error-codes"><span class="std std-ref">Error codes</span></a> for more information.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment will only assign the implicit <code class="docutils literal notranslate"><span class="pre">Any</span></code>
type if mypy cannot find information about that particular module. So,
if we did have a stub available for <code class="docutils literal notranslate"><span class="pre">frobnicate</span></code> then mypy would
ignore the <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment and typecheck the stub as usual.</p>
</div>
<p>Another option is to explicitly annotate values with type <code class="docutils literal notranslate"><span class="pre">Any</span></code> –
mypy will let you perform arbitrary operations on <code class="docutils literal notranslate"><span class="pre">Any</span></code>
values. Sometimes there is no more precise type you can use for a
particular value, especially if you use dynamic Python features
such as <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__getattr__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__getattr__</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Wrapper</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapped</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, you can create a stub file (<code class="docutils literal notranslate"><span class="pre">.pyi</span></code>) for a file that
generates spurious errors. Mypy will only look at the stub file
and ignore the implementation, since stub files take precedence
over <code class="docutils literal notranslate"><span class="pre">.py</span></code> files.</p>
</section>
<section id="ignoring-a-whole-file">
<h4>Ignoring a whole file<a class="headerlink" href="#ignoring-a-whole-file" title="Permalink to this headline">#</a></h4>
<ul class="simple">
<li><p>To only ignore errors, use a top-level <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">mypy:</span> <span class="pre">ignore-errors</span></code> comment instead.</p></li>
<li><p>To only ignore errors with a specific error code, use a top-level
<code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">mypy:</span> <span class="pre">disable-error-code=&quot;...&quot;</span></code> comment. Example: <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">mypy:</span> <span class="pre">disable-error-code=&quot;truthy-bool,</span> <span class="pre">ignore-without-code&quot;</span></code></p></li>
<li><p>To replace the contents of a module with <code class="docutils literal notranslate"><span class="pre">Any</span></code>, use a per-module <code class="docutils literal notranslate"><span class="pre">follow_imports</span> <span class="pre">=</span> <span class="pre">skip</span></code>.
See <a class="reference internal" href="index.html#follow-imports"><span class="std std-ref">Following imports</span></a> for details.</p></li>
</ul>
<p>Note that a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment at the top of a module (before any statements,
including imports or docstrings) has the effect of ignoring the entire contents of the module.
This behaviour can be surprising and result in
“Module … has no attribute … [attr-defined]” errors.</p>
</section>
<section id="issues-with-code-at-runtime">
<h4>Issues with code at runtime<a class="headerlink" href="#issues-with-code-at-runtime" title="Permalink to this headline">#</a></h4>
<p>Idiomatic use of type annotations can sometimes run up against what a given
version of Python considers legal code. These can result in some of the
following errors when trying to run your code:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ImportError</span></code> from circular imports</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NameError:</span> <span class="pre">name</span> <span class="pre">&quot;X&quot;</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">defined</span></code> from forward references</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TypeError:</span> <span class="pre">'type'</span> <span class="pre">object</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">subscriptable</span></code> from types that are not generic at runtime</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ImportError</span></code> or <code class="docutils literal notranslate"><span class="pre">ModuleNotFoundError</span></code> from use of stub definitions not available at runtime</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TypeError:</span> <span class="pre">unsupported</span> <span class="pre">operand</span> <span class="pre">type(s)</span> <span class="pre">for</span> <span class="pre">|:</span> <span class="pre">'type'</span> <span class="pre">and</span> <span class="pre">'type'</span></code> from use of new syntax</p></li>
</ul>
<p>For dealing with these, see <a class="reference internal" href="index.html#runtime-troubles"><span class="std std-ref">Annotation issues at runtime</span></a>.</p>
</section>
<section id="mypy-runs-are-slow">
<h4>Mypy runs are slow<a class="headerlink" href="#mypy-runs-are-slow" title="Permalink to this headline">#</a></h4>
<p>If your mypy runs feel slow, you should probably use the <a class="reference internal" href="index.html#mypy-daemon"><span class="std std-ref">mypy
daemon</span></a>, which can speed up incremental mypy runtimes by
a factor of 10 or more. <a class="reference internal" href="index.html#remote-cache"><span class="std std-ref">Remote caching</span></a> can
make cold mypy runs several times faster.</p>
</section>
<section id="types-of-empty-collections">
<h4>Types of empty collections<a class="headerlink" href="#types-of-empty-collections" title="Permalink to this headline">#</a></h4>
<p>You often need to specify the type when you assign an empty list or
dict to a new variable, as mentioned earlier:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>Without the annotation mypy can’t always figure out the
precise type of <code class="docutils literal notranslate"><span class="pre">a</span></code>.</p>
<p>You can use a simple empty list literal in a dynamically typed function (as the
type of <code class="docutils literal notranslate"><span class="pre">a</span></code> would be implicitly <code class="docutils literal notranslate"><span class="pre">Any</span></code> and need not be inferred), if type
of the variable has been declared or inferred before, or if you perform a simple
modification operation in the same scope (such as <code class="docutils literal notranslate"><span class="pre">append</span></code> for a list):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># Okay because followed by append, inferred type List[int]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<p>However, in more complex cases an explicit type annotation can be
required (mypy will tell you this). Often the annotation can
make your code easier to understand, so it doesn’t only help mypy but
everybody who is reading the code!</p>
</section>
<section id="redefinitions-with-incompatible-types">
<h4>Redefinitions with incompatible types<a class="headerlink" href="#redefinitions-with-incompatible-types" title="Permalink to this headline">#</a></h4>
<p>Each name within a function only has a single ‘declared’ type. You can
reuse for loop indices etc., but if you want to use a variable with
multiple types within a single function, you may need to instead use
multiple variables (or maybe declare the variable with an <code class="docutils literal notranslate"><span class="pre">Any</span></code> type).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="o">...</span>
    <span class="n">n</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>  <span class="c1"># error: Incompatible types in assignment (expression has type &quot;str&quot;, variable has type &quot;int&quot;)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using the <a class="reference internal" href="index.html#cmdoption-mypy-allow-redefinition"><code class="xref std std-option docutils literal notranslate"><span class="pre">--allow-redefinition</span></code></a>
flag can suppress this error in several cases.</p>
</div>
<p>Note that you can redefine a variable with a more <em>precise</em> or a more
concrete type. For example, you can redefine a sequence (which does
not support <code class="docutils literal notranslate"><span class="pre">sort()</span></code>) as a list and sort it in-place:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Type of x is Sequence[int] here; we don&#39;t know the concrete type.</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="c1"># Type of x is List[int] here.</span>
    <span class="n">x</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>  <span class="c1"># Okay!</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#type-narrowing"><span class="std std-ref">Type narrowing</span></a> for more information.</p>
</section>
<section id="invariance-vs-covariance">
<span id="variance"></span><h4>Invariance vs covariance<a class="headerlink" href="#invariance-vs-covariance" title="Permalink to this headline">#</a></h4>
<p>Most mutable generic collections are invariant, and mypy considers all
user-defined generic classes invariant by default
(see <a class="reference internal" href="index.html#variance-of-generics"><span class="std std-ref">Variance of generic types</span></a> for motivation). This could lead to some
unexpected errors when combined with type inference. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">B</span><span class="p">(</span><span class="n">A</span><span class="p">):</span> <span class="o">...</span>

<span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="p">(),</span> <span class="n">A</span><span class="p">()]</span>  <span class="c1"># Inferred type is List[A]</span>
<span class="n">new_lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">B</span><span class="p">(),</span> <span class="n">B</span><span class="p">()]</span>  <span class="c1"># inferred type is List[B]</span>
<span class="n">lst</span> <span class="o">=</span> <span class="n">new_lst</span>  <span class="c1"># mypy will complain about this, because List is invariant</span>
</pre></div>
</div>
<p>Possible strategies in such situations are:</p>
<ul>
<li><p>Use an explicit type annotation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">new_lst</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">A</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">B</span><span class="p">(),</span> <span class="n">B</span><span class="p">()]</span>
<span class="n">lst</span> <span class="o">=</span> <span class="n">new_lst</span>  <span class="c1"># OK</span>
</pre></div>
</div>
</li>
<li><p>Make a copy of the right hand side:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_lst</span><span class="p">)</span> <span class="c1"># Also OK</span>
</pre></div>
</div>
</li>
<li><p>Use immutable collections as annotations whenever possible:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f_bad</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">A</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">f_bad</span><span class="p">(</span><span class="n">new_lst</span><span class="p">)</span> <span class="c1"># Fails</span>

<span class="k">def</span> <span class="nf">f_good</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">A</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">f_good</span><span class="p">(</span><span class="n">new_lst</span><span class="p">)</span> <span class="c1"># OK</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="declaring-a-supertype-as-variable-type">
<h4>Declaring a supertype as variable type<a class="headerlink" href="#declaring-a-supertype-as-variable-type" title="Permalink to this headline">#</a></h4>
<p>Sometimes the inferred type is a subtype (subclass) of the desired
type. The type inference uses the first assignment to infer the type
of a name:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Shape</span><span class="p">:</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">Circle</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">Triangle</span><span class="p">(</span><span class="n">Shape</span><span class="p">):</span> <span class="o">...</span>

<span class="n">shape</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">()</span>    <span class="c1"># mypy infers the type of shape to be Circle</span>
<span class="n">shape</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">()</span>  <span class="c1"># error: Incompatible types in assignment (expression has type &quot;Triangle&quot;, variable has type &quot;Circle&quot;)</span>
</pre></div>
</div>
<p>You can just give an explicit type for the variable in cases such the
above example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">shape</span><span class="p">:</span> <span class="n">Shape</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">()</span>  <span class="c1"># The variable s can be any Shape, not just Circle</span>
<span class="n">shape</span> <span class="o">=</span> <span class="n">Triangle</span><span class="p">()</span>       <span class="c1"># OK</span>
</pre></div>
</div>
</section>
<section id="complex-type-tests">
<h4>Complex type tests<a class="headerlink" href="#complex-type-tests" title="Permalink to this headline">#</a></h4>
<p>Mypy can usually infer the types correctly when using <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance</span></code></a>,
<a class="reference external" href="https://docs.python.org/3/library/functions.html#issubclass" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">issubclass</span></code></a>,
or <code class="docutils literal notranslate"><span class="pre">type(obj)</span> <span class="pre">is</span> <span class="pre">some_class</span></code> type tests,
and even <a class="reference internal" href="index.html#type-guards"><span class="std std-ref">user-defined type guards</span></a>,
but for other kinds of checks you may need to add an
explicit type cast:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">cast</span>

<span class="k">def</span> <span class="nf">find_first_str</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">index</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No str found&#39;</span><span class="p">)</span>

    <span class="n">found</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>  <span class="c1"># Has type &quot;object&quot;, despite the fact that we know it is &quot;str&quot;</span>
    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>  <span class="c1"># We need an explicit cast to make mypy happy</span>
</pre></div>
</div>
<p>Alternatively, you can use an <code class="docutils literal notranslate"><span class="pre">assert</span></code> statement together with some
of the supported type inference techniques:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_first_str</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">object</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">index</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">)),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No str found&#39;</span><span class="p">)</span>

    <span class="n">found</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>  <span class="c1"># Has type &quot;object&quot;, despite the fact that we know it is &quot;str&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">found</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>  <span class="c1"># Now, &quot;found&quot; will be narrowed to &quot;str&quot;</span>
    <span class="k">return</span> <span class="n">found</span>  <span class="c1"># No need for the explicit &quot;cast()&quot; anymore</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a> type used in the above example is similar
to <code class="docutils literal notranslate"><span class="pre">Object</span></code> in Java: it only supports operations defined for <em>all</em>
objects, such as equality and <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a>. The type <code class="docutils literal notranslate"><span class="pre">Any</span></code>,
in contrast, supports all operations, even if they may fail at
runtime. The cast above would have been unnecessary if the type of
<code class="docutils literal notranslate"><span class="pre">o</span></code> was <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can read more about type narrowing techniques <a class="reference internal" href="index.html#type-narrowing"><span class="std std-ref">here</span></a>.</p>
</div>
<p>Type inference in Mypy is designed to work well in common cases, to be
predictable and to let the type checker give useful error
messages. More powerful type inference strategies often have complex
and difficult-to-predict failure modes and could result in very
confusing error messages. The tradeoff is that you as a programmer
sometimes have to give the type checker a little help.</p>
</section>
<section id="python-version-and-system-platform-checks">
<span id="version-and-platform-checks"></span><h4>Python version and system platform checks<a class="headerlink" href="#python-version-and-system-platform-checks" title="Permalink to this headline">#</a></h4>
<p>Mypy supports the ability to perform Python version checks and platform
checks (e.g. Windows vs Posix), ignoring code paths that won’t be run on
the targeted Python version or platform. This allows you to more effectively
typecheck code that supports multiple versions of Python or multiple operating
systems.</p>
<p>More specifically, mypy will understand the use of <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.version_info" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.version_info</span></code></a> and
<a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.platform" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.platform</span></code></a> checks within <code class="docutils literal notranslate"><span class="pre">if/elif/else</span></code> statements. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># Distinguishing between different versions of Python:</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
    <span class="c1"># Python 3.8+ specific definitions and imports</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Other definitions and imports</span>

<span class="c1"># Distinguishing between different operating systems:</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;linux&quot;</span><span class="p">):</span>
    <span class="c1"># Linux-specific code</span>
<span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>
    <span class="c1"># Mac-specific code</span>
<span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;win32&quot;</span><span class="p">:</span>
    <span class="c1"># Windows-specific code</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Other systems</span>
</pre></div>
</div>
<p>As a special case, you can also use one of these checks in a top-level
(unindented) <code class="docutils literal notranslate"><span class="pre">assert</span></code>; this makes mypy skip the rest of the file.
Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="s1">&#39;win32&#39;</span>

<span class="c1"># The rest of this file doesn&#39;t apply to Windows.</span>
</pre></div>
</div>
<p>Some other expressions exhibit similar behavior; in particular,
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.TYPE_CHECKING" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">TYPE_CHECKING</span></code></a>, variables named <code class="docutils literal notranslate"><span class="pre">MYPY</span></code>, and any variable
whose name is passed to <a class="reference internal" href="index.html#cmdoption-mypy-always-true"><code class="xref std std-option docutils literal notranslate"><span class="pre">--always-true</span></code></a> or <a class="reference internal" href="index.html#cmdoption-mypy-always-false"><code class="xref std std-option docutils literal notranslate"><span class="pre">--always-false</span></code></a>.
(However, <code class="docutils literal notranslate"><span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code> are not treated specially!)</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Mypy currently does not support more complex checks, and does not assign
any special meaning when assigning a <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.version_info" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.version_info</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.platform" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.platform</span></code></a>
check to a variable. This may change in future versions of mypy.</p>
</div>
<p>By default, mypy will use your current version of Python and your current
operating system as default values for <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.version_info" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.version_info</span></code></a> and
<a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.platform" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.platform</span></code></a>.</p>
<p>To target a different Python version, use the <a class="reference internal" href="index.html#cmdoption-mypy-python-version"><code class="xref std std-option docutils literal notranslate"><span class="pre">--python-version</span> <span class="pre">X.Y</span></code></a> flag.
For example, to verify your code typechecks if were run using Python 3.8, pass
in <a class="reference internal" href="index.html#cmdoption-mypy-python-version"><code class="xref std std-option docutils literal notranslate"><span class="pre">--python-version</span> <span class="pre">3.8</span></code></a> from the command line. Note that you do not need
to have Python 3.8 installed to perform this check.</p>
<p>To target a different operating system, use the <a class="reference internal" href="index.html#cmdoption-mypy-platform"><code class="xref std std-option docutils literal notranslate"><span class="pre">--platform</span> <span class="pre">PLATFORM</span></code></a> flag.
For example, to verify your code typechecks if it were run in Windows, pass
in <a class="reference internal" href="index.html#cmdoption-mypy-platform"><code class="xref std std-option docutils literal notranslate"><span class="pre">--platform</span> <span class="pre">win32</span></code></a>. See the documentation for <a class="reference external" href="https://docs.python.org/3/library/sys.html#sys.platform" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">sys.platform</span></code></a>
for examples of valid platform parameters.</p>
</section>
<section id="displaying-the-type-of-an-expression">
<span id="reveal-type"></span><h4>Displaying the type of an expression<a class="headerlink" href="#displaying-the-type-of-an-expression" title="Permalink to this headline">#</a></h4>
<p>You can use <code class="docutils literal notranslate"><span class="pre">reveal_type(expr)</span></code> to ask mypy to display the inferred
static type of an expression. This can be useful when you don’t quite
understand how mypy handles a particular piece of code. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reveal_type</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">))</span>  <span class="c1"># Revealed type is &quot;Tuple[builtins.int, builtins.str]&quot;</span>
</pre></div>
</div>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">reveal_locals()</span></code> at any line in a file
to see the types of all local variables at once. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">b</span> <span class="o">=</span> <span class="s1">&#39;one&#39;</span>
<span class="n">reveal_locals</span><span class="p">()</span>
<span class="c1"># Revealed local types are:</span>
<span class="c1">#     a: builtins.int</span>
<span class="c1">#     b: builtins.str</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">reveal_type</span></code> and <code class="docutils literal notranslate"><span class="pre">reveal_locals</span></code> are only understood by mypy and
don’t exist in Python. If you try to run your program, you’ll have to
remove any <code class="docutils literal notranslate"><span class="pre">reveal_type</span></code> and <code class="docutils literal notranslate"><span class="pre">reveal_locals</span></code> calls before you can
run your code. Both are always available and you don’t need to import
them.</p>
</div>
</section>
<section id="silencing-linters">
<span id="id1"></span><h4>Silencing linters<a class="headerlink" href="#silencing-linters" title="Permalink to this headline">#</a></h4>
<p>In some cases, linters will complain about unused imports or code. In
these cases, you can silence them with a comment after type comments, or on
the same line as the import:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># to silence complaints about unused imports</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>  <span class="c1"># noqa</span>
<span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: List[int]</span>
</pre></div>
</div>
<p>To silence the linter on the same line as a type comment
put the linter comment <em>after</em> the type comment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">some_complex_thing</span><span class="p">()</span>  <span class="c1"># type: ignore  # noqa</span>
</pre></div>
</div>
</section>
<section id="covariant-subtyping-of-mutable-protocol-members-is-rejected">
<h4>Covariant subtyping of mutable protocol members is rejected<a class="headerlink" href="#covariant-subtyping-of-mutable-protocol-members-is-rejected" title="Permalink to this headline">#</a></h4>
<p>Mypy rejects this because this is potentially unsafe.
Consider this example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="k">class</span> <span class="nc">P</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">float</span>

<span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="n">P</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">arg</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">3.14</span>

<span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">C</span><span class="p">()</span>
<span class="n">fun</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># This is not safe</span>
<span class="n">c</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span>  <span class="c1"># Since this will fail!</span>
</pre></div>
</div>
<p>To work around this problem consider whether “mutating” is actually part
of a protocol. If not, then one can use a <a class="reference external" href="https://docs.python.org/3/library/functions.html#property" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">&#64;property</span></code></a> in
the protocol definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="k">class</span> <span class="nc">P</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
       <span class="k">pass</span>

<span class="k">def</span> <span class="nf">fun</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="n">P</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">fun</span><span class="p">(</span><span class="n">C</span><span class="p">())</span>  <span class="c1"># OK</span>
</pre></div>
</div>
</section>
<section id="dealing-with-conflicting-names">
<h4>Dealing with conflicting names<a class="headerlink" href="#dealing-with-conflicting-names" title="Permalink to this headline">#</a></h4>
<p>Suppose you have a class with a method whose name is the same as an
imported (or built-in) type, and you want to use the type in another
method signature.  E.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Message</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>  <span class="c1"># error: Invalid type &quot;mod.Message.bytes&quot;</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>The third line elicits an error because mypy sees the argument type
<code class="docutils literal notranslate"><span class="pre">bytes</span></code> as a reference to the method by that name.  Other than
renaming the method, a workaround is to use an alias:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bytes_</span> <span class="o">=</span> <span class="nb">bytes</span>
<span class="k">class</span> <span class="nc">Message</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">bytes_</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="using-a-development-mypy-build">
<h4>Using a development mypy build<a class="headerlink" href="#using-a-development-mypy-build" title="Permalink to this headline">#</a></h4>
<p>You can install the latest development version of mypy from source. Clone the
<a class="reference external" href="https://github.com/python/mypy">mypy repository on GitHub</a>, and then run
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> locally:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/python/mypy.git
cd mypy
python3 -m pip install --upgrade .
</pre></div>
</div>
<p>To install a development version of mypy that is mypyc-compiled, see the
instructions at the <a class="reference external" href="https://github.com/mypyc/mypy_mypyc-wheels">mypyc wheels repo</a>.</p>
</section>
<section id="variables-vs-type-aliases">
<h4>Variables vs type aliases<a class="headerlink" href="#variables-vs-type-aliases" title="Permalink to this headline">#</a></h4>
<p>Mypy has both <em>type aliases</em> and variables with types like <code class="docutils literal notranslate"><span class="pre">Type[...]</span></code>. These are
subtly different, and it’s important to understand how they differ to avoid pitfalls.</p>
<ol class="arabic">
<li><p>A variable with type <code class="docutils literal notranslate"><span class="pre">Type[...]</span></code> is defined using an assignment with an
explicit type annotation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="o">...</span>
<span class="n">tp</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">A</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span>
</pre></div>
</div>
</li>
<li><p>You can define a type alias using an assignment without an explicit type annotation
at the top level of a module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="o">...</span>
<span class="n">Alias</span> <span class="o">=</span> <span class="n">A</span>
</pre></div>
</div>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">TypeAlias</span></code> (<span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0613/"><strong>PEP 613</strong></a>) to define an <em>explicit type alias</em>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeAlias</span>  <span class="c1"># &quot;from typing_extensions&quot; in Python 3.9 and earlier</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="o">...</span>
<span class="n">Alias</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="n">A</span>
</pre></div>
</div>
<p>You should always use <code class="docutils literal notranslate"><span class="pre">TypeAlias</span></code> to define a type alias in a class body or
inside a function.</p>
</li>
</ol>
<p>The main difference is that the target of an alias is precisely known statically, and this
means that they can be used in type annotations and other <em>type contexts</em>. Type aliases
can’t be defined conditionally (unless using
<a class="reference internal" href="#version-and-platform-checks"><span class="std std-ref">supported Python version and platform checks</span></a>):</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">B</span><span class="p">:</span> <span class="o">...</span>

<span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
    <span class="n">Alias</span> <span class="o">=</span> <span class="n">A</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># error: Cannot assign multiple types to name &quot;Alias&quot; without an</span>
    <span class="c1"># explicit &quot;Type[...]&quot; annotation</span>
    <span class="n">Alias</span> <span class="o">=</span> <span class="n">B</span>

<span class="n">tp</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span>  <span class="c1"># &quot;tp&quot; is a variable with a type object value</span>
<span class="k">if</span> <span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="n">A</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="n">B</span>  <span class="c1"># This is OK</span>

<span class="k">def</span> <span class="nf">fun1</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Alias</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>  <span class="c1"># OK</span>
<span class="k">def</span> <span class="nf">fun2</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">tp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>  <span class="c1"># Error: &quot;tp&quot; is not valid as a type</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="incompatible-overrides">
<h4>Incompatible overrides<a class="headerlink" href="#incompatible-overrides" title="Permalink to this headline">#</a></h4>
<p>It’s unsafe to override a method with a more specific argument type,
as it violates the <a class="reference external" href="https://stackoverflow.com/questions/56860/what-is-an-example-of-the-liskov-substitution-principle">Liskov substitution principle</a>.
For return types, it’s unsafe to override a method with a more general
return type.</p>
<p>Other incompatible signature changes in method overrides, such as
adding an extra required parameter, or removing an optional parameter,
will also generate errors. The signature of a method in a subclass
should accept all valid calls to the base class method. Mypy
treats a subclass as a subtype of the base class. An instance of a
subclass is valid everywhere where an instance of the base class is
valid.</p>
<p>This example demonstrates both safe and unsafe overrides:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Iterable</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">GeneralizedArgument</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="c1"># A more general argument type is okay</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>  <span class="c1"># OK</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">NarrowerArgument</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="c1"># A more specific argument type isn&#39;t accepted</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>  <span class="c1"># Error</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">NarrowerReturn</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="c1"># A more specific return type is fine</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>  <span class="c1"># OK</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">GeneralizedReturn</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="c1"># A more general return type is an error</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>  <span class="c1"># Error</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>You can use <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore[override]</span></code> to silence the error. Add it
to the line that generates the error, if you decide that type safety is
not necessary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NarrowerArgument</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>  <span class="c1"># type: ignore[override]</span>
        <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="unreachable-code">
<span id="unreachable"></span><h4>Unreachable code<a class="headerlink" href="#unreachable-code" title="Permalink to this headline">#</a></h4>
<p>Mypy may consider some code as <em>unreachable</em>, even if it might not be
immediately obvious why.  It’s important to note that mypy will <em>not</em>
type check such code. Consider this example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">def</span> <span class="nf">bar</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">foo</span><span class="p">:</span> <span class="n">Foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
    <span class="k">return</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span>  <span class="c1"># Unreachable -- no error</span>
</pre></div>
</div>
<p>It’s easy to see that any statement after <code class="docutils literal notranslate"><span class="pre">return</span></code> is unreachable,
and hence mypy will not complain about the mis-typed code below
it. For a more subtle example, consider this code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">def</span> <span class="nf">bar</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">foo</span><span class="p">:</span> <span class="n">Foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">foo</span><span class="o">.</span><span class="n">bar</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span>  <span class="c1"># Unreachable -- no error</span>
</pre></div>
</div>
<p>Again, mypy will not report any errors. The type of <code class="docutils literal notranslate"><span class="pre">foo.bar</span></code> is
<code class="docutils literal notranslate"><span class="pre">str</span></code>, and mypy reasons that it can never be <code class="docutils literal notranslate"><span class="pre">None</span></code>.  Hence the
<code class="docutils literal notranslate"><span class="pre">assert</span></code> statement will always fail and the statement below will
never be executed.  (Note that in Python, <code class="docutils literal notranslate"><span class="pre">None</span></code> is not an empty
reference but an object of type <code class="docutils literal notranslate"><span class="pre">None</span></code>.)</p>
<p>In this example mypy will go on to check the last line and report an
error, since mypy thinks that the condition could be either True or
False:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">def</span> <span class="nf">bar</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">foo</span><span class="p">:</span> <span class="n">Foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span>  <span class="c1"># Reachable -- error</span>
</pre></div>
</div>
<p>If you use the <a class="reference internal" href="index.html#cmdoption-mypy-warn-unreachable"><code class="xref std std-option docutils literal notranslate"><span class="pre">--warn-unreachable</span></code></a> flag, mypy will generate
an error about each unreachable code block.</p>
</section>
<section id="narrowing-and-inner-functions">
<h4>Narrowing and inner functions<a class="headerlink" href="#narrowing-and-inner-functions" title="Permalink to this headline">#</a></h4>
<p>Because closures in Python are late-binding (<a class="reference external" href="https://docs.python-guide.org/writing/gotchas/#late-binding-closures">https://docs.python-guide.org/writing/gotchas/#late-binding-closures</a>),
mypy will not narrow the type of a captured variable in an inner function.
This is best understood via an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># mypy correctly deduces x must be an int here</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># but (correctly) complains about this line</span>

    <span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># because x could later be assigned None</span>
    <span class="k">return</span> <span class="n">inner</span>

<span class="n">inner</span> <span class="o">=</span> <span class="n">foo</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">inner</span><span class="p">()</span>  <span class="c1"># this will raise an error when called</span>
</pre></div>
</div>
<p>To get this code to type check, you could assign <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">x</span></code> after <code class="docutils literal notranslate"><span class="pre">x</span></code> has been
narrowed, and use <code class="docutils literal notranslate"><span class="pre">y</span></code> in the inner function, or add an assert in the inner
function.</p>
</section>
</section>
<span id="document-supported_python_features"></span><section id="supported-python-features">
<h3>Supported Python features<a class="headerlink" href="#supported-python-features" title="Permalink to this headline">#</a></h3>
<p>A list of unsupported Python features is maintained in the mypy wiki:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/python/mypy/wiki/Unsupported-Python-Features">Unsupported Python features</a></p></li>
</ul>
<section id="runtime-definition-of-methods-and-functions">
<h4>Runtime definition of methods and functions<a class="headerlink" href="#runtime-definition-of-methods-and-functions" title="Permalink to this headline">#</a></h4>
<p>By default, mypy will complain if you add a function to a class
or module outside its definition – but only if this is visible to the
type checker. This only affects static checking, as mypy performs no
additional type checking at runtime. You can easily work around
this. For example, you can use dynamically typed code or values with
<code class="docutils literal notranslate"><span class="pre">Any</span></code> types, or you can use <a class="reference external" href="https://docs.python.org/3/library/functions.html#setattr" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">setattr()</span></code></a> or other introspection
features. However, you need to be careful if you decide to do this. If
used indiscriminately, you may have difficulty using static typing
effectively, since the type checker cannot see functions defined at
runtime.</p>
</section>
</section>
<span id="document-error_codes"></span><section id="error-codes">
<span id="id1"></span><h3>Error codes<a class="headerlink" href="#error-codes" title="Permalink to this headline">#</a></h3>
<p>Mypy can optionally display an error code such as <code class="docutils literal notranslate"><span class="pre">[attr-defined]</span></code>
after each error message. Error codes serve two purposes:</p>
<ol class="arabic simple">
<li><p>It’s possible to silence specific error codes on a line using <code class="docutils literal notranslate"><span class="pre">#</span>
<span class="pre">type:</span> <span class="pre">ignore[code]</span></code>. This way you won’t accidentally ignore other,
potentially more serious errors.</p></li>
<li><p>The error code can be used to find documentation about the error.
The next two topics (<a class="reference internal" href="index.html#error-code-list"><span class="std std-ref">Error codes enabled by default</span></a> and
<a class="reference internal" href="index.html#error-codes-optional"><span class="std std-ref">Error codes for optional checks</span></a>) document the various error codes
mypy can report.</p></li>
</ol>
<p>Most error codes are shared between multiple related error messages.
Error codes may change in future mypy releases.</p>
<section id="displaying-error-codes">
<h4>Displaying error codes<a class="headerlink" href="#displaying-error-codes" title="Permalink to this headline">#</a></h4>
<p>Error codes are displayed by default.  Use <a class="reference internal" href="index.html#cmdoption-mypy-hide-error-codes"><code class="xref std std-option docutils literal notranslate"><span class="pre">--hide-error-codes</span></code></a>
or config <code class="docutils literal notranslate"><span class="pre">hide_error_codes</span> <span class="pre">=</span> <span class="pre">True</span></code> to hide error codes. Error codes are shown inside square brackets:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ mypy prog.py
prog.py:1: error: &quot;str&quot; has no attribute &quot;trim&quot;  [attr-defined]
</pre></div>
</div>
<p>It’s also possible to require error codes for <code class="docutils literal notranslate"><span class="pre">type:</span> <span class="pre">ignore</span></code> comments.
See <a class="reference internal" href="index.html#code-ignore-without-code"><span class="std std-ref">ignore-without-code</span></a> for more information.</p>
</section>
<section id="silencing-errors-based-on-error-codes">
<span id="silence-error-codes"></span><h4>Silencing errors based on error codes<a class="headerlink" href="#silencing-errors-based-on-error-codes" title="Permalink to this headline">#</a></h4>
<p>You can use a special comment <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore[code,</span> <span class="pre">...]</span></code> to only
ignore errors with a specific error code (or codes) on a particular
line.  This can be used even if you have not configured mypy to show
error codes.</p>
<p>This example shows how to ignore an error about an imported name mypy
thinks is undefined:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &#39;foo&#39; is defined in &#39;foolib&#39;, even though mypy can&#39;t see the</span>
<span class="c1"># definition.</span>
<span class="kn">from</span> <span class="nn">foolib</span> <span class="kn">import</span> <span class="n">foo</span>  <span class="c1"># type: ignore[attr-defined]</span>
</pre></div>
</div>
</section>
<section id="enabling-disabling-specific-error-codes-globally">
<h4>Enabling/disabling specific error codes globally<a class="headerlink" href="#enabling-disabling-specific-error-codes-globally" title="Permalink to this headline">#</a></h4>
<p>There are command-line flags and config file settings for enabling
certain optional error codes, such as <a class="reference internal" href="index.html#cmdoption-mypy-disallow-untyped-defs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-untyped-defs</span></code></a>,
which enables the <code class="docutils literal notranslate"><span class="pre">no-untyped-def</span></code> error code.</p>
<p>You can use <a class="reference internal" href="index.html#cmdoption-mypy-enable-error-code"><code class="xref std std-option docutils literal notranslate"><span class="pre">--enable-error-code</span></code></a>
and <a class="reference internal" href="index.html#cmdoption-mypy-disable-error-code"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disable-error-code</span></code></a>
to enable or disable specific error codes that don’t have a dedicated
command-line flag or config file setting.</p>
</section>
<section id="per-module-enabling-disabling-error-codes">
<h4>Per-module enabling/disabling error codes<a class="headerlink" href="#per-module-enabling-disabling-error-codes" title="Permalink to this headline">#</a></h4>
<p>You can use <a class="reference internal" href="index.html#config-file"><span class="std std-ref">configuration file</span></a> sections to enable or
disable specific error codes only in some modules. For example, this <code class="docutils literal notranslate"><span class="pre">mypy.ini</span></code>
config will enable non-annotated empty containers in tests, while keeping
other parts of code checked in strict mode:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[mypy]</span>
<span class="na">strict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>

<span class="k">[mypy-tests.*]</span>
<span class="na">allow_untyped_defs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<span class="na">allow_untyped_calls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<span class="na">disable_error_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">var-annotated, has-type</span>
</pre></div>
</div>
<p>Note that per-module enabling/disabling acts as override over the global
options. So that you don’t need to repeat the error code lists for each
module if you have them in global config section. For example:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[mypy]</span>
<span class="na">enable_error_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">truthy-bool, ignore-without-code, unused-awaitable</span>

<span class="k">[mypy-extensions.*]</span>
<span class="na">disable_error_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">unused-awaitable</span>
</pre></div>
</div>
<p>The above config will allow unused awaitables in extension modules, but will
still keep the other two error codes enabled. The overall logic is following:</p>
<ul class="simple">
<li><p>Command line and/or config main section set global error codes</p></li>
<li><p>Individual config sections <em>adjust</em> them per glob/module</p></li>
<li><p>Inline <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">mypy:</span> <span class="pre">disable-error-code=&quot;...&quot;</span></code> comments can further
<em>adjust</em> them for a specific module.
For example: <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">mypy:</span> <span class="pre">disable-error-code=&quot;truthy-bool,</span> <span class="pre">ignore-without-code&quot;</span></code></p></li>
</ul>
<p>So one can e.g. enable some code globally, disable it for all tests in
the corresponding config section, and then re-enable it with an inline
comment in some specific test.</p>
</section>
<section id="subcodes-of-error-codes">
<h4>Subcodes of error codes<a class="headerlink" href="#subcodes-of-error-codes" title="Permalink to this headline">#</a></h4>
<p>In some cases, mostly for backwards compatibility reasons, an error
code may be covered also by another, wider error code. For example, an error with
code <code class="docutils literal notranslate"><span class="pre">[method-assign]</span></code> can be ignored by <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore[assignment]</span></code>.
Similar logic works for disabling error codes globally. If a given error code
is a subcode of another one, it will be mentioned in the documentation for the narrower
code. This hierarchy is not nested: there cannot be subcodes of other
subcodes.</p>
</section>
</section>
<span id="document-error_code_list"></span><section id="error-codes-enabled-by-default">
<span id="error-code-list"></span><h3>Error codes enabled by default<a class="headerlink" href="#error-codes-enabled-by-default" title="Permalink to this headline">#</a></h3>
<p>This section documents various errors codes that mypy can generate
with default options. See <a class="reference internal" href="index.html#error-codes"><span class="std std-ref">Error codes</span></a> for general documentation
about error codes. <a class="reference internal" href="index.html#error-codes-optional"><span class="std std-ref">Error codes for optional checks</span></a> documents additional
error codes that you can enable.</p>
<section id="check-that-attribute-exists-attr-defined">
<span id="code-attr-defined"></span><h4>Check that attribute exists [attr-defined]<a class="headerlink" href="#check-that-attribute-exists-attr-defined" title="Permalink to this headline">#</a></h4>
<p>Mypy checks that an attribute is defined in the target class or module
when using the dot operator. This applies to both getting and setting
an attribute. New attributes are defined by assignments in the class
body, or assignments to <code class="docutils literal notranslate"><span class="pre">self.x</span></code> in methods. These assignments don’t
generate <code class="docutils literal notranslate"><span class="pre">attr-defined</span></code> errors.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Resource</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">Resource</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>  <span class="c1"># Error: &quot;Resource&quot; has no attribute &quot;id&quot;  [attr-defined]</span>
<span class="n">r</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Error: &quot;Resource&quot; has no attribute &quot;id&quot;  [attr-defined]</span>
</pre></div>
</div>
<p>This error code is also generated if an imported name is not defined
in the module in a <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">...</span> <span class="pre">import</span></code> statement (as long as the
target module can be found):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error: Module &quot;os&quot; has no attribute &quot;non_existent&quot;  [attr-defined]</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">non_existent</span>
</pre></div>
</div>
<p>A reference to a missing attribute is given the <code class="docutils literal notranslate"><span class="pre">Any</span></code> type. In the
above example, the type of <code class="docutils literal notranslate"><span class="pre">non_existent</span></code> will be <code class="docutils literal notranslate"><span class="pre">Any</span></code>, which can
be important if you silence the error.</p>
</section>
<section id="check-that-attribute-exists-in-each-union-item-union-attr">
<span id="code-union-attr"></span><h4>Check that attribute exists in each union item [union-attr]<a class="headerlink" href="#check-that-attribute-exists-in-each-union-item-union-attr" title="Permalink to this headline">#</a></h4>
<p>If you access the attribute of a value with a union type, mypy checks
that the attribute is defined for <em>every</em> type in that
union. Otherwise the operation can fail at runtime. This also applies
to optional types.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="k">class</span> <span class="nc">Cat</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">sleep</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">miaow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">Dog</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">sleep</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>
    <span class="k">def</span> <span class="nf">follow_me</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">animal</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Cat</span><span class="p">,</span> <span class="n">Dog</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># OK: &#39;sleep&#39; is defined for both Cat and Dog</span>
    <span class="n">animal</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
    <span class="c1"># Error: Item &quot;Cat&quot; of &quot;Union[Cat, Dog]&quot; has no attribute &quot;follow_me&quot;  [union-attr]</span>
    <span class="n">animal</span><span class="o">.</span><span class="n">follow_me</span><span class="p">()</span>
</pre></div>
</div>
<p>You can often work around these errors by using <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">isinstance(obj,</span> <span class="pre">ClassName)</span></code>
or <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">obj</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">None</span></code> to tell mypy that you know that the type is more specific
than what mypy thinks.</p>
</section>
<section id="check-that-name-is-defined-name-defined">
<span id="code-name-defined"></span><h4>Check that name is defined [name-defined]<a class="headerlink" href="#check-that-name-is-defined-name-defined" title="Permalink to this headline">#</a></h4>
<p>Mypy expects that all references to names have a corresponding
definition in an active scope, such as an assignment, function
definition or an import. This can catch missing definitions, missing
imports, and typos.</p>
<p>This example accidentally calls <code class="docutils literal notranslate"><span class="pre">sort()</span></code> instead of <a class="reference external" href="https://docs.python.org/3/library/functions.html#sorted" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">sorted()</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">sort</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>  <span class="c1"># Error: Name &quot;sort&quot; is not defined  [name-defined]</span>
</pre></div>
</div>
</section>
<section id="check-that-a-variable-is-not-used-before-it-s-defined-used-before-def">
<span id="code-used-before-def"></span><h4>Check that a variable is not used before it’s defined [used-before-def]<a class="headerlink" href="#check-that-a-variable-is-not-used-before-it-s-defined-used-before-def" title="Permalink to this headline">#</a></h4>
<p>Mypy will generate an error if a name is used before it’s defined.
While the name-defined check will catch issues with names that are undefined,
it will not flag if a variable is used and then defined later in the scope.
used-before-def check will catch such cases.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Error: Name &quot;x&quot; is used before definition [used-before-def]</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">123</span>
</pre></div>
</div>
</section>
<section id="check-arguments-in-calls-call-arg">
<span id="code-call-arg"></span><h4>Check arguments in calls [call-arg]<a class="headerlink" href="#check-arguments-in-calls-call-arg" title="Permalink to this headline">#</a></h4>
<p>Mypy expects that the number and names of arguments match the called function.
Note that argument type checks have a separate error code <code class="docutils literal notranslate"><span class="pre">arg-type</span></code>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Sequence</span>

<span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="n">greet</span><span class="p">(</span><span class="s1">&#39;jack&#39;</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="n">greet</span><span class="p">(</span><span class="s1">&#39;jill&#39;</span><span class="p">,</span> <span class="s1">&#39;jack&#39;</span><span class="p">)</span>  <span class="c1"># Error: Too many arguments for &quot;greet&quot;  [call-arg]</span>
</pre></div>
</div>
</section>
<section id="check-argument-types-arg-type">
<span id="code-arg-type"></span><h4>Check argument types [arg-type]<a class="headerlink" href="#check-argument-types-arg-type" title="Permalink to this headline">#</a></h4>
<p>Mypy checks that argument types in a call match the declared argument
types in the signature of the called function (if one exists).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="mi">0</span>

<span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="c1"># Error: Argument 1 to &quot;first&quot; has incompatible type &quot;tuple[int, int]&quot;;</span>
<span class="c1">#        expected &quot;list[int]&quot;  [arg-type]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="check-calls-to-overloaded-functions-call-overload">
<span id="code-call-overload"></span><h4>Check calls to overloaded functions [call-overload]<a class="headerlink" href="#check-calls-to-overloaded-functions-call-overload" title="Permalink to this headline">#</a></h4>
<p>When you call an overloaded function, mypy checks that at least one of
the signatures of the overload items match the argument types in the
call.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">overload</span><span class="p">,</span> <span class="n">Optional</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">inc_maybe</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">inc_maybe</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">inc_maybe</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
     <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="k">return</span> <span class="kc">None</span>
     <span class="k">else</span><span class="p">:</span>
         <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">inc_maybe</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="n">inc_maybe</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># OK</span>

<span class="c1"># Error: No overload variant of &quot;inc_maybe&quot; matches argument type &quot;float&quot;  [call-overload]</span>
<span class="n">inc_maybe</span><span class="p">(</span><span class="mf">1.2</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="check-validity-of-types-valid-type">
<span id="code-valid-type"></span><h4>Check validity of types [valid-type]<a class="headerlink" href="#check-validity-of-types-valid-type" title="Permalink to this headline">#</a></h4>
<p>Mypy checks that each type annotation and any expression that
represents a type is a valid type. Examples of valid types include
classes, union types, callable types, type aliases, and literal types.
Examples of invalid types include bare integer literals, functions,
variables, and modules.</p>
<p>This example incorrectly uses the function <code class="docutils literal notranslate"><span class="pre">log</span></code> as a type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;log:&#39;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="c1"># Error: Function &quot;t.log&quot; is not valid as a type  [valid-type]</span>
<span class="k">def</span> <span class="nf">log_all</span><span class="p">(</span><span class="n">objs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">object</span><span class="p">],</span> <span class="n">f</span><span class="p">:</span> <span class="n">log</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
        <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>You can use <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a> as the type for callable objects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>

<span class="c1"># OK</span>
<span class="k">def</span> <span class="nf">log_all</span><span class="p">(</span><span class="n">objs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">object</span><span class="p">],</span> <span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">object</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
        <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="require-annotation-if-variable-type-is-unclear-var-annotated">
<span id="code-var-annotated"></span><h4>Require annotation if variable type is unclear [var-annotated]<a class="headerlink" href="#require-annotation-if-variable-type-is-unclear-var-annotated" title="Permalink to this headline">#</a></h4>
<p>In some cases mypy can’t infer the type of a variable without an
explicit annotation. Mypy treats this as an error. This typically
happens when you initialize a variable with an empty collection or
<code class="docutils literal notranslate"><span class="pre">None</span></code>.  If mypy can’t infer the collection item type, mypy replaces
any parts of the type it couldn’t infer with <code class="docutils literal notranslate"><span class="pre">Any</span></code> and generates an
error.</p>
<p>Example with an error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Bundle</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Error: Need type annotation for &quot;items&quot;</span>
        <span class="c1">#        (hint: &quot;items: list[&lt;type&gt;] = ...&quot;)  [var-annotated]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">reveal_type</span><span class="p">(</span><span class="n">Bundle</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>  <span class="c1"># list[Any]</span>
</pre></div>
</div>
<p>To address this, we add an explicit annotation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="k">class</span> <span class="nc">Bundle</span><span class="p">:</span>
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># OK</span>

<span class="n">reveal_type</span><span class="p">(</span><span class="n">Bundle</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>  <span class="c1"># list[str]</span>
</pre></div>
</div>
</section>
<section id="check-validity-of-overrides-override">
<span id="code-override"></span><h4>Check validity of overrides [override]<a class="headerlink" href="#check-validity-of-overrides-override" title="Permalink to this headline">#</a></h4>
<p>Mypy checks that an overridden method or attribute is compatible with
the base class.  A method in a subclass must accept all arguments
that the base class method accepts, and the return type must conform
to the return type in the base class (Liskov substitution principle).</p>
<p>Argument types can be more general is a subclass (i.e., they can vary
contravariantly).  The return type can be narrowed in a subclass
(i.e., it can vary covariantly).  It’s okay to define additional
arguments in a subclass method, as long all extra arguments have default
values or can be left out (<code class="docutils literal notranslate"><span class="pre">*args</span></code>, for example).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">arg</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">Derived</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">arg</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># OK</span>
        <span class="o">...</span>

<span class="k">class</span> <span class="nc">DerivedBad</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># Error: Argument 1 of &quot;method&quot; is incompatible with &quot;Base&quot;  [override]</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">arg</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="check-that-function-returns-a-value-return">
<span id="code-return"></span><h4>Check that function returns a value [return]<a class="headerlink" href="#check-that-function-returns-a-value-return" title="Permalink to this headline">#</a></h4>
<p>If a function has a non-<code class="docutils literal notranslate"><span class="pre">None</span></code> return type, mypy expects that the
function always explicitly returns a value (or raises an exception).
The function should not fall off the end of the function, since this
is often a bug.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error: Missing return statement  [return]</span>
<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Error: Missing return statement  [return]</span>
<span class="k">def</span> <span class="nf">pred1</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c1"># OK</span>
<span class="k">def</span> <span class="nf">pred2</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;not defined for zero&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="check-that-functions-don-t-have-empty-bodies-outside-stubs-empty-body">
<span id="code-empty-body"></span><h4>Check that functions don’t have empty bodies outside stubs [empty-body]<a class="headerlink" href="#check-that-functions-don-t-have-empty-bodies-outside-stubs-empty-body" title="Permalink to this headline">#</a></h4>
<p>This error code is similar to the <code class="docutils literal notranslate"><span class="pre">[return]</span></code> code but is emitted specifically
for functions and methods with empty bodies (if they are annotated with
non-trivial return type). Such a distinction exists because in some contexts
an empty body can be valid, for example for an abstract method or in a stub
file. Also old versions of mypy used to unconditionally allow functions with
empty bodies, so having a dedicated error code simplifies cross-version
compatibility.</p>
<p>Note that empty bodies are allowed for methods in <em>protocols</em>, and such methods
are considered implicitly abstract:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Protocol</span>

<span class="k">class</span> <span class="nc">RegularABC</span><span class="p">:</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># OK</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># Error: Missing return statement  [empty-body]</span>

<span class="k">class</span> <span class="nc">Proto</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># OK</span>
</pre></div>
</div>
</section>
<section id="check-that-return-value-is-compatible-return-value">
<span id="code-return-value"></span><h4>Check that return value is compatible [return-value]<a class="headerlink" href="#check-that-return-value-is-compatible-return-value" title="Permalink to this headline">#</a></h4>
<p>Mypy checks that the returned value is compatible with the type
signature of the function.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># Error: Incompatible return value type (got &quot;int&quot;, expected &quot;str&quot;)  [return-value]</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="check-types-in-assignment-statement-assignment">
<span id="code-assignment"></span><h4>Check types in assignment statement [assignment]<a class="headerlink" href="#check-types-in-assignment-statement-assignment" title="Permalink to this headline">#</a></h4>
<p>Mypy checks that the assigned expression is compatible with the
assignment target (or targets).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Resource</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">Resource</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>

<span class="n">r</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span>  <span class="c1"># OK</span>

<span class="c1"># Error: Incompatible types in assignment (expression has type &quot;int&quot;,</span>
<span class="c1">#        variable has type &quot;str&quot;)  [assignment]</span>
<span class="n">r</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</section>
<section id="check-that-assignment-target-is-not-a-method-method-assign">
<span id="code-method-assign"></span><h4>Check that assignment target is not a method [method-assign]<a class="headerlink" href="#check-that-assignment-target-is-not-a-method-method-assign" title="Permalink to this headline">#</a></h4>
<p>In general, assigning to a method on class object or instance (a.k.a.
monkey-patching) is ambiguous in terms of types, since Python’s static type
system cannot express the difference between bound and unbound callable types.
Consider this example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>
    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>

<span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="k">pass</span>

<span class="n">A</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">h</span>  <span class="c1"># Type of h is Callable[[A], None]</span>
<span class="n">A</span><span class="p">()</span><span class="o">.</span><span class="n">f</span><span class="p">()</span>  <span class="c1"># This works</span>
<span class="n">A</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">A</span><span class="p">()</span><span class="o">.</span><span class="n">g</span>  <span class="c1"># Type of A().g is Callable[[], None]</span>
<span class="n">A</span><span class="p">()</span><span class="o">.</span><span class="n">f</span><span class="p">()</span>  <span class="c1"># ...but this also works at runtime</span>
</pre></div>
</div>
<p>To prevent the ambiguity, mypy will flag both assignments by default. If this
error code is disabled, mypy will treat the assigned value in all method assignments as unbound,
so only the second assignment will still generate an error.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This error code is a subcode of the more general <code class="docutils literal notranslate"><span class="pre">[assignment]</span></code> code.</p>
</div>
</section>
<section id="check-type-variable-values-type-var">
<span id="code-type-var"></span><h4>Check type variable values [type-var]<a class="headerlink" href="#check-type-variable-values-type-var" title="Permalink to this headline">#</a></h4>
<p>Mypy checks that value of a type variable is compatible with a value
restriction or the upper bound type.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span>

<span class="n">T1</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T1&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">T1</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">T1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T1</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">)</span>  <span class="c1"># OK</span>

<span class="c1"># Error: Value of type variable &quot;T1&quot; of &quot;add&quot; cannot be &quot;str&quot;  [type-var]</span>
<span class="n">add</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="check-uses-of-various-operators-operator">
<span id="code-operator"></span><h4>Check uses of various operators [operator]<a class="headerlink" href="#check-uses-of-various-operators-operator" title="Permalink to this headline">#</a></h4>
<p>Mypy checks that operands support a binary or unary operation, such as
<code class="docutils literal notranslate"><span class="pre">+</span></code> or <code class="docutils literal notranslate"><span class="pre">~</span></code>. Indexing operations are so common that they have their
own error code <code class="docutils literal notranslate"><span class="pre">index</span></code> (see below).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error: Unsupported operand types for + (&quot;int&quot; and &quot;str&quot;)  [operator]</span>
<span class="mi">1</span> <span class="o">+</span> <span class="s1">&#39;x&#39;</span>
</pre></div>
</div>
</section>
<section id="check-indexing-operations-index">
<span id="code-index"></span><h4>Check indexing operations [index]<a class="headerlink" href="#check-indexing-operations-index" title="Permalink to this headline">#</a></h4>
<p>Mypy checks that the indexed value in indexing operation such as
<code class="docutils literal notranslate"><span class="pre">x[y]</span></code> supports indexing, and that the index expression has a valid
type.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

<span class="n">a</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>  <span class="c1"># OK</span>

<span class="c1"># Error: Invalid index type &quot;int&quot; for &quot;dict[str, int]&quot;; expected type &quot;str&quot;  [index]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Error: Invalid index type &quot;bytes&quot; for &quot;dict[str, int]&quot;; expected type &quot;str&quot;  [index]</span>
<span class="n">a</span><span class="p">[</span><span class="sa">b</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
</section>
<section id="check-list-items-list-item">
<span id="code-list-item"></span><h4>Check list items [list-item]<a class="headerlink" href="#check-list-items-list-item" title="Permalink to this headline">#</a></h4>
<p>When constructing a list using <code class="docutils literal notranslate"><span class="pre">[item,</span> <span class="pre">...]</span></code>, mypy checks that each item
is compatible with the list type that is inferred from the surrounding
context.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error: List item 0 has incompatible type &quot;int&quot;; expected &quot;str&quot;  [list-item]</span>
<span class="n">a</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="check-dict-items-dict-item">
<span id="code-dict-item"></span><h4>Check dict items [dict-item]<a class="headerlink" href="#check-dict-items-dict-item" title="Permalink to this headline">#</a></h4>
<p>When constructing a dictionary using <code class="docutils literal notranslate"><span class="pre">{key:</span> <span class="pre">value,</span> <span class="pre">...}</span></code> or <code class="docutils literal notranslate"><span class="pre">dict(key=value,</span> <span class="pre">...)</span></code>,
mypy checks that each key and value is compatible with the dictionary type that is
inferred from the surrounding context.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error: Dict entry 0 has incompatible type &quot;str&quot;: &quot;str&quot;; expected &quot;str&quot;: &quot;int&quot;  [dict-item]</span>
<span class="n">d</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="check-typeddict-items-typeddict-item">
<span id="code-typeddict-item"></span><h4>Check TypedDict items [typeddict-item]<a class="headerlink" href="#check-typeddict-items-typeddict-item" title="Permalink to this headline">#</a></h4>
<p>When constructing a TypedDict object, mypy checks that each key and value is compatible
with the TypedDict type that is inferred from the surrounding context.</p>
<p>When getting a TypedDict item, mypy checks that the key
exists. When assigning to a TypedDict, mypy checks that both the
key and the value are valid.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">TypedDict</span>

<span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>

<span class="c1"># Error: Incompatible types (expression has type &quot;float&quot;,</span>
<span class="c1">#        TypedDict item &quot;x&quot; has type &quot;int&quot;)  [typeddict-item]</span>
<span class="n">p</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="check-typeddict-keys-typeddict-unknown-key">
<span id="code-typeddict-unknown-key"></span><h4>Check TypedDict Keys [typeddict-unknown-key]<a class="headerlink" href="#check-typeddict-keys-typeddict-unknown-key" title="Permalink to this headline">#</a></h4>
<p>When constructing a TypedDict object, mypy checks whether the
definition contains unknown keys, to catch invalid keys and
misspellings. On the other hand, mypy will not generate an error when
a previously constructed TypedDict value with extra keys is passed
to a function as an argument, since TypedDict values support
structural subtyping (“static duck typing”) and the keys are assumed
to have been validated at the point of construction. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">TypedDict</span>

<span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">class</span> <span class="nc">Point3D</span><span class="p">(</span><span class="n">Point</span><span class="p">):</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">add_x_coordinates</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Point</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>

<span class="n">a</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
<span class="n">b</span><span class="p">:</span> <span class="n">Point3D</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}</span>

<span class="n">add_x_coordinates</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>  <span class="c1"># OK</span>

<span class="c1"># Error: Extra key &quot;z&quot; for TypedDict &quot;Point&quot;  [typeddict-unknown-key]</span>
<span class="n">add_x_coordinates</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
</pre></div>
</div>
<p>Setting a TypedDict item using an unknown key will also generate this
error, since it could be a misspelling:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="c1"># Error: Extra key &quot;z&quot; for TypedDict &quot;Point&quot;  [typeddict-unknown-key]</span>
<span class="n">a</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
<p>Reading an unknown key will generate the more general (and serious)
<code class="docutils literal notranslate"><span class="pre">typeddict-item</span></code> error, which is likely to result in an exception at
runtime:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">:</span> <span class="n">Point</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="c1"># Error: TypedDict &quot;Point&quot; has no key &quot;z&quot;  [typeddict-item]</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This error code is a subcode of the wider <code class="docutils literal notranslate"><span class="pre">[typeddict-item]</span></code> code.</p>
</div>
</section>
<section id="check-that-type-of-target-is-known-has-type">
<span id="code-has-type"></span><h4>Check that type of target is known [has-type]<a class="headerlink" href="#check-that-type-of-target-is-known-has-type" title="Permalink to this headline">#</a></h4>
<p>Mypy sometimes generates an error when it hasn’t inferred any type for
a variable being referenced. This can happen for references to
variables that are initialized later in the source file, and for
references across modules that form an import cycle. When this
happens, the reference gets an implicit <code class="docutils literal notranslate"><span class="pre">Any</span></code> type.</p>
<p>In this example the definitions of <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are circular:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Problem</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">set_x</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Error: Cannot determine type of &quot;y&quot;  [has-type]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>

    <span class="k">def</span> <span class="nf">set_y</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
<p>To work around this error, you can add an explicit type annotation to
the target variable or attribute. Sometimes you can also reorganize
the code so that the definition of the variable is placed earlier than
the reference to the variable in a source file. Untangling cyclic
imports may also help.</p>
<p>We add an explicit annotation to the <code class="docutils literal notranslate"><span class="pre">y</span></code> attribute to work around
the issue:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Problem</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">set_x</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>  <span class="c1"># OK</span>

    <span class="k">def</span> <span class="nf">set_y</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>  <span class="c1"># Added annotation here</span>
</pre></div>
</div>
</section>
<section id="check-for-an-issue-with-imports-import">
<span id="code-import"></span><h4>Check for an issue with imports [import]<a class="headerlink" href="#check-for-an-issue-with-imports-import" title="Permalink to this headline">#</a></h4>
<p>Mypy generates an error if it can’t resolve an <cite>import</cite> statement.
This is a parent error code of <cite>import-not-found</cite> and <cite>import-untyped</cite></p>
<p>See <a class="reference internal" href="index.html#ignore-missing-imports"><span class="std std-ref">Missing imports</span></a> for how to work around these errors.</p>
</section>
<section id="check-that-import-target-can-be-found-import-not-found">
<span id="code-import-not-found"></span><h4>Check that import target can be found [import-not-found]<a class="headerlink" href="#check-that-import-target-can-be-found-import-not-found" title="Permalink to this headline">#</a></h4>
<p>Mypy generates an error if it can’t find the source code or a stub file
for an imported module.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error: Cannot find implementation or library stub for module named &quot;m0dule_with_typo&quot;  [import-not-found]</span>
<span class="kn">import</span> <span class="nn">m0dule_with_typo</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#ignore-missing-imports"><span class="std std-ref">Missing imports</span></a> for how to work around these errors.</p>
</section>
<section id="check-that-import-target-can-be-found-import-untyped">
<span id="code-import-untyped"></span><h4>Check that import target can be found [import-untyped]<a class="headerlink" href="#check-that-import-target-can-be-found-import-untyped" title="Permalink to this headline">#</a></h4>
<p>Mypy generates an error if it can find the source code for an imported module,
but that module does not provide type annotations (via <a class="reference internal" href="index.html#installed-packages"><span class="std std-ref">PEP 561</span></a>).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error: Library stubs not installed for &quot;bs4&quot;  [import-untyped]</span>
<span class="kn">import</span> <span class="nn">bs4</span>
<span class="c1"># Error: Skipping analyzing &quot;no_py_typed&quot;: module is installed, but missing library stubs or py.typed marker  [import-untyped]</span>
<span class="kn">import</span> <span class="nn">no_py_typed</span>
</pre></div>
</div>
<p>In some cases, these errors can be fixed by installing an appropriate
stub package. See <a class="reference internal" href="index.html#ignore-missing-imports"><span class="std std-ref">Missing imports</span></a> for more details.</p>
</section>
<section id="check-that-each-name-is-defined-once-no-redef">
<span id="code-no-redef"></span><h4>Check that each name is defined once [no-redef]<a class="headerlink" href="#check-that-each-name-is-defined-once-no-redef" title="Permalink to this headline">#</a></h4>
<p>Mypy may generate an error if you have multiple definitions for a name
in the same namespace.  The reason is that this is often an error, as
the second definition may overwrite the first one. Also, mypy often
can’t be able to determine whether references point to the first or
the second definition, which would compromise type checking.</p>
<p>If you silence this error, all references to the defined name refer to
the <em>first</em> definition.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>  <span class="c1"># Error: Name &quot;A&quot; already defined on line 1  [no-redef]</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="c1"># Error: Argument 1 to &quot;A&quot; has incompatible type &quot;str&quot;; expected &quot;int&quot;</span>
<span class="c1">#        (the first definition wins!)</span>
<span class="n">A</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="check-that-called-function-returns-a-value-func-returns-value">
<span id="code-func-returns-value"></span><h4>Check that called function returns a value [func-returns-value]<a class="headerlink" href="#check-that-called-function-returns-a-value-func-returns-value" title="Permalink to this headline">#</a></h4>
<p>Mypy reports an error if you call a function with a <code class="docutils literal notranslate"><span class="pre">None</span></code>
return type and don’t ignore the return value, as this is
usually (but not always) a programming error.</p>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">f()</span></code> check is always false since <code class="docutils literal notranslate"><span class="pre">f</span></code>
returns <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>

<span class="c1"># OK: we don&#39;t do anything with the return value</span>
<span class="n">f</span><span class="p">()</span>

<span class="c1"># Error: &quot;f&quot; does not return a value  [func-returns-value]</span>
<span class="k">if</span> <span class="n">f</span><span class="p">():</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;not false&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="check-instantiation-of-abstract-classes-abstract">
<span id="code-abstract"></span><h4>Check instantiation of abstract classes [abstract]<a class="headerlink" href="#check-instantiation-of-abstract-classes-abstract" title="Permalink to this headline">#</a></h4>
<p>Mypy generates an error if you try to instantiate an abstract base
class (ABC). An abstract base class is a class with at least one
abstract method or attribute. (See also <a class="reference external" href="https://docs.python.org/3/library/abc.html#module-abc" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">abc</span></code></a> module documentation)</p>
<p>Sometimes a class is made accidentally abstract, often due to an
unimplemented abstract method. In a case like this you need to provide
an implementation for the method to make the class concrete
(non-abstract).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="k">class</span> <span class="nc">Persistent</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="o">...</span>

<span class="k">class</span> <span class="nc">Thing</span><span class="p">(</span><span class="n">Persistent</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="o">...</span>

    <span class="o">...</span>  <span class="c1"># No &quot;save&quot; method</span>

<span class="c1"># Error: Cannot instantiate abstract class &quot;Thing&quot; with abstract attribute &quot;save&quot;  [abstract]</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Thing</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="safe-handling-of-abstract-type-object-types-type-abstract">
<span id="code-type-abstract"></span><h4>Safe handling of abstract type object types [type-abstract]<a class="headerlink" href="#safe-handling-of-abstract-type-object-types-type-abstract" title="Permalink to this headline">#</a></h4>
<p>Mypy always allows instantiating (calling) type objects typed as <code class="docutils literal notranslate"><span class="pre">Type[t]</span></code>,
even if it is not known that <code class="docutils literal notranslate"><span class="pre">t</span></code> is non-abstract, since it is a common
pattern to create functions that act as object factories (custom constructors).
Therefore, to prevent issues described in the above section, when an abstract
type object is passed where <code class="docutils literal notranslate"><span class="pre">Type[t]</span></code> is expected, mypy will give an error.
Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">ABCMeta</span><span class="p">):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">...</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">make_many</span><span class="p">(</span><span class="n">typ</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">typ</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>  <span class="c1"># This will raise if typ is abstract</span>

<span class="c1"># Error: Only concrete class can be given where &quot;Type[Config]&quot; is expected [type-abstract]</span>
<span class="n">make_many</span><span class="p">(</span><span class="n">Config</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="check-that-call-to-an-abstract-method-via-super-is-valid-safe-super">
<span id="code-safe-super"></span><h4>Check that call to an abstract method via super is valid [safe-super]<a class="headerlink" href="#check-that-call-to-an-abstract-method-via-super-is-valid-safe-super" title="Permalink to this headline">#</a></h4>
<p>Abstract methods often don’t have any default implementation, i.e. their
bodies are just empty. Calling such methods in subclasses via <code class="docutils literal notranslate"><span class="pre">super()</span></code>
will cause runtime errors, so mypy prevents you from doing so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>
<span class="k">class</span> <span class="nc">Base</span><span class="p">:</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>
<span class="k">class</span> <span class="nc">Sub</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># error: Call to abstract method &quot;foo&quot; of &quot;Base&quot; with</span>
                                  <span class="c1"># trivial body via super() is unsafe  [safe-super]</span>
<span class="n">Sub</span><span class="p">()</span><span class="o">.</span><span class="n">foo</span><span class="p">()</span>  <span class="c1"># This will crash at runtime.</span>
</pre></div>
</div>
<p>Mypy considers the following as trivial bodies: a <code class="docutils literal notranslate"><span class="pre">pass</span></code> statement, a literal
ellipsis <code class="docutils literal notranslate"><span class="pre">...</span></code>, a docstring, and a <code class="docutils literal notranslate"><span class="pre">raise</span> <span class="pre">NotImplementedError</span></code> statement.</p>
</section>
<section id="check-the-target-of-newtype-valid-newtype">
<span id="code-valid-newtype"></span><h4>Check the target of NewType [valid-newtype]<a class="headerlink" href="#check-the-target-of-newtype-valid-newtype" title="Permalink to this headline">#</a></h4>
<p>The target of a <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.NewType" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">NewType</span></code></a> definition must be a class type. It can’t
be a union type, <code class="docutils literal notranslate"><span class="pre">Any</span></code>, or various other special types.</p>
<p>You can also get this error if the target has been imported from a
module whose source mypy cannot find, since any such definitions are
treated by mypy as values with <code class="docutils literal notranslate"><span class="pre">Any</span></code> types. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NewType</span>

<span class="c1"># The source for &quot;acme&quot; is not available for mypy</span>
<span class="kn">from</span> <span class="nn">acme</span> <span class="kn">import</span> <span class="n">Entity</span>  <span class="c1"># type: ignore</span>

<span class="c1"># Error: Argument 2 to NewType(...) must be subclassable (got &quot;Any&quot;)  [valid-newtype]</span>
<span class="n">UserEntity</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s1">&#39;UserEntity&#39;</span><span class="p">,</span> <span class="n">Entity</span><span class="p">)</span>
</pre></div>
</div>
<p>To work around the issue, you can either give mypy access to the sources
for <code class="docutils literal notranslate"><span class="pre">acme</span></code> or create a stub file for the module.  See <a class="reference internal" href="index.html#ignore-missing-imports"><span class="std std-ref">Missing imports</span></a>
for more information.</p>
</section>
<section id="check-the-return-type-of-exit-exit-return">
<span id="code-exit-return"></span><h4>Check the return type of __exit__ [exit-return]<a class="headerlink" href="#check-the-return-type-of-exit-exit-return" title="Permalink to this headline">#</a></h4>
<p>If mypy can determine that <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__exit__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__exit__</span></code></a> always returns <code class="docutils literal notranslate"><span class="pre">False</span></code>, mypy
checks that the return type is <em>not</em> <code class="docutils literal notranslate"><span class="pre">bool</span></code>.  The boolean value of
the return type affects which lines mypy thinks are reachable after a
<code class="docutils literal notranslate"><span class="pre">with</span></code> statement, since any <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__exit__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__exit__</span></code></a> method that can return
<code class="docutils literal notranslate"><span class="pre">True</span></code> may swallow exceptions. An imprecise return type can result
in mysterious errors reported near <code class="docutils literal notranslate"><span class="pre">with</span></code> statements.</p>
<p>To fix this, use either <code class="docutils literal notranslate"><span class="pre">typing_extensions.Literal[False]</span></code> or
<code class="docutils literal notranslate"><span class="pre">None</span></code> as the return type. Returning <code class="docutils literal notranslate"><span class="pre">None</span></code> is equivalent to
returning <code class="docutils literal notranslate"><span class="pre">False</span></code> in this context, since both are treated as false
values.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyContext</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># Error</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exit&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<p>This produces the following output from mypy:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>example.py:3: error: &quot;bool&quot; is invalid as return type for &quot;__exit__&quot; that always returns False
example.py:3: note: Use &quot;typing_extensions.Literal[False]&quot; as the return type or change it to
    &quot;None&quot;
example.py:3: note: If return type of &quot;__exit__&quot; implies that it may return True, the context
    manager may swallow exceptions
</pre></div>
</div>
<p>You can use <code class="docutils literal notranslate"><span class="pre">Literal[False]</span></code> to fix the error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Literal</span>

<span class="k">class</span> <span class="nc">MyContext</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">]:</span>  <span class="c1"># OK</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exit&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyContext</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Also OK</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exit&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="check-that-naming-is-consistent-name-match">
<span id="code-name-match"></span><h4>Check that naming is consistent [name-match]<a class="headerlink" href="#check-that-naming-is-consistent-name-match" title="Permalink to this headline">#</a></h4>
<p>The definition of a named tuple or a TypedDict must be named
consistently when using the call-based syntax. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>

<span class="c1"># Error: First argument to namedtuple() should be &quot;Point2D&quot;, not &quot;Point&quot;</span>
<span class="n">Point2D</span> <span class="o">=</span> <span class="n">NamedTuple</span><span class="p">(</span><span class="s2">&quot;Point&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)])</span>
</pre></div>
</div>
</section>
<section id="check-that-literal-is-used-where-expected-literal-required">
<span id="code-literal-required"></span><h4>Check that literal is used where expected [literal-required]<a class="headerlink" href="#check-that-literal-is-used-where-expected-literal-required" title="Permalink to this headline">#</a></h4>
<p>There are some places where only a (string) literal value is expected for
the purposes of static type checking, for example a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> key, or
a <code class="docutils literal notranslate"><span class="pre">__match_args__</span></code> item. Providing a <code class="docutils literal notranslate"><span class="pre">str</span></code>-valued variable in such contexts
will result in an error. Note that in many cases you can also use <code class="docutils literal notranslate"><span class="pre">Final</span></code>
or <code class="docutils literal notranslate"><span class="pre">Literal</span></code> variables. Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Final</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">TypedDict</span>

<span class="k">class</span> <span class="nc">Point</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n">Point</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">X</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>
    <span class="n">p</span><span class="p">[</span><span class="n">X</span><span class="p">]</span>  <span class="c1"># OK</span>

    <span class="n">Y</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span>
    <span class="n">p</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span>  <span class="c1"># OK</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>  <span class="c1"># Inferred type of key is `str`</span>
    <span class="c1"># Error: TypedDict key must be a string literal;</span>
    <span class="c1">#   expected one of (&quot;x&quot;, &quot;y&quot;)  [literal-required]</span>
    <span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="check-that-overloaded-functions-have-an-implementation-no-overload-impl">
<span id="code-no-overload-impl"></span><h4>Check that overloaded functions have an implementation [no-overload-impl]<a class="headerlink" href="#check-that-overloaded-functions-have-an-implementation-no-overload-impl" title="Permalink to this headline">#</a></h4>
<p>Overloaded functions outside of stub files must be followed by a non overloaded
implementation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">overload</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="o">...</span>

<span class="nd">@overload</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="o">...</span>

<span class="c1"># presence of required function below is checked</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">pass</span>  <span class="c1"># actual implementation</span>
</pre></div>
</div>
</section>
<section id="check-that-coroutine-return-value-is-used-unused-coroutine">
<span id="code-unused-coroutine"></span><h4>Check that coroutine return value is used [unused-coroutine]<a class="headerlink" href="#check-that-coroutine-return-value-is-used-unused-coroutine" title="Permalink to this headline">#</a></h4>
<p>Mypy ensures that return values of async def functions are not
ignored, as this is usually a programming error, as the coroutine
won’t be executed at the call site.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">f</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">g</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">f</span><span class="p">()</span>  <span class="c1"># Error: missing await</span>
    <span class="k">await</span> <span class="n">f</span><span class="p">()</span>  <span class="c1"># OK</span>
</pre></div>
</div>
<p>You can work around this error by assigning the result to a temporary,
otherwise unused variable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">f</span><span class="p">()</span>  <span class="c1"># No error</span>
</pre></div>
</div>
</section>
<section id="warn-about-top-level-await-expressions-top-level-await">
<span id="code-top-level-await"></span><h4>Warn about top level await expressions [top-level-await]<a class="headerlink" href="#warn-about-top-level-await-expressions-top-level-await" title="Permalink to this headline">#</a></h4>
<p>This error code is separate from the general <code class="docutils literal notranslate"><span class="pre">[syntax]</span></code> errors, because in
some environments (e.g. IPython) a top level <code class="docutils literal notranslate"><span class="pre">await</span></code> is allowed. In such
environments a user may want to use <code class="docutils literal notranslate"><span class="pre">--disable-error-code=top-level-await</span></code>,
that allows to still have errors for other improper uses of <code class="docutils literal notranslate"><span class="pre">await</span></code>, for
example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">f</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>

<span class="n">top</span> <span class="o">=</span> <span class="k">await</span> <span class="n">f</span><span class="p">()</span>  <span class="c1"># Error: &quot;await&quot; outside function  [top-level-await]</span>
</pre></div>
</div>
</section>
<section id="warn-about-await-expressions-used-outside-of-coroutines-await-not-async">
<span id="code-await-not-async"></span><h4>Warn about await expressions used outside of coroutines [await-not-async]<a class="headerlink" href="#warn-about-await-expressions-used-outside-of-coroutines-await-not-async" title="Permalink to this headline">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">await</span></code> must be used inside a coroutine.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">f</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">g</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">await</span> <span class="n">f</span><span class="p">()</span>  <span class="c1"># Error: &quot;await&quot; outside coroutine (&quot;async def&quot;)  [await-not-async]</span>
</pre></div>
</div>
</section>
<section id="check-types-in-assert-type-assert-type">
<span id="code-assert-type"></span><h4>Check types in assert_type [assert-type]<a class="headerlink" href="#check-types-in-assert-type-assert-type" title="Permalink to this headline">#</a></h4>
<p>The inferred type for an expression passed to <code class="docutils literal notranslate"><span class="pre">assert_type</span></code> must match
the provided type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">assert_type</span>

<span class="n">assert_type</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span>  <span class="c1"># OK</span>

<span class="n">assert_type</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span>  <span class="c1"># Error</span>
</pre></div>
</div>
</section>
<section id="check-that-function-isn-t-used-in-boolean-context-truthy-function">
<span id="code-truthy-function"></span><h4>Check that function isn’t used in boolean context [truthy-function]<a class="headerlink" href="#check-that-function-isn-t-used-in-boolean-context-truthy-function" title="Permalink to this headline">#</a></h4>
<p>Functions will always evaluate to true in boolean contexts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="o">...</span>

<span class="k">if</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># Error: Function &quot;Callable[[], Any]&quot; could always be true in boolean context  [truthy-function]</span>
    <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="check-that-string-formatting-interpolation-is-type-safe-str-format">
<span id="code-str-format"></span><h4>Check that string formatting/interpolation is type-safe [str-format]<a class="headerlink" href="#check-that-string-formatting-interpolation-is-type-safe-str-format" title="Permalink to this headline">#</a></h4>
<p>Mypy will check that f-strings, <code class="docutils literal notranslate"><span class="pre">str.format()</span></code> calls, and <code class="docutils literal notranslate"><span class="pre">%</span></code> interpolations
are valid (when corresponding template is a literal string). This includes
checking number and types of replacements, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error: Cannot find replacement for positional format specifier 1 [str-format]</span>
<span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;spam&quot;</span><span class="p">)</span>
<span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="c1"># Error: Not all arguments converted during string formatting [str-format]</span>
<span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;spam&quot;</span><span class="p">,</span> <span class="s2">&quot;eggs&quot;</span><span class="p">,</span> <span class="s2">&quot;cheese&quot;</span><span class="p">)</span>

<span class="c1"># Error: Incompatible types in string interpolation</span>
<span class="c1"># (expression has type &quot;float&quot;, placeholder has type &quot;int&quot;) [str-format]</span>
<span class="s2">&quot;</span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">3.14</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="check-for-implicit-bytes-coercions-str-bytes-safe">
<span id="code-str-bytes-safe"></span><h4>Check for implicit bytes coercions [str-bytes-safe]<a class="headerlink" href="#check-for-implicit-bytes-coercions-str-bytes-safe" title="Permalink to this headline">#</a></h4>
<p>Warn about cases where a bytes object may be converted to a string in an unexpected manner.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;abc&quot;</span>

<span class="c1"># Error: If x = b&#39;abc&#39; then f&quot;{x}&quot; or &quot;{}&quot;.format(x) produces &quot;b&#39;abc&#39;&quot;, not &quot;abc&quot;.</span>
<span class="c1"># If this is desired behavior, use f&quot;{x!r}&quot; or &quot;{!r}&quot;.format(x).</span>
<span class="c1"># Otherwise, decode the bytes [str-bytes-safe]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The alphabet starts with </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Okay</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The alphabet starts with </span><span class="si">{</span><span class="n">b</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># The alphabet starts with b&#39;abc&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The alphabet starts with </span><span class="si">{</span><span class="n">b</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># The alphabet starts with abc</span>
</pre></div>
</div>
</section>
<section id="notify-about-an-annotation-in-an-unchecked-function-annotation-unchecked">
<span id="code-annotation-unchecked"></span><h4>Notify about an annotation in an unchecked function [annotation-unchecked]<a class="headerlink" href="#notify-about-an-annotation-in-an-unchecked-function-annotation-unchecked" title="Permalink to this headline">#</a></h4>
<p>Sometimes a user may accidentally omit an annotation for a function, and mypy
will not check the body of this function (unless one uses
<a class="reference internal" href="index.html#cmdoption-mypy-check-untyped-defs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--check-untyped-defs</span></code></a> or
<a class="reference internal" href="index.html#cmdoption-mypy-disallow-untyped-defs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-untyped-defs</span></code></a>). To avoid
such situations go unnoticed, mypy will show a note, if there are any type
annotations in an unchecked function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_assignment</span><span class="p">():</span>  <span class="c1"># &quot;-&gt; None&quot; return annotation is missing</span>
    <span class="c1"># Note: By default the bodies of untyped functions are not checked,</span>
    <span class="c1"># consider using --check-untyped-defs [annotation-unchecked]</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="s2">&quot;no way&quot;</span>
</pre></div>
</div>
<p>Note that mypy will still exit with return code <code class="docutils literal notranslate"><span class="pre">0</span></code>, since such behaviour is
specified by <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0484/"><strong>PEP 484</strong></a>.</p>
</section>
<section id="report-syntax-errors-syntax">
<span id="code-syntax"></span><h4>Report syntax errors [syntax]<a class="headerlink" href="#report-syntax-errors-syntax" title="Permalink to this headline">#</a></h4>
<p>If the code being checked is not syntactically valid, mypy issues a
syntax error. Most, but not all, syntax errors are <em>blocking errors</em>:
they can’t be ignored with a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment.</p>
</section>
<section id="miscellaneous-checks-misc">
<span id="code-misc"></span><h4>Miscellaneous checks [misc]<a class="headerlink" href="#miscellaneous-checks-misc" title="Permalink to this headline">#</a></h4>
<p>Mypy performs numerous other, less commonly failing checks that don’t
have specific error codes. These use the <code class="docutils literal notranslate"><span class="pre">misc</span></code> error code. Other
than being used for multiple unrelated errors, the <code class="docutils literal notranslate"><span class="pre">misc</span></code> error code
is not special. For example, you can ignore all errors in this
category by using <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore[misc]</span></code> comment. Since these errors
are not expected to be common, it’s unlikely that you’ll see two
<em>different</em> errors with the <code class="docutils literal notranslate"><span class="pre">misc</span></code> code on a single line – though
this can certainly happen once in a while.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Future mypy versions will likely add new error codes for some errors
that currently use the <code class="docutils literal notranslate"><span class="pre">misc</span></code> error code.</p>
</div>
</section>
</section>
<span id="document-error_code_list2"></span><section id="error-codes-for-optional-checks">
<span id="error-codes-optional"></span><h3>Error codes for optional checks<a class="headerlink" href="#error-codes-for-optional-checks" title="Permalink to this headline">#</a></h3>
<p>This section documents various errors codes that mypy generates only
if you enable certain options. See <a class="reference internal" href="index.html#error-codes"><span class="std std-ref">Error codes</span></a> for general
documentation about error codes. <a class="reference internal" href="index.html#error-code-list"><span class="std std-ref">Error codes enabled by default</span></a> documents
error codes that are enabled by default.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The examples in this section use <a class="reference internal" href="index.html#inline-config"><span class="std std-ref">inline configuration</span></a> to specify mypy options. You can also set the same
options by using a <a class="reference internal" href="index.html#config-file"><span class="std std-ref">configuration file</span></a> or
<a class="reference internal" href="index.html#command-line"><span class="std std-ref">command-line options</span></a>.</p>
</div>
<section id="check-that-type-arguments-exist-type-arg">
<span id="code-type-arg"></span><h4>Check that type arguments exist [type-arg]<a class="headerlink" href="#check-that-type-arguments-exist-type-arg" title="Permalink to this headline">#</a></h4>
<p>If you use <a class="reference internal" href="index.html#cmdoption-mypy-disallow-any-generics"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-any-generics</span></code></a>, mypy requires that each generic
type has values for each type argument. For example, the types <code class="docutils literal notranslate"><span class="pre">list</span></code> or
<code class="docutils literal notranslate"><span class="pre">dict</span></code> would be rejected. You should instead use types like <code class="docutils literal notranslate"><span class="pre">list[int]</span></code> or
<code class="docutils literal notranslate"><span class="pre">dict[str,</span> <span class="pre">int]</span></code>. Any omitted generic type arguments get implicit <code class="docutils literal notranslate"><span class="pre">Any</span></code>
values. The type <code class="docutils literal notranslate"><span class="pre">list</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">list[Any]</span></code>, and so on.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: disallow-any-generics</span>

<span class="c1"># Error: Missing type parameters for generic type &quot;list&quot;  [type-arg]</span>
<span class="k">def</span> <span class="nf">remove_dups</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="check-that-every-function-has-an-annotation-no-untyped-def">
<span id="code-no-untyped-def"></span><h4>Check that every function has an annotation [no-untyped-def]<a class="headerlink" href="#check-that-every-function-has-an-annotation-no-untyped-def" title="Permalink to this headline">#</a></h4>
<p>If you use <a class="reference internal" href="index.html#cmdoption-mypy-disallow-untyped-defs"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-untyped-defs</span></code></a>, mypy requires that all functions
have annotations (either a Python 3 annotation or a type comment).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: disallow-untyped-defs</span>

<span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>  <span class="c1"># Error: Function is missing a type annotation  [no-untyped-def]</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">inc_ok</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># OK</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">class</span> <span class="nc">Counter</span><span class="p">:</span>
     <span class="c1"># Error: Function is missing a type annotation  [no-untyped-def]</span>
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">CounterOk</span><span class="p">:</span>
     <span class="c1"># OK: An explicit &quot;-&gt; None&quot; is needed if &quot;__init__&quot; takes no arguments</span>
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="check-that-cast-is-not-redundant-redundant-cast">
<span id="code-redundant-cast"></span><h4>Check that cast is not redundant [redundant-cast]<a class="headerlink" href="#check-that-cast-is-not-redundant-redundant-cast" title="Permalink to this headline">#</a></h4>
<p>If you use <a class="reference internal" href="index.html#cmdoption-mypy-warn-redundant-casts"><code class="xref std std-option docutils literal notranslate"><span class="pre">--warn-redundant-casts</span></code></a>, mypy will generate an error if the source
type of a cast is the same as the target type.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: warn-redundant-casts</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">cast</span>

<span class="n">Count</span> <span class="o">=</span> <span class="nb">int</span>

<span class="k">def</span> <span class="nf">example</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Count</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="c1"># Error: Redundant cast to &quot;int&quot;  [redundant-cast]</span>
    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="check-that-methods-do-not-have-redundant-self-annotations-redundant-self">
<span id="code-redundant-self"></span><h4>Check that methods do not have redundant Self annotations [redundant-self]<a class="headerlink" href="#check-that-methods-do-not-have-redundant-self-annotations-redundant-self" title="Permalink to this headline">#</a></h4>
<p>If a method uses the <code class="docutils literal notranslate"><span class="pre">Self</span></code> type in the return type or the type of a
non-self argument, there is no need to annotate the <code class="docutils literal notranslate"><span class="pre">self</span></code> argument
explicitly. Such annotations are allowed by <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0673/"><strong>PEP 673</strong></a> but are
redundant. If you enable this error code, mypy will generate an error if
there is a redundant <code class="docutils literal notranslate"><span class="pre">Self</span></code> type.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: enable-error-code=&quot;redundant-self&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Self</span>

<span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="c1"># Error: Redundant &quot;Self&quot; annotation for the first method argument</span>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)()</span>
</pre></div>
</div>
</section>
<section id="check-that-comparisons-are-overlapping-comparison-overlap">
<span id="code-comparison-overlap"></span><h4>Check that comparisons are overlapping [comparison-overlap]<a class="headerlink" href="#check-that-comparisons-are-overlapping-comparison-overlap" title="Permalink to this headline">#</a></h4>
<p>If you use <a class="reference internal" href="index.html#cmdoption-mypy-strict-equality"><code class="xref std std-option docutils literal notranslate"><span class="pre">--strict-equality</span></code></a>, mypy will generate an error if it
thinks that a comparison operation is always true or false. These are
often bugs. Sometimes mypy is too picky and the comparison can
actually be useful. Instead of disabling strict equality checking
everywhere, you can use <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore[comparison-overlap]</span></code> to
ignore the issue on a particular line only.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: strict-equality</span>

<span class="k">def</span> <span class="nf">is_magic</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="c1"># Error: Non-overlapping equality check (left operand type: &quot;bytes&quot;,</span>
    <span class="c1">#        right operand type: &quot;str&quot;)  [comparison-overlap]</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;magic&#39;</span>
</pre></div>
</div>
<p>We can fix the error by changing the string literal to a bytes
literal:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: strict-equality</span>

<span class="k">def</span> <span class="nf">is_magic</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;magic&#39;</span>  <span class="c1"># OK</span>
</pre></div>
</div>
</section>
<section id="check-that-no-untyped-functions-are-called-no-untyped-call">
<span id="code-no-untyped-call"></span><h4>Check that no untyped functions are called [no-untyped-call]<a class="headerlink" href="#check-that-no-untyped-functions-are-called-no-untyped-call" title="Permalink to this headline">#</a></h4>
<p>If you use <a class="reference internal" href="index.html#cmdoption-mypy-disallow-untyped-calls"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-untyped-calls</span></code></a>, mypy generates an error when you
call an unannotated function in an annotated function.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: disallow-untyped-calls</span>

<span class="k">def</span> <span class="nf">do_it</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Error: Call to untyped function &quot;bad&quot; in typed context  [no-untyped-call]</span>
    <span class="n">bad</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">bad</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="check-that-function-does-not-return-any-value-no-any-return">
<span id="code-no-any-return"></span><h4>Check that function does not return Any value [no-any-return]<a class="headerlink" href="#check-that-function-does-not-return-any-value-no-any-return" title="Permalink to this headline">#</a></h4>
<p>If you use <a class="reference internal" href="index.html#cmdoption-mypy-warn-return-any"><code class="xref std std-option docutils literal notranslate"><span class="pre">--warn-return-any</span></code></a>, mypy generates an error if you return a
value with an <code class="docutils literal notranslate"><span class="pre">Any</span></code> type in a function that is annotated to return a
non-<code class="docutils literal notranslate"><span class="pre">Any</span></code> value.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: warn-return-any</span>

<span class="k">def</span> <span class="nf">fields</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">first_field</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># Error: Returning Any from function declared to return &quot;str&quot;  [no-any-return]</span>
    <span class="k">return</span> <span class="n">fields</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="check-that-types-have-no-any-components-due-to-missing-imports-no-any-unimported">
<span id="code-no-any-unimported"></span><h4>Check that types have no Any components due to missing imports [no-any-unimported]<a class="headerlink" href="#check-that-types-have-no-any-components-due-to-missing-imports-no-any-unimported" title="Permalink to this headline">#</a></h4>
<p>If you use <a class="reference internal" href="index.html#cmdoption-mypy-disallow-any-unimported"><code class="xref std std-option docutils literal notranslate"><span class="pre">--disallow-any-unimported</span></code></a>, mypy generates an error if a component of
a type becomes <code class="docutils literal notranslate"><span class="pre">Any</span></code> because mypy couldn’t resolve an import. These “stealth”
<code class="docutils literal notranslate"><span class="pre">Any</span></code> types can be surprising and accidentally cause imprecise type checking.</p>
<p>In this example, we assume that mypy can’t find the module <code class="docutils literal notranslate"><span class="pre">animals</span></code>, which means
that <code class="docutils literal notranslate"><span class="pre">Cat</span></code> falls back to <code class="docutils literal notranslate"><span class="pre">Any</span></code> in a type annotation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: disallow-any-unimported</span>

<span class="kn">from</span> <span class="nn">animals</span> <span class="kn">import</span> <span class="n">Cat</span>  <span class="c1"># type: ignore</span>

<span class="c1"># Error: Argument 1 to &quot;feed&quot; becomes &quot;Any&quot; due to an unfollowed import  [no-any-unimported]</span>
<span class="k">def</span> <span class="nf">feed</span><span class="p">(</span><span class="n">cat</span><span class="p">:</span> <span class="n">Cat</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="check-that-statement-or-expression-is-unreachable-unreachable">
<span id="code-unreachable"></span><h4>Check that statement or expression is unreachable [unreachable]<a class="headerlink" href="#check-that-statement-or-expression-is-unreachable-unreachable" title="Permalink to this headline">#</a></h4>
<p>If you use <a class="reference internal" href="index.html#cmdoption-mypy-warn-unreachable"><code class="xref std std-option docutils literal notranslate"><span class="pre">--warn-unreachable</span></code></a>, mypy generates an error if it
thinks that a statement or expression will never be executed. In most cases, this is due to
incorrect control flow or conditional checks that are accidentally always true or false.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># mypy: warn-unreachable</span>

<span class="k">def</span> <span class="nf">example</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Error: Right operand of &quot;or&quot; is never evaluated  [unreachable]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;unused&#39;</span>

    <span class="k">return</span>
    <span class="c1"># Error: Statement is unreachable  [unreachable]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;unreachable&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="check-that-expression-is-redundant-redundant-expr">
<span id="code-redundant-expr"></span><h4>Check that expression is redundant [redundant-expr]<a class="headerlink" href="#check-that-expression-is-redundant-redundant-expr" title="Permalink to this headline">#</a></h4>
<p>If you use <a class="reference internal" href="index.html#cmdoption-mypy-enable-error-code"><code class="xref std std-option docutils literal notranslate"><span class="pre">--enable-error-code</span> <span class="pre">redundant-expr</span></code></a>,
mypy generates an error if it thinks that an expression is redundant.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use &quot;mypy --enable-error-code redundant-expr ...&quot;</span>

<span class="k">def</span> <span class="nf">example</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Error: Left operand of &quot;and&quot; is always true  [redundant-expr]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Error: If condition is always true  [redundant-expr]</span>
    <span class="mi">1</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="c1"># Error: If condition in comprehension is always true  [redundant-expr]</span>
    <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="warn-about-variables-that-are-defined-only-in-some-execution-paths-possibly-undefined">
<span id="code-possibly-undefined"></span><h4>Warn about variables that are defined only in some execution paths [possibly-undefined]<a class="headerlink" href="#warn-about-variables-that-are-defined-only-in-some-execution-paths-possibly-undefined" title="Permalink to this headline">#</a></h4>
<p>If you use <a class="reference internal" href="index.html#cmdoption-mypy-enable-error-code"><code class="xref std std-option docutils literal notranslate"><span class="pre">--enable-error-code</span> <span class="pre">possibly-undefined</span></code></a>,
mypy generates an error if it cannot verify that a variable will be defined in
all execution paths. This includes situations when a variable definition
appears in a loop, in a conditional branch, in an except handler, etc. For
example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use &quot;mypy --enable-error-code possibly-undefined ...&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">flag</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Error: Name &quot;a&quot; may be undefined [possibly-undefined]</span>

    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Error: Name &quot;b&quot; may be undefined [possibly-undefined]</span>
</pre></div>
</div>
</section>
<section id="check-that-expression-is-not-implicitly-true-in-boolean-context-truthy-bool">
<span id="code-truthy-bool"></span><h4>Check that expression is not implicitly true in boolean context [truthy-bool]<a class="headerlink" href="#check-that-expression-is-not-implicitly-true-in-boolean-context-truthy-bool" title="Permalink to this headline">#</a></h4>
<p>Warn when the type of an expression in a boolean context does not
implement <code class="docutils literal notranslate"><span class="pre">__bool__</span></code> or <code class="docutils literal notranslate"><span class="pre">__len__</span></code>. Unless one of these is
implemented by a subtype, the expression will always be considered
true, and there may be a bug in the condition.</p>
<p>As an exception, the <code class="docutils literal notranslate"><span class="pre">object</span></code> type is allowed in a boolean context.
Using an iterable value in a boolean context has a separate error code
(see below).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use &quot;mypy --enable-error-code truthy-bool ...&quot;</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="n">foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="c1"># Error: &quot;foo&quot; has type &quot;Foo&quot; which does not implement __bool__ or __len__ so it could always be true in boolean context</span>
<span class="k">if</span> <span class="n">foo</span><span class="p">:</span>
     <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="check-that-iterable-is-not-implicitly-true-in-boolean-context-truthy-iterable">
<span id="code-truthy-iterable"></span><h4>Check that iterable is not implicitly true in boolean context [truthy-iterable]<a class="headerlink" href="#check-that-iterable-is-not-implicitly-true-in-boolean-context-truthy-iterable" title="Permalink to this headline">#</a></h4>
<p>Generate an error if a value of type <code class="docutils literal notranslate"><span class="pre">Iterable</span></code> is used as a boolean
condition, since <code class="docutils literal notranslate"><span class="pre">Iterable</span></code> does not implement <code class="docutils literal notranslate"><span class="pre">__len__</span></code> or <code class="docutils literal notranslate"><span class="pre">__bool__</span></code>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Iterable</span>

<span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="c1"># Error: &quot;items&quot; has type &quot;Iterable[int]&quot; which can always be true in boolean context. Consider using &quot;Collection[int]&quot; instead.  [truthy-iterable]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">42</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">transform</span></code> is called with a <code class="docutils literal notranslate"><span class="pre">Generator</span></code> argument, such as
<code class="docutils literal notranslate"><span class="pre">int(x)</span> <span class="pre">for</span> <span class="pre">x</span> <span class="pre">in</span> <span class="pre">[]</span></code>, this function would not return <code class="docutils literal notranslate"><span class="pre">[42]</span></code> unlike
what might be intended. Of course, it’s possible that <code class="docutils literal notranslate"><span class="pre">transform</span></code> is
only called with <code class="docutils literal notranslate"><span class="pre">list</span></code> or other container objects, and the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">not</span>
<span class="pre">items</span></code> check is actually valid. If that is the case, it is
recommended to annotate <code class="docutils literal notranslate"><span class="pre">items</span></code> as <code class="docutils literal notranslate"><span class="pre">Collection[int]</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">Iterable[int]</span></code>.</p>
</section>
<section id="check-that-type-ignore-include-an-error-code-ignore-without-code">
<span id="code-ignore-without-code"></span><h4>Check that <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> include an error code [ignore-without-code]<a class="headerlink" href="#check-that-type-ignore-include-an-error-code-ignore-without-code" title="Permalink to this headline">#</a></h4>
<p>Warn when a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment does not specify any error codes.
This clarifies the intent of the ignore and ensures that only the
expected errors are silenced.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use &quot;mypy --enable-error-code ignore-without-code ...&quot;</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>

<span class="c1"># This line has a typo that mypy can&#39;t help with as both:</span>
<span class="c1"># - the expected error &#39;assignment&#39;, and</span>
<span class="c1"># - the unexpected error &#39;attr-defined&#39;</span>
<span class="c1"># are silenced.</span>
<span class="c1"># Error: &quot;type: ignore&quot; comment without error code (consider &quot;type: ignore[attr-defined]&quot; instead)</span>
<span class="n">f</span><span class="o">.</span><span class="n">nme</span> <span class="o">=</span> <span class="mi">42</span>  <span class="c1"># type: ignore</span>

<span class="c1"># This line warns correctly about the typo in the attribute name</span>
<span class="c1"># Error: &quot;Foo&quot; has no attribute &quot;nme&quot;; maybe &quot;name&quot;?</span>
<span class="n">f</span><span class="o">.</span><span class="n">nme</span> <span class="o">=</span> <span class="mi">42</span>  <span class="c1"># type: ignore[assignment]</span>
</pre></div>
</div>
</section>
<section id="check-that-awaitable-return-value-is-used-unused-awaitable">
<span id="code-unused-awaitable"></span><h4>Check that awaitable return value is used [unused-awaitable]<a class="headerlink" href="#check-that-awaitable-return-value-is-used-unused-awaitable" title="Permalink to this headline">#</a></h4>
<p>If you use <a class="reference internal" href="index.html#cmdoption-mypy-enable-error-code"><code class="xref std std-option docutils literal notranslate"><span class="pre">--enable-error-code</span> <span class="pre">unused-awaitable</span></code></a>,
mypy generates an error if you don’t use a returned value that defines <code class="docutils literal notranslate"><span class="pre">__await__</span></code>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use &quot;mypy --enable-error-code unused-awaitable ...&quot;</span>

<span class="kn">import</span> <span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">f</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span> <span class="o">...</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">g</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># Error: Value of type &quot;Task[int]&quot; must be used</span>
    <span class="c1">#        Are you missing an await?</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">f</span><span class="p">())</span>
</pre></div>
</div>
<p>You can assign the value to a temporary, otherwise unused to variable to
silence the error:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">g</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">f</span><span class="p">())</span>  <span class="c1"># No error</span>
</pre></div>
</div>
</section>
<section id="check-that-type-ignore-comment-is-used-unused-ignore">
<span id="code-unused-ignore"></span><h4>Check that <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment is used [unused-ignore]<a class="headerlink" href="#check-that-type-ignore-comment-is-used-unused-ignore" title="Permalink to this headline">#</a></h4>
<p>If you use <a class="reference internal" href="index.html#cmdoption-mypy-enable-error-code"><code class="xref std std-option docutils literal notranslate"><span class="pre">--enable-error-code</span> <span class="pre">unused-ignore</span></code></a>,
or <a class="reference internal" href="index.html#cmdoption-mypy-warn-unused-ignores"><code class="xref std std-option docutils literal notranslate"><span class="pre">--warn-unused-ignores</span></code></a>
mypy generates an error if you don’t use a <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment, i.e. if
there is a comment, but there would be no error generated by mypy on this line
anyway.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use &quot;mypy --warn-unused-ignores ...&quot;</span>

<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="c1"># Error: unused &quot;type: ignore&quot; comment</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>  <span class="c1"># type: ignore</span>
</pre></div>
</div>
<p>Note that due to a specific nature of this comment, the only way to selectively
silence it, is to include the error code explicitly. Also note that this error is
not shown if the <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> is not used due to code being statically
unreachable (e.g. due to platform or version checks).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use &quot;mypy --warn-unused-ignores ...&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># The &quot;[unused-ignore]&quot; is needed to get a clean mypy run</span>
    <span class="c1"># on both Python 3.8, and 3.9 where this module was added</span>
    <span class="kn">import</span> <span class="nn">graphlib</span>  <span class="c1"># type: ignore[import,unused-ignore]</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">):</span>
    <span class="c1"># The following will not generate an error on either</span>
    <span class="c1"># Python 3.8, or Python 3.9</span>
    <span class="mi">42</span> <span class="o">+</span> <span class="s2">&quot;testing...&quot;</span>  <span class="c1"># type: ignore</span>
</pre></div>
</div>
</section>
<section id="check-that-override-is-used-when-overriding-a-base-class-method-explicit-override">
<span id="code-explicit-override"></span><h4>Check that <code class="docutils literal notranslate"><span class="pre">&#64;override</span></code> is used when overriding a base class method [explicit-override]<a class="headerlink" href="#check-that-override-is-used-when-overriding-a-base-class-method-explicit-override" title="Permalink to this headline">#</a></h4>
<p>If you use <a class="reference internal" href="index.html#cmdoption-mypy-enable-error-code"><code class="xref std std-option docutils literal notranslate"><span class="pre">--enable-error-code</span> <span class="pre">explicit-override</span></code></a>
mypy generates an error if you override a base class method without using the
<code class="docutils literal notranslate"><span class="pre">&#64;override</span></code> decorator. An error will not be emitted for overrides of <code class="docutils literal notranslate"><span class="pre">__init__</span></code>
or <code class="docutils literal notranslate"><span class="pre">__new__</span></code>. See <a class="reference external" href="https://peps.python.org/pep-0698/#strict-enforcement-per-project">PEP 698</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Starting with Python 3.12, the <code class="docutils literal notranslate"><span class="pre">&#64;override</span></code> decorator can be imported from <code class="docutils literal notranslate"><span class="pre">typing</span></code>.
To use it with older Python versions, import it from <code class="docutils literal notranslate"><span class="pre">typing_extensions</span></code> instead.</p>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use &quot;mypy --enable-error-code explicit-override ...&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">override</span>

<span class="k">class</span> <span class="nc">Parent</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Child</span><span class="p">(</span><span class="n">Parent</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Error: Missing @override decorator</span>
        <span class="k">pass</span>

    <span class="nd">@override</span>
    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</div>
</section>
</section>
<span id="document-additional_features"></span><section id="additional-features">
<h3>Additional features<a class="headerlink" href="#additional-features" title="Permalink to this headline">#</a></h3>
<p>This section discusses various features that did not fit in naturally in one
of the previous sections.</p>
<section id="dataclasses">
<span id="dataclasses-support"></span><h4>Dataclasses<a class="headerlink" href="#dataclasses" title="Permalink to this headline">#</a></h4>
<p>The <a class="reference external" href="https://docs.python.org/3/library/dataclasses.html#module-dataclasses" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">dataclasses</span></code></a> module allows defining and customizing simple
boilerplate-free classes. They can be defined using the
<a class="reference external" href="https://docs.python.org/3/library/dataclasses.html#dataclasses.dataclass" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;dataclasses.dataclass</span></code></a> decorator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Application</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">plugins</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<span class="n">test</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span><span class="s2">&quot;Testing...&quot;</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="n">bad</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span><span class="s2">&quot;Testing...&quot;</span><span class="p">,</span> <span class="s2">&quot;with plugin&quot;</span><span class="p">)</span>  <span class="c1"># Error: list[str] expected</span>
</pre></div>
</div>
<p>Mypy will detect special methods (such as <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__lt__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__lt__</span></code></a>) depending on the flags used to
define dataclasses. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">OrderedPoint</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>

<span class="nd">@dataclass</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">UnorderedPoint</span><span class="p">:</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">OrderedPoint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">OrderedPoint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># OK</span>
<span class="n">UnorderedPoint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">UnorderedPoint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># Error: Unsupported operand types</span>
</pre></div>
</div>
<p>Dataclasses can be generic and can be used in any other way a normal
class can be used:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">BoxedData</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">T</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">def</span> <span class="nf">unbox</span><span class="p">(</span><span class="n">bd</span><span class="p">:</span> <span class="n">BoxedData</span><span class="p">[</span><span class="n">T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
    <span class="o">...</span>

<span class="n">val</span> <span class="o">=</span> <span class="n">unbox</span><span class="p">(</span><span class="n">BoxedData</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="s2">&quot;&lt;important&gt;&quot;</span><span class="p">))</span>  <span class="c1"># OK, inferred type is int</span>
</pre></div>
</div>
<p>For more information see <a class="reference external" href="https://docs.python.org/3/library/dataclasses.html" title="(in Python v3.11)"><span class="xref std std-doc">official docs</span></a>
and <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0557/"><strong>PEP 557</strong></a>.</p>
<section id="caveats-known-issues">
<h5>Caveats/Known Issues<a class="headerlink" href="#caveats-known-issues" title="Permalink to this headline">#</a></h5>
<p>Some functions in the <a class="reference external" href="https://docs.python.org/3/library/dataclasses.html#module-dataclasses" title="(in Python v3.11)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">dataclasses</span></code></a> module, such as <a class="reference external" href="https://docs.python.org/3/library/dataclasses.html#dataclasses.replace" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">replace()</span></code></a> and <a class="reference external" href="https://docs.python.org/3/library/dataclasses.html#dataclasses.asdict" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">asdict()</span></code></a>,
have imprecise (too permissive) types. This will be fixed in future releases.</p>
<p>Mypy does not yet recognize aliases of <a class="reference external" href="https://docs.python.org/3/library/dataclasses.html#dataclasses.dataclass" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">dataclasses.dataclass</span></code></a>, and will
probably never recognize dynamically computed decorators. The following examples
do <strong>not</strong> work:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="n">dataclass_alias</span> <span class="o">=</span> <span class="n">dataclass</span>
<span class="k">def</span> <span class="nf">dataclass_wrapper</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">dataclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

<span class="nd">@dataclass_alias</span>
<span class="k">class</span> <span class="nc">AliasDecorated</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Mypy doesn&#39;t recognize this as a dataclass because it is decorated by an</span>
<span class="sd">  alias of `dataclass` rather than by `dataclass` itself.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">attribute</span><span class="p">:</span> <span class="nb">int</span>

<span class="nd">@dataclass_wrapper</span>
<span class="k">class</span> <span class="nc">DynamicallyDecorated</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Mypy doesn&#39;t recognize this as a dataclass because it is decorated by a</span>
<span class="sd">  function returning `dataclass` rather than by `dataclass` itself.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">attribute</span><span class="p">:</span> <span class="nb">int</span>

<span class="n">AliasDecorated</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># error: Unexpected keyword argument</span>
<span class="n">DynamicallyDecorated</span><span class="p">(</span><span class="n">attribute</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># error: Unexpected keyword argument</span>
</pre></div>
</div>
</section>
</section>
<section id="the-attrs-package">
<span id="attrs-package"></span><h4>The attrs package<a class="headerlink" href="#the-attrs-package" title="Permalink to this headline">#</a></h4>
<p><a class="reference external" href="https://www.attrs.org/en/stable/index.html" title="(in attrs v23.1)"><span class="xref std std-doc">attrs</span></a> is a package that lets you define
classes without writing boilerplate code. Mypy can detect uses of the
package and will generate the necessary method definitions for decorated
classes using the type annotations it finds.
Type annotations can be added as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">attr</span>

<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">one</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">two</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">three</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
<p>If you’re using <code class="docutils literal notranslate"><span class="pre">auto_attribs=False</span></code> you must use <code class="docutils literal notranslate"><span class="pre">attrs.field</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">attrs</span>

<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">one</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">()</span>          <span class="c1"># Variable annotation (Python 3.6+)</span>
    <span class="n">two</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">()</span>  <span class="c1"># type: int  # Type comment</span>
    <span class="n">three</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>     <span class="c1"># type= argument</span>
</pre></div>
</div>
<p>Typeshed has a couple of “white lie” annotations to make type checking
easier. <a class="reference external" href="https://www.attrs.org/en/stable/api.html#attrs.field" title="(in attrs v23.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">attrs.field()</span></code></a> and <a class="reference external" href="https://www.attrs.org/en/stable/api.html#attrs.Factory" title="(in attrs v23.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">attrs.Factory</span></code></a> actually return objects, but the
annotation says these return the types that they expect to be assigned to.
That enables this to work:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">attrs</span>

<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="n">one</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">two</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">Factory</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">bad</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>   <span class="c1"># Error: can&#39;t assign int to str</span>
</pre></div>
</div>
<section id="id1">
<h5>Caveats/Known Issues<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h5>
<ul>
<li><p>The detection of attr classes and attributes works by function name only.
This means that if you have your own helper functions that, for example,
<code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">attrs.field()</span></code> mypy will not see them.</p></li>
<li><p>All boolean arguments that mypy cares about must be literal <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>.
e.g the following will not work:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">attrs</span>
<span class="n">YES</span> <span class="o">=</span> <span class="kc">True</span>
<span class="nd">@attrs</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="n">YES</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
<li><p>Currently, <code class="docutils literal notranslate"><span class="pre">converter</span></code> only supports named functions.  If mypy finds something else it
will complain about not understanding the argument and the type annotation in
<a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__init__" title="(in Python v3.11)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__init__</span></code></a> will be replaced by <code class="docutils literal notranslate"><span class="pre">Any</span></code>.</p></li>
<li><p><a class="reference external" href="https://www.attrs.org/en/stable/examples.html#examples-validators" title="(in attrs v23.1)"><span class="xref std std-ref">Validator decorators</span></a>
and <a class="reference external" href="https://www.attrs.org/en/stable/examples.html#defaults">default decorators</a>
are not type-checked against the attribute they are setting/validating.</p></li>
<li><p>Method definitions added by mypy currently overwrite any existing method
definitions.</p></li>
</ul>
</section>
</section>
<section id="using-a-remote-cache-to-speed-up-mypy-runs">
<span id="remote-cache"></span><h4>Using a remote cache to speed up mypy runs<a class="headerlink" href="#using-a-remote-cache-to-speed-up-mypy-runs" title="Permalink to this headline">#</a></h4>
<p>Mypy performs type checking <em>incrementally</em>, reusing results from
previous runs to speed up successive runs. If you are type checking a
large codebase, mypy can still be sometimes slower than desirable. For
example, if you create a new branch based on a much more recent commit
than the target of the previous mypy run, mypy may have to
process almost every file, as a large fraction of source files may
have changed. This can also happen after you’ve rebased a local
branch.</p>
<p>Mypy supports using a <em>remote cache</em> to improve performance in cases
such as the above.  In a large codebase, remote caching can sometimes
speed up mypy runs by a factor of 10, or more.</p>
<p>Mypy doesn’t include all components needed to set
this up – generally you will have to perform some simple integration
with your Continuous Integration (CI) or build system to configure
mypy to use a remote cache. This discussion assumes you have a CI
system set up for the mypy build you want to speed up, and that you
are using a central git repository. Generalizing to different
environments should not be difficult.</p>
<p>Here are the main components needed:</p>
<ul class="simple">
<li><p>A shared repository for storing mypy cache files for all landed commits.</p></li>
<li><p>CI build that uploads mypy incremental cache files to the shared repository for
each commit for which the CI build runs.</p></li>
<li><p>A wrapper script around mypy that developers use to run mypy with remote
caching enabled.</p></li>
</ul>
<p>Below we discuss each of these components in some detail.</p>
<section id="shared-repository-for-cache-files">
<h5>Shared repository for cache files<a class="headerlink" href="#shared-repository-for-cache-files" title="Permalink to this headline">#</a></h5>
<p>You need a repository that allows you to upload mypy cache files from
your CI build and make the cache files available for download based on
a commit id.  A simple approach would be to produce an archive of the
<code class="docutils literal notranslate"><span class="pre">.mypy_cache</span></code> directory (which contains the mypy cache data) as a
downloadable <em>build artifact</em> from your CI build (depending on the
capabilities of your CI system).  Alternatively, you could upload the
data to a web server or to S3, for example.</p>
</section>
<section id="continuous-integration-build">
<h5>Continuous Integration build<a class="headerlink" href="#continuous-integration-build" title="Permalink to this headline">#</a></h5>
<p>The CI build would run a regular mypy build and create an archive containing
the <code class="docutils literal notranslate"><span class="pre">.mypy_cache</span></code> directory produced by the build. Finally, it will produce
the cache as a build artifact or upload it to a repository where it is
accessible by the mypy wrapper script.</p>
<p>Your CI script might work like this:</p>
<ul class="simple">
<li><p>Run mypy normally. This will generate cache data under the
<code class="docutils literal notranslate"><span class="pre">.mypy_cache</span></code> directory.</p></li>
<li><p>Create a tarball from the <code class="docutils literal notranslate"><span class="pre">.mypy_cache</span></code> directory.</p></li>
<li><p>Determine the current git master branch commit id (say, using
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rev-parse</span> <span class="pre">HEAD</span></code>).</p></li>
<li><p>Upload the tarball to the shared repository with a name derived from the
commit id.</p></li>
</ul>
</section>
<section id="mypy-wrapper-script">
<h5>Mypy wrapper script<a class="headerlink" href="#mypy-wrapper-script" title="Permalink to this headline">#</a></h5>
<p>The wrapper script is used by developers to run mypy locally during
development instead of invoking mypy directly.  The wrapper first
populates the local <code class="docutils literal notranslate"><span class="pre">.mypy_cache</span></code> directory from the shared
repository and then runs a normal incremental build.</p>
<p>The wrapper script needs some logic to determine the most recent
central repository commit (by convention, the <code class="docutils literal notranslate"><span class="pre">origin/master</span></code> branch
for git) the local development branch is based on. In a typical git
setup you can do it like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">merge</span><span class="o">-</span><span class="n">base</span> <span class="n">HEAD</span> <span class="n">origin</span><span class="o">/</span><span class="n">master</span>
</pre></div>
</div>
<p>The next step is to download the cache data (contents of the
<code class="docutils literal notranslate"><span class="pre">.mypy_cache</span></code> directory) from the shared repository based on the
commit id of the merge base produced by the git command above. The
script will decompress the data so that mypy will start with a fresh
<code class="docutils literal notranslate"><span class="pre">.mypy_cache</span></code>. Finally, the script runs mypy normally. And that’s all!</p>
</section>
<section id="caching-with-mypy-daemon">
<h5>Caching with mypy daemon<a class="headerlink" href="#caching-with-mypy-daemon" title="Permalink to this headline">#</a></h5>
<p>You can also use remote caching with the <a class="reference internal" href="index.html#mypy-daemon"><span class="std std-ref">mypy daemon</span></a>.
The remote cache will significantly speed up the first <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">check</span></code>
run after starting or restarting the daemon.</p>
<p>The mypy daemon requires extra fine-grained dependency data in
the cache files which aren’t included by default. To use caching with
the mypy daemon, use the <a class="reference internal" href="index.html#cmdoption-mypy-cache-fine-grained"><code class="xref std std-option docutils literal notranslate"><span class="pre">--cache-fine-grained</span></code></a> option in your CI
build:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mypy --cache-fine-grained &lt;args...&gt;
</pre></div>
</div>
<p>This flag adds extra information for the daemon to the cache. In
order to use this extra information, you will also need to use the
<code class="docutils literal notranslate"><span class="pre">--use-fine-grained-cache</span></code> option with <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">start</span></code> or
<code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">restart</span></code>. Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dmypy start -- --use-fine-grained-cache &lt;options...&gt;
</pre></div>
</div>
<p>Now your first <code class="docutils literal notranslate"><span class="pre">dmypy</span> <span class="pre">check</span></code> run should be much faster, as it can use
cache information to avoid processing the whole program.</p>
</section>
<section id="refinements">
<h5>Refinements<a class="headerlink" href="#refinements" title="Permalink to this headline">#</a></h5>
<p>There are several optional refinements that may improve things further,
at least if your codebase is hundreds of thousands of lines or more:</p>
<ul class="simple">
<li><p>If the wrapper script determines that the merge base hasn’t changed
from a previous run, there’s no need to download the cache data and
it’s better to instead reuse the existing local cache data.</p></li>
<li><p>If you use the mypy daemon, you may want to restart the daemon each time
after the merge base or local branch has changed to avoid processing a
potentially large number of changes in an incremental build, as this can
be much slower than downloading cache data and restarting the daemon.</p></li>
<li><p>If the current local branch is based on a very recent master commit,
the remote cache data may not yet be available for that commit, as
there will necessarily be some latency to build the cache files. It
may be a good idea to look for cache data for, say, the 5 latest
master commits and use the most recent data that is available.</p></li>
<li><p>If the remote cache is not accessible for some reason (say, from a public
network), the script can still fall back to a normal incremental build.</p></li>
<li><p>You can have multiple local cache directories for different local branches
using the <a class="reference internal" href="index.html#cmdoption-mypy-cache-dir"><code class="xref std std-option docutils literal notranslate"><span class="pre">--cache-dir</span></code></a> option. If the user switches to an existing
branch where downloaded cache data is already available, you can continue
to use the existing cache data instead of redownloading the data.</p></li>
<li><p>You can set up your CI build to use a remote cache to speed up the
CI build. This would be particularly useful if each CI build starts
from a fresh state without access to cache files from previous
builds. It’s still recommended to run a full, non-incremental
mypy build to create the cache data, as repeatedly updating cache
data incrementally could result in drift over a long time period (due
to a mypy caching issue, perhaps).</p></li>
</ul>
</section>
</section>
<section id="extended-callable-types">
<span id="extended-callable"></span><h4>Extended Callable types<a class="headerlink" href="#extended-callable-types" title="Permalink to this headline">#</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature is deprecated.  You can use
<a class="reference internal" href="index.html#callback-protocols"><span class="std std-ref">callback protocols</span></a> as a replacement.</p>
</div>
<p>As an experimental mypy extension, you can specify <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a> types
that support keyword arguments, optional arguments, and more.  When
you specify the arguments of a <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a>, you can choose to supply just
the type of a nameless positional argument, or an “argument specifier”
representing a more complicated form of argument.  This allows one to
more closely emulate the full range of possibilities given by the
<code class="docutils literal notranslate"><span class="pre">def</span></code> statement in Python.</p>
<p>As an example, here’s a complicated function definition and the
corresponding <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span>
<span class="kn">from</span> <span class="nn">mypy_extensions</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Arg</span><span class="p">,</span> <span class="n">DefaultArg</span><span class="p">,</span> <span class="n">NamedArg</span><span class="p">,</span>
                             <span class="n">DefaultNamedArg</span><span class="p">,</span> <span class="n">VarArg</span><span class="p">,</span> <span class="n">KwArg</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">__a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>  <span class="c1"># This convention is for nameless arguments</span>
         <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
         <span class="n">c</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
         <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
         <span class="n">d</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
         <span class="n">e</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
         <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="o">...</span>

<span class="n">F</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span>  <span class="c1"># Or Arg(int)</span>
              <span class="n">Arg</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span>
              <span class="n">DefaultArg</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span>
              <span class="n">VarArg</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span>
              <span class="n">NamedArg</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">),</span>
              <span class="n">DefaultNamedArg</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">),</span>
              <span class="n">KwArg</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span>
             <span class="nb">int</span><span class="p">]</span>

<span class="n">f</span><span class="p">:</span> <span class="n">F</span> <span class="o">=</span> <span class="n">func</span>
</pre></div>
</div>
<p>Argument specifiers are special function calls that can specify the
following aspects of an argument:</p>
<ul class="simple">
<li><p>its type (the only thing that the basic format supports)</p></li>
<li><p>its name (if it has one)</p></li>
<li><p>whether it may be omitted</p></li>
<li><p>whether it may or must be passed using a keyword</p></li>
<li><p>whether it is a <code class="docutils literal notranslate"><span class="pre">*args</span></code> argument (representing the remaining
positional arguments)</p></li>
<li><p>whether it is a <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> argument (representing the remaining
keyword arguments)</p></li>
</ul>
<p>The following functions are available in <code class="docutils literal notranslate"><span class="pre">mypy_extensions</span></code> for this
purpose:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Arg</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Any</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># A normal, mandatory, positional argument.</span>
    <span class="c1"># If the name is specified it may be passed as a keyword.</span>

<span class="k">def</span> <span class="nf">DefaultArg</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Any</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># An optional positional argument (i.e. with a default value).</span>
    <span class="c1"># If the name is specified it may be passed as a keyword.</span>

<span class="k">def</span> <span class="nf">NamedArg</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Any</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># A mandatory keyword-only argument.</span>

<span class="k">def</span> <span class="nf">DefaultNamedArg</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Any</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># An optional keyword-only argument (i.e. with a default value).</span>

<span class="k">def</span> <span class="nf">VarArg</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Any</span><span class="p">):</span>
    <span class="c1"># A *args-style variadic positional argument.</span>
    <span class="c1"># A single VarArg() specifier represents all remaining</span>
    <span class="c1"># positional arguments.</span>

<span class="k">def</span> <span class="nf">KwArg</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">Any</span><span class="p">):</span>
    <span class="c1"># A **kwargs-style variadic keyword argument.</span>
    <span class="c1"># A single KwArg() specifier represents all remaining</span>
    <span class="c1"># keyword arguments.</span>
</pre></div>
</div>
<p>In all cases, the <code class="docutils literal notranslate"><span class="pre">type</span></code> argument defaults to <code class="docutils literal notranslate"><span class="pre">Any</span></code>, and if the
<code class="docutils literal notranslate"><span class="pre">name</span></code> argument is omitted the argument has no name (the name is
required for <code class="docutils literal notranslate"><span class="pre">NamedArg</span></code> and <code class="docutils literal notranslate"><span class="pre">DefaultNamedArg</span></code>).  A basic
<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a> such as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MyFunc</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span>
</pre></div>
</div>
<p>is equivalent to the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MyFunc</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Arg</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">Arg</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">Arg</span><span class="p">(</span><span class="nb">int</span><span class="p">)],</span> <span class="nb">float</span><span class="p">]</span>
</pre></div>
</div>
<p>A <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Callable" title="(in Python v3.11)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Callable</span></code></a> with unspecified argument types, such as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MyOtherFunc</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</pre></div>
</div>
<p>is (roughly) equivalent to</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MyOtherFunc</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">VarArg</span><span class="p">(),</span> <span class="n">KwArg</span><span class="p">()],</span> <span class="nb">int</span><span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each of the functions above currently just returns its <code class="docutils literal notranslate"><span class="pre">type</span></code>
argument at runtime, so the information contained in the argument
specifiers is not available at runtime.  This limitation is
necessary for backwards compatibility with the existing
<code class="docutils literal notranslate"><span class="pre">typing.py</span></code> module as present in the Python 3.5+ standard library
and distributed via PyPI.</p>
</div>
</section>
</section>
<span id="document-faq"></span><section id="frequently-asked-questions">
<h3>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">#</a></h3>
<section id="why-have-both-dynamic-and-static-typing">
<h4>Why have both dynamic and static typing?<a class="headerlink" href="#why-have-both-dynamic-and-static-typing" title="Permalink to this headline">#</a></h4>
<p>Dynamic typing can be flexible, powerful, convenient and easy. But
it’s not always the best approach; there are good reasons why many
developers choose to use statically typed languages or static typing
for Python.</p>
<p>Here are some potential benefits of mypy-style static typing:</p>
<ul class="simple">
<li><p>Static typing can make programs easier to understand and
maintain. Type declarations can serve as machine-checked
documentation. This is important as code is typically read much more
often than modified, and this is especially important for large and
complex programs.</p></li>
<li><p>Static typing can help you find bugs earlier and with less testing
and debugging. Especially in large and complex projects this can be
a major time-saver.</p></li>
<li><p>Static typing can help you find difficult-to-find bugs before your
code goes into production. This can improve reliability and reduce
the number of security issues.</p></li>
<li><p>Static typing makes it practical to build very useful development
tools that can improve programming productivity or software quality,
including IDEs with precise and reliable code completion, static
analysis tools, etc.</p></li>
<li><p>You can get the benefits of both dynamic and static typing in a
single language. Dynamic typing can be perfect for a small project
or for writing the UI of your program, for example. As your program
grows, you can adapt tricky application logic to static typing to
help maintenance.</p></li>
</ul>
<p>See also the <a class="reference external" href="https://www.mypy-lang.org">front page</a> of the mypy web
site.</p>
</section>
<section id="would-my-project-benefit-from-static-typing">
<h4>Would my project benefit from static typing?<a class="headerlink" href="#would-my-project-benefit-from-static-typing" title="Permalink to this headline">#</a></h4>
<p>For many projects dynamic typing is perfectly fine (we think that
Python is a great language). But sometimes your projects demand bigger
guns, and that’s when mypy may come in handy.</p>
<p>If some of these ring true for your projects, mypy (and static typing)
may be useful:</p>
<ul class="simple">
<li><p>Your project is large or complex.</p></li>
<li><p>Your codebase must be maintained for a long time.</p></li>
<li><p>Multiple developers are working on the same code.</p></li>
<li><p>Running tests takes a lot of time or work (type checking helps
you find errors quickly early in development, reducing the number of
testing iterations).</p></li>
<li><p>Some project members (devs or management) don’t like dynamic typing,
but others prefer dynamic typing and Python syntax. Mypy could be a
solution that everybody finds easy to accept.</p></li>
<li><p>You want to future-proof your project even if currently none of the
above really apply. The earlier you start, the easier it will be to
adopt static typing.</p></li>
</ul>
</section>
<section id="can-i-use-mypy-to-type-check-my-existing-python-code">
<h4>Can I use mypy to type check my existing Python code?<a class="headerlink" href="#can-i-use-mypy-to-type-check-my-existing-python-code" title="Permalink to this headline">#</a></h4>
<p>Mypy supports most Python features and idioms, and many large Python
projects are using mypy successfully. Code that uses complex
introspection or metaprogramming may be impractical to type check, but
it should still be possible to use static typing in other parts of a
codebase that are less dynamic.</p>
</section>
<section id="will-static-typing-make-my-programs-run-faster">
<h4>Will static typing make my programs run faster?<a class="headerlink" href="#will-static-typing-make-my-programs-run-faster" title="Permalink to this headline">#</a></h4>
<p>Mypy only does static type checking and it does not improve
performance. It has a minimal performance impact. In the future, there
could be other tools that can compile statically typed mypy code to C
modules or to efficient JVM bytecode, for example, but this is outside
the scope of the mypy project.</p>
</section>
<section id="is-mypy-free">
<h4>Is mypy free?<a class="headerlink" href="#is-mypy-free" title="Permalink to this headline">#</a></h4>
<p>Yes. Mypy is free software, and it can also be used for commercial and
proprietary projects. Mypy is available under the MIT license.</p>
</section>
<section id="can-i-use-duck-typing-with-mypy">
<h4>Can I use duck typing with mypy?<a class="headerlink" href="#can-i-use-duck-typing-with-mypy" title="Permalink to this headline">#</a></h4>
<p>Mypy provides support for both <a class="reference external" href="https://en.wikipedia.org/wiki/Nominative_type_system">nominal subtyping</a> and
<a class="reference external" href="https://en.wikipedia.org/wiki/Structural_type_system">structural subtyping</a>.
Structural subtyping can be thought of as “static duck typing”.
Some argue that structural subtyping is better suited for languages with duck
typing such as Python. Mypy however primarily uses nominal subtyping,
leaving structural subtyping mostly opt-in (except for built-in protocols
such as <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Iterable" title="(in Python v3.11)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code></a> that always support structural subtyping). Here are some
reasons why:</p>
<ol class="arabic simple">
<li><p>It is easy to generate short and informative error messages when
using a nominal type system. This is especially important when
using type inference.</p></li>
<li><p>Python provides built-in support for nominal <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> tests and
they are widely used in programs. Only limited support for structural
<a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.11)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> is available, and it’s less type safe than nominal type tests.</p></li>
<li><p>Many programmers are already familiar with static, nominal subtyping and it
has been successfully used in languages such as Java, C++ and
C#. Fewer languages use structural subtyping.</p></li>
</ol>
<p>However, structural subtyping can also be useful. For example, a “public API”
may be more flexible if it is typed with protocols. Also, using protocol types
removes the necessity to explicitly declare implementations of ABCs.
As a rule of thumb, we recommend using nominal classes where possible, and
protocols where necessary. For more details about protocol types and structural
subtyping see <a class="reference internal" href="index.html#protocol-types"><span class="std std-ref">Protocols and structural subtyping</span></a> and <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0544/"><strong>PEP 544</strong></a>.</p>
</section>
<section id="i-like-python-and-i-have-no-need-for-static-typing">
<h4>I like Python and I have no need for static typing<a class="headerlink" href="#i-like-python-and-i-have-no-need-for-static-typing" title="Permalink to this headline">#</a></h4>
<p>The aim of mypy is not to convince everybody to write statically typed
Python – static typing is entirely optional, now and in the
future. The goal is to give more options for Python programmers, to
make Python a more competitive alternative to other statically typed
languages in large projects, to improve programmer productivity, and
to improve software quality.</p>
</section>
<section id="how-are-mypy-programs-different-from-normal-python">
<h4>How are mypy programs different from normal Python?<a class="headerlink" href="#how-are-mypy-programs-different-from-normal-python" title="Permalink to this headline">#</a></h4>
<p>Since you use a vanilla Python implementation to run mypy programs,
mypy programs are also Python programs. The type checker may give
warnings for some valid Python code, but the code is still always
runnable. Also, some Python features and syntax are still not
supported by mypy, but this is gradually improving.</p>
<p>The obvious difference is the availability of static type
checking. The section <a class="reference internal" href="index.html#common-issues"><span class="std std-ref">Common issues and solutions</span></a> mentions some
modifications to Python code that may be required to make code type
check without errors. Also, your code must make attributes explicit.</p>
<p>Mypy supports modular, efficient type checking, and this seems to
rule out type checking some language features, such as arbitrary
monkey patching of methods.</p>
</section>
<section id="how-is-mypy-different-from-cython">
<h4>How is mypy different from Cython?<a class="headerlink" href="#how-is-mypy-different-from-cython" title="Permalink to this headline">#</a></h4>
<p><a class="reference external" href="https://docs.cython.org/en/latest/index.html" title="(in Cython v3.0)"><span class="xref std std-doc">Cython</span></a> is a variant of Python that supports
compilation to CPython C modules. It can give major speedups to
certain classes of programs compared to CPython, and it provides
static typing (though this is different from mypy). Mypy differs in
the following aspects, among others:</p>
<ul class="simple">
<li><p>Cython is much more focused on performance than mypy. Mypy is only
about static type checking, and increasing performance is not a
direct goal.</p></li>
<li><p>The mypy syntax is arguably simpler and more “Pythonic” (no cdef/cpdef, etc.) for statically typed code.</p></li>
<li><p>The mypy syntax is compatible with Python. Mypy programs are normal
Python programs that can be run using any Python
implementation. Cython has many incompatible extensions to Python
syntax, and Cython programs generally cannot be run without first
compiling them to CPython extension modules via C. Cython also has a
pure Python mode, but it seems to support only a subset of Cython
functionality, and the syntax is quite verbose.</p></li>
<li><p>Mypy has a different set of type system features. For example, mypy
has genericity (parametric polymorphism), function types and
bidirectional type inference, which are not supported by
Cython. (Cython has fused types that are different but related to
mypy generics. Mypy also has a similar feature as an extension of
generics.)</p></li>
<li><p>The mypy type checker knows about the static types of many Python
stdlib modules and can effectively type check code that uses them.</p></li>
<li><p>Cython supports accessing C functions directly and many features are
defined in terms of translating them to C or C++. Mypy just uses
Python semantics, and mypy does not deal with accessing C library
functionality.</p></li>
</ul>
</section>
<section id="does-it-run-on-pypy">
<h4>Does it run on PyPy?<a class="headerlink" href="#does-it-run-on-pypy" title="Permalink to this headline">#</a></h4>
<p>Somewhat. With PyPy 3.8, mypy is at least able to type check itself.
With older versions of PyPy, mypy relies on <a class="reference external" href="https://github.com/python/typed_ast">typed-ast</a>, which uses several APIs that
PyPy does not support (including some internal CPython APIs).</p>
</section>
<section id="mypy-is-a-cool-project-can-i-help">
<h4>Mypy is a cool project. Can I help?<a class="headerlink" href="#mypy-is-a-cool-project-can-i-help" title="Permalink to this headline">#</a></h4>
<p>Any help is much appreciated! <a class="reference external" href="https://www.mypy-lang.org/contact.html">Contact</a> the developers if you would
like to contribute. Any help related to development, design,
publicity, documentation, testing, web site maintenance, financing,
etc. can be helpful. You can learn a lot by contributing, and anybody
can help, even beginners! However, some knowledge of compilers and/or
type systems is essential if you want to work on mypy internals.</p>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
</div>
</section>
</section>
<section id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2012-2022 Jukka Lehtosalo and mypy contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link" href="https://readthedocs.org/projects/mypy" aria-label="On Read the Docs">
                <svg x="0px" y="0px" viewBox="-125 217 360 360" xml:space="preserve">
                  <path fill="currentColor" d="M39.2,391.3c-4.2,0.6-7.1,4.4-6.5,8.5c0.4,3,2.6,5.5,5.5,6.3 c0,0,18.5,6.1,50,8.7c25.3,2.1,54-1.8,54-1.8c4.2-0.1,7.5-3.6,7.4-7.8c-0.1-4.2-3.6-7.5-7.8-7.4c-0.5,0-1,0.1-1.5,0.2 c0,0-28.1,3.5-50.9,1.6c-30.1-2.4-46.5-7.9-46.5-7.9C41.7,391.3,40.4,391.1,39.2,391.3z M39.2,353.6c-4.2,0.6-7.1,4.4-6.5,8.5 c0.4,3,2.6,5.5,5.5,6.3c0,0,18.5,6.1,50,8.7c25.3,2.1,54-1.8,54-1.8c4.2-0.1,7.5-3.6,7.4-7.8c-0.1-4.2-3.6-7.5-7.8-7.4 c-0.5,0-1,0.1-1.5,0.2c0,0-28.1,3.5-50.9,1.6c-30.1-2.4-46.5-7.9-46.5-7.9C41.7,353.6,40.4,353.4,39.2,353.6z M39.2,315.9 c-4.2,0.6-7.1,4.4-6.5,8.5c0.4,3,2.6,5.5,5.5,6.3c0,0,18.5,6.1,50,8.7c25.3,2.1,54-1.8,54-1.8c4.2-0.1,7.5-3.6,7.4-7.8 c-0.1-4.2-3.6-7.5-7.8-7.4c-0.5,0-1,0.1-1.5,0.2c0,0-28.1,3.5-50.9,1.6c-30.1-2.4-46.5-7.9-46.5-7.9 C41.7,315.9,40.4,315.8,39.2,315.9z M39.2,278.3c-4.2,0.6-7.1,4.4-6.5,8.5c0.4,3,2.6,5.5,5.5,6.3c0,0,18.5,6.1,50,8.7 c25.3,2.1,54-1.8,54-1.8c4.2-0.1,7.5-3.6,7.4-7.8c-0.1-4.2-3.6-7.5-7.8-7.4c-0.5,0-1,0.1-1.5,0.2c0,0-28.1,3.5-50.9,1.6 c-30.1-2.4-46.5-7.9-46.5-7.9C41.7,278.2,40.4,278.1,39.2,278.3z M-13.6,238.5c-39.6,0.3-54.3,12.5-54.3,12.5v295.7 c0,0,14.4-12.4,60.8-10.5s55.9,18.2,112.9,19.3s71.3-8.8,71.3-8.8l0.8-301.4c0,0-25.6,7.3-75.6,7.7c-49.9,0.4-61.9-12.7-107.7-14.2 C-8.2,238.6-10.9,238.5-13.6,238.5z M19.5,257.8c0,0,24,7.9,68.3,10.1c37.5,1.9,75-3.7,75-3.7v267.9c0,0-19,10-66.5,6.6 C59.5,536.1,19,522.1,19,522.1L19.5,257.8z M-3.6,264.8c4.2,0,7.7,3.4,7.7,7.7c0,4.2-3.4,7.7-7.7,7.7c0,0-12.4,0.1-20,0.8 c-12.7,1.3-21.4,5.9-21.4,5.9c-3.7,2-8.4,0.5-10.3-3.2c-2-3.7-0.5-8.4,3.2-10.3c0,0,0,0,0,0c0,0,11.3-6,27-7.5 C-16,264.9-3.6,264.8-3.6,264.8z M-11,302.6c4.2-0.1,7.4,0,7.4,0c4.2,0.5,7.2,4.3,6.7,8.5c-0.4,3.5-3.2,6.3-6.7,6.7 c0,0-12.4,0.1-20,0.8c-12.7,1.3-21.4,5.9-21.4,5.9c-3.7,2-8.4,0.5-10.3-3.2c-2-3.7-0.5-8.4,3.2-10.3c0,0,11.3-6,27-7.5 C-20.5,302.9-15.2,302.7-11,302.6z M-3.6,340.2c4.2,0,7.7,3.4,7.7,7.7s-3.4,7.7-7.7,7.7c0,0-12.4-0.1-20,0.7 c-12.7,1.3-21.4,5.9-21.4,5.9c-3.7,2-8.4,0.5-10.3-3.2c-2-3.7-0.5-8.4,3.2-10.3c0,0,11.3-6,27-7.5C-16,340.1-3.6,340.2-3.6,340.2z" />
                </svg>
              </a><a class="muted-link" href="https://github.com/python/mypy" aria-label="On GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
              </a>
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <p class="caption" role="heading"><span class="caption-text">First steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-getting_started">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#installing-and-running-mypy">Installing and running mypy</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#dynamic-vs-static-typing">Dynamic vs static typing</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#strict-mode-and-configuration">Strict mode and configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#more-complex-types">More complex types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#local-type-inference">Local type inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#types-from-libraries">Types from libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#next-steps">Next steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cheat_sheet_py3">Type hints cheat sheet</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#variables">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#useful-built-in-types">Useful built-in types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#functions">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#classes">Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#when-you-re-puzzled-or-when-things-are-complicated">When you’re puzzled or when things are complicated</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#standard-duck-types">Standard “duck types”</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#forward-references">Forward references</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#decorators">Decorators</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#coroutines-and-asyncio">Coroutines and asyncio</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-existing_code">Using mypy with an existing codebase</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#start-small">Start small</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#run-mypy-consistently-and-prevent-regressions">Run mypy consistently and prevent regressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#ignoring-errors-from-certain-modules">Ignoring errors from certain modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#fixing-errors-related-to-imports">Fixing errors related to imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#prioritise-annotating-widely-imported-modules">Prioritise annotating widely imported modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#write-annotations-as-you-go">Write annotations as you go</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#automate-annotation-of-legacy-code">Automate annotation of legacy code</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#introduce-stricter-options">Introduce stricter options</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#speed-up-mypy-runs">Speed up mypy runs</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Type system reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-builtin_types">Built-in types</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#simple-types">Simple types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#any-type">Any type</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#generic-types">Generic types</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-type_inference_and_annotations">Type inference and type annotations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#type-inference">Type inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#explicit-types-for-variables">Explicit types for variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#explicit-types-for-collections">Explicit types for collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#compatibility-of-container-types">Compatibility of container types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#context-in-type-inference">Context in type inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#silencing-type-errors">Silencing type errors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-kinds_of_types">Kinds of types</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#class-types">Class types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-any-type">The Any type</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tuple-types">Tuple types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#callable-types-and-lambdas">Callable types (and lambdas)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#union-types">Union types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#optional-types-and-the-none-type">Optional types and the None type</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#disabling-strict-optional-checking">Disabling strict optional checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#type-aliases">Type aliases</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#named-tuples">Named tuples</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-type-of-class-objects">The type of class objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#generators">Generators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-class_basics">Class basics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#instance-and-class-attributes">Instance and class attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#annotating-init-methods">Annotating __init__ methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#class-attribute-annotations">Class attribute annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#overriding-statically-typed-methods">Overriding statically typed methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#abstract-base-classes-and-multiple-inheritance">Abstract base classes and multiple inheritance</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#slots">Slots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-runtime_troubles">Annotation issues at runtime</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#string-literal-types-and-type-comments">String literal types and type comments</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#future-annotations-import-pep-563">Future annotations import (PEP 563)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#typing-type-checking">typing.TYPE_CHECKING</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#class-name-forward-references">Class name forward references</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#import-cycles">Import cycles</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-classes-that-are-generic-in-stubs-but-not-at-runtime">Using classes that are generic in stubs but not at runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-types-defined-in-stubs-but-not-at-runtime">Using types defined in stubs but not at runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-generic-builtins">Using generic builtins</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-x-y-syntax-for-unions">Using X | Y syntax for Unions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-new-additions-to-the-typing-module">Using new additions to the typing module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-protocols">Protocols and structural subtyping</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#predefined-protocols">Predefined protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#simple-user-defined-protocols">Simple user-defined protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#defining-subprotocols-and-subclassing-protocols">Defining subprotocols and subclassing protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#invariance-of-protocol-attributes">Invariance of protocol attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#recursive-protocols">Recursive protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-isinstance-with-protocols">Using isinstance() with protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#callback-protocols">Callback protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#predefined-protocol-reference">Predefined protocol reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-dynamic_typing">Dynamically typed code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#operations-on-any-values">Operations on Any values</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#any-vs-object">Any vs. object</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-type_narrowing">Type narrowing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#type-narrowing-expressions">Type narrowing expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#casts">Casts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#user-defined-type-guards">User-Defined Type Guards</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-duck_type_compatibility">Duck type compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-stubs">Stub files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#creating-a-stub">Creating a stub</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#stub-file-syntax">Stub file syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-stub-file-syntax-at-runtime">Using stub file syntax at runtime</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-generics">Generics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#defining-generic-classes">Defining generic classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#defining-subclasses-of-generic-classes">Defining subclasses of generic classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#generic-functions">Generic functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#generic-methods-and-generic-self">Generic methods and generic self</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#automatic-self-types-using-typing-self">Automatic self types using typing.Self</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#variance-of-generic-types">Variance of generic types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#type-variables-with-upper-bounds">Type variables with upper bounds</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#type-variables-with-value-restriction">Type variables with value restriction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#declaring-decorators">Declaring decorators</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#generic-protocols">Generic protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#generic-type-aliases">Generic type aliases</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#generic-class-internals">Generic class internals</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-more_types">More types</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-noreturn-type">The NoReturn type</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#newtypes">NewTypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#function-overloading">Function overloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#advanced-uses-of-self-types">Advanced uses of self-types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#typing-async-await">Typing async/await</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-literal_types">Literal types and Enums</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#literal-types">Literal types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#enums">Enums</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-typed_dict">TypedDict</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#totality">Totality</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#supported-operations">Supported operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#class-based-syntax">Class-based syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#mixing-required-and-non-required-items">Mixing required and non-required items</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#unions-of-typeddicts">Unions of TypedDicts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-final_attrs">Final names, methods and classes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#final-names">Final names</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#final-methods">Final methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#final-classes">Final classes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-metaclasses">Metaclasses</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#defining-a-metaclass">Defining a metaclass</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#metaclass-usage-example">Metaclass usage example</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#gotchas-and-limitations-of-metaclass-support">Gotchas and limitations of metaclass support</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configuring and running mypy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-running_mypy">Running mypy and managing imports</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#specifying-code-to-be-checked">Specifying code to be checked</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#reading-a-list-of-files-from-a-file">Reading a list of files from a file</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#mapping-file-paths-to-modules">Mapping file paths to modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-mypy-handles-imports">How mypy handles imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#missing-imports">Missing imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-imports-are-found">How imports are found</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#following-imports">Following imports</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-command_line">The mypy command line</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#specifying-what-to-type-check">Specifying what to type check</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#optional-arguments">Optional arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#config-file">Config file</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#import-discovery">Import discovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#platform-configuration">Platform configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#disallow-dynamic-typing">Disallow dynamic typing</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#untyped-definitions-and-calls">Untyped definitions and calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#none-and-optional-handling">None and Optional handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuring-warnings">Configuring warnings</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#miscellaneous-strictness-flags">Miscellaneous strictness flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuring-error-messages">Configuring error messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#incremental-mode">Incremental mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#advanced-options">Advanced options</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#report-generation">Report generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-config_file">The mypy configuration file</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#config-file-format">Config file format</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#per-module-and-global-options">Per-module and global options</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#inverting-option-values">Inverting option values</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#example-mypy-ini">Example <code class="docutils literal notranslate"><span class="pre">mypy.ini</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#import-discovery">Import discovery</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#platform-configuration">Platform configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#disallow-dynamic-typing">Disallow dynamic typing</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#untyped-definitions-and-calls">Untyped definitions and calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#none-and-optional-handling">None and Optional handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuring-warnings">Configuring warnings</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#suppressing-errors">Suppressing errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#miscellaneous-strictness-flags">Miscellaneous strictness flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuring-error-messages">Configuring error messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#incremental-mode">Incremental mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#advanced-options">Advanced options</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#report-generation">Report generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#miscellaneous">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-a-pyproject-toml-file">Using a pyproject.toml file</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#example-pyproject-toml">Example <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-inline_config">Inline configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuration-comment-format">Configuration comment format</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-mypy_daemon">Mypy daemon (mypy server)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#basic-usage">Basic usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#daemon-client-commands">Daemon client commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#additional-daemon-flags">Additional daemon flags</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#static-inference-of-annotations">Static inference of annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#statically-inspect-expressions">Statically inspect expressions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-installed_packages">Using installed packages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-installed-packages-with-mypy-pep-561">Using installed packages with mypy (PEP 561)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#creating-pep-561-compatible-packages">Creating PEP 561 compatible packages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-extending_mypy">Extending and integrating mypy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#integrating-mypy-into-another-python-application">Integrating mypy into another Python application</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#extending-mypy-using-plugins">Extending mypy using plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#configuring-mypy-to-use-plugins">Configuring mypy to use plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#high-level-overview">High-level overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#current-list-of-plugin-hooks">Current list of plugin hooks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-stubgen">Automatic stub generation (stubgen)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#specifying-what-to-stub">Specifying what to stub</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#specifying-how-to-generate-stubs">Specifying how to generate stubs</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#additional-flags">Additional flags</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-stubtest">Automatic stub testing (stubtest)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#what-stubtest-does-and-does-not-do">What stubtest does and does not do</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#usage">Usage</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-common_issues">Common issues and solutions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#no-errors-reported-for-obviously-wrong-code">No errors reported for obviously wrong code</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#spurious-errors-and-locally-silencing-the-checker">Spurious errors and locally silencing the checker</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#ignoring-a-whole-file">Ignoring a whole file</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#issues-with-code-at-runtime">Issues with code at runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#mypy-runs-are-slow">Mypy runs are slow</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#types-of-empty-collections">Types of empty collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#redefinitions-with-incompatible-types">Redefinitions with incompatible types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#invariance-vs-covariance">Invariance vs covariance</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#declaring-a-supertype-as-variable-type">Declaring a supertype as variable type</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#complex-type-tests">Complex type tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#python-version-and-system-platform-checks">Python version and system platform checks</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#displaying-the-type-of-an-expression">Displaying the type of an expression</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#silencing-linters">Silencing linters</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#covariant-subtyping-of-mutable-protocol-members-is-rejected">Covariant subtyping of mutable protocol members is rejected</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#dealing-with-conflicting-names">Dealing with conflicting names</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-a-development-mypy-build">Using a development mypy build</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#variables-vs-type-aliases">Variables vs type aliases</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#incompatible-overrides">Incompatible overrides</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#unreachable-code">Unreachable code</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#narrowing-and-inner-functions">Narrowing and inner functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-supported_python_features">Supported Python features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#runtime-definition-of-methods-and-functions">Runtime definition of methods and functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-error_codes">Error codes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#displaying-error-codes">Displaying error codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#silencing-errors-based-on-error-codes">Silencing errors based on error codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#enabling-disabling-specific-error-codes-globally">Enabling/disabling specific error codes globally</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#per-module-enabling-disabling-error-codes">Per-module enabling/disabling error codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#subcodes-of-error-codes">Subcodes of error codes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-error_code_list">Error codes enabled by default</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-attribute-exists-attr-defined">Check that attribute exists [attr-defined]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-attribute-exists-in-each-union-item-union-attr">Check that attribute exists in each union item [union-attr]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-name-is-defined-name-defined">Check that name is defined [name-defined]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-a-variable-is-not-used-before-it-s-defined-used-before-def">Check that a variable is not used before it’s defined [used-before-def]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-arguments-in-calls-call-arg">Check arguments in calls [call-arg]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-argument-types-arg-type">Check argument types [arg-type]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-calls-to-overloaded-functions-call-overload">Check calls to overloaded functions [call-overload]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-validity-of-types-valid-type">Check validity of types [valid-type]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#require-annotation-if-variable-type-is-unclear-var-annotated">Require annotation if variable type is unclear [var-annotated]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-validity-of-overrides-override">Check validity of overrides [override]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-function-returns-a-value-return">Check that function returns a value [return]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-functions-don-t-have-empty-bodies-outside-stubs-empty-body">Check that functions don’t have empty bodies outside stubs [empty-body]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-return-value-is-compatible-return-value">Check that return value is compatible [return-value]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-types-in-assignment-statement-assignment">Check types in assignment statement [assignment]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-assignment-target-is-not-a-method-method-assign">Check that assignment target is not a method [method-assign]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-type-variable-values-type-var">Check type variable values [type-var]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-uses-of-various-operators-operator">Check uses of various operators [operator]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-indexing-operations-index">Check indexing operations [index]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-list-items-list-item">Check list items [list-item]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-dict-items-dict-item">Check dict items [dict-item]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-typeddict-items-typeddict-item">Check TypedDict items [typeddict-item]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-typeddict-keys-typeddict-unknown-key">Check TypedDict Keys [typeddict-unknown-key]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-type-of-target-is-known-has-type">Check that type of target is known [has-type]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-for-an-issue-with-imports-import">Check for an issue with imports [import]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-import-target-can-be-found-import-not-found">Check that import target can be found [import-not-found]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-import-target-can-be-found-import-untyped">Check that import target can be found [import-untyped]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-each-name-is-defined-once-no-redef">Check that each name is defined once [no-redef]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-called-function-returns-a-value-func-returns-value">Check that called function returns a value [func-returns-value]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-instantiation-of-abstract-classes-abstract">Check instantiation of abstract classes [abstract]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#safe-handling-of-abstract-type-object-types-type-abstract">Safe handling of abstract type object types [type-abstract]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-call-to-an-abstract-method-via-super-is-valid-safe-super">Check that call to an abstract method via super is valid [safe-super]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-the-target-of-newtype-valid-newtype">Check the target of NewType [valid-newtype]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-the-return-type-of-exit-exit-return">Check the return type of __exit__ [exit-return]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-naming-is-consistent-name-match">Check that naming is consistent [name-match]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-literal-is-used-where-expected-literal-required">Check that literal is used where expected [literal-required]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-overloaded-functions-have-an-implementation-no-overload-impl">Check that overloaded functions have an implementation [no-overload-impl]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-coroutine-return-value-is-used-unused-coroutine">Check that coroutine return value is used [unused-coroutine]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#warn-about-top-level-await-expressions-top-level-await">Warn about top level await expressions [top-level-await]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#warn-about-await-expressions-used-outside-of-coroutines-await-not-async">Warn about await expressions used outside of coroutines [await-not-async]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-types-in-assert-type-assert-type">Check types in assert_type [assert-type]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-function-isn-t-used-in-boolean-context-truthy-function">Check that function isn’t used in boolean context [truthy-function]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-string-formatting-interpolation-is-type-safe-str-format">Check that string formatting/interpolation is type-safe [str-format]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-for-implicit-bytes-coercions-str-bytes-safe">Check for implicit bytes coercions [str-bytes-safe]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#notify-about-an-annotation-in-an-unchecked-function-annotation-unchecked">Notify about an annotation in an unchecked function [annotation-unchecked]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#report-syntax-errors-syntax">Report syntax errors [syntax]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#miscellaneous-checks-misc">Miscellaneous checks [misc]</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-error_code_list2">Error codes for optional checks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-type-arguments-exist-type-arg">Check that type arguments exist [type-arg]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-every-function-has-an-annotation-no-untyped-def">Check that every function has an annotation [no-untyped-def]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-cast-is-not-redundant-redundant-cast">Check that cast is not redundant [redundant-cast]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-methods-do-not-have-redundant-self-annotations-redundant-self">Check that methods do not have redundant Self annotations [redundant-self]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-comparisons-are-overlapping-comparison-overlap">Check that comparisons are overlapping [comparison-overlap]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-no-untyped-functions-are-called-no-untyped-call">Check that no untyped functions are called [no-untyped-call]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-function-does-not-return-any-value-no-any-return">Check that function does not return Any value [no-any-return]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-types-have-no-any-components-due-to-missing-imports-no-any-unimported">Check that types have no Any components due to missing imports [no-any-unimported]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-statement-or-expression-is-unreachable-unreachable">Check that statement or expression is unreachable [unreachable]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-expression-is-redundant-redundant-expr">Check that expression is redundant [redundant-expr]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#warn-about-variables-that-are-defined-only-in-some-execution-paths-possibly-undefined">Warn about variables that are defined only in some execution paths [possibly-undefined]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-expression-is-not-implicitly-true-in-boolean-context-truthy-bool">Check that expression is not implicitly true in boolean context [truthy-bool]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-iterable-is-not-implicitly-true-in-boolean-context-truthy-iterable">Check that iterable is not implicitly true in boolean context [truthy-iterable]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-type-ignore-include-an-error-code-ignore-without-code">Check that <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> include an error code [ignore-without-code]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-awaitable-return-value-is-used-unused-awaitable">Check that awaitable return value is used [unused-awaitable]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-type-ignore-comment-is-used-unused-ignore">Check that <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">type:</span> <span class="pre">ignore</span></code> comment is used [unused-ignore]</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#check-that-override-is-used-when-overriding-a-base-class-method-explicit-override">Check that <code class="docutils literal notranslate"><span class="pre">&#64;override</span></code> is used when overriding a base class method [explicit-override]</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-additional_features">Additional features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#dataclasses">Dataclasses</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-attrs-package">The attrs package</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-a-remote-cache-to-speed-up-mypy-runs">Using a remote cache to speed up mypy runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#extended-callable-types">Extended Callable types</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-faq">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#why-have-both-dynamic-and-static-typing">Why have both dynamic and static typing?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#would-my-project-benefit-from-static-typing">Would my project benefit from static typing?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#can-i-use-mypy-to-type-check-my-existing-python-code">Can I use mypy to type check my existing Python code?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#will-static-typing-make-my-programs-run-faster">Will static typing make my programs run faster?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#is-mypy-free">Is mypy free?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#can-i-use-duck-typing-with-mypy">Can I use duck typing with mypy?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#i-like-python-and-i-have-no-need-for-static-typing">I like Python and I have no need for static typing</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-are-mypy-programs-different-from-normal-python">How are mypy programs different from normal Python?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-is-mypy-different-from-cython">How is mypy different from Cython?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#does-it-run-on-pypy">Does it run on PyPy?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#mypy-is-a-cool-project-can-i-help">Mypy is a cool project. Can I help?</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/python/mypy">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://mypy-lang.org/">Website</a></li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>